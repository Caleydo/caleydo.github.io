/*! Caleydo - v0.0.1 - 2016-01-22
* Copyright (c) 2016 Caleydo Team; Licensed SEE LICENSE IN LICENSE */

!function(a){function b(a){return"css"===a||"text"===a}var c={load:function(a,b){b(null)}};if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a(function(a){return b(a)?c:require(a)})(1);else if("function"==typeof define&&define.amd){var d=["bootstrap","d3","es6-promise","font-awesome","html2canvas","jquery","jquery-ui","lineupjs","marked"];define(d,function(){var e=arguments;return a(function(a){return b(a)?c:e[d.indexOf(a)]})(1)})}else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Caleydo=a(function(a){return b(a)?c:e[a]})(1)}}(function(require){var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=[];Object.defineProperty(c,"core",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{"2D":{enumerable:!0,get:function(){return a("./caleydo_core/2D")}},ajax:{enumerable:!0,get:function(){return a("./caleydo_core/ajax")}},behavior:{enumerable:!0,get:function(){return a("./caleydo_core/behavior")}},data:{enumerable:!0,get:function(){return a("./caleydo_core/data")}},datatype:{enumerable:!0,get:function(){return a("./caleydo_core/datatype")}},event:{enumerable:!0,get:function(){return a("./caleydo_core/event")}},geom:{enumerable:!0,get:function(){return a("./caleydo_core/geom")}},idtype:{enumerable:!0,get:function(){return a("./caleydo_core/idtype")}},iterator:{enumerable:!0,get:function(){return a("./caleydo_core/iterator")}},layout:{enumerable:!0,get:function(){return a("./caleydo_core/layout")}},layout_view:{enumerable:!0,get:function(){return a("./caleydo_core/layout_view")}},main:{enumerable:!0,get:function(){return a("./caleydo_core/main")}},mapper:{enumerable:!0,get:function(){return a("./caleydo_core/mapper")}},math:{enumerable:!0,get:function(){return a("./caleydo_core/math")}},matrix:{enumerable:!0,get:function(){return a("./caleydo_core/matrix")}},matrix_impl:{enumerable:!0,get:function(){return a("./caleydo_core/matrix_impl")}},multiform:{enumerable:!0,get:function(){return a("./caleydo_core/multiform")}},plugin:{enumerable:!0,get:function(){return a("./caleydo_core/plugin")}},range:{enumerable:!0,get:function(){return a("./caleydo_core/range")}},session:{enumerable:!0,get:function(){return a("./caleydo_core/session")}},stratification:{enumerable:!0,get:function(){return a("./caleydo_core/stratification")}},stratification_impl:{enumerable:!0,get:function(){return a("./caleydo_core/stratification_impl")}},table:{enumerable:!0,get:function(){return a("./caleydo_core/table")}},table_impl:{enumerable:!0,get:function(){return a("./caleydo_core/table_impl")}},vector:{enumerable:!0,get:function(){return a("./caleydo_core/vector")}},vector_impl:{enumerable:!0,get:function(){return a("./caleydo_core/vector_impl")}},vis:{enumerable:!0,get:function(){return a("./caleydo_core/vis")}},wrapper:{enumerable:!0,get:function(){return a("./caleydo_core/wrapper")}}}),b}}),d.push.apply(d,[{folder:"caleydo_core",id:"matrix",version:"0.0.1-alpha",name:"caleydo_core",type:"datatype",file:"matrix_impl",loader:function(){return a("./caleydo_core/matrix_impl")}},{folder:"caleydo_core",id:"table",version:"0.0.1-alpha",name:"caleydo_core",type:"datatype",file:"table_impl",loader:function(){return a("./caleydo_core/table_impl")}},{folder:"caleydo_core",id:"vector",version:"0.0.1-alpha",name:"caleydo_core",type:"datatype",file:"vector_impl",loader:function(){return a("./caleydo_core/vector_impl")}},{folder:"caleydo_core",id:"stratification",version:"0.0.1-alpha",name:"caleydo_core",type:"datatype",file:"stratification_impl",loader:function(){return a("./caleydo_core/stratification_impl")}}]),Object.defineProperty(c,"caleydo_core",{enumerable:!0,get:function(){return c.core}}),Object.defineProperty(c,"security_flask",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{login:{enumerable:!0,get:function(){return a("./caleydo_security_flask/login")}}}),b}}),d.push.apply(d,[]),Object.defineProperty(c,"caleydo_security_flask",{enumerable:!0,get:function(){return c.security_flask}}),Object.defineProperty(c,"d3",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{ajax_adapter_d3:{enumerable:!0,get:function(){return a("./caleydo_d3/ajax_adapter_d3")}},d3util:{enumerable:!0,get:function(){return a("./caleydo_d3/d3util")}},databrowser:{enumerable:!0,get:function(){return a("./caleydo_d3/databrowser")}},layout_d3util:{enumerable:!0,get:function(){return a("./caleydo_d3/layout_d3util")}},parser:{enumerable:!0,get:function(){return a("./caleydo_d3/parser")}},selectioninfo:{enumerable:!0,get:function(){return a("./caleydo_d3/selectioninfo")}}}),b}}),d.push.apply(d,[{folder:"caleydo_d3",id:"caleydo_adapter_d3",version:"0.0.1",name:"caleydo_d3",type:"ajax-adapter",file:"ajax_adapter_d3",loader:function(){return a("./caleydo_d3/ajax_adapter_d3")}}]),Object.defineProperty(c,"caleydo_d3",{enumerable:!0,get:function(){return c.d3}}),Object.defineProperty(c,"tooltip",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{main:{enumerable:!0,get:function(){return a("./caleydo_tooltip/main")}}}),b}}),d.push.apply(d,[]),Object.defineProperty(c,"caleydo_tooltip",{enumerable:!0,get:function(){return c.tooltip}}),Object.defineProperty(c,"graph",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{main:{enumerable:!0,get:function(){return a("./caleydo_graph/main")}}}),b}}),d.push.apply(d,[{folder:"caleydo_graph",id:"graph",version:"0.0.1",name:"caleydo_graph",type:"datatype",file:"main",loader:function(){return a("./caleydo_graph/main")}}]),Object.defineProperty(c,"caleydo_graph",{enumerable:!0,get:function(){return c.graph}}),Object.defineProperty(c,"vis_graph",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{main:{enumerable:!0,get:function(){return a("./caleydo_vis_graph/main")}}}),b}}),d.push.apply(d,[{folder:"caleydo_vis_graph",id:"caleydo_vis_graph",version:"0.0.1",name:"Force Directed Graph",type:"vis",filter:"graph",icon:"icon.svg",sizeDependsOnDataDimension:[!1,!1],loader:function(){return a("./caleydo_vis_graph/main")}}]),Object.defineProperty(c,"caleydo_vis_graph",{enumerable:!0,get:function(){return c.vis_graph}}),Object.defineProperty(c,"links",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{link:{enumerable:!0,get:function(){return a("./caleydo_links/link")}},link_representation:{enumerable:!0,get:function(){return a("./caleydo_links/link_representation")}},main:{enumerable:!0,get:function(){return a("./caleydo_links/main")}}}),b}}),d.push.apply(d,[{folder:"caleydo_links",id:"caleydo_links",version:"0.0.1",name:"caleydo_links",type:"autoload",loader:function(){return a("./caleydo_links/main")}},{folder:"caleydo_links",id:"link-block",version:"0.0.1",name:"Block Link Representation",type:"link-representation",file:"link_representation",factory:"createBlockRep",granularity:0,loader:function(){return a("./caleydo_links/link_representation")}},{folder:"caleydo_links",id:"link-group",version:"0.0.1",name:"Group Link Representation",type:"link-representation",file:"link_representation",factory:"createGroupRep",granularity:5,loader:function(){return a("./caleydo_links/link_representation")}},{folder:"caleydo_links",id:"link-item",version:"0.0.1",name:"Item Link Representation",type:"link-representation",file:"link_representation",factory:"createItemRep",granularity:10,loader:function(){return a("./caleydo_links/link_representation")}}]),Object.defineProperty(c,"caleydo_links",{enumerable:!0,get:function(){return c.links}}),Object.defineProperty(c,"screenshot",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{main:{enumerable:!0,get:function(){return a("./caleydo_screenshot/main")}}}),b}}),d.push.apply(d,[{folder:"caleydo_screenshot",id:"screenshot",version:"0.0.1",name:"caleydo_screenshot",type:"manager",singleton:!0,file:"main",loader:function(){return a("./caleydo_screenshot/main")}}]),Object.defineProperty(c,"caleydo_screenshot",{enumerable:!0,get:function(){return c.screenshot}}),Object.defineProperty(c,"provenance",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{main:{enumerable:!0,get:function(){return a("./caleydo_provenance/main")}},mode:{enumerable:!0,get:function(){return a("./caleydo_provenance/mode")}},multiform:{enumerable:!0,get:function(){return a("./caleydo_provenance/multiform")}},player:{enumerable:!0,get:function(){return a("./caleydo_provenance/player")}},selection:{enumerable:!0,get:function(){return a("./caleydo_provenance/selection")}}}),b}}),d.push.apply(d,[{folder:"caleydo_provenance",id:"idtype-selection",version:"0.0.1",name:"caleydo_provenance",type:"actionFactory",file:"selection",factory:"createCmd",creates:"select",loader:function(){return a("./caleydo_provenance/selection")}},{folder:"caleydo_provenance",id:"idtype-selection",version:"0.0.1",name:"caleydo_provenance",type:"actionCompressor",file:"selection",factory:"compressSelection",loader:function(){return a("./caleydo_provenance/selection")}},{folder:"caleydo_provenance",id:"multiform",version:"0.0.1",name:"caleydo_provenance",type:"actionFactory",file:"multiform",factory:"createCmd",creates:"(transform|changeVis|setOption)",loader:function(){return a("./caleydo_provenance/multiform")}}]),Object.defineProperty(c,"caleydo_provenance",{enumerable:!0,get:function(){return c.provenance}}),Object.defineProperty(c,"window",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{main:{enumerable:!0,get:function(){return a("./caleydo_window/main")}}}),b}}),d.push.apply(d,[{folder:"caleydo_window",id:"caleydo_window",version:"0.0.1",name:"caleydo_window",type:"_marker",__notes:"just a marker plugin",loader:function(){return a("./caleydo_window/main")}}]),Object.defineProperty(c,"caleydo_window",{enumerable:!0,get:function(){return c.window}}),Object.defineProperty(c,"vis_lineup",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{main:{enumerable:!0,get:function(){return a("./caleydo_vis_lineup/main")}}}),b}}),d.push.apply(d,[{folder:"caleydo_vis_lineup",id:"caleydo-vis-lineup",version:"0.0.1",name:"LineUp",type:"vis",sizeDependsOnDataDimension:[!1,!0],filter:"table",loader:function(){return a("./caleydo_vis_lineup/main")}}]),Object.defineProperty(c,"caleydo_vis_lineup",{enumerable:!0,get:function(){return c.vis_lineup}}),Object.defineProperty(c,"vis",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{axis:{enumerable:!0,get:function(){return a("./caleydo_vis/axis")}},barplot:{enumerable:!0,get:function(){return a("./caleydo_vis/barplot")}},box:{enumerable:!0,get:function(){return a("./caleydo_vis/box")}},distribution:{enumerable:!0,get:function(){return a("./caleydo_vis/distribution")}},heatmap:{enumerable:!0,get:function(){return a("./caleydo_vis/heatmap")}},kaplanmeier:{enumerable:!0,get:function(){return a("./caleydo_vis/kaplanmeier")}},scatterplot:{enumerable:!0,get:function(){return a("./caleydo_vis/scatterplot")}},table:{enumerable:!0,get:function(){return a("./caleydo_vis/table")}}}),b}}),d.push.apply(d,[{folder:"caleydo_vis",id:"axis",version:"0.0.1",name:"Axis",type:"vis",file:"axis",icon:"axis_icon.svg",scaling:"height-only",filter:["vector","(real|int)"],options:{tickSize:{type:"int",range:[1,null],"default":2},orient:{type:"categorical",categories:["left","right","top","bottom"],"default":"left"}},loader:function(){return a("./caleydo_vis/axis")}},{folder:"caleydo_vis",id:"barplot",version:"0.0.1",name:"Bar Plot",type:"vis",file:"barplot",icon:"barplot_icon.png",sizeDependsOnDataDimension:[!1,!0],filter:["vector","(real|int)"],loader:function(){return a("./caleydo_vis/barplot")}},{folder:"caleydo_vis",id:"table",version:"0.0.1",name:"Table",type:"vis",file:"table",filter:"(matrix|table|vector)",sizeDependsOnDataDimension:!0,loader:function(){return a("./caleydo_vis/table")}},{folder:"caleydo_vis",id:"scatterplot",version:"0.0.1",name:"ScatterPlot",type:"vis",file:"scatterplot",filter:"matrix",loader:function(){return a("./caleydo_vis/scatterplot")}},{folder:"caleydo_vis",id:"caleydo-vis-heatmap",version:"0.0.1",name:"HeatMap",type:"vis",file:"heatmap",icon:"heatmap_icon.svg",sizeDependsOnDataDimension:!0,filter:"matrix",loader:function(){return a("./caleydo_vis/heatmap")}},{folder:"caleydo_vis",id:"caleydo-vis-heatmap1d",version:"0.0.1",name:"HeatMap 1D",type:"vis",file:"heatmap",icon:"heatmap_icon.svg",sizeDependsOnDataDimension:[!1,!0],scaling:"height-only",filter:"vector",loader:function(){return a("./caleydo_vis/heatmap")}},{folder:"caleydo_vis",id:"caleydo-vis-kaplanmeier",version:"0.0.1",name:"Kaplanmeier Plot",type:"vis",file:"kaplanmeier",icon:"kaplanmeier_icon.svg",sizeDependsOnDataDimension:[!1,!1],scaling:"aspect",filter:["vector","int"],loader:function(){return a("./caleydo_vis/kaplanmeier")}},{folder:"caleydo_vis",id:"caleydo-vis-histogram",version:"0.0.1",name:"Histogram",type:"vis",file:"distribution",icon:"distribution_histogram_icon.png",filter:["(vector|matrix|stratification)","(categorical|real|int)"],loader:function(){return a("./caleydo_vis/distribution")}},{folder:"caleydo_vis",id:"caleydo-vis-mosaic",version:"0.0.1",name:"Mosaic",type:"vis",file:"distribution",factory:"createMosaic",icon:"distribution_mosaic_icon.png",sizeDependsOnDataDimension:[!1,!0],scaling:"height-only",filter:["(vector|stratification)","categorical"],loader:function(){return a("./caleydo_vis/distribution")}},{folder:"caleydo_vis",id:"caleydo-vis-pie",version:"0.0.1",name:"Pie",type:"vis",file:"distribution",factory:"createPie",icon:"distribution_pie_icon.png",scaling:"aspect",filter:["(vector|stratification)","categorical"],loader:function(){return a("./caleydo_vis/distribution")}},{folder:"caleydo_vis",id:"caleydo-vis-box",version:"0.0.1",name:"BoxPlot",type:"vis",file:"box",icon:"box_icon.png",scaling:"aspect",filter:["vector","(real|int)"],loader:function(){return a("./caleydo_vis/box")}}]),Object.defineProperty(c,"caleydo_vis",{enumerable:!0,get:function(){return c.vis}}),Object.defineProperty(c,"clue",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{annotation:{enumerable:!0,get:function(){return a("./clue/annotation")}},provvis2:{enumerable:!0,get:function(){return a("./clue/provvis2")}},storyvis2:{enumerable:!0,get:function(){return a("./clue/storyvis2")}},template:{enumerable:!0,get:function(){return a("./clue/template")}},utils:{enumerable:!0,get:function(){return a("./clue/utils")}}}),b}}),d.push.apply(d,[]),Object.defineProperty(c,"wrapper_bootstrap_fontawesome",{enumerable:!0,get:function(){var b={};return Object.defineProperties(b,{ajax_adapter_jquery:{enumerable:!0,get:function(){return a("./wrapper_bootstrap_fontawesome/ajax_adapter_jquery")}},dialogs:{enumerable:!0,get:function(){return a("./wrapper_bootstrap_fontawesome/dialogs")}},header:{enumerable:!0,get:function(){return a("./wrapper_bootstrap_fontawesome/header")}}}),b}}),d.push.apply(d,[{folder:"wrapper_bootstrap_fontawesome",id:"caleydo_adapter_jquery",version:"0.0.1",name:"wrapper_bootstrap_fontawesome",type:"ajax-adapter",file:"ajax_adapter_jquery",loader:function(){return a("./wrapper_bootstrap_fontawesome/ajax_adapter_jquery")}}]);var e="";document.currentScript?e=document.currentScript.dataset.context||"":(e=document.querySelector("script[data-context]"),e=e?e.dataset.context:""),c.core.main._init({apiUrl:"/api",registry:{baseUrl:e+"",relativeUrl:"..",extensions:d}})},{"./caleydo_core/2D":2,"./caleydo_core/ajax":3,"./caleydo_core/behavior":4,"./caleydo_core/data":5,"./caleydo_core/datatype":6,"./caleydo_core/event":7,"./caleydo_core/geom":8,"./caleydo_core/idtype":9,"./caleydo_core/iterator":10,"./caleydo_core/layout":11,"./caleydo_core/layout_view":12,"./caleydo_core/main":13,"./caleydo_core/mapper":14,"./caleydo_core/math":15,"./caleydo_core/matrix":16,"./caleydo_core/matrix_impl":17,"./caleydo_core/multiform":18,"./caleydo_core/plugin":19,"./caleydo_core/range":20,"./caleydo_core/session":21,"./caleydo_core/stratification":22,"./caleydo_core/stratification_impl":23,"./caleydo_core/table":24,"./caleydo_core/table_impl":25,"./caleydo_core/vector":26,"./caleydo_core/vector_impl":27,"./caleydo_core/vis":28,"./caleydo_core/wrapper":29,"./caleydo_d3/ajax_adapter_d3":30,"./caleydo_d3/d3util":31,"./caleydo_d3/databrowser":32,"./caleydo_d3/layout_d3util":33,"./caleydo_d3/parser":34,"./caleydo_d3/selectioninfo":35,"./caleydo_graph/main":36,"./caleydo_links/link":37,"./caleydo_links/link_representation":38,"./caleydo_links/main":39,"./caleydo_provenance/main":40,"./caleydo_provenance/mode":41,"./caleydo_provenance/multiform":42,"./caleydo_provenance/player":43,"./caleydo_provenance/selection":44,"./caleydo_screenshot/main":45,"./caleydo_security_flask/login":46,"./caleydo_tooltip/main":47,"./caleydo_vis/axis":48,"./caleydo_vis/barplot":49,"./caleydo_vis/box":50,"./caleydo_vis/distribution":51,"./caleydo_vis/heatmap":52,"./caleydo_vis/kaplanmeier":53,"./caleydo_vis/scatterplot":54,"./caleydo_vis/table":55,"./caleydo_vis_graph/main":56,"./caleydo_vis_lineup/main":57,"./caleydo_window/main":58,"./clue/annotation":59,"./clue/provvis2":60,"./clue/storyvis2":61,"./clue/template":62,"./clue/utils":63,"./wrapper_bootstrap_fontawesome/ajax_adapter_jquery":64,"./wrapper_bootstrap_fontawesome/dialogs":65,"./wrapper_bootstrap_fontawesome/header":66}],2:[function(a,b,c){!function(a,b){function c(a,b){return void 0===b&&(b=Number.NaN),"number"==typeof a?new f(a,b):new f(a.x,a.y)}var d=function(){function a(a,b){this.name=a,this.params=b}return a}(),e=function(){function a(a){void 0===a&&(a="No Intersection"),this.status=a,this.points=[]}return Object.defineProperty(a.prototype,"intersects",{get:function(){return"Intersection"===this.status},enumerable:!0,configurable:!0}),a.prototype.appendPoint=function(a){this.status="Intersection",this.points.push(a)},a.prototype.appendPoints=function(a){a.length>0&&(this.status="Intersection"),this.points.push.apply(this.points,a)},Object.defineProperty(a.prototype,"length",{get:function(){return this.points.length},enumerable:!0,configurable:!0}),a.prototype.forEach=function(a,b){this.points.forEach(a,b)},a.prototype.map=function(a,b){return this.points.map(a,b)},a.intersectShapes=function(b,c){var d,e=b.asIntersectionParams(),f=c.asIntersectionParams();if(null!=e&&null!=f)if(b instanceof i)d=a.intersectPathShape(b,c);else if(c instanceof i)d=a.intersectPathShape(c,b);else{var g,h;if(e.name<f.name?(g="intersect"+e.name+f.name,h=e.params.concat(f.params)):(g="intersect"+f.name+e.name,h=f.params.concat(e.params)),"function"!=typeof a[g])throw new Error("Intersection not available: "+g);d=a[g].apply(null,h)}else d=new a;return d},a.intersectPathShape=function(a,b){return a.intersectShape(b)},a.intersectBezier2Bezier2=function(b,c,d,e,h,i){var j,k,l,m,n,o,p,q,r=1e-4,s=new a;j=c.multiply(-2),l=b.add(j.add(d)),j=b.multiply(-2),k=c.multiply(2),m=j.add(k),n=new f(b.x,b.y),j=h.multiply(-2),o=e.add(j.add(i)),j=e.multiply(-2),k=h.multiply(2),p=j.add(k),q=new f(e.x,e.y),j=l.x*m.y-m.x*l.y,k=o.x*m.y-m.x*o.y;for(var t=p.x*m.y-m.x*p.y,u=m.x*(n.y-q.y)+m.y*(-n.x+q.x),v=o.x*l.y-l.x*o.y,w=p.x*l.y-l.x*p.y,x=l.x*(n.y-q.y)+l.y*(-n.x+q.x),y=new g(-v*v,-2*v*w,j*k-w*w-2*v*x,j*t-2*w*x,j*u-x*x),z=y.getRoots(),A=0;A<z.length;A++){var B=z[A];if(B>=0&&1>=B){var C=new g(-l.x,-m.x,-n.x+q.x+B*p.x+B*B*o.x).getRoots(),D=new g(-l.y,-m.y,-n.y+q.y+B*p.y+B*B*o.y).getRoots();if(C.length>0&&D.length>0)a:for(var E=0;E<C.length;E++){var F=C[E];if(F>=0&&1>=F)for(var G=0;G<D.length;G++)if(Math.abs(F-D[G])<r){s.points.push(o.multiply(B*B).add(p.multiply(B).add(q)));break a}}}}return s},a.intersectBezier2Bezier3=function(b,c,d,e,h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v=new a;k=c.multiply(-2),o=b.add(k.add(d)),k=b.multiply(-2),l=c.multiply(2),p=k.add(l),q=new f(b.x,b.y),k=e.multiply(-1),l=h.multiply(3),m=i.multiply(-3),n=k.add(l.add(m.add(j))),r=new f(n.x,n.y),k=e.multiply(3),l=h.multiply(-6),m=i.multiply(3),n=k.add(l.add(m)),s=new f(n.x,n.y),k=e.multiply(-3),l=h.multiply(3),m=k.add(l),t=new f(m.x,m.y),u=new f(e.x,e.y);for(var w=q.x*q.x,x=q.y*q.y,y=p.x*p.x,z=p.y*p.y,A=o.x*o.x,B=o.y*o.y,C=u.x*u.x,D=u.y*u.y,E=t.x*t.x,F=t.y*t.y,G=s.x*s.x,H=s.y*s.y,I=r.x*r.x,J=r.y*r.y,K=new g(-2*o.x*o.y*r.x*r.y+A*J+B*I,-2*o.x*o.y*s.x*r.y-2*o.x*o.y*s.y*r.x+2*B*s.x*r.x+2*A*s.y*r.y,-2*o.x*t.x*o.y*r.y-2*o.x*o.y*t.y*r.x-2*o.x*o.y*s.x*s.y+2*t.x*B*r.x+B*G+A*(2*t.y*r.y+H),2*q.x*o.x*o.y*r.y+2*q.y*o.x*o.y*r.x+p.x*p.y*o.x*r.y+p.x*p.y*o.y*r.x-2*u.x*o.x*o.y*r.y-2*o.x*u.y*o.y*r.x-2*o.x*t.x*o.y*s.y-2*o.x*o.y*t.y*s.x-2*q.x*B*r.x-2*q.y*A*r.y+2*u.x*B*r.x+2*t.x*B*s.x-z*o.x*r.x-y*o.y*r.y+A*(2*u.y*r.y+2*t.y*s.y),2*q.x*o.x*o.y*s.y+2*q.y*o.x*o.y*s.x+p.x*p.y*o.x*s.y+p.x*p.y*o.y*s.x-2*u.x*o.x*o.y*s.y-2*o.x*u.y*o.y*s.x-2*o.x*t.x*o.y*t.y-2*q.x*B*s.x-2*q.y*A*s.y+2*u.x*B*s.x-z*o.x*s.x-y*o.y*s.y+E*B+A*(2*u.y*s.y+F),2*q.x*o.x*o.y*t.y+2*q.y*o.x*t.x*o.y+p.x*p.y*o.x*t.y+p.x*p.y*t.x*o.y-2*u.x*o.x*o.y*t.y-2*o.x*u.y*t.x*o.y-2*q.x*t.x*B-2*q.y*A*t.y+2*u.x*t.x*B-z*o.x*t.x-y*o.y*t.y+2*A*u.y*t.y,-2*q.x*q.y*o.x*o.y-q.x*p.x*p.y*o.y-q.y*p.x*p.y*o.x+2*q.x*o.x*u.y*o.y+2*q.y*u.x*o.x*o.y+p.x*u.x*p.y*o.y+p.x*p.y*o.x*u.y-2*u.x*o.x*u.y*o.y-2*q.x*u.x*B+q.x*z*o.x+q.y*y*o.y-2*q.y*A*u.y-u.x*z*o.x-y*u.y*o.y+w*B+x*A+C*B+A*D),L=K.getRootsInInterval(0,1),M=0;M<L.length;M++){var N=L[M],O=new g(o.x,p.x,q.x-u.x-N*t.x-N*N*s.x-N*N*N*r.x).getRoots(),P=new g(o.y,p.y,q.y-u.y-N*t.y-N*N*s.y-N*N*N*r.y).getRoots();if(O.length>0&&P.length>0){var Q=1e-4;a:for(var R=0;R<O.length;R++){var S=O[R];if(S>=0&&1>=S)for(var T=0;T<P.length;T++)if(Math.abs(S-P[T])<Q){v.points.push(r.multiply(N*N*N).add(s.multiply(N*N).add(t.multiply(N).add(u))));break a}}}}return v},a.intersectBezier2Circle=function(b,c,d,e,f){return a.intersectBezier2Ellipse(b,c,d,e,f,f)},a.intersectBezier2Ellipse=function(b,c,d,e,h,i){var j,k,l,m,n,o=new a;j=c.multiply(-2),l=b.add(j.add(d)),j=b.multiply(-2),k=c.multiply(2),m=j.add(k),n=new f(b.x,b.y);for(var p=h*h,q=i*i,r=new g(q*l.x*l.x+p*l.y*l.y,2*(q*l.x*m.x+p*l.y*m.y),q*(2*l.x*n.x+m.x*m.x)+p*(2*l.y*n.y+m.y*m.y)-2*(q*e.x*l.x+p*e.y*l.y),2*(q*m.x*(n.x-e.x)+p*m.y*(n.y-e.y)),q*(n.x*n.x+e.x*e.x)+p*(n.y*n.y+e.y*e.y)-2*(q*e.x*n.x+p*e.y*n.y)-p*q).getRoots(),s=0;s<r.length;s++){var t=r[s];t>=0&&1>=t&&o.points.push(l.multiply(t*t).add(m.multiply(t).add(n)))}return o},a.intersectBezier2Line=function(b,c,d,e,h){var i,j,k,l,m,n,o,p=e.min(h),q=e.max(h),r=new a;i=c.multiply(-2),k=b.add(i.add(d)),i=b.multiply(-2),j=c.multiply(2),l=i.add(j),m=new f(b.x,b.y),o=new f(e.y-h.y,h.x-e.x),n=e.x*h.y-h.x*e.y;for(var s=new g(o.dot(k),o.dot(l),o.dot(m)+n).getRoots(),t=0;t<s.length;t++){var u=s[t];if(u>=0&&1>=u){var v=b.lerp(c,u),w=c.lerp(d,u),x=v.lerp(w,u);e.x===h.x?p.y<=x.y&&x.y<=q.y&&r.appendPoint(x):e.y===h.y?p.x<=x.x&&x.x<=q.x&&r.appendPoint(x):x.gte(p)&&x.lte(q)&&r.appendPoint(x)}}return r},a.prototype.intersectBezier2Polygon=function(b,c,d,e){for(var f=new a,g=e.length,h=0;g>h;h++){var i=e[h],j=e[(h+1)%g],k=a.intersectBezier2Line(b,c,d,i,j);f.appendPoints(k.points)}return f},a.intersectBezier2Rectangle=function(b,c,d,e,g){var h=e.min(g),i=e.max(g),j=new f(i.x,h.y),k=new f(h.x,i.y),l=a.intersectBezier2Line(b,c,d,h,j),m=a.intersectBezier2Line(b,c,d,j,i),n=a.intersectBezier2Line(b,c,d,i,k),o=a.intersectBezier2Line(b,c,d,k,h),p=new a;return p.appendPoints(l.points),p.appendPoints(m.points),p.appendPoints(n.points),p.appendPoints(o.points),p},a.intersectBezier3Bezier3=function(b,c,d,e,h,i,j,k){var l,m,n,o,p,q,r,s,t,u,v,w,x=new a;l=b.multiply(-1),m=c.multiply(3),n=d.multiply(-3),o=l.add(m.add(n.add(e))),p=new f(o.x,o.y),l=b.multiply(3),m=c.multiply(-6),n=d.multiply(3),o=l.add(m.add(n)),q=new f(o.x,o.y),l=b.multiply(-3),m=c.multiply(3),n=l.add(m),r=new f(n.x,n.y),s=new f(b.x,b.y),l=h.multiply(-1),m=i.multiply(3),n=j.multiply(-3),o=l.add(m.add(n.add(k))),t=new f(o.x,o.y),l=h.multiply(3),m=i.multiply(-6),n=j.multiply(3),o=l.add(m.add(n)),u=new f(o.x,o.y),l=h.multiply(-3),m=i.multiply(3),n=l.add(m),v=new f(n.x,n.y),w=new f(h.x,h.y);for(var y=s.x*s.x,z=s.x*s.x*s.x,A=s.y*s.y,B=s.y*s.y*s.y,C=r.x*r.x,D=r.x*r.x*r.x,E=r.y*r.y,F=r.y*r.y*r.y,G=q.x*q.x,H=q.x*q.x*q.x,I=q.y*q.y,J=q.y*q.y*q.y,K=p.x*p.x,L=p.x*p.x*p.x,M=p.y*p.y,N=p.y*p.y*p.y,O=w.x*w.x,P=w.x*w.x*w.x,Q=w.y*w.y,R=w.y*w.y*w.y,S=v.x*v.x,T=v.x*v.x*v.x,U=v.y*v.y,V=u.x*u.x,W=u.x*u.x*u.x,X=u.y*u.y,Y=t.x*t.x,Z=t.x*t.x*t.x,$=t.y*t.y,_=t.y*t.y*t.y,aa=new g(-L*_+N*Z-3*p.x*M*Y*t.y+3*K*p.y*t.x*$,-6*p.x*u.x*M*t.x*t.y+6*K*p.y*u.y*t.x*t.y+3*u.x*N*Y-3*L*u.y*$-3*p.x*M*u.y*Y+3*K*u.x*p.y*$,-6*v.x*p.x*M*t.x*t.y-6*p.x*u.x*M*u.y*t.x+6*K*u.x*p.y*u.y*t.y+3*v.x*N*Y+3*V*N*t.x+3*v.x*K*p.y*$-3*p.x*v.y*M*Y-3*p.x*V*M*t.y+K*p.y*t.x*(6*v.y*t.y+3*X)+L*(-v.y*$-2*X*t.y-t.y*(2*v.y*t.y+X)),r.x*q.y*p.x*p.y*t.x*t.y-r.y*q.x*p.x*p.y*t.x*t.y+6*v.x*u.x*N*t.x+3*r.x*q.x*p.x*p.y*$+6*s.x*p.x*M*t.x*t.y-3*r.x*q.x*M*t.x*t.y-3*r.y*q.y*p.x*p.y*Y-6*s.y*K*p.y*t.x*t.y-6*w.x*p.x*M*t.x*t.y+3*r.y*q.y*K*t.x*t.y-2*q.x*I*p.x*t.x*t.y-6*v.x*p.x*u.x*M*t.y-6*v.x*p.x*M*u.y*t.x-6*p.x*v.y*u.x*M*t.x+6*v.x*K*p.y*u.y*t.y+2*G*q.y*p.y*t.x*t.y+W*N-3*s.x*N*Y+3*s.y*L*$+3*w.x*N*Y+J*p.x*Y-H*p.y*$-3*s.x*K*p.y*$+3*s.y*p.x*M*Y-2*r.x*q.y*K*$+r.x*q.y*M*Y-r.y*q.x*K*$+2*r.y*q.x*M*Y+3*w.x*K*p.y*$-q.x*I*p.y*Y-3*w.y*p.x*M*Y+G*q.y*p.x*$-3*p.x*V*M*u.y+K*p.y*t.x*(6*w.y*t.y+6*v.y*u.y)+K*u.x*p.y*(6*v.y*t.y+3*X)+L*(-2*v.y*u.y*t.y-w.y*$-u.y*(2*v.y*t.y+X)-t.y*(2*w.y*t.y+2*v.y*u.y)),6*r.x*q.x*p.x*p.y*u.y*t.y+r.x*q.y*p.x*u.x*p.y*t.y+r.x*q.y*p.x*p.y*u.y*t.x-r.y*q.x*p.x*u.x*p.y*t.y-r.y*q.x*p.x*p.y*u.y*t.x-6*r.y*q.y*p.x*u.x*p.y*t.x-6*s.x*u.x*N*t.x+6*w.x*u.x*N*t.x+6*s.y*L*u.y*t.y+2*J*p.x*u.x*t.x-2*H*p.y*u.y*t.y+6*s.x*p.x*u.x*M*t.y+6*s.x*p.x*M*u.y*t.x+6*s.y*p.x*u.x*M*t.x-3*r.x*q.x*u.x*M*t.y-3*r.x*q.x*M*u.y*t.x+2*r.x*q.y*u.x*M*t.x+4*r.y*q.x*u.x*M*t.x-6*s.x*K*p.y*u.y*t.y-6*s.y*K*u.x*p.y*t.y-6*s.y*K*p.y*u.y*t.x-4*r.x*q.y*K*u.y*t.y-6*w.x*p.x*u.x*M*t.y-6*w.x*p.x*M*u.y*t.x-2*r.y*q.x*K*u.y*t.y+3*r.y*q.y*K*u.x*t.y+3*r.y*q.y*K*u.y*t.x-2*q.x*I*p.x*u.x*t.y-2*q.x*I*p.x*u.y*t.x-2*q.x*I*u.x*p.y*t.x-6*w.y*p.x*u.x*M*t.x-6*v.x*p.x*v.y*M*t.x-6*v.x*p.x*u.x*M*u.y+6*w.x*K*p.y*u.y*t.y+2*G*q.y*p.x*u.y*t.y+2*G*q.y*u.x*p.y*t.y+2*G*q.y*p.y*u.y*t.x+3*v.x*V*N+3*S*N*t.x-3*p.x*v.y*V*M-3*S*p.x*M*t.y+K*u.x*p.y*(6*w.y*t.y+6*v.y*u.y)+K*p.y*t.x*(6*w.y*u.y+3*U)+v.x*K*p.y*(6*v.y*t.y+3*X)+L*(-2*w.y*u.y*t.y-t.y*(2*w.y*u.y+U)-v.y*(2*v.y*t.y+X)-u.y*(2*w.y*t.y+2*v.y*u.y)),r.x*v.x*q.y*p.x*p.y*t.y+r.x*q.y*p.x*v.y*p.y*t.x+r.x*q.y*p.x*u.x*p.y*u.y-r.y*q.x*v.x*p.x*p.y*t.y-r.y*q.x*p.x*v.y*p.y*t.x-r.y*q.x*p.x*u.x*p.y*u.y-6*r.y*v.x*q.y*p.x*p.y*t.x-6*s.x*v.x*N*t.x+6*w.x*v.x*N*t.x+2*v.x*J*p.x*t.x+6*s.x*v.x*p.x*M*t.y+6*s.x*p.x*v.y*M*t.x+6*s.x*p.x*u.x*M*u.y+6*s.y*v.x*p.x*M*t.x-3*r.x*q.x*v.x*M*t.y-3*r.x*q.x*v.y*M*t.x-3*r.x*q.x*u.x*M*u.y+2*r.x*v.x*q.y*M*t.x+4*r.y*q.x*v.x*M*t.x-6*s.y*v.x*K*p.y*t.y-6*s.y*K*v.y*p.y*t.x-6*s.y*K*u.x*p.y*u.y-6*w.x*v.x*p.x*M*t.y-6*w.x*p.x*v.y*M*t.x-6*w.x*p.x*u.x*M*u.y+3*r.y*v.x*q.y*K*t.y-3*r.y*q.y*p.x*V*p.y+3*r.y*q.y*K*v.y*t.x+3*r.y*q.y*K*u.x*u.y-2*q.x*v.x*I*p.x*t.y-2*q.x*v.x*I*p.y*t.x-2*q.x*I*p.x*v.y*t.x-2*q.x*I*p.x*u.x*u.y-6*w.y*v.x*p.x*M*t.x-6*v.x*p.x*v.y*u.x*M+6*w.y*K*v.y*p.y*t.x+2*G*v.x*q.y*p.y*t.y+2*G*q.y*v.y*p.y*t.x+2*G*q.y*u.x*p.y*u.y-3*s.x*V*N+3*w.x*V*N+3*S*u.x*N+J*p.x*V+3*s.y*p.x*V*M+r.x*q.y*V*M+2*r.y*q.x*V*M-q.x*I*V*p.y-3*w.y*p.x*V*M-3*S*p.x*M*u.y+G*q.y*p.x*(2*v.y*t.y+X)+r.x*q.x*p.x*p.y*(6*v.y*t.y+3*X)+v.x*K*p.y*(6*w.y*t.y+6*v.y*u.y)+H*p.y*(-2*v.y*t.y-X)+s.y*L*(6*v.y*t.y+3*X)+r.y*q.x*K*(-2*v.y*t.y-X)+r.x*q.y*K*(-4*v.y*t.y-2*X)+s.x*K*p.y*(-6*v.y*t.y-3*X)+K*u.x*p.y*(6*w.y*u.y+3*U)+w.x*K*p.y*(6*v.y*t.y+3*X)+L*(-2*w.y*v.y*t.y-u.y*(2*w.y*u.y+U)-w.y*(2*v.y*t.y+X)-v.y*(2*w.y*t.y+2*v.y*u.y)),-s.x*r.x*q.y*p.x*p.y*t.y+s.x*r.y*q.x*p.x*p.y*t.y+6*s.x*r.y*q.y*p.x*p.y*t.x-6*s.y*r.x*q.x*p.x*p.y*t.y-s.y*r.x*q.y*p.x*p.y*t.x+s.y*r.y*q.x*p.x*p.y*t.x+r.x*r.y*q.x*q.y*p.x*t.y-r.x*r.y*q.x*q.y*p.y*t.x+r.x*w.x*q.y*p.x*p.y*t.y+r.x*w.y*q.y*p.x*p.y*t.x+r.x*v.x*q.y*p.x*p.y*u.y+r.x*q.y*p.x*v.y*u.x*p.y-w.x*r.y*q.x*p.x*p.y*t.y-6*w.x*r.y*q.y*p.x*p.y*t.x-r.y*q.x*w.y*p.x*p.y*t.x-r.y*q.x*v.x*p.x*p.y*u.y-r.y*q.x*p.x*v.y*u.x*p.y-6*r.y*v.x*q.y*p.x*u.x*p.y-6*s.x*w.x*N*t.x-6*s.x*v.x*u.x*N-2*s.x*J*p.x*t.x+6*w.x*v.x*u.x*N+2*w.x*J*p.x*t.x+2*v.x*J*p.x*u.x+2*s.y*H*p.y*t.y-6*s.x*s.y*p.x*M*t.x+3*s.x*r.x*q.x*M*t.y-2*s.x*r.x*q.y*M*t.x-4*s.x*r.y*q.x*M*t.x+3*s.y*r.x*q.x*M*t.x+6*s.x*s.y*K*p.y*t.y+6*s.x*w.x*p.x*M*t.y-3*s.x*r.y*q.y*K*t.y+2*s.x*q.x*I*p.x*t.y+2*s.x*q.x*I*p.y*t.x+6*s.x*w.y*p.x*M*t.x+6*s.x*v.x*p.x*M*u.y+6*s.x*p.x*v.y*u.x*M+4*s.y*r.x*q.y*K*t.y+6*s.y*w.x*p.x*M*t.x+2*s.y*r.y*q.x*K*t.y-3*s.y*r.y*q.y*K*t.x+2*s.y*q.x*I*p.x*t.x+6*s.y*v.x*p.x*u.x*M-3*r.x*w.x*q.x*M*t.y+2*r.x*w.x*q.y*M*t.x+r.x*r.y*I*p.x*t.x-3*r.x*q.x*w.y*M*t.x-3*r.x*q.x*v.x*M*u.y-3*r.x*q.x*v.y*u.x*M+2*r.x*v.x*q.y*u.x*M+4*w.x*r.y*q.x*M*t.x+4*r.y*q.x*v.x*u.x*M-2*s.x*G*q.y*p.y*t.y-6*s.y*w.x*K*p.y*t.y-6*s.y*w.y*K*p.y*t.x-6*s.y*v.x*K*p.y*u.y-2*s.y*G*q.y*p.x*t.y-2*s.y*G*q.y*p.y*t.x-6*s.y*K*v.y*u.x*p.y-r.x*r.y*G*p.y*t.y-2*r.x*E*p.x*p.y*t.x+3*w.x*r.y*q.y*K*t.y-2*w.x*q.x*I*p.x*t.y-2*w.x*q.x*I*p.y*t.x-6*w.x*w.y*p.x*M*t.x-6*w.x*v.x*p.x*M*u.y-6*w.x*p.x*v.y*u.x*M+3*r.y*w.y*q.y*K*t.x+3*r.y*v.x*q.y*K*u.y+3*r.y*q.y*K*v.y*u.x-2*q.x*w.y*I*p.x*t.x-2*q.x*v.x*I*p.x*u.y-2*q.x*v.x*I*u.x*p.y-2*q.x*I*p.x*v.y*u.x-6*w.y*v.x*p.x*u.x*M-E*q.x*q.y*p.x*t.x+2*w.x*G*q.y*p.y*t.y+6*w.y*K*v.y*u.x*p.y+2*C*r.y*p.x*p.y*t.y+C*q.x*q.y*p.y*t.y+2*G*w.y*q.y*p.y*t.x+2*G*v.x*q.y*p.y*u.y+2*G*q.y*v.y*u.x*p.y+T*N+3*y*N*t.x-3*A*L*t.y+3*O*N*t.x+F*K*t.x-D*M*t.y-r.x*E*K*t.y+C*r.y*M*t.x-3*y*p.x*M*t.y+3*A*K*p.y*t.x-C*I*p.x*t.y+E*G*p.y*t.x-3*S*p.x*v.y*M-3*O*p.x*M*t.y+3*Q*K*p.y*t.x+r.x*q.x*p.x*p.y*(6*w.y*t.y+6*v.y*u.y)+H*p.y*(-2*w.y*t.y-2*v.y*u.y)+s.y*L*(6*w.y*t.y+6*v.y*u.y)+r.y*q.x*K*(-2*w.y*t.y-2*v.y*u.y)+G*q.y*p.x*(2*w.y*t.y+2*v.y*u.y)+r.x*q.y*K*(-4*w.y*t.y-4*v.y*u.y)+s.x*K*p.y*(-6*w.y*t.y-6*v.y*u.y)+w.x*K*p.y*(6*w.y*t.y+6*v.y*u.y)+v.x*K*p.y*(6*w.y*u.y+3*U)+L*(-2*w.y*v.y*u.y-Q*t.y-v.y*(2*w.y*u.y+U)-w.y*(2*w.y*t.y+2*v.y*u.y)),-s.x*r.x*q.y*p.x*p.y*u.y+s.x*r.y*q.x*p.x*p.y*u.y+6*s.x*r.y*q.y*p.x*u.x*p.y-6*s.y*r.x*q.x*p.x*p.y*u.y-s.y*r.x*q.y*p.x*u.x*p.y+s.y*r.y*q.x*p.x*u.x*p.y+r.x*r.y*q.x*q.y*p.x*u.y-r.x*r.y*q.x*q.y*u.x*p.y+r.x*w.x*q.y*p.x*p.y*u.y+r.x*w.y*q.y*p.x*u.x*p.y+r.x*v.x*q.y*p.x*v.y*p.y-w.x*r.y*q.x*p.x*p.y*u.y-6*w.x*r.y*q.y*p.x*u.x*p.y-r.y*q.x*w.y*p.x*u.x*p.y-r.y*q.x*v.x*p.x*v.y*p.y-6*s.x*w.x*u.x*N-2*s.x*J*p.x*u.x+2*w.x*J*p.x*u.x+2*s.y*H*p.y*u.y-6*s.x*s.y*p.x*u.x*M+3*s.x*r.x*q.x*M*u.y-2*s.x*r.x*q.y*u.x*M-4*s.x*r.y*q.x*u.x*M+3*s.y*r.x*q.x*u.x*M+6*s.x*s.y*K*p.y*u.y+6*s.x*w.x*p.x*M*u.y-3*s.x*r.y*q.y*K*u.y+2*s.x*q.x*I*p.x*u.y+2*s.x*q.x*I*u.x*p.y+6*s.x*w.y*p.x*u.x*M+6*s.x*v.x*p.x*v.y*M+4*s.y*r.x*q.y*K*u.y+6*s.y*w.x*p.x*u.x*M+2*s.y*r.y*q.x*K*u.y-3*s.y*r.y*q.y*K*u.x+2*s.y*q.x*I*p.x*u.x-3*r.x*w.x*q.x*M*u.y+2*r.x*w.x*q.y*u.x*M+r.x*r.y*I*p.x*u.x-3*r.x*q.x*w.y*u.x*M-3*r.x*q.x*v.x*v.y*M+4*w.x*r.y*q.x*u.x*M-2*s.x*G*q.y*p.y*u.y-6*s.y*w.x*K*p.y*u.y-6*s.y*w.y*K*u.x*p.y-6*s.y*v.x*K*v.y*p.y-2*s.y*G*q.y*p.x*u.y-2*s.y*G*q.y*u.x*p.y-r.x*r.y*G*p.y*u.y-2*r.x*E*p.x*u.x*p.y+3*w.x*r.y*q.y*K*u.y-2*w.x*q.x*I*p.x*u.y-2*w.x*q.x*I*u.x*p.y-6*w.x*w.y*p.x*u.x*M-6*w.x*v.x*p.x*v.y*M+3*r.y*w.y*q.y*K*u.x+3*r.y*v.x*q.y*K*v.y-2*q.x*w.y*I*p.x*u.x-2*q.x*v.x*I*p.x*v.y-E*q.x*q.y*p.x*u.x+2*w.x*G*q.y*p.y*u.y-3*r.y*S*q.y*p.x*p.y+6*w.y*v.x*K*v.y*p.y+2*C*r.y*p.x*p.y*u.y+C*q.x*q.y*p.y*u.y+2*G*w.y*q.y*u.x*p.y+2*G*v.x*q.y*v.y*p.y-3*s.x*S*N+3*w.x*S*N+3*y*u.x*N-3*A*L*u.y+3*O*u.x*N+S*J*p.x+F*K*u.x-D*M*u.y+3*s.y*S*p.x*M-r.x*E*K*u.y+r.x*S*q.y*M+2*r.y*q.x*S*M+C*r.y*u.x*M-q.x*S*I*p.y-3*w.y*S*p.x*M-3*y*p.x*M*u.y+3*A*K*u.x*p.y-C*I*p.x*u.y+E*G*u.x*p.y-3*O*p.x*M*u.y+3*Q*K*u.x*p.y+G*q.y*p.x*(2*w.y*u.y+U)+r.x*q.x*p.x*p.y*(6*w.y*u.y+3*U)+H*p.y*(-2*w.y*u.y-U)+s.y*L*(6*w.y*u.y+3*U)+r.y*q.x*K*(-2*w.y*u.y-U)+r.x*q.y*K*(-4*w.y*u.y-2*U)+s.x*K*p.y*(-6*w.y*u.y-3*U)+w.x*K*p.y*(6*w.y*u.y+3*U)+L*(-2*w.y*U-Q*u.y-w.y*(2*w.y*u.y+U)),-s.x*r.x*q.y*p.x*v.y*p.y+s.x*r.y*q.x*p.x*v.y*p.y+6*s.x*r.y*v.x*q.y*p.x*p.y-6*s.y*r.x*q.x*p.x*v.y*p.y-s.y*r.x*v.x*q.y*p.x*p.y+s.y*r.y*q.x*v.x*p.x*p.y-r.x*r.y*q.x*v.x*q.y*p.y+r.x*r.y*q.x*q.y*p.x*v.y+r.x*w.x*q.y*p.x*v.y*p.y+6*r.x*q.x*w.y*p.x*v.y*p.y+r.x*w.y*v.x*q.y*p.x*p.y-w.x*r.y*q.x*p.x*v.y*p.y-6*w.x*r.y*v.x*q.y*p.x*p.y-r.y*q.x*w.y*v.x*p.x*p.y-6*s.x*w.x*v.x*N-2*s.x*v.x*J*p.x+6*s.y*w.y*L*v.y+2*w.x*v.x*J*p.x+2*s.y*H*v.y*p.y-2*H*w.y*v.y*p.y-6*s.x*s.y*v.x*p.x*M+3*s.x*r.x*q.x*v.y*M-2*s.x*r.x*v.x*q.y*M-4*s.x*r.y*q.x*v.x*M+3*s.y*r.x*q.x*v.x*M+6*s.x*s.y*K*v.y*p.y+6*s.x*w.x*p.x*v.y*M-3*s.x*r.y*q.y*K*v.y+2*s.x*q.x*v.x*I*p.y+2*s.x*q.x*I*p.x*v.y+6*s.x*w.y*v.x*p.x*M+4*s.y*r.x*q.y*K*v.y+6*s.y*w.x*v.x*p.x*M+2*s.y*r.y*q.x*K*v.y-3*s.y*r.y*v.x*q.y*K+2*s.y*q.x*v.x*I*p.x-3*r.x*w.x*q.x*v.y*M+2*r.x*w.x*v.x*q.y*M+r.x*r.y*v.x*I*p.x-3*r.x*q.x*w.y*v.x*M+4*w.x*r.y*q.x*v.x*M-6*s.x*w.y*K*v.y*p.y-2*s.x*G*q.y*v.y*p.y-6*s.y*w.x*K*v.y*p.y-6*s.y*w.y*v.x*K*p.y-2*s.y*G*v.x*q.y*p.y-2*s.y*G*q.y*p.x*v.y-r.x*r.y*G*v.y*p.y-4*r.x*w.y*q.y*K*v.y-2*r.x*E*v.x*p.x*p.y+3*w.x*r.y*q.y*K*v.y-2*w.x*q.x*v.x*I*p.y-2*w.x*q.x*I*p.x*v.y-6*w.x*w.y*v.x*p.x*M-2*r.y*q.x*w.y*K*v.y+3*r.y*w.y*v.x*q.y*K-2*q.x*w.y*v.x*I*p.x-E*q.x*v.x*q.y*p.x+6*w.x*w.y*K*v.y*p.y+2*w.x*G*q.y*v.y*p.y+2*C*r.y*p.x*v.y*p.y+C*q.x*q.y*v.y*p.y+2*G*w.y*v.x*q.y*p.y+2*G*w.y*q.y*p.x*v.y+3*y*v.x*N-3*A*L*v.y+3*O*v.x*N+F*v.x*K-D*v.y*M-3*Q*L*v.y-r.x*E*K*v.y+C*r.y*v.x*M-3*y*p.x*v.y*M+3*A*v.x*K*p.y-C*I*p.x*v.y+E*G*v.x*p.y-3*O*p.x*v.y*M+3*Q*v.x*K*p.y,s.x*s.y*r.x*q.y*p.x*p.y-s.x*s.y*r.y*q.x*p.x*p.y+s.x*r.x*r.y*q.x*q.y*p.y-s.y*r.x*r.y*q.x*q.y*p.x-s.x*r.x*w.y*q.y*p.x*p.y+6*s.x*w.x*r.y*q.y*p.x*p.y+s.x*r.y*q.x*w.y*p.x*p.y-s.y*r.x*w.x*q.y*p.x*p.y-6*s.y*r.x*q.x*w.y*p.x*p.y+s.y*w.x*r.y*q.x*p.x*p.y-r.x*w.x*r.y*q.x*q.y*p.y+r.x*r.y*q.x*w.y*q.y*p.x+r.x*w.x*w.y*q.y*p.x*p.y-w.x*r.y*q.x*w.y*p.x*p.y-2*s.x*w.x*J*p.x+2*s.y*H*w.y*p.y-3*s.x*s.y*r.x*q.x*M-6*s.x*s.y*w.x*p.x*M+3*s.x*s.y*r.y*q.y*K-2*s.x*s.y*q.x*I*p.x-2*s.x*r.x*w.x*q.y*M-s.x*r.x*r.y*I*p.x+3*s.x*r.x*q.x*w.y*M-4*s.x*w.x*r.y*q.x*M+3*s.y*r.x*w.x*q.x*M+6*s.x*s.y*w.y*K*p.y+2*s.x*s.y*G*q.y*p.y+2*s.x*r.x*E*p.x*p.y+2*s.x*w.x*q.x*I*p.y+6*s.x*w.x*w.y*p.x*M-3*s.x*r.y*w.y*q.y*K+2*s.x*q.x*w.y*I*p.x+s.x*E*q.x*q.y*p.x+s.y*r.x*r.y*G*p.y+4*s.y*r.x*w.y*q.y*K-3*s.y*w.x*r.y*q.y*K+2*s.y*w.x*q.x*I*p.x+2*s.y*r.y*q.x*w.y*K+r.x*w.x*r.y*I*p.x-3*r.x*w.x*q.x*w.y*M-2*s.x*G*w.y*q.y*p.y-6*s.y*w.x*w.y*K*p.y-2*s.y*w.x*G*q.y*p.y-2*s.y*C*r.y*p.x*p.y-s.y*C*q.x*q.y*p.y-2*s.y*G*w.y*q.y*p.x-2*r.x*w.x*E*p.x*p.y-r.x*r.y*G*w.y*p.y+3*w.x*r.y*w.y*q.y*K-2*w.x*q.x*w.y*I*p.x-w.x*E*q.x*q.y*p.x+3*A*r.x*q.x*p.x*p.y+3*r.x*q.x*Q*p.x*p.y+2*w.x*G*w.y*q.y*p.y-3*y*r.y*q.y*p.x*p.y+2*C*r.y*w.y*p.x*p.y+C*q.x*w.y*q.y*p.y-3*O*r.y*q.y*p.x*p.y-z*N+B*L+P*N-R*L-3*s.x*O*N-s.x*F*K+3*y*w.x*N+s.y*D*M+3*s.y*Q*L+w.x*F*K+y*J*p.x-3*A*w.y*L-A*H*p.y+O*J*p.x-D*w.y*M-H*Q*p.y-s.x*C*r.y*M+s.y*r.x*E*K-3*s.x*A*K*p.y-s.x*E*G*p.y+s.y*C*I*p.x-r.x*E*w.y*K+3*y*s.y*p.x*M+y*r.x*q.y*M+2*y*r.y*q.x*M-2*A*r.x*q.y*K-A*r.y*q.x*K+C*w.x*r.y*M-3*s.x*Q*K*p.y+3*s.y*O*p.x*M+r.x*O*q.y*M-2*r.x*Q*q.y*K+w.x*E*G*p.y-r.y*q.x*Q*K-y*q.x*I*p.y-3*y*w.y*p.x*M+3*A*w.x*K*p.y+A*G*q.y*p.x-C*w.y*I*p.x+2*O*r.y*q.x*M+3*w.x*Q*K*p.y-O*q.x*I*p.y-3*O*w.y*p.x*M+G*Q*q.y*p.x),ba=aa.getRootsInInterval(0,1),ca=0;ca<ba.length;ca++){
var da=ba[ca],ea=new g(p.x,q.x,r.x,s.x-w.x-da*v.x-da*da*u.x-da*da*da*t.x).getRoots(),fa=new g(p.y,q.y,r.y,s.y-w.y-da*v.y-da*da*u.y-da*da*da*t.y).getRoots();if(ea.length>0&&fa.length>0){var ga=1e-4;a:for(var ha=0;ha<ea.length;ha++){var ia=ea[ha];if(ia>=0&&1>=ia)for(var ja=0;ja<fa.length;ja++)if(Math.abs(ia-fa[ja])<ga){x.points.push(t.multiply(da*da*da).add(u.multiply(da*da).add(v.multiply(da).add(w))));break a}}}}return x},a.intersectBezier3Circle=function(b,c,d,e,f,g){return a.intersectBezier3Ellipse(b,c,d,e,f,g,g)},a.intersectBezier3Ellipse=function(b,c,d,e,h,i,j){var k,l,m,n,o,p,q,r,s=new a;k=b.multiply(-1),l=c.multiply(3),m=d.multiply(-3),n=k.add(l.add(m.add(e))),o=new f(n.x,n.y),k=b.multiply(3),l=c.multiply(-6),m=d.multiply(3),n=k.add(l.add(m)),p=new f(n.x,n.y),k=b.multiply(-3),l=c.multiply(3),m=k.add(l),q=new f(m.x,m.y),r=new f(b.x,b.y);for(var t=i*i,u=j*j,v=new g(o.x*o.x*u+o.y*o.y*t,2*(o.x*p.x*u+o.y*p.y*t),2*(o.x*q.x*u+o.y*q.y*t)+p.x*p.x*u+p.y*p.y*t,2*o.x*u*(r.x-h.x)+2*o.y*t*(r.y-h.y)+2*(p.x*q.x*u+p.y*q.y*t),2*p.x*u*(r.x-h.x)+2*p.y*t*(r.y-h.y)+q.x*q.x*u+q.y*q.y*t,2*q.x*u*(r.x-h.x)+2*q.y*t*(r.y-h.y),r.x*r.x*u-2*r.y*h.y*t-2*r.x*h.x*u+r.y*r.y*t+h.x*h.x*u+h.y*h.y*t-t*u),w=v.getRootsInInterval(0,1),x=0;x<w.length;x++){var y=w[x];s.points.push(o.multiply(y*y*y).add(p.multiply(y*y).add(q.multiply(y).add(r))))}return s},a.intersectBezier3Line=function(b,c,d,e,h,i){var j,k,l,m,n,o,p,q,r,s,t=h.min(i),u=h.max(i),v=new a;j=b.multiply(-1),k=c.multiply(3),l=d.multiply(-3),m=j.add(k.add(l.add(e))),n=new f(m.x,m.y),j=b.multiply(3),k=c.multiply(-6),l=d.multiply(3),m=j.add(k.add(l)),o=new f(m.x,m.y),j=b.multiply(-3),k=c.multiply(3),l=j.add(k),p=new f(l.x,l.y),q=new f(b.x,b.y),s=new f(h.y-i.y,i.x-h.x),r=h.x*i.y-i.x*h.y;for(var w=new g(s.dot(n),s.dot(o),s.dot(p),s.dot(q)+r).getRoots(),x=0;x<w.length;x++){var y=w[x];if(y>=0&&1>=y){var z=b.lerp(c,y),A=c.lerp(d,y),B=d.lerp(e,y),C=z.lerp(A,y),D=A.lerp(B,y),E=C.lerp(D,y);h.x===i.x?t.y<=E.y&&E.y<=u.y&&v.appendPoint(E):h.y===i.y?t.x<=E.x&&E.x<=u.x&&v.appendPoint(E):E.gte(t)&&E.lte(u)&&v.appendPoint(E)}}return v},a.intersectBezier3Polygon=function(b,c,d,e,f){for(var g=new a,h=f.length,i=0;h>i;i++){var j=f[i],k=f[(i+1)%h],l=a.intersectBezier3Line(b,c,d,e,j,k);g.appendPoints(l.points)}return g},a.intersectBezier3Rectangle=function(b,c,d,e,g,h){var i=g.min(h),j=g.max(h),k=new f(j.x,i.y),l=new f(i.x,j.y),m=a.intersectBezier3Line(b,c,d,e,i,k),n=a.intersectBezier3Line(b,c,d,e,k,j),o=a.intersectBezier3Line(b,c,d,e,j,l),p=a.intersectBezier3Line(b,c,d,e,l,i),q=new a;return q.appendPoints(m.points),q.appendPoints(n.points),q.appendPoints(o.points),q.appendPoints(p.points),q},a.intersectCircleCircle=function(b,c,d,e){var g,h=c+e,i=Math.abs(c-e),j=b.distanceFrom(d);if(j>h)g=new a("Outside");else if(i>j)g=new a("Inside");else{g=new a("Intersection");var k=(c*c-e*e+j*j)/(2*j),l=Math.sqrt(c*c-k*k),m=b.lerp(d,k/j),n=l/j;g.points.push(new f(m.x-n*(d.y-b.y),m.y+n*(d.x-b.x))),g.points.push(new f(m.x+n*(d.y-b.y),m.y-n*(d.x-b.x)))}return g},a.intersectCircleEllipse=function(b,c,d,e,f){return a.intersectEllipseEllipse(b,c,c,d,e,f)},a.intersectCircleLine=function(b,c,d,e){var f,g=(e.x-d.x)*(e.x-d.x)+(e.y-d.y)*(e.y-d.y),h=2*((e.x-d.x)*(d.x-b.x)+(e.y-d.y)*(d.y-b.y)),i=b.x*b.x+b.y*b.y+d.x*d.x+d.y*d.y-2*(b.x*d.x+b.y*d.y)-c*c,j=h*h-4*g*i;if(0>j)f=new a("Outside");else if(0===j)f=new a("Tangent");else{var k=Math.sqrt(j),l=(-h+k)/(2*g),m=(-h-k)/(2*g);(0>l||l>1)&&(0>m||m>1)?f=new a(0>l&&0>m||l>1&&m>1?"Outside":"Inside"):(f=new a("Intersection"),l>=0&&1>=l&&f.points.push(d.lerp(e,l)),m>=0&&1>=m&&f.points.push(d.lerp(e,m)))}return f},a.intersectCirclePolygon=function(b,c,d){for(var e,f=new a,g=d.length,h=0;g>h;h++){var i=d[h],j=d[(h+1)%g];e=a.intersectCircleLine(b,c,i,j),f.appendPoints(e.points)}return f.points.length>0?f.status="Intersection":f.status=e.status,f},a.intersectCircleRectangle=function(b,c,d,e){var g=d.min(e),h=d.max(e),i=new f(h.x,g.y),j=new f(g.x,h.y),k=a.intersectCircleLine(b,c,g,i),l=a.intersectCircleLine(b,c,i,h),m=a.intersectCircleLine(b,c,h,j),n=a.intersectCircleLine(b,c,j,g),o=new a;return o.appendPoints(k.points),o.appendPoints(l.points),o.appendPoints(m.points),o.appendPoints(n.points),o.points.length>0?o.status="Intersection":o.status=k.status,o},a.intersectEllipseEllipse=function(b,c,d,e,h,i){for(var j=[d*d,0,c*c,-2*d*d*b.x,-2*c*c*b.y,d*d*b.x*b.x+c*c*b.y*b.y-c*c*d*d],k=[i*i,0,h*h,-2*i*i*e.x,-2*h*h*e.y,i*i*e.x*e.x+h*h*e.y*e.y-h*h*i*i],l=a.bezout(j,k),m=l.getRoots(),n=.001,o=(j[0]*j[0]+2*j[1]*j[1]+j[2]*j[2])*n,p=(k[0]*k[0]+2*k[1]*k[1]+k[2]*k[2])*n,q=new a,r=0;r<m.length;r++)for(var s=new g(j[0],j[3]+m[r]*j[1],j[5]+m[r]*(j[4]+m[r]*j[2])),t=s.getRoots(),u=0;u<t.length;u++){var v=(j[0]*t[u]+j[1]*m[r]+j[3])*t[u]+(j[2]*m[r]+j[4])*m[r]+j[5];Math.abs(v)<o&&(v=(k[0]*t[u]+k[1]*m[r]+k[3])*t[u]+(k[2]*m[r]+k[4])*m[r]+k[5],Math.abs(v)<p&&q.appendPoint(new f(t[u],m[r])))}return q},a.intersectEllipseLine=function(b,c,d,e,g){var h,i=new f(e.x,e.y),j=f.fromPoints(e,g),k=new f(b.x,b.y),l=i.subtract(k),m=new f(j.x/(c*c),j.y/(d*d)),n=new f(l.x/(c*c),l.y/(d*d)),o=j.dot(m),p=j.dot(n);b=l.dot(n)-1;var q=p*p-o*b;if(0>q)h=new a("Outside");else if(q>0){var r=Math.sqrt(q),s=(-p-r)/o,t=(-p+r)/o;(0>s||s>1)&&(0>t||t>1)?h=new a(0>s&&0>t||s>1&&t>1?"Outside":"Inside"):(h=new a("Intersection"),s>=0&&1>=s&&h.appendPoint(e.lerp(g,s)),t>=0&&1>=t&&h.appendPoint(e.lerp(g,t)))}else{var u=-p/o;u>=0&&1>=u?(h=new a("Intersection"),h.appendPoint(e.lerp(g,u))):h=new a("Outside")}return h},a.intersectEllipsePolygon=function(b,c,d,e){for(var f=new a,g=e.length,h=0;g>h;h++){var i=e[h],j=e[(h+1)%g],k=a.intersectEllipseLine(b,c,d,i,j);f.appendPoints(k.points)}return f},a.intersectEllipseRectangle=function(b,c,d,e,g){var h=e.min(g),i=e.max(g),j=new f(i.x,h.y),k=new f(h.x,i.y),l=a.intersectEllipseLine(b,c,d,h,j),m=a.intersectEllipseLine(b,c,d,j,i),n=a.intersectEllipseLine(b,c,d,i,k),o=a.intersectEllipseLine(b,c,d,k,h),p=new a;return p.appendPoints(l.points),p.appendPoints(m.points),p.appendPoints(n.points),p.appendPoints(o.points),p},a.intersectLineLine=function(b,c,d,e){var g,h=(e.x-d.x)*(b.y-d.y)-(e.y-d.y)*(b.x-d.x),i=(c.x-b.x)*(b.y-d.y)-(c.y-b.y)*(b.x-d.x),j=(e.y-d.y)*(c.x-b.x)-(e.x-d.x)*(c.y-b.y);if(0!==j){var k=h/j,l=i/j;k>=0&&1>=k&&l>=0&&1>=l?(g=new a("Intersection"),g.points.push(new f(b.x+k*(c.x-b.x),b.y+k*(c.y-b.y)))):g=new a}else g=new a(0===h||0===i?"Coincident":"Parallel");return g},a.intersectLinePolygon=function(b,c,d){for(var e=new a,f=d.length,g=0;f>g;g++){var h=d[g],i=d[(g+1)%f],j=a.intersectLineLine(b,c,h,i);e.appendPoints(j.points)}return e},a.intersectLineRectangle=function(b,c,d,e){var g=d.min(e),h=d.max(e),i=new f(h.x,g.y),j=new f(g.x,h.y),k=a.intersectLineLine(g,i,b,c),l=a.intersectLineLine(i,h,b,c),m=a.intersectLineLine(h,j,b,c),n=a.intersectLineLine(j,g,b,c),o=new a;return o.appendPoints(k.points),o.appendPoints(l.points),o.appendPoints(m.points),o.appendPoints(n.points),o},a.intersectPolygonPolygon=function(b,c){for(var d=new a,e=b.length,f=0;e>f;f++){var g=b[f],h=b[(f+1)%e],i=a.intersectLinePolygon(g,h,c);d.appendPoints(i.points)}return d},a.intersectPolygonRectangle=function(b,c,d){var e=c.min(d),g=c.max(d),h=new f(g.x,e.y),i=new f(e.x,g.y),j=a.intersectLinePolygon(e,h,b),k=a.intersectLinePolygon(h,g,b),l=a.intersectLinePolygon(g,i,b),m=a.intersectLinePolygon(i,e,b),n=new a;return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n},a.intersectRayRay=function(b,c,d,e){var g,h=(e.x-d.x)*(b.y-d.y)-(e.y-d.y)*(b.x-d.x),i=(c.x-b.x)*(b.y-d.y)-(c.y-b.y)*(b.x-d.x),j=(e.y-d.y)*(c.x-b.x)-(e.x-d.x)*(c.y-b.y);if(0!==j){var k=h/j;g=new a("Intersection"),g.points.push(new f(b.x+k*(c.x-b.x),b.y+k*(c.y-b.y)))}else g=new a(0===h||0===i?"Coincident":"Parallel");return g},a.intersectRectangleRectangle=function(b,c,d,e){var g=b.min(c),h=b.max(c),i=new f(h.x,g.y),j=new f(g.x,h.y),k=a.intersectLineRectangle(g,i,d,e),l=a.intersectLineRectangle(i,h,d,e),m=a.intersectLineRectangle(h,j,d,e),n=a.intersectLineRectangle(j,g,d,e),o=new a;return o.appendPoints(k.points),o.appendPoints(l.points),o.appendPoints(m.points),o.appendPoints(n.points),o},a.bezout=function(a,b){var c=a[0]*b[1]-b[0]*a[1],d=a[0]*b[2]-b[0]*a[2],e=a[0]*b[3]-b[0]*a[3],f=a[0]*b[4]-b[0]*a[4],h=a[0]*b[5]-b[0]*a[5],i=a[1]*b[2]-b[1]*a[2],j=a[1]*b[4]-b[1]*a[4],k=a[1]*b[5]-b[1]*a[5],l=a[2]*b[3]-b[2]*a[3],m=a[3]*b[4]-b[3]*a[4],n=a[3]*b[5]-b[3]*a[5],o=k+m,p=j-l;return new g(c*i-d*d,c*p+e*i-2*d*f,c*o+e*p-f*f-2*d*h,c*n+e*o-2*f*h,e*n-h*h)},a}();b.Intersection=e,b.vec=c;var f=function(){function a(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b}return a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.addEquals=function(a){return this.x+=a.x,this.y+=a.y,this},a.prototype.scalarAdd=function(b){return new a(this.x+b,this.y+b)},a.prototype.scalarAddEquals=function(a){return this.x+=a,this.y+=a,this},a.prototype.subtract=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.subtractEquals=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.scalarSubtract=function(b){return new a(this.x-b,this.y-b)},a.prototype.scalarSubtractEquals=function(a){return this.x-=a,this.y-=a,this},a.prototype.multiply=function(b){return new a(this.x*b,this.y*b)},a.prototype.multiplyEquals=function(a){return this.x*=a,this.y*=a,this},a.prototype.divide=function(b){return new a(this.x/b,this.y/b)},a.prototype.divideEquals=function(a){return this.x/=a,this.y/=a,this},a.prototype.eq=function(a){return this.x===a.x&&this.y===a.y},a.prototype.lt=function(a){return this.x<a.x&&this.y<a.y},a.prototype.lte=function(a){return this.x<=a.x&&this.y<=a.y},a.prototype.gt=function(a){return this.x>a.x&&this.y>a.y},a.prototype.gte=function(a){return this.x>=a.x&&this.y>=a.y},a.prototype.lerp=function(b,c){return new a(this.x+(b.x-this.x)*c,this.y+(b.y-this.y)*c)},a.prototype.distanceFrom=function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},a.prototype.min=function(b){return new a(Math.min(this.x,b.x),Math.min(this.y,b.y))},a.prototype.max=function(b){return new a(Math.max(this.x,b.x),Math.max(this.y,b.y))},a.prototype.toString=function(){return this.x+","+this.y},a.prototype.setXY=function(a,b){this.x=a,this.y=b},a.prototype.setFromPoint=function(a){this.x=a.x,this.y=a.y},a.prototype.swap=function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c},a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.cross=function(a){return this.x*a.y-this.y*a.x},a.prototype.unit=function(){return this.divide(this.length())},a.prototype.unitEquals=function(){return this.divideEquals(this.length()),this},a.prototype.perp=function(){return new a(-this.y,this.x)},a.fromPoints=function(b,c){return new a(c.x-b.x,c.y-b.y)},a}();b.Vector2D=f;var g=function(){function a(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];this.coefs=[];for(var c=a.length-1;c>=0;c--)this.coefs.push(a[c])}return a.prototype.eval=function(a){for(var b=0,c=this.coefs.length-1;c>=0;c--)b=b*a+this.coefs[c];return b},a.prototype.multiply=function(b){var c,d=new a;for(c=0;c<=this.getDegree()+b.getDegree();c++)d.coefs.push(0);for(c=0;c<=this.getDegree();c++)for(var e=0;e<=b.getDegree();e++)d.coefs[c+e]+=this.coefs[c]*b.coefs[e];return d},a.prototype.divide_scalar=function(a){for(var b=0;b<this.coefs.length;b++)this.coefs[b]/=a},a.prototype.simplify=function(){for(var b=this.getDegree();b>=0&&Math.abs(this.coefs[b])<=a.TOLERANCE;b--)this.coefs.pop()},a.prototype.bisection=function(b,c){var d,e=this.eval(b),f=this.eval(c);if(Math.abs(e)<=a.TOLERANCE)d=b;else if(Math.abs(f)<=a.TOLERANCE)d=c;else if(0>=e*f)for(var g=Math.log(c-b),h=Math.log(10)*a.ACCURACY,i=Math.ceil((g+h)/Math.log(2)),j=0;i>j;j++){d=.5*(b+c);var k=this.eval(d);if(Math.abs(k)<=a.TOLERANCE)break;0>k*e?(c=d,f=k):(b=d,e=k)}return d},a.prototype.toString=function(){var a,b=new Array,c=new Array;for(a=this.coefs.length-1;a>=0;a--){var d=this.coefs[a];if(0!==d){var e=0>d?" - ":" + ";d=Math.abs(d),a>0&&1===d?d="x":d+="x",a>1&&(d+="^"+a),c.push(e),b.push(d)}}c[0]=" + "===c[0]?"":"-";var f="";for(a=0;a<b.length;a++)f+=c[a]+b[a];return f},a.prototype.getDegree=function(){return this.coefs.length-1},a.prototype.getDerivative=function(){for(var b=new a,c=1;c<this.coefs.length;c++)b.coefs.push(c*this.coefs[c]);return b},a.prototype.getRoots=function(){var a;switch(this.simplify(),this.getDegree()){case 0:a=new Array;break;case 1:a=this.getLinearRoot();break;case 2:a=this.getQuadraticRoots();break;case 3:a=this.getCubicRoots();break;case 4:a=this.getQuarticRoots();break;default:a=new Array}return a},a.prototype.getRootsInInterval=function(a,b){var c,d,e=new Array;if(1===this.getDegree())d=this.bisection(a,b),null!=d&&e.push(d);else{var f=this.getDerivative(),g=f.getRootsInInterval(a,b);if(g.length>0){for(d=this.bisection(a,g[0]),null!=d&&e.push(d),c=0;c<=g.length-2;c++)d=this.bisection(g[c],g[c+1]),null!=d&&e.push(d);d=this.bisection(g[g.length-1],b),null!=d&&e.push(d)}else d=this.bisection(a,b),null!=d&&e.push(d)}return e},a.prototype.getLinearRoot=function(){var a=new Array,b=this.coefs[1];return 0!==b&&a.push(-this.coefs[0]/b),a},a.prototype.getQuadraticRoots=function(){var a=new Array;if(2===this.getDegree()){var b=this.coefs[2],c=this.coefs[1]/b,d=this.coefs[0]/b,e=c*c-4*d;if(e>0){var f=Math.sqrt(e);a.push(.5*(-c+f)),a.push(.5*(-c-f))}else 0===e&&a.push(.5*-c)}return a},a.prototype.getCubicRoots=function(){var b,c=new Array;if(3===this.getDegree()){var d=this.coefs[3],e=this.coefs[2]/d,f=this.coefs[1]/d,g=this.coefs[0]/d,h=(3*f-e*e)/3,i=(2*e*e*e-9*f*e+27*g)/27,j=e/3,k=i*i/4+h*h*h/27,l=i/2;Math.abs(k)<=a.TOLERANCE&&(b=0);var m;if(k>0){var n,o=Math.sqrt(k);m=-l+o,n=m>=0?Math.pow(m,1/3):-Math.pow(-m,1/3),m=-l-o,m>=0?n+=Math.pow(m,1/3):n-=Math.pow(-m,1/3),c.push(n-j)}else if(0>k){var p=Math.sqrt(-h/3),q=Math.atan2(Math.sqrt(-k),-l)/3,r=Math.cos(q),s=Math.sin(q),t=Math.sqrt(3);c.push(2*p*r-j),c.push(-p*(r+t*s)-j),c.push(-p*(r-t*s)-j)}else m=l>=0?-Math.pow(l,1/3):Math.pow(-l,1/3),c.push(2*m-j),c.push(-m-j)}return c},a.prototype.getQuarticRoots=function(){var b=new Array;if(4===this.getDegree()){var c=this.coefs[4],d=this.coefs[3]/c,e=this.coefs[2]/c,f=this.coefs[1]/c,g=this.coefs[0]/c,h=new a(1,-e,d*f-4*g,-d*d*g+4*e*g-f*f).getCubicRoots(),i=h[0],j=d*d/4-e+i;Math.abs(j)<=a.TOLERANCE&&(j=0);var k,l;if(j>0){var m=Math.sqrt(j),n=3*d*d/4-m*m-2*e;k=(4*d*e-8*f-d*d*d)/(4*m);var o,p=n+k,q=n-k;Math.abs(p)<=a.TOLERANCE&&(p=0),Math.abs(q)<=a.TOLERANCE&&(q=0),p>=0&&(o=Math.sqrt(p),b.push(-d/4+(m+o)/2),b.push(-d/4+(m-o)/2)),q>=0&&(o=Math.sqrt(q),b.push(-d/4+(o-m)/2),b.push(-d/4-(o+m)/2))}else j>=0&&(k=i*i-4*g,k>=-a.TOLERANCE&&(0>k&&(k=0),k=2*Math.sqrt(k),n=3*d*d/4-2*e,n+k>=a.TOLERANCE&&(l=Math.sqrt(n+k),b.push(-d/4+l/2),b.push(-d/4-l/2)),n-k>=a.TOLERANCE&&(l=Math.sqrt(n-k),b.push(-d/4+l/2),b.push(-d/4-l/2))))}return b},a.TOLERANCE=1e-6,a.ACCURACY=6,a}(),h=function(){function a(a,b){this.type=a,this.text=b}return a.prototype.typeis=function(a){return this.type===a},a}(),i=function(){function a(a){this.segments=null,this.parseData(a)}return a.prototype.appendPathSegment=function(a){a.previous=this.segments[this.segments.length-1],this.segments.push(a)},a.prototype.parseData=function(b){var c=this.tokenize(b),d=0,e=c[d],f="BOD";for(this.segments=new Array;!e.typeis(a.EOD);){var g,h=new Array;if("BOD"===f){if("M"!==e.text&&"m"!==e.text)throw new Error("Path data must begin with a moveto command");d++,g=a.PARAMS[e.text].length,f=e.text}else e.typeis(a.NUMBER)?g=a.PARAMS[f].length:(d++,g=a.PARAMS[e.text].length,f=e.text);if(!(d+g<c.length))throw new Error("Path data ended before all parameters were found");for(var i=d;d+g>i;i++){var j=c[i];if(!j.typeis(a.NUMBER))throw new Error("Parameter type is not a number: "+f+","+j.text);h[h.length]=j.text}var s,A=this.segments.length,B=0===A?null:this.segments[A-1];switch(f){case"A":s=new k(h,this,B);break;case"C":s=new m(h,this,B);break;case"c":s=new v(h,this,B);break;case"H":s=new n(h,this,B);break;case"L":s=new o(h,this,B);break;case"l":s=new w(h,this,B);break;case"M":s=new p(h,this,B);break;case"m":s=new x(h,this,B);break;case"Q":s=new l(h,this,B);break;case"q":s=new u(h,this,B);break;case"S":s=new r(h,this,B);break;case"s":s=new z(h,this,B);break;case"T":s=new q(h,this,B);break;case"t":s=new y(h,this,B);break;case"Z":s=new t(h,this,B);break;case"z":s=new t(h,this,B);break;default:throw new Error("Unsupported segment type: "+f)}this.segments.push(s),d+=g,e=c[d],"M"===f&&(f="L"),"m"===f&&(f="l")}},a.prototype.tokenize=function(b){for(var c=new Array;""!==b;)if(b.match(/^([ \t\r\n,]+)/))b=b.substr(RegExp.$1.length);else if(b.match(/^([aAcChHlLmMqQsStTvVzZ])/))c[c.length]=new h(a.COMMAND,RegExp.$1),b=b.substr(RegExp.$1.length);else{if(!b.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))throw new Error("Unrecognized segment command: "+b);c[c.length]=new h(a.NUMBER,parseFloat(RegExp.$1)),b=b.substr(RegExp.$1.length)}return c[c.length]=new h(a.EOD,null),c},a.prototype.intersectShape=function(a){for(var b=new e,c=0;c<this.segments.length;c++){var d=e.intersectShapes(this.segments[c],a);b.appendPoints(d.points)}return b},a.prototype.asIntersectionParams=function(){return new d("Path",[])},a.COMMAND=0,a.NUMBER=1,a.EOD=2,a.PARAMS={A:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],a:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],C:["x1","y1","x2","y2","x","y"],c:["x1","y1","x2","y2","x","y"],H:["x"],h:["x"],L:["x","y"],l:["x","y"],M:["x","y"],m:["x","y"],Q:["x1","y1","x","y"],q:["x1","y1","x","y"],S:["x2","y2","x","y"],s:["x2","y2","x","y"],T:["x","y"],t:["x","y"],V:["y"],v:["y"],Z:[],z:[]},a}();b.Path=i;var j=function(){function a(a,b,c,d){this.command=a,this.owner=c,this.previous=d,this.points=[];for(var e=0;e<b.length;)this.points.push(new f(parseFloat(b[e]),parseFloat(b[e+1]))),e+=2}return a.prototype.toString=function(){var a=this.points.map(function(a){return a.toString()}),b="";return this.previous.command!==this.command&&(b=this.command),b+a.join(" ")},Object.defineProperty(a.prototype,"lastPoint",{get:function(){return this.points[this.points.length-1]},enumerable:!0,configurable:!0}),a.prototype.asIntersectionParams=function(){return null},a}(),k=function(a){function b(b,c,d){a.call(this,"A",b.slice(b.length-2),c,d),this.rx=parseFloat(b.shift()),this.ry=parseFloat(b.shift()),this.angle=parseFloat(b.shift()),this.arcFlag=parseFloat(b.shift()),this.sweepFlag=parseFloat(b.shift())}return __extends(b,a),b.prototype.toString=function(){var a="";return this.previous.command!==this.command&&(a=this.command),a+[this.rx,this.ry,this.angle,this.arcFlag,this.sweepFlag,this.points[0].toString()].join(",")},b.prototype.asIntersectionParams=function(){return new d("Ellipse",[this.center,this.rx,this.ry])},Object.defineProperty(b.prototype,"center",{get:function(){var a,b=this.previous.lastPoint,c=this.points[0],d=this.rx,e=this.ry,g=this.angle*Math.PI/180,h=Math.cos(g),i=Math.sin(g),j=1e-6,k=b.subtract(c).divide(2),l=k.x*h+k.y*i,m=k.x*-i+k.y*h,n=l*l,o=m*m,p=n/(d*d)+o/(e*e);p>1&&(a=Math.sqrt(p),d*=a,e*=a);var q=d*d,r=e*e,s=q*o,t=r*n;a=(q*r-s-t)/(s+t),Math.abs(a)<j&&(a=0);var u=Math.sqrt(a);this.arcFlag===this.sweepFlag&&(u=-u);var v=b.add(c).divide(2),w=u*d*m/e,x=u*-e*l/d;return new f(w*h-x*i+v.x,w*i+x*h+v.y)},enumerable:!0,configurable:!0}),b}(j),l=function(a){function b(b,c,d){a.call(this,"Q",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"controlPoint",{get:function(){return this.points[0]},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Bezier2",[this.previous.lastPoint,this.points[0],this.points[1]])},b}(j),m=function(a){function b(b,c,d){a.call(this,"C",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"lastControlPoint",{get:function(){return this.points[1]},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Bezier3",[this.previous.lastPoint,this.points[0],this.points[1],this.points[2]])},b}(j),n=function(a){function b(b,c,d){a.call(this,"H",[b.pop(),d.lastPoint.y],c,d)}return __extends(b,a),b.prototype.toString=function(){var a="";return this.previous.command!==this.command&&(a=this.command),a+this.points[0].x},b}(j),o=function(a){function b(b,c,d){a.call(this,"L",b,c,d)}return __extends(b,a),b.prototype.toString=function(){var a="";return this.previous.command!==this.command&&"M"!==this.previous.command&&(a=this.command),a+this.points[0].toString()},b.prototype.asIntersectionParams=function(){return new d("Line",[this.previous.lastPoint,this.points[0]])},b}(j),p=function(a){function b(b,c,d){a.call(this,"M",b,c,d)}return __extends(b,a),b.prototype.toString=function(){return"M"+this.points[0].toString()},b}(j),q=function(a){function b(b,c,d){a.call(this,"T",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"controlPoint",{get:function(){var a,b=this.previous.lastPoint;if(this.previous.command.match(/^[QqTt]$/)){var c=this.previous.controlPoint,d=c.subtract(b);a=b.subtract(d)}else a=b;return a},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Bezier2",[this.previous.lastPoint,this.controlPoint,this.points[0]])},b}(j),r=function(a){function b(b,c,d){a.call(this,"S",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"firstControlPoint",{get:function(){var a,b=this.previous.lastPoint;if(this.previous.command.match(/^[SsCc]$/)){var c=this.previous.lastControlPoint,d=c.subtract(b);a=b.subtract(d)}else a=b;return a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lastControlPoint",{get:function(){return this.points[0]},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Bezier3",[this.previous.lastPoint,this.firstControlPoint,this.points[0],this.points[1]])},b}(j),s=function(){function a(a,b,c,d){this.command=a,this.owner=c,this.previous=d,this.points=[];for(var e=this.previous?this.previous.lastPoint:new f(0,0),g=0;g<b.length;){var h=new f(e.x+parseFloat(b[g]),e.y+parseFloat(b[g+1]));this.points.push(h),g+=2}}return a.prototype.toString=function(){var a=new Array,b="",c=this.previous?this.previous.lastPoint:new f(0,0);(null==this.previous||this.previous.command!==this.command)&&(b=this.command);for(var d=0;d<this.points.length;d++){var e=this.points[d].subtract(c);a.push(e.toString())}return b+a.join(" ")},Object.defineProperty(a.prototype,"lastPoint",{get:function(){return this.points[this.points.length-1]},enumerable:!0,configurable:!0}),a.prototype.asIntersectionParams=function(){return null},a}(),t=function(a){function b(b,c,d){a.call(this,"z",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"lastPoint",{get:function(){for(var a,b=this.previous;b;){if(b.command.match(/^[mMzZ]$/)){a=b.lastPoint;break}b=b.previous}return a},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Line",[this.previous.lastPoint,this.lastPoint])},b}(s),u=function(a){function b(b,c,d){a.call(this,"q",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"controlPoint",{get:function(){return this.points[0]},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Bezier2",[this.previous.lastPoint,this.points[0],this.points[1]])},b}(s),v=function(a){function b(b,c,d){a.call(this,"c",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"lastControlPoint",{get:function(){return this.points[1]},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Bezier3",[this.previous.lastPoint,this.points[0],this.points[1],this.points[2]])},b}(s),w=function(a){function b(b,c,d){a.call(this,"l",b,c,d)}return __extends(b,a),b.prototype.toString=function(){var a=this.previous?this.previous.lastPoint:new f(0,0),b=this.points[0].subtract(a),c="";return this.previous.command!==this.command&&"m"!==this.previous.command&&(c=this.command),c+b.toString()},b.prototype.asIntersectionParams=function(){return new d("Line",[this.previous.lastPoint,this.points[0]])},b}(s),x=function(a){function b(b,c,d){a.call(this,"m",b,c,d)}return __extends(b,a),b.prototype.toString=function(){return"m"+this.points[0].toString()},b}(s),y=function(a){function b(b,c,d){a.call(this,"t",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"controlPoint",{get:function(){var a,b=this.previous.lastPoint;if(this.previous.command.match(/^[QqTt]$/)){var c=this.previous.controlPoint,d=c.subtract(b);a=b.subtract(d)}else a=b;return a},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Bezier2",[this.previous.lastPoint,this.controlPoint,this.points[0]])},b}(s),z=function(a){function b(b,c,d){a.call(this,"s",b,c,d)}return __extends(b,a),Object.defineProperty(b.prototype,"firstControlPoint",{get:function(){var a,b=this.previous.lastPoint;if(this.previous.command.match(/^[SsCc]$/)){var c=this.previous.lastControlPoint,d=c.subtract(b);a=b.subtract(d)}else a=b;return a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lastControlPoint",{get:function(){return this.points[0]},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return new d("Bezier3",[this.previous.lastPoint,this.firstControlPoint,this.points[0],this.points[1]])},b}(s)}(a,c)},{}],3:[function(a,b,c){!function(a,b,c,d){"use strict";function e(){if(null!=n)return n;var a=c.list("ajax-adapter"),b=a[0];return n=b.load().then(function(a){return a.factory()})}function f(a,b,c,d){return void 0===b&&(b={}),void 0===c&&(c="get"),void 0===d&&(d="json"),e().then(function(e){return e.send(a,b,c,d)})}function g(a,b){return void 0===b&&(b={}),f(a,b)}function h(a,b,c){return void 0===b&&(b={}),void 0===c&&(c="json"),f(a,b,"get",c)}function i(a,b){return void 0===b&&(b=null),a=""+d.server_url+a+d.server_json_suffix,b=j(b),b&&(a+=(/\?/.test(a)?"&":"?")+b),a}function j(a){function b(a,c,e){Array.isArray(e)?e.forEach(function(d,e){"object"==typeof d?b(a,c+"["+e+"]",d):b(a,c+"[]",d)}):"object"==typeof e?Object.keys(e).forEach(function(d){b(a,c+"["+d+"]",e[d])}):d.push(encodeURIComponent(a+c)+"="+encodeURIComponent(e))}if(void 0===a&&(a=null),null===a)return null;if("string"==typeof a)return encodeURIComponent(a);var c=Object.keys(a);if(0===c.length)return null;var d=[];return c.forEach(function(c){b("",c,a[c])}),d.join("&").replace(/%20/g,"+")}function k(a,b,c,d){return void 0===b&&(b={}),void 0===c&&(c="get"),void 0===d&&(d="json"),f(i(a),b,c,d)}function l(a,b){return void 0===b&&(b={}),g(i(a),b)}function m(a,b,c){return void 0===b&&(b={}),void 0===c&&(c="json"),h(i(a),b,c)}var n=null;b.send=f,b.getJSON=g,b.getData=h,b.api2absURL=i,b.encodeParams=j,b.sendAPI=k,b.getAPIJSON=l,b.getAPIData=m}(a,c,a("./plugin"),a("./main"))},{"./main":13,"./plugin":19}],4:[function(a,b,c){!function(a,b,c){var d=function(a){function b(b,c){a.call(this),this.v=b,this.meta=c}return __extends(b,a),b.prototype.zoomIn=function(){return this.zoom(1,1)},b.prototype.zoomOut=function(){return this.zoom(-1,-1)},b.prototype.zoom=function(a,b){function c(a){return a>0?.2:0>a?-.2:0}if(!this.v)return null;var d=this.v.transform(),e=c(a),f=c(b);return this.zoomSet(d.scale[0]+e,d.scale[1]+f)},Object.defineProperty(b.prototype,"isWidthFixed",{get:function(){return this.meta&&"height-only"===this.meta.scaling},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isHeightFixed",{get:function(){return this.meta&&"width-only"===this.meta.scaling},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isFixedAspectRatio",{get:function(){return this.meta&&"aspect"===this.meta.scaling},enumerable:!0,configurable:!0}),b.prototype.zoomSet=function(a,b){if(!this.v)return null;var c=this.v.transform(),d=[a,b];switch(this.meta?this.meta.scaling:"free"){case"width-only":d[1]=c.scale[1];break;case"height-only":d[0]=c.scale[0]}return d[0]<=0&&(d[0]=.001),d[1]<=0&&(d[1]=.001),this.meta&&"aspect"===this.meta.scaling&&(d[0]=d[1]=Math.min.apply(Math,d)),this.fire("zoom",{scale:d,rotate:c.rotate},c),this.v.transform(d,c.rotate)},b.prototype.zoomTo=function(a,b){if(!this.v)return null;var c=this.v.rawSize;return this.zoomSet(a/c[0],b/c[1])},b}(c.EventHandler);b.ZoomLogic=d;var e=function(a){function b(b,c,d){var e=this;a.call(this,c,d),this.node=b,b.addEventListener("mousewheel",function(a){if(e.v){var b=a.ctrlKey,c=a.shiftKey,d=a.altKey,f=a.wheelDelta;e.zoom(f*(b||d?1:0),f*(b||c?1:0)),(b||c||d)&&a.preventDefault()}})}return __extends(b,a),b}(d);b.ZoomBehavior=e}(a,c,a("./event"))},{"./event":7}],5:[function(a,b,c){!function(a,b,c,d,e,f,g){"use strict";function h(a){if(a){var b=a.desc||a;delete E[b.id],delete F[b.name],delete G[b.fqname]}else E={},F={},G={}}function i(a,b){return E[a.id]=b,G[a.fqname]=b,F[a.name]=b,b}function j(a){var b=a.replace(/[!#$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|}~_]/g," ");return b=b.toLowerCase(),b=b.split(/\s/).map(function(a,b){return 0===b?a:a[0].toUpperCase()+a.substr(1)}).join("")}function k(a){if(void 0===a)return a;if(a.id=a.id||j(a.name+b.random_id(5)),a.fqname=a.fqname||a.name,a.id in E)return E[a.id];var c=D.filter(function(b){return b.id===a.type});return 0===c.length?i(a,Promise.resolve(new f.DataTypeBase(a))):i(a,c[0].load().then(function(b){return b.factory(a)}))}function l(a){var b="function"==typeof a?a:c.constantTrue,e="undefined"!=typeof a&&"function"!=typeof a?a:{},f=d.getAPIJSON("/dataset/",e).then(function(a){return Promise.all(a.map(function(a){return k(a)}))});return b!==c.constantTrue&&(f=f.then(function(a){return a.filter(b)})),f}function m(a){var b={children:[],name:"/",data:null};return a.forEach(function(a){var c=a.desc.fqname.split("/"),d=b;c.forEach(function(a){var b=d.children.filter(function(b){return b.name===a})[0];b||(b={children:[],name:a,data:null},d.children.push(b)),d=b}),d.data=a}),b}function n(a){return l(a).then(m)}function o(a){return"string"==typeof a||a instanceof RegExp?p(a):(a.limit=1,l(a).then(function(b){return 0===b.length?Promise.reject({error:"nothing found, matching",args:a}):b[0]}))}function p(a){return r(a,F,"name")}function q(a){return r(a,G,"fqname")}function r(a,b,c){void 0===c&&(c="name");var d=null,e=Object.keys(b).some(function(c){return null!=c.match(a)?(d=b[c],!0):!1});return e?d:o((f={},f[c]="string"==typeof a?a:a.source,f));var f}function s(a){return a in E?E[a]:d.getAPIJSON("/dataset/"+a+"/desc").then(k)}function t(a){return"string"==typeof a?s(a):a.root?t(a.root).then(function(b){return b?b.restore(a):null}):Promise.reject("cant restore non root and non data id")}function u(a){return k(a)}function v(a,b){var c=new FormData;return c.append("desc",JSON.stringify(a)),b&&c.append("file",b),c}function w(a,b){var c=v(a,b);return d.sendAPI("/dataset/",c,"post").then(k)}function x(a,b,c){var e=v(b,c);return d.sendAPI("/dataset/"+a.desc.id,e,"put").then(function(b){return h(a),k(b)})}function y(a,b,c){var e=v(b,c);return d.sendAPI("/dataset/"+a.desc.id,e,"post").then(function(b){return h(a),k(b)})}function z(a){var b=a.desc||a;return d.sendAPI("/dataset/"+b.id,{},"delete").then(function(a){return h(b),!0})}function A(a){return g.wrapObjects({id:"_data",name:"data",fqname:"custom/data",type:"table",idtype:"_data",size:[a.length,4],columns:[{name:"Name",value:{type:"string"},getter:function(a){return a.desc.name}},{name:"Type",value:{type:"string"},getter:function(a){return a.desc.type}},{name:"Dimensions",value:{type:"string"},getter:function(a){return a.dim.join(" x ")}},{name:"ID Types",value:{type:"string"},getter:function(a){return a.idtypes.join(" x ")}}]},a,function(a){return a.desc.name})}function B(a){var b=[];return a.forEach(function(a){"table"===a.desc.type?b.push.apply(b,a.cols()):b.push(a)}),b}function C(a){void 0===a&&(a=!1);var b=l();return a&&(b=b.then(B)),b.then(A)}var D=e.list("datatype"),E={},F={},G={};b.clearCache=h,b.fixId=j,b.random_id=c.random_id,b.list=l,b.convertToTree=m,b.tree=n,b.getFirst=o,b.getFirstByName=p,b.getFirstByFQName=q,
b.get=t,b.create=u,b.upload=w,b.update=x,b.modify=y,b.remove=z,b.convertToTable=A,b.convertTableToVectors=B,b.listAsTable=C}(a,c,a("./main"),a("./ajax"),a("./plugin"),a("./datatype"),a("./table_impl"))},{"./ajax":3,"./datatype":6,"./main":13,"./plugin":19,"./table_impl":25}],6:[function(a,b,c){!function(a,b,c,d,e){"use strict";function f(a){return a instanceof m?!0:a instanceof d.SelectAble&&c.isFunction(a.idView)&&c.isFunction(a.persist)&&c.isFunction(a.restore)&&"desc"in a&&"dim"in a}function g(a,b){a.__data__=b}function h(a){if(0===a.length||0===a[0].length)return[];for(var b=a[0].map(function(a){return[a]}),c=1;c<a.length;++c)a[c].forEach(function(a,c){return b[c].push(a)});return b}function i(a,b){if(Array.isArray(a)){var c=a;if(c.indexOf(b)>=0)return c.map(function(a){return a===b?NaN:a})}return a===b?NaN:a}function j(a,b){return"int"===b.type&&"missing"in b?i(a,b.missing):a}function k(a,b,d){void 0===d&&(d={});var f=c.mixin({skipEmptyCategories:!0,colors:["gray"],labels:null,name:"Partitioning"},d),g=b.map(function(a,b){return{name:f.labels?f.labels[b]:a,color:f.colors[Math.min(b,f.colors.length-1)],indices:[]}});a.forEach(function(a,c){var d=b.indexOf(a);d>=0&&g[d].indices.push(c)}),f.skipEmptyCategories&&(g=g.filter(function(a){return a.indices.length>0}));var h=g.map(function(a){return new e.Range1DGroup(a.name,a.color,e.Range1D.from(a.indices))});return e.composite(f.name,h)}function l(a,b){function d(a){m.call(this,a),c.isFunction(this.init)&&this.init.apply(this,c.argList(arguments))}return c.extendClass(d,m),d.prototype.toString=function(){return a},d.prototype=c.mixin(d.prototype,b),d}b.isDataType=f,b.assignData=g;var m=function(a){function b(b){a.call(this),this.desc=b}return __extends(b,a),Object.defineProperty(b.prototype,"dim",{get:function(){return[]},enumerable:!0,configurable:!0}),b.prototype.ids=function(a){return void 0===a&&(a=e.all()),Promise.resolve(e.none())},b.prototype.idView=function(a){return Promise.resolve(this)},Object.defineProperty(b.prototype,"idtypes",{get:function(){return[]},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return this.desc.id},b.prototype.restore=function(a){return this},b.prototype.toString=function(){return this.persist()},b}(d.SelectAble);b.DataTypeBase=m,b.transpose=h,b.mask=j,b.categorical2partitioning=k,b.defineDataType=l}(a,c,a("./main"),a("./idtype"),a("./range"))},{"./idtype":9,"./main":13,"./range":20}],7:[function(a,b,c){!function(a,b){"use strict";function c(a,b,c){return new e(a,b,c,c)}function d(a,b){return new e(a.type,a.args,b,a.target)}var e=function(){function a(a,b,c,d){this.type=a,this.args=b,this.target=c,this.delegateTarget=d,this.timeStamp=new Date,this.stopped=!1,this.stopedPropagation=!1}return Object.defineProperty(a.prototype,"currentTarget",{get:function(){return this.target},enumerable:!0,configurable:!0}),a.prototype.isImmediatePropagationStopped=function(){return this.stopped},a.prototype.stopImmediatePropagation=function(){this.stopped=!0},a.prototype.isPropagationStopped=function(){return this.stopedPropagation},a.prototype.stopPropagation=function(){this.stopedPropagation=!0},a}(),f=function(){function a(a){this.type=a,this.listeners=[]}return a.prototype.push=function(a){this.listeners.push(a)},a.prototype.remove=function(a){var b=this.listeners.indexOf(a);return b>=0?(this.listeners.splice(b,1),!0):!1},a.prototype.fire=function(a){if(0===this.listeners.length)return!1;var b=[a].concat(a.args);if(1===this.listeners.length)this.listeners[0].apply(a,b);else for(var c=this.listeners.slice(),d=c.length,e=0;d>e&&!a.isImmediatePropagationStopped();++e)c[e].apply(a,b);return!0},Object.defineProperty(a.prototype,"length",{get:function(){return this.listeners.length},enumerable:!0,configurable:!0}),a}(),g=function(){function a(){this.handlers={}}return a.prototype.on=function(a,b){var c=this;return"string"==typeof a?a.split(",").forEach(function(a){c.handlers.hasOwnProperty(a)||(c.handlers[a]=new f(a)),c.handlers[a].push(b)}):Object.keys(a).forEach(function(b){var d=a[b];c.on(b,d)}),this},a.prototype.off=function(a,b){var c=this;return"string"==typeof a?a.split(",").forEach(function(a){if(c.handlers.hasOwnProperty(a)){var d=c.handlers[a];d.remove(b),0===d.length&&delete c.handlers[a]}}):Object.keys(a).forEach(function(b){var d=a[b];c.off(b,d)}),this},a.prototype.list=function(){var a=this,b={};return Object.keys(this.handlers).forEach(function(c){b[c]=a.handlers[c].length}),b},a.prototype.fire=function(a){for(var b=this,d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.split(",").forEach(function(a){b.fireEvent(c(a,d,b))}),this},a.prototype.fireEvent=function(a){if(this.handlers.hasOwnProperty(a.type)){var b=this.handlers[a.type];return b.fire(a)}return!1},a.prototype.propagate=function(a){for(var b=this,c=[],e=1;e<arguments.length;e++)c[e-1]=arguments[e];a.on(c.join(","),function(a){a.isPropagationStopped()||b.fireEvent(d(a,b))})},a}();b.EventHandler=g;var h=new g;b.on=h.on.bind(h),b.off=h.off.bind(h),b.fire=h.fire.bind(h),b.list=h.list.bind(h)}(a,c)},{}],8:[function(a,b,c){!function(a,b,c,d){function e(a,b){return void 0===b&&(b=Number.NaN),d.vec(a,b)}function f(a,b){return d.vec(a,b)}function g(a,b,c,d){return new n(a,b,c,d)}function h(a,b,c){return new o(a,b,c)}function i(a,b,c,d){return new p(a,b,c,d)}function j(a,b,c,d){return new q(a,b,c,d)}function k(){return new r(Array.isArray(arguments[0])?arguments[0]:c.argList(arguments))}function l(a){if(!a)return a;if(a instanceof m)return a;if(a.hasOwnProperty("x")&&a.hasOwnProperty("y")){if(a.hasOwnProperty("radius")||a.hasOwnProperty("r"))return h(a.x,a.y,a.hasOwnProperty("radius")?a.radius:a.r);if((a.hasOwnProperty("radiusX")||a.hasOwnProperty("rx"))&&(a.hasOwnProperty("radiusY")||a.hasOwnProperty("ry")))return i(a.x,a.y,a.hasOwnProperty("radiusX")?a.radiusX:a.rx,a.hasOwnProperty("radiusY")?a.radiusY:a.ry);if(a.hasOwnProperty("w")&&a.hasOwnProperty("h"))return g(a.x,a.y,a.w,a.h);if(a.hasOwnProperty("width")&&a.hasOwnProperty("height"))return g(a.x,a.y,a.width,a.height)}return a.hasOwnProperty("x1")&&a.hasOwnProperty("y1")&&a.hasOwnProperty("x2")&&a.hasOwnProperty("y2")?j(a.x1,a.y1,a.x2,a.y2):Array.isArray(a)&&a.length>0&&a[0].hasOwnProperty("x")&&a[0].hasOwnProperty("y")?k(a):a}b.CORNER=[],b.CORNER.N=b.CORNER[0]="n",b.CORNER.NE=b.CORNER[1]="ne",b.CORNER.E=b.CORNER[2]="e",b.CORNER.SE=b.CORNER[3]="se",b.CORNER.S=b.CORNER[4]="s",b.CORNER.SW=b.CORNER[5]="sw",b.CORNER.W=b.CORNER[6]="w",b.CORNER.NW=b.CORNER[7]="nw",b.vec=e;var m=function(){function a(){}return a.prototype.shift=function(){return"number"==typeof arguments[0]?this.shiftImpl(arguments[0],arguments[1]):Array.isArray(arguments[0])?this.shiftImpl(arguments[0][0],arguments[0][1]):this.shiftImpl(arguments[0].x,arguments[0].y),this},Object.defineProperty(a.prototype,"center",{get:function(){return this.bs().xy},enumerable:!0,configurable:!0}),a.prototype.aabb=function(){throw new Error("not implemented")},a.prototype.corner=function(a){var c=this.aabb();switch(a){case b.CORNER.N:return f(c.cx,c.y);case b.CORNER.S:return f(c.cx,c.y2);case b.CORNER.W:return f(c.x,c.cy);case b.CORNER.E:return f(c.x2,c.cy);case b.CORNER.NE:return f(c.x2,c.y);case b.CORNER.NW:return c.xy;case b.CORNER.SE:return f(c.x2,c.y2);case b.CORNER.SW:return f(c.x,c.y2)}return this.center},a.prototype.bs=function(){throw new Error("not implemented")},a.prototype.shiftImpl=function(a,b){throw new Error("Not Implemented")},a.prototype.asIntersectionParams=function(){throw new Error("Not Implemented")},a.prototype.intersects=function(a){return d.Intersection.intersectShapes(this,a)},a}();b.AShape=m;var n=function(a){function b(b,c,d,e){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0),a.call(this),this.x=b,this.y=c,this.w=d,this.h=e}return __extends(b,a),b.prototype.eq=function(a){return this.x===a.x&&this.y===a.y&&this.w===a.w&&this.h===a.h},b.prototype.toString=function(){return"Rect(x="+this.x+",y="+this.y+",w="+this.w+",h="+this.h+")"},Object.defineProperty(b.prototype,"xy",{get:function(){return d.vec(this.x,this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x2y2",{get:function(){return d.vec(this.x2,this.y2)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"size",{get:function(){return d.vec(this.w,this.h)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cx",{get:function(){return this.x+this.w/2},set:function(a){this.x=a-this.w/2},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cy",{get:function(){return this.y+this.h/2},set:function(a){this.y=a-this.y/2},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x2",{get:function(){return this.x+this.w},set:function(a){this.w=a-this.x},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y2",{get:function(){return this.y+this.h},set:function(a){this.h=a-this.y},enumerable:!0,configurable:!0}),b.prototype.shiftImpl=function(a,b){this.x+=a,this.y+=b},b.prototype.aabb=function(){return this},b.prototype.bs=function(){return h(this.cx,this.cy,Math.sqrt(2*this.w+2*this.h))},b.prototype.transform=function(a,b){return g(this.x*a[0],this.y*a[1],this.w*a[0],this.h*a[1])},b.prototype.asIntersectionParams=function(){return{name:"Rectangle",params:[this.xy,this.x2y2]}},b}(m);b.Rect=n;var o=function(a){function b(b,c,d){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),a.call(this),this.x=b,this.y=c,this.radius=d}return __extends(b,a),Object.defineProperty(b.prototype,"xy",{get:function(){return d.vec(this.x,this.y)},enumerable:!0,configurable:!0}),b.prototype.toString=function(){return"Circle(x="+this.x+",y="+this.y+",radius="+this.radius+")"},b.prototype.shiftImpl=function(a,b){this.x+=a,this.y+=b},b.prototype.aabb=function(){return g(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},b.prototype.bs=function(){return this},b.prototype.transform=function(a,b){return h(this.x*a[0],this.y*a[1],this.radius*(a[0]+a[1])/2)},b.prototype.asIntersectionParams=function(){return{name:"Circle",params:[this.xy,this.radius]}},b}(m);b.Circle=o;var p=function(a){function b(b,c,d,e){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0),a.call(this),this.x=b,this.y=c,this.radiusX=d,this.radiusY=e}return __extends(b,a),Object.defineProperty(b.prototype,"xy",{get:function(){return d.vec(this.x,this.y)},enumerable:!0,configurable:!0}),b.prototype.toString=function(){return"Ellipse(x="+this.x+",y="+this.y+",radiusX="+this.radiusX+NaN+this.radiusY+")"},b.prototype.shiftImpl=function(a,b){this.x+=a,this.y+=b},b.prototype.aabb=function(){return g(this.x-this.radiusX,this.y-this.radiusY,2*this.radiusX,2*this.radiusY)},b.prototype.bs=function(){return h(this.x,this.y,Math.max(this.radiusX,this.radiusY))},b.prototype.transform=function(a,c){return new b(this.x*a[0],this.y*a[1],this.radiusX*a[0],this.radiusX*a[1])},b.prototype.asIntersectionParams=function(){return{name:"Ellipse",params:[this.xy,this.radiusX,this.radiusY]}},b}(m);b.Ellipse=p;var q=function(a){function b(b,c,d,e){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0),a.call(this),this.x1=b,this.y1=c,this.x2=d,this.y2=e}return __extends(b,a),Object.defineProperty(b.prototype,"xy",{get:function(){return d.vec(this.x1,this.y1)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x1y1",{get:function(){return this.xy},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x2y2",{get:function(){return d.vec(this.x2,this.y2)},enumerable:!0,configurable:!0}),b.prototype.toString=function(){return"Line(x1="+this.x1+",y1="+this.y1+",x2="+this.x2+NaN+this.y2+")"},b.prototype.shiftImpl=function(a,b){this.x1+=a,this.y1+=b,this.x2+=a,this.y2+=b},b.prototype.aabb=function(){return g(Math.min(this.x1,this.x2),Math.min(this.y1,this.y2),Math.abs(this.x1-this.x2),Math.abs(this.y1-this.y2))},b.prototype.bs=function(){var a=.5*(this.x1+this.x2),b=.5*(this.y1+this.y2);return h(a,b,Math.max(Math.abs(this.x1-this.x2),Math.abs(this.y1-this.y2))/2)},b.prototype.transform=function(a,c){return new b(this.x1*a[0],this.y1*a[1],this.x2*a[0],this.y2*a[1])},b.prototype.asIntersectionParams=function(){return{name:"Line",params:[this.xy,this.x2y2]}},b}(m);b.Line=q;var r=function(a){function b(b){void 0===b&&(b=[]),a.call(this),this.points=b}return __extends(b,a),b.prototype.push=function(){2===arguments.length&&"number"==typeof arguments[0]?this.points.push(f(arguments[0],arguments[1])):this.points.push.apply(this.points,c.argList(arguments))},b.prototype.toString=function(){return"Polygon("+this.points.join(",")+")"},b.prototype.shiftImpl=function(a,b){this.points.forEach(function(c){c.x+=a,c.y+=b})},Object.defineProperty(b.prototype,"length",{get:function(){return this.points.length},enumerable:!0,configurable:!0}),b.prototype.aabb=function(){var a=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY;return this.points.forEach(function(e){e.x<a&&(a=e.x),e.y<b&&(b=e.y),e.x>c&&(c=e.x),e.y>d&&(d=e.y)}),g(a,b,c-a,d-b)},b.prototype.bs=function(){var a=0,b=0;this.points.forEach(function(c){a+=c.x,b+=c.y}),a/=this.length,b/=this.length;var c=0;return this.points.forEach(function(d){var e=d.x-a,f=d.y-b,g=e*e+f*f;g>c&&(c=g)}),h(a,b,Math.sqrt(c))},b.prototype.transform=function(a,b){return k(this.points.map(function(b){return f(b.x*a[0],b.y*a[1])}))},b.prototype.pointInPolygon=function(a){for(var b,c=this.points.length,d=0,e=this.points[0],f=1;c>=f;f++){var g=this.points[f%c];a.y>Math.min(e.y,g.y)&&a.y<=Math.max(e.y,g.y)&&a.x<=Math.max(e.x,g.x)&&e.y!==g.y&&(b=(a.y-e.y)*(g.x-e.x)/(g.y-e.y)+e.x,(e.x===g.x||a.x<=b)&&d++),e=g}return d%2===1},Object.defineProperty(b.prototype,"area",{get:function(){for(var a=0,b=this.points.length,c=0;b>c;c++){var d=this.points[c],e=this.points[(c+1)%b];a+=d.x*e.y-e.x*d.y}return a/2},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"centroid",{get:function(){for(var a=this.points.length,b=6*this.area,c=0,d=0,e=0;a>e;e++){var g=this.points[e],h=this.points[(e+1)%a],i=g.x*h.y-h.x*g.y;c+=(g.x+h.x)*i,d+=(g.y+h.y)*i}return f(c/b,d/b)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isClockwise",{get:function(){return this.area<0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isCounterClockwise",{get:function(){return this.area>0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isConcave",{get:function(){for(var a=0,b=0,c=this.points.length,e=0;c>e;e++){var f=this.points[e],g=this.points[(e+1)%c],h=this.points[(e+2)%c],i=d.Vector2D.fromPoints(f,g),j=d.Vector2D.fromPoints(g,h),k=i.cross(j);0>k?b++:a++}return 0!==b&&0!==a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isConvex",{get:function(){return!this.isConvex},enumerable:!0,configurable:!0}),b.prototype.asIntersectionParams=function(){return{name:"Polygon",params:[this.points.slice()]}},b}(m);b.Polygon=r,b.vec2=f,b.rect=g,b.circle=h,b.ellipse=i,b.line=j,b.polygon=k,b.wrap=l}(a,c,a("./main"),a("./2D"))},{"./2D":2,"./main":13}],9:[function(a,b,c){!function(a,b,c,d,e,f){"use strict";function g(a){var b,c,d,e;return"boolean"==typeof a?(b=a,d=arguments[1]||!1,c=arguments[2]||!1,e=arguments[3]||!1):(b=a.ctrlKey||!1,d=a.altKey||!1,c=a.shiftKey||!1,e=a.metaKey||!1),b||c?y.ADD:d||e?y.REMOVE:y.SET}function h(a){return a.id}function i(a){return function(b){return b&&b.id===a}}function j(){function a(a){return a in d?d[a]:(d[a]=b.checkOut(),d[a])}var b=new c.IdPool,d={};return function(b){return f.list.apply(f,b.map(a))}}function k(a){return Array.isArray(a)?f.list.apply(f,a):a}function l(a){if(!a)return y.SET;if("string"==typeof a)switch(a.toLowerCase()){case"add":return y.ADD;case"remove":return y.REMOVE;default:return y.SET}return+a}function m(a,b){for(;a.ndim<b;)a.dims[a.ndim]=f.Range1D.none();return a}function n(a){a.forEach(function(a){var b=w[a.id],c=!1;b?(b.name=a.name,b.names=a.names):(b=new z(a.id,a.name,a.names),c=!0),w[a.id]=b,c&&e.fire("register.idtype",b)})}function o(){x||(x=!0,d.getAPIJSON("/idtype").then(function(a){return n(a),w}))}function p(a){return"y"===a[a.length-1]?a.slice(0,a.length-1)+"ies":a+"s"}function q(a){return a instanceof z?a:s(a,new z(a,a,p(a)))}function r(){return o(),Object.keys(w).map(function(a){return w[a]})}function s(a,b){return o(),w.hasOwnProperty(a)?w[a]:(w[a]=b,e.fire("register.idtype",b),b)}function t(){var a={};return Object.keys(w).forEach(function(b){a[b]=w[b].persist()}),a}function u(a){Object.keys(a).forEach(function(b){q(b).restore(a[b])})}function v(a){void 0===a&&(a=b.defaultSelectionType),Object.keys(w).forEach(function(b){return w[b].clear(a)})}var w={},x=!1;b.defaultSelectionType="selected",b.hoverSelectionType="hovered",function(a){a[a.SET=0]="SET",a[a.ADD=1]="ADD",a[a.REMOVE=2]="REMOVE"}(b.SelectOperation||(b.SelectOperation={}));var y=b.SelectOperation;b.toSelectOperation=g;var z=function(a){function c(b,c,d,e){void 0===e&&(e=!1),a.call(this),this.id=b,this.name=c,this.names=d,this.internal=e,this.sel={},this.name2id_cache={},this.id2name_cache={}}return __extends(c,a),c.prototype.persist=function(){var a=this,b={};return Object.keys(this.sel).forEach(function(c){return b[c]=a.sel[c].toString()}),{sel:b,name:this.name,names:this.names}},c.prototype.restore=function(a){var b=this;return this.name=a.name,this.names=a.names,Object.keys(a.sel).forEach(function(c){return b.sel[c]=f.parse(a.sel[c])}),this},c.prototype.toString=function(){return this.name},c.prototype.selectionTypes=function(){return Object.keys(this.sel)},c.prototype.selections=function(a){return void 0===a&&(a=b.defaultSelectionType),this.sel.hasOwnProperty(a)?this.sel[a]:this.sel[a]=f.none()},c.prototype.select=function(a,c,d){function e(a){return Array.isArray(a)?f.list(a):a}void 0===d&&(d=y.SET);var g="string"==typeof a?a.toString():b.defaultSelectionType,h=e("string"==typeof a?c:a);return d="string"==typeof a?d:c?c:y.SET,this.selectImpl(h,d,g)},c.prototype.selectImpl=function(a,c,d){void 0===c&&(c=y.SET),void 0===d&&(d=b.defaultSelectionType);var e=this.selections(d),g=f.none();switch(c){case y.SET:g=a;break;case y.ADD:g=e.union(a);break;case y.REMOVE:g=e.without(a)}if(e.eq(g))return e;this.sel[d]=g;var h=c!==y.REMOVE?a:f.none(),i=c===y.ADD?f.none():c===y.SET?e:a;return this.fire("select",d,g,h,i,e),this.fire("select-"+d,g,h,i,e),e},c.prototype.clear=function(a){return void 0===a&&(a=b.defaultSelectionType),this.selectImpl(f.none(),y.SET,a)},c.prototype.fillMapCache=function(a,b){var c=this;a.forEach(function(a,d){var e=b[d];c.name2id_cache[e]=a,c.id2name_cache[a]=e})},c.prototype.map=function(a){var b=this,c=a.filter(function(a){return!(a in b.name2id_cache)});return 0===c.length?Promise.resolve(a.map(function(a){return b.name2id_cache[a]})):d.getAPIJSON("/idtype/"+this.id+"/map",{ids:c}).then(function(d){return c.forEach(function(a,c){b.name2id_cache[a]=d[c]}),a.map(function(a){return b.name2id_cache[a]})})},c.prototype.unmap=function(a){var b=this,c=a instanceof f.Range?a:f.list(a),e=[];if(c.dim(0).forEach(function(a){return a in b.id2name_cache?null:e.push(a)}),0===e.length){var g=[];return c.dim(0).forEach(function(a){return g.push(b.id2name_cache[a])}),Promise.resolve(g)}return d.getAPIJSON("/idtype/"+this.id+"/unmap",{ids:f.list(e).toString()}).then(function(a){e.forEach(function(c,d){b.id2name_cache[c]=a[d]});var d=[];return c.dim(0).forEach(function(a){return d.push(b.id2name_cache[a])}),d})},c}(e.EventHandler);b.IDType=z,b.toId=h,b.isId=i;var A=function(a){function d(b,d){a.call(this,b,d,d+"s",!0),this.instances=[],this.pool=new c.IdPool}return __extends(d,a),d.prototype.nextId=function(a){var b=this.pool.checkOut();return a&&(a.id=b,this.instances[b]=a,this.fire("add",b,a)),b},d.prototype.push=function(){for(var a=this,b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];b.forEach(function(b){a.instances[b.id]=b,a.fire("add",b.id,b)})},d.prototype.byId=function(a){return this.instances[a]},d.prototype.forEach=function(a,b){var c=this;this.instances.forEach(function(d,e){return c.pool.isCheckedOut(e)?a.call(b,d):null})},Object.defineProperty(d.prototype,"entries",{get:function(){var a=this;return this.instances.filter(function(b,c){return a.pool.isCheckedOut(c)})},enumerable:!0,configurable:!0}),d.prototype.remove=function(a){var b=this,c=null;return"number"==typeof a.id&&(a=a.id),"number"==typeof a&&(c=this.instances[a],delete this.instances[a],this.fire("remove",a,c)),this.selectionTypes().forEach(function(c){b.select(c,[a],y.REMOVE)}),this.pool.checkIn(a),c},d.prototype.selectedObjects=function(a){void 0===a&&(a=b.defaultSelectionType);var c=this.selections(a);return c.filter(this.instances)},d}(z);b.ObjectManager=A;var B=function(){function a(){this.pool=new c.IdPool,this.lookup={}}return a.prototype.unmapOne=function(a){return this.unmap([a])[0]},a.prototype.unmap=function(a){var b=this,c=Object.keys(this.lookup);return a.map(function(a){for(var d in c)if(b.lookup[d]===a)return d;return null})},a.prototype.mapOne=function(a){return a in this.lookup?this.lookup[a]:(this.lookup[a]=this.pool.checkOut(),this.lookup[a])},a.prototype.map=function(a){return f.list.apply(f,a.map(this.mapOne.bind(this)))},a}();b.LocalIDAssigner=B,b.createLocalAssigner=j;var C=function(a){function d(){var b=this;a.apply(this,arguments),this.numSelectListeners=0,this.selectionListeners=[],this.singleSelectionListener=function(a,c,d,e,f){b.ids().then(function(a){d=a.indexOf(d),e=a.indexOf(e),f=a.indexOf(f),d.isNone&&e.isNone&&f.isNone||(m(d,a.ndim),m(e,a.ndim),m(f,a.ndim),b.fire("select",c,d,e,f),b.fire("select-"+c,d,e,f))})},this.selectionCache=[],this.accumulateEvents=-1}return __extends(d,a),d.prototype.ids=function(a){throw new Error("not implemented")},d.prototype.fromIdRange=function(a){return void 0===a&&(a=f.all()),this.ids().then(function(b){return b.indexOf(a)})},Object.defineProperty(d.prototype,"idtypes",{get:function(){throw new Error("not implemented")},enumerable:!0,configurable:!0}),d.prototype.selectionListener=function(a,b,c){var d=this,e=function(a,e,f,g,h){d.selectionCache[b]={act:f,added:g,removed:h},(d.accumulateEvents<0||++d.accumulateEvents===c)&&d.fillAndSend(e,b)};return e},d.prototype.fillAndSend=function(a,b){var c=this,d=this.idtypes,e=d.map(function(b,d){var e=c.selectionCache[d];return e?e:{act:b.selections(a),added:f.none(),removed:f.none()}}),g=f.join(e.map(function(a){return a.act})),h=f.join(e.map(function(a){return a.added})),i=f.join(e.map(function(a){return a.removed}));this.selectionCache=[],this.accumulateEvents=-1,this.ids().then(function(b){g=b.indexOf(g),h=b.indexOf(h),i=b.indexOf(i),g.isNone&&h.isNone&&i.isNone||(m(g,b.ndim),m(h,b.ndim),m(i,b.ndim),c.fire("select",a,g,h,i),c.fire("select-"+a,g,h,i))})},d.prototype.on=function(b,c){var d=this;if(("string"==typeof b&&"select"===b||"select-"===b.slice(0,"select-".length))&&(this.numSelectListeners++,1===this.numSelectListeners)){var e=this.idtypes;1===e.length?(this.selectionListeners.push(this.singleSelectionListener),e[0].on("select",this.singleSelectionListener)):e.forEach(function(a,b){var c=d.selectionListener(a,b,e.length);d.selectionListeners.push(c),a.on("select",c)})}return a.prototype.on.call(this,b,c)},d.prototype.off=function(b,c){var d=this;return("string"==typeof b&&"select"===b||"select-"===b.match("^select-"))&&(this.numSelectListeners--,0===this.numSelectListeners&&(this.idtypes.forEach(function(a,b){return a.off("select",d.selectionListeners[b])}),this.selectionListeners=[])),a.prototype.off.call(this,b,c)},d.prototype.selections=function(a){var c=this;return void 0===a&&(a=b.defaultSelectionType),this.ids().then(function(b){var d=f.join(c.idtypes.map(function(b){return b.selections(a)}));return b.indexRangeOf(d)})},d.prototype.select=function(){var a=c.argList(arguments),d="number"==typeof a[0]?+a.shift():-1,e="string"==typeof a[0]?a.shift():b.defaultSelectionType,f=k(a[0]),g=l(a[1]);return this.selectImpl(f,g,e,d)},d.prototype.selectImpl=function(a,c,d,e){var g=this;return void 0===c&&(c=y.SET),void 0===d&&(d=b.defaultSelectionType),void 0===e&&(e=-1),this.ids().then(function(b){var h=g.idtypes;if(-1===e){a=b.preMultiply(a),g.accumulateEvents=0;var i=f.join(a.split().map(function(a,b){return h[b].select(d,a,c)}));for(g.accumulateEvents>0&&g.fillAndSend(d,-1);i.ndim<h.length;)i.dim(i.ndim);return b.indexRangeOf(i)}return b=b.split()[e],a=b.preMultiply(a),h[e].select(d,a,c),b.indexRangeOf(a)})},d.prototype.clear=function(){var a=c.argList(arguments),d="number"==typeof a[0]?+a.shift:-1,e="string"==typeof a[0]?a[0]:b.defaultSelectionType;return this.selectImpl(f.none(),y.SET,e,d)},d}(e.EventHandler);b.SelectAble=C,b.resolve=q,b.list=r,b.register=s,b.persist=t,b.restore=u,b.clearSelection=v}(a,c,a("./main"),a("./ajax"),a("./event"),a("./range"))},{"./ajax":3,"./event":7,"./main":13,"./range":20}],10:[function(a,b,c){!function(a,b){"use strict";function c(){return new m}function d(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return 0===a.length?c():1===a.length?a[0]:new l(a)}function e(a,b,c){return new i(a,b,c)}function f(a){return new k(a)}function g(a){return new j(a)}var h=function(){function a(){}return a.prototype.hasNext=function(){return!1},a.prototype.next=function(){return null},a.prototype.forEach=function(a,b){for(var c=0;this.hasNext();)a.call(b,this.next(),c++)},a.prototype.map=function(a,b){return new n(this,a,b)},a.prototype.asList=function(){for(var a=[];this.hasNext();)a.push(this.next());return a},Object.defineProperty(a.prototype,"isIncreasing",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isDecreasing",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"byOne",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"byMinusOne",{get:function(){return!1},enumerable:!0,configurable:!0}),a}();b.AIterator=h;var i=function(a){function b(b,c,d){a.call(this),this.from=b,this.to=c,this.step=d,this.act=this.from}return __extends(b,a),b.prototype.hasNext=function(){return this.act!==this.to&&(this.step>0&&this.act<this.to||this.step<0&&this.act>this.to)},b.prototype.next=function(){if(!this.hasNext())throw new RangeError("end of iterator");var a=this.act;return this.act+=this.step,this.step<0&&this.act<this.to?this.act=this.to:this.step>0&&this.act>this.to&&(this.act=this.to),a},Object.defineProperty(b.prototype,"isIncreasing",{get:function(){return this.step>0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDecreasing",{get:function(){return this.step<0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byOne",{get:function(){return 1===this.step},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byMinusOne",{get:function(){return-1===this.step},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"size",{get:function(){if(this.byOne)return Math.max(this.to-this.from,0);if(this.byMinusOne)return Math.max(this.from-this.to,0);var a=this.isIncreasing?this.to-this.from+1:this.from-this.to+1,b=Math.abs(this.step);return 0>=a?0:Math.floor(a/b)},enumerable:!0,configurable:!0}),b}(h);b.Iterator=i;var j=function(a){function b(b){a.call(this),this.arr=b,this.it=new i(0,b.length,1)}return __extends(b,a),b.prototype.hasNext=function(){return this.it.hasNext()},b.prototype.next=function(){if(!this.hasNext())throw new RangeError("end of iterator");return this.arr[this.it.next()]},b.prototype.asList=function(){return this.arr.slice()},b}(h);b.ListIterator=j;var k=function(a){function b(b){a.call(this),this.value=b,this.delivered=!1}return __extends(b,a),b.prototype.hasNext=function(){return!this.delivered},b.prototype.next=function(){if(!this.hasNext())throw new RangeError("end of iterator");return this.delivered=!0,this.value},b.prototype.asList=function(){return[this.value]},Object.defineProperty(b.prototype,"isIncreasing",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDecreasing",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byOne",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byMinusOne",{get:function(){return!0},enumerable:!0,configurable:!0}),b}(h);b.SingleIterator=k;var l=function(a){function b(b){a.call(this),this.its=b,this.act=b.shift()}return __extends(b,a),b.prototype.hasNext=function(){for(var a=!1;!(a=this.act.hasNext())&&this.its.length>0;)this.act=this.its.shift();return a},b.prototype.next=function(){if(!this.hasNext())throw new RangeError("end of iterator");return this.act.next()},b.prototype.asList=function(){for(var a=[];this.hasNext();)a.push(this.next());return a},Object.defineProperty(b.prototype,"isIncreasing",{get:function(){return this.its.every(function(a){return a.isIncreasing})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDecreasing",{get:function(){return this.its.every(function(a){return a.isDecreasing})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byOne",{get:function(){return this.its.every(function(a){return a.byOne})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byMinusOne",{get:function(){return this.its.every(function(a){return a.byMinusOne})},enumerable:!0,configurable:!0}),b}(h);b.ConcatIterator=l;var m=function(a){function b(){a.apply(this,arguments),this.isIncreasing=!1,this.isDecreasing=!1,this.byOne=!1,this.byMinusOne=!1}return __extends(b,a),b.prototype.hasNext=function(){return!1},b.prototype.next=function(){throw new RangeError("end of iterator")},b.prototype.asList=function(){return[]},b}(h);b.EmptyIterator=m;var n=function(a){function b(b,c,d){a.call(this),this.it=b,this.f=c,this.thisArg=d}return __extends(b,a),b.prototype.hasNext=function(){return this.it.hasNext()},b.prototype.next=function(){if(!this.hasNext())throw new RangeError("end of iterator");return this.f.call(this.thisArg,this.it.next())},Object.defineProperty(b.prototype,"isIncreasing",{get:function(){return this.it.isIncreasing},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDecreasing",{get:function(){return this.it.isDecreasing},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byOne",{get:function(){return this.it.byOne},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byMinusOne",{get:function(){return this.it.byMinusOne},enumerable:!0,configurable:!0}),b}(h);b.empty=c,b.concat=d,b.range=e,b.single=f,b.forList=g}(a,c)},{}],11:[function(a,b,c){!function(a,b,c){function d(a,b){return void 0===b&&(b={}),new m(a,b)}function e(a){return 0>a||isNaN(a)}function f(a,b){return e(a)?b:a}function g(a,b){return void 0===b&&(b=!1),a=a.filter(function(a){return null!=a}),0===a.length?Promise.resolve(b):1===a.length?a[0].then(function(){return b}):Promise.all(a).then(function(){return b})}function h(a,b,c,d){return g(a.map(function(a){var d=f(a.layoutOption("prefX",Number.NaN),0),e=f(a.layoutOption("prefY",Number.NaN),0);return a.setBounds(d,e,b-d,c-e)}))}function i(a,b,c){function d(b,c,d,e){return a?[e,f(d.layoutOption("prefHeight",Number.NaN),c)]:[f(d.layoutOption("prefWidth",Number.NaN),b),e]}function h(f,h,i,j){h-=c.left+c.right,i-=c.top+c.bottom;var k=(a?h:i)-b*(f.length-1),l=0,m=0,n=0;f.forEach(function(b){var c=b.layoutOption(a?"prefWidth":"prefHeight",Number.NaN),d=b.layoutOption("ratio",Number.NaN);e(c)&&e(d)?l++:c>=0?m+=c:n+=d});var o=1>n?1:n,p=(k-m-k*n/o)/l,q=f.map(function(b){var c=b.layoutOption(a?"prefWidth":"prefHeight",Number.NaN),f=b.layoutOption("ratio",Number.NaN);if(e(c)&&e(f))return d(h,i,b,p);if(c>=0)return d(h,i,b,c);var g=f/o*k;return d(h,i,b,g)}),r=c.left,s=c.top,t=[];return f.forEach(function(c,d){var e=q[d];t.push(c.setBounds(r,s,e[0],e[1])),a?r+=e[0]+b:s+=e[1]+b}),g(t)}return void 0===c&&(c={top:0,left:0,right:0,bottom:0}),h}function j(a,c,d){function h(b,c,d,e,g,h){return a?g.setBounds(b,c,h,f(g.layoutOption("prefHeight",Number.NaN),e)):g.setBounds(b,c,f(g.layoutOption("prefWidth",Number.NaN),d),h);
}function i(b,f,i,j){f-=d.left+d.right,i-=d.top+d.bottom;var k=a?f:i,l=0;b.forEach(function(b){var d=b.layoutOption(a?"prefWidth":"prefHeight",Number.NaN);e(d)&&(d=c),l+=d});var m=(k-l)/(b.length-1),n=d.left,o=d.top;1===b.length&&(a?n+=(k-l)/2:o+=(k-l)/2);var p=[];return b.forEach(function(b){var d=b.layoutOption(a?"prefWidth":"prefHeight",Number.NaN);e(d)&&(d=c),p.push(h(n,o,f,i,b,d)),a?n+=d+m:o+=d+m}),g(p)}return void 0===d&&(d=b.no_padding),i}function k(a,c,d,e){function f(a,b,f,h){b-=e.left+e.right,f-=e.top+e.bottom;var j=e.top,k=e.left,l=b,m=f,n={top:[],center:[],left:[],right:[],bottom:[]};a.forEach(function(a){var b=a.layoutOption("border","center");n.hasOwnProperty(b)||(b="center"),n[b].push(n)});var o=[];return n.top.length>0&&(k+=f*d.top,m-=f*d.top,o.push(i(!0,c)(n.top,b,f*d.top,h))),n.bottom.length>0&&(m-=f*d.bottom,o.push(i(!0,c)(n.bottom,b,f*d.bottom,h))),n.left.length>0&&(j+=b*d.left,l-=b*d.left,o.push(i(!1,c)(n.left,b*d.left,m,h))),n.right.length>0&&(l-=b*d.right,o.push(i(!1,c)(n.right,b*d.right,m,h))),n.center.length>0&&o.push(i(!0,c)(n.center,l,m,h)),g(o)}return void 0===d&&(d={top:.2,left:.2,right:.2,bottom:.2}),void 0===e&&(e=b.no_padding),f}var l=function(){function a(a){void 0===a&&(a={}),this.options=a}return a.prototype.getBounds=function(){return c.rect(0,0,0,0)},a.prototype.getLocation=function(){return this.getBounds().xy},a.prototype.getSize=function(){return this.getBounds().size},a.prototype.layoutOption=function(a,b){return void 0===b&&(b=null),this.options.hasOwnProperty(a)?this.options[a]:b},a}();b.ALayoutElem=l;var m=function(a){function b(b,c){void 0===c&&(c={}),a.call(this,c),this.node=b}return __extends(b,a),b.prototype.setBounds=function(a,b,c,d){var e=this.layoutOption("unit","px"),f=this.node.style;return f.left=a+e,f.top=b+e,f.width=c+e,f.height=d+e,null},b.prototype.getBounds=function(){function a(a){return a.length>=b.length&&a.substring(a.length-b.length)===b?(a=a.substring(0,a.length-b.length),parseFloat(a)):0}var b=this.layoutOption("unit","px"),d=this.node.style;return c.rect(a(d.left),a(d.top),a(d.width),a(d.height))},b}(l);b.wrapDOM=d,b.no_padding={top:0,left:0,right:0,bottom:0},b.layers=h,b.flowLayout=i,b.distributeLayout=j,b.borderLayout=k}(a,c,a("./geom"))},{"./geom":8}],12:[function(a,b,c){!function(a,b,c,d,e){function f(a){var b=a;return b.type=b.type||"main",b.location=b.location||"center",b}function g(){return c.list("view").map(f)}var h=function(a){function b(){a.call(this),this._layoutOptions={}}return __extends(b,a),Object.defineProperty(b.prototype,"data",{get:function(){return[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[]},enumerable:!0,configurable:!0}),b.prototype.setBounds=function(a,b,c,d){return null},b.prototype.getBounds=function(){return e.rect(0,0,0,0)},b.prototype.setLayoutOption=function(a,b){this._layoutOptions[a]=b},b.prototype.layoutOption=function(a,b){return void 0===b&&(b=null),this._layoutOptions.hasOwnProperty(a)?this._layoutOptions[a]:b},b}(d.EventHandler);b.AView=h,b.list=g}(a,c,a("./plugin"),a("./event"),a("./geom"))},{"./event":7,"./geom":8,"./plugin":19}],13:[function(a,b,c){!function(a,b,c){"use strict";function d(a){b.server_url=a.apiUrl||"/api",b.server_json_suffix=a.apiJSONSuffix||"",b.registry={baseUrl:a.registry&&a.registry.baseUrl||"",relativeUrl:a.registry&&a.registry.relativeUrl||"..",extensions:a.registry&&a.registry.extensions||[]}}function e(a){function b(a,c){return Object.keys(c).forEach(function(d){var e=c[d];"[object Object]"===Object.prototype.toString.call(e)?a[d]=null!=a[d]?b(a[d],e):e:a[d]=e}),a}for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];return c.forEach(function(c){c&&(a=b(a,c))}),a}function f(a){return"undefined"==typeof a}function g(a,b){for(var c=this,d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];return function(){for(var e=[],f=0;f<arguments.length;f++)e[f-0]=arguments[f];return a.apply(b?b:c,d.concat(e))}}function h(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return 1===a.length?function(b){return b[a[0]]}:function(b){return a.map(function(a){return b[a]})}}function i(a){return"function"==typeof a}function j(a){return a}function k(){}function l(a){return"boolean"==typeof a&&a===!0?m:"boolean"==typeof a&&a===!1?n:function(){return a}}function m(){return!0}function n(){return!0}function o(a,b){function c(){function c(){d[b].apply(d,r(arguments))}var d;return d=c,e(c,a),c}return c}function p(a,b){var c=void 0;return a.some(function(a){return b(a)?(c=a,!0):!1}),c}function q(a,b){var c=-1;return a.some(function(a,d){return b(a)?(c=d,!0):!1}),c}function r(a){return arguments.length>1?Array.prototype.slice.call(arguments):Array.prototype.slice.call(a)}function s(a){return Array.apply(null,{length:a}).map(Number.call,Number)}function t(a,b,c){var d=s(a.length);return d.sort(function(d,e){return b.call(c,a[d],a[e])})}function u(a,b,c){var d=s(a.length);return d.filter(function(d,e){return b.call(c,a[d],e)})}function v(a){void 0===a&&(a=8);for(var b="";b.length<a;)b+=Math.random().toString(36).slice(-8);return b.substr(0,a)}function w(a,b,c){var d,e=document.getElementsByTagName("body")[0];d=Array.isArray(a)?a:[a],d.forEach(function(d){function f(g){for(var h=d;h;){if(g.target===h)return a=null,d.removeEventListener("DOMNodeRemoved",f),e.removeEventListener("DOMNodeRemoved",f),void b.call(c,d);h=h.parentNode}}d.addEventListener("DOMNodeRemoved",f),e.addEventListener("DOMNodeRemoved",f)})}function x(a){return void 0===a&&(a="_default"),J.hasOwnProperty(a)||(J[a]=0),J[a]++}function y(a,b){return isNaN(b)||0>b?b:(J.hasOwnProperty(a)?J[a]=Math.max(J[a],b+1):J[a]=b+1,b)}function z(a){return void 0===a&&(a="_default"),a+x(a)}function A(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c}function B(a,b,c){void 0===b&&(b=100),void 0===c&&(c=this);var d=-1;return function(){for(var e=[],f=0;f<arguments.length;f++)e[f-0]=arguments[f];d>=0&&(clearTimeout(d),d=-1),e.unshift(c),d=setTimeout(a.bind.apply(a,e),b)}}function C(a){if(!a)return{left:0,top:0,width:0,height:0};var b=a.getBoundingClientRect();return{left:b.left+window.pageXOffset,top:b.top+window.pageYOffset,width:b.width,height:b.height}}function D(a){if(!a)return{x:0,y:0,w:0,h:0};var b=a.getBoundingClientRect();return{x:b.left,y:b.top,w:b.width,h:b.height}}function E(a,b){var c=a.dataTransfer.types;return i(c.indexOf)?c.indexOf(b)>=0:i(c.includes)?c.includes(b):!1}function F(a){var b=a.dataTransfer;return a.ctrlKey&&b.effectAllowed.match(/copy/gi)||!b.effectAllowed.match(/move/gi)}function G(a){var b=a.dataTransfer;F(a)?b.dropEffect="copy":b.dropEffect="move"}function H(a){return 0>=a?Promise.resolve(null):new Promise(function(b){setTimeout(b,a)})}if(!window.Promise){var I=a;I(["es6-promise"])}b.version="0.0.1-alpha",b.server_url="/api",b.server_json_suffix="",b._init=d,null!=c&&"function"==typeof c.config&&d(c.config()),b.mixin=e,b.isUndefined=f,b.bind=g,b.getter=h,b.isFunction=i,b.identity=j,b.noop=k,b.constant=l,b.constantTrue=m,b.constantFalse=n,b.callable=o,b.search=p,b.indexOf=q,b.argList=r,b.argSort=t,b.argFilter=u,b.random_id=v,b.onDOMNodeRemoved=w;var J={};b.uniqueId=x,b.flagId=y,b.uniqueString=z,b.extendClass=A;var K=function(){function a(){this.counter=0,this.free=[]}return a.prototype.checkOut=function(){return 0===this.free.length?this.counter++:this.free.shift()},a.prototype.checkIn=function(a){a===this.counter-1?this.counter--:this.free.push(a)},a.prototype.isCheckedOut=function(a){return a<this.counter&&this.free.indexOf(a)<0},Object.defineProperty(a.prototype,"size",{get:function(){return this.counter-this.free.length},enumerable:!0,configurable:!0}),a}();b.IdPool=K;var L=function(){function a(a){this.map={},a&&this.parse(a)}return a.prototype.is=function(a){return null!=this.getProp(a,null)},a.prototype.getProp=function(a,b){return this.map.hasOwnProperty(a)?this.map[a]:b},a.prototype.getInt=function(a,b){var c=this.getProp(a,null);return null===c?b:null!=c.match(/[0-9-.]/)?parseInt(c,10):parseInt(c,36)},a.prototype.removeProp=function(a){return this.map.hasOwnProperty(a)?(delete this.map[a],!0):!1},a.prototype.toString=function(){var a=this,b=[];return Object.keys(this.map).forEach(function(c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a.map[c]))}),b.join("&")},a.prototype.parse=function(a){var b=this;void 0===a&&(a=""),this.map={},a.length<=1||a.substr(1).split("&").forEach(function(a){var c=a.split("="),d=decodeURIComponent(c[0]),e=c[1]&&decodeURIComponent(c[1]);if(d in b.map){var f=b.map[d];Array.isArray(f)?b.map[d].push(e):b.map[d]=[f,e]}else b.map[d]=e})},a}(),M=function(a){function b(){var b=this;a.call(this),this.updated=function(){b.parse(location.hash)},this.map=history.state,this.map||this.parse(location.hash),window.addEventListener("hashchange",this.updated,!1)}return __extends(b,a),b.prototype.setInt=function(a,b,c){void 0===c&&(c=!0);var d=String(b);b>100&&(d=b.toString(36)),this.setProp(a,String(b),c)},b.prototype.setProp=function(a,b,c){void 0===c&&(c=!0),this.map[a]=b,c&&this.update()},b.prototype.removeProp=function(a,b){return void 0===b&&(b=!0),this.map.hasOwnProperty(a)?(delete this.map[a],b&&this.update(),!0):!1},b.prototype.update=function(){window.removeEventListener("hashchange",this.updated,!1),history.pushState(this.map,"State "+Date.now(),"#"+this.toString()),window.addEventListener("hashchange",this.updated,!1)},b}(L);b.hash=new M,b.param=new L(location.search),b.delayedCall=B,b.offset=C,b.bounds=D,b.hasDnDType=E,b.copyDnD=F,b.updateDropEffect=G,b.resolveIn=H}(a,c,b)},{}],14:[function(a,b,c){!function(a,b,c,d,e){"use strict";function f(a,b){var d=this;if(2===arguments.length)return function(){var e=c.argList(arguments);return e.unshift(b),e.unshift(a),f.apply(d,e)};var h=c.argList(arguments);h.shift(),h.shift();var i,j=h.shift();return Array.isArray(j)?i=e.list(j):e.is(j)?i=j:(h.unshift(j),i=e.list(h)),g(a,b,i)}function g(a,b,c){var f=a.toString()+"->"+b.toString()+":"+c.toString();if(h.hasOwnProperty(f))return h[f];var g=d.getAPIJSON("/mapper/map",{source:a.toString(),target:b.toString(),range:c.toString()}).then(function(a){return e.parse(a.range)});return h[f]=g,g}b.map=f;var h={}}(a,c,a("./main"),a("./ajax"),a("./range"))},{"./ajax":3,"./main":13,"./range":20}],15:[function(a,b,c){!function(a,b,c,d){function e(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=new j;return a.forEach(function(a){return a.forEach(c.push,c)}),c}function f(a,b,c,d,e){var f=new l(d,e);return f.pushAll(a,b,c),f}function g(a,b,c,d,e,f){var g=new m(d,e,f);return g.pushAll(a,b,c),g}function h(a){return new n(a)}function i(a,b){return new l(a.length,b,a)}var j=function(){function a(){this.min=NaN,this.max=NaN,this.sum=0,this.mean=0,this._var=0,this.n=0,this.nans=0,this.moment2=NaN,this.moment3=NaN,this.moment4=NaN}return Object.defineProperty(a.prototype,"var",{get:function(){return this.n>1?this._var/(this.n-1):0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sd",{get:function(){return Math.sqrt(this["var"])},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"kurtosis",{get:function(){return 0===this.n?0:this.n*this.moment4/(this.moment2*this.moment2)-3},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"skewness",{get:function(){return 0===this.n?0:Math.sqrt(this.n)*this.moment3/Math.pow(this.moment2,1.5)},enumerable:!0,configurable:!0}),a.prototype.push=function(a){if(a=+a,isNaN(a))return void this.nans++;if(this.n++,this.sum+=a,(a<this.min||isNaN(this.min))&&(this.min=a),(this.max<a||isNaN(this.max))&&(this.max=a),1===this.n)this.mean=a,this._var=0,this.moment2=this.moment3=this.moment4=0;else{var b=this.mean;this.mean=b+(a-b)/this.n,this._var=this._var+(a-b)*(a-this.mean);var c=a-b,d=c/this.n,e=d*d,f=c*d*(this.n-1);this.moment4+=f*e*(this.n*this.n-3*this.n+3)+6*e*this.moment2-4*d*this.moment3,this.moment3+=f*d*(this.n-2)-3*d*this.moment2,this.moment2+=f}},a}();b.computeStats=e,b.hist=f,b.categoricalHist=g,b.rangeHist=h,b.wrapHist=i;var k=function(){function a(a,b){this.missing_=0,this.missingRange_=c.none(),this.bins_=[];for(var d=0;a>d;++d)this.bins_.push(b&&b.length>d?b[d]:0)}return Object.defineProperty(a.prototype,"largestFrequency",{get:function(){return Math.max(Math.max.apply(Math,this.bins_),this.missing_)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"largestBin",{get:function(){return Math.max.apply(Math,this.bins_)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"count",{get:function(){return this.validCount+this.missing_},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"validCount",{get:function(){return this.bins_.reduce(function(a,b){return a+b},0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bins",{get:function(){return this.bins_.length},enumerable:!0,configurable:!0}),a.prototype.binOf=function(a){return-1},a.prototype.frequency=function(a){return this.bins_[a]},a.prototype.range=function(a){return this.ranges_?this.ranges_[a]:c.none()},Object.defineProperty(a.prototype,"missing",{get:function(){return this.missing_},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"missingRange",{get:function(){return this.missingRange_},enumerable:!0,configurable:!0}),a.prototype.pushAll=function(a,b,d){for(var e=this,f=[],g=[],h=this.bins-1;h>=0;--h)f.push([]);if(b){var i=b.iter(d);a.forEach(function(a){var b=i.next(),c=e.binOf(a);0>c?(e.missing_++,g.push(b)):(e.bins_[c]++,f[c].push(b))}),this.ranges_=f.map(function(a){return c.list(a.sort().filter(function(a,b,c){return a!==c[b-1]}))}),this.missingRange_=c.list(g.sort().filter(function(a,b,c){return a!==c[b-1]}))}else a.forEach(function(a){var b=e.binOf(a);0>b?e.missing_++:e.bins_[b]++}),this.ranges_=null,this.missingRange_=null},a.prototype.forEach=function(a,b){return this.bins_.forEach(a,b)},a}(),l=function(a){function b(b,c,d){a.call(this,b,d),this.value_range=c}return __extends(b,a),b.prototype.binOf=function(a){return"number"==typeof a?this.binOfImpl(a):-1},b.prototype.binOfImpl=function(a){if(isNaN(a))return-1;var b=(a-this.value_range[0])/(this.value_range[1]-this.value_range[0]),c=Math.round(b*(this.bins-1));return 0>c&&(c=0),c>=this.bins&&(c=this.bins-1),c},b}(k),m=function(a){function b(b,c,d){a.call(this,b.length),this.values=b,this.categories=c,this.colors=d}return __extends(b,a),b.prototype.binOf=function(a){return this.values.indexOf(a)},b}(k),n=function(){function a(a){this.range_=a}return Object.defineProperty(a.prototype,"categories",{get:function(){return this.range_.groups.map(function(a){return a.name})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"colors",{get:function(){return this.range_.groups.map(function(a){return a.color})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"largestFrequency",{get:function(){return Math.max.apply(Math,this.range_.groups.map(function(a){return a.length}))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"largestBin",{get:function(){return this.largestFrequency},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"count",{get:function(){return this.range_.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"validCount",{get:function(){return this.count},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bins",{get:function(){return this.range_.groups.length},enumerable:!0,configurable:!0}),a.prototype.binOf=function(a){return d.indexOf(this.range_.groups,function(b){return b.name===a})},a.prototype.frequency=function(a){return this.range_.groups[a].length},a.prototype.range=function(a){return c.list(this.range_.groups[a])},Object.defineProperty(a.prototype,"missing",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"missingRange",{get:function(){return c.none()},enumerable:!0,configurable:!0}),a.prototype.forEach=function(a,b){return this.range_.groups.forEach(function(c,d){return a.call(b,c.length,d)})},a}()}(a,c,a("./range"),a("./main"))},{"./main":13,"./range":20}],16:[function(a,b,c){!function(a,b){"use strict"}(a,c)},{}],17:[function(require,module,exports){!function(require,exports,C,ajax,ranges,idtypes,datatypes,vector_impl,math){"use strict";function flatten(a,b,c){void 0===c&&(c=0);var d=[],e=[a.length,a[0].length];if(0===c)d=d.concat.apply(d,a);else for(var f=0;f<e[1];++f)a.forEach(function(a){d.push(a[f])});return{data:d,indices:b.dim(c).repeat(e[1-c])}}function adapterOne2Two(a){return{rowIds:function(b,c){return a(b).then(function(a){return c.preMultiply(a.rowIds,b.size)})},rows:function(b,c){return a(b).then(function(a){return c.dim(0).filter(a.rows,b.size[0])})},colIds:function(b,c){return a(b).then(function(a){return c.preMultiply(a.colIds,b.size)})},cols:function(b,c){return a(b).then(function(a){return c.dim(1).filter(a.cols,b.size[1])})},ids:function(b,c){return a(b).then(function(a){return c.preMultiply(a.ids,b.size)})},at:function(b,c,d){return a(b).then(function(a){return a[c][d]})},data:function(b,c){return a(b).then(function(a){return c.filter(a.data,b.size)})}}}function maskIt(a){return function(b){return datatypes.mask(b,a)}}function viaAPI2Loader(){var a=null,b=null,c=null,d=null,e=null,f=null,g={rowIds:function(b,c){return null==a&&(a=ajax.getAPIJSON("/dataset/matrix/"+b.id+"/rowIds").then(function(a){return ranges.parse(a)})),a.then(function(a){return a.preMultiply(c,b.size)})},rows:function(a,c){return null==b&&(b=ajax.getAPIJSON("/dataset/matrix/"+a.id+"/rows")),b.then(function(b){return c.dim(0).filter(b,a.size[0])})},colIds:function(a,b){return null==c&&(c=ajax.getAPIJSON("/dataset/matrix/"+a.id+"/colIds").then(function(a){return ranges.parse(a)})),c.then(function(c){return c.preMultiply(b,a.size)})},cols:function(a,b){return null==d&&(d=ajax.getAPIJSON("/dataset/matrix/"+a.id+"/cols")),d.then(function(c){return b.dim(1).filter(c,a.size[1])})},ids:function(a,b){if(1===b.ndim)return g.rowIds(a,b);b.dim(0),b.dim(1);var c=b.split();return Promise.all([g.rowIds(a,c[0]||ranges.all()),g.colIds(a,c[1]||ranges.all())]).then(function(a){return ranges.join(a)})},hist:function(a,b,c){if(void 0===c&&(c=NaN),b.isAll&&isNaN(c))return null==f&&(f=ajax.getAPIJSON("/dataset/matrix/"+a.id+"/hist").then(function(b){return math.wrapHist(b,a.value.range)})),f;var d={range:b.toString()};return isNaN(c)||(d.bins=c),ajax.getAPIJSON("/dataset/matrix/"+a.id+"/hist",d).then(function(b){return math.wrapHist(b,a.value.range)})},at:function(a,b,c){return g.data(a,ranges.list([b],[c])).then(function(b){return datatypes.mask(b[0][0],a)})},data:function(a,b){if(b.isAll)return null==e&&(e=ajax.getAPIJSON("/dataset/matrix/"+a.id+"/raw").then(maskIt(a))),e;if(null!=e)return e.then(function(c){return b.filter(c,a.size)});var c=a.size;return c[0]*c[1]<1e3||a.loadAtOnce?(e=ajax.getAPIJSON("/dataset/matrix/"+a.id+"/raw").then(maskIt(a)),e.then(function(c){return b.filter(c,a.size)})):ajax.getAPIData("/dataset/matrix/"+a.id+"/raw",{range:b.toString()}).then(maskIt(a))},heatmapUrl:function(a,b,c){var d={format:c.format||"png",range:b.toString()};return c.transpose===!0&&(d.format_transpose=!0),c.range&&(d.format_min=c.range[0],d.format_max=c.range[1]),c.palette&&(d.format_palette=c.palette),ajax.api2absURL("/dataset/matrix/"+a.id+"/data",d)}};return g}function create(a,b){return C.isFunction(a.loader)?new Matrix(a,adapterOne2Two(a.loader)):new Matrix(a,b?b:viaAPI2Loader())}var MatrixBase=function(_super){function MatrixBase(a){_super.call(this),this._root=a}return __extends(MatrixBase,_super),MatrixBase.prototype.size=function(){throw new Error("not implemented")},Object.defineProperty(MatrixBase.prototype,"dim",{get:function(){return this.size()},enumerable:!0,configurable:!0}),Object.defineProperty(MatrixBase.prototype,"length",{get:function(){return this.nrow*this.ncol},enumerable:!0,configurable:!0}),Object.defineProperty(MatrixBase.prototype,"nrow",{get:function(){return this.dim[0]},enumerable:!0,configurable:!0}),Object.defineProperty(MatrixBase.prototype,"ncol",{get:function(){return this.dim[1]},enumerable:!0,configurable:!0}),Object.defineProperty(MatrixBase.prototype,"indices",{get:function(){return ranges.range([0,this.nrow],[0,this.ncol])},enumerable:!0,configurable:!0}),MatrixBase.prototype.data=function(){throw new Error("not implemented")},MatrixBase.prototype.view=function(){if("string"==typeof arguments[0])return this.dynview(arguments[0]);var a=0===arguments.length?ranges.all():arguments[0];return a.isAll?this._root:new MatrixView(this._root,a)},MatrixBase.prototype.dynview=function(a){return null},MatrixBase.prototype.slice=function(a){return new SliceColVector(this,a)},MatrixBase.prototype.stats=function(){return this.data().then(function(a){return math.computeStats.apply(math,a)})},MatrixBase.prototype.hist=function(a,b,c){var d=this;void 0===b&&(b=ranges.all()),void 0===c&&(c=0);var e=this._root.valuetype;return this.data().then(function(b){var f=flatten(b,d.indices,c);switch(e.type){case"categorical":return math.categoricalHist(f.data,f.indices,f.data.length,e.categories.map(function(a){return"string"==typeof a?a:a.name}),e.categories.map(function(a){return"string"==typeof a?a:a.name||a.label}),e.categories.map(function(a){return"string"==typeof a?"gray":a.color||"gray"}));case"real":case"int":return math.hist(f.data,f.indices,f.data.length,a?a:Math.round(Math.sqrt(d.length)),e.range);default:return null}})},MatrixBase.prototype.idView=function(a){var b=this;return void 0===a&&(a=ranges.all()),a.isAll?Promise.resolve(this._root):this.ids().then(function(c){return b.view(c.indexOf(a))})},MatrixBase.prototype.reduce=function(a,b,c,d){return new ProjectedVector(this,a,b,c,d)},MatrixBase.prototype.restore=function(persisted){return persisted&&persisted.f?this.reduce(eval(persisted.f),this,persisted.valuetype,persisted.idtype?idtypes.resolve(persisted.idtype):void 0):persisted&&persisted.range?this.view(ranges.parse(persisted.range)):persisted&&persisted.transposed?this.t:persisted&&persisted.col?this.slice(+persisted.col):persisted&&persisted.row?this.t.slice(+persisted.row):this},MatrixBase}(idtypes.SelectAble);exports.MatrixBase=MatrixBase;var Matrix=function(a){function b(b,c){a.call(this,null),this.desc=b,this.loader=c,this._root=this;var d=b;this.valuetype=d.value,this.rowtype=idtypes.resolve(d.rowtype),this.coltype=idtypes.resolve(d.coltype),this.t=new TransposedMatrix(this)}return __extends(b,a),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.rowtype,this.coltype]},enumerable:!0,configurable:!0}),b.prototype.at=function(a,b){return this.loader.at(this.desc,a,b)},b.prototype.data=function(a){return void 0===a&&(a=ranges.all()),this.loader.data(this.desc,a)},b.prototype.ids=function(a){return void 0===a&&(a=ranges.all()),this.loader.ids(this.desc,a)},b.prototype.cols=function(a){return void 0===a&&(a=ranges.all()),this.loader.cols(this.desc,a)},b.prototype.colIds=function(a){return void 0===a&&(a=ranges.all()),this.loader.colIds(this.desc,a)},b.prototype.rows=function(a){return void 0===a&&(a=ranges.all()),this.loader.rows(this.desc,a)},b.prototype.rowIds=function(a){return void 0===a&&(a=ranges.all()),this.loader.rowIds(this.desc,a)},b.prototype.hist=function(b,c,d){return void 0===c&&(c=ranges.all()),void 0===d&&(d=0),this.loader.hist?this.loader.hist(this.desc,c,b):a.prototype.hist.call(this,b,c,d)},b.prototype.size=function(){return this.desc.size},b.prototype.persist=function(){return this.desc.id},b.prototype.heatmapUrl=function(a,b){return void 0===a&&(a=ranges.all()),void 0===b&&(b={}),this.loader.heatmapUrl?this.loader.heatmapUrl(this.desc,a,b):null},b}(MatrixBase);exports.Matrix=Matrix;var TransposedMatrix=function(a){function b(b){a.call(this,b),this.t=b}return __extends(b,a),Object.defineProperty(b.prototype,"desc",{get:function(){return this._root.desc},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this._root.persist(),transposed:!0}},Object.defineProperty(b.prototype,"valuetype",{get:function(){return this._root.valuetype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rowtype",{get:function(){return this._root.coltype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"coltype",{get:function(){return this._root.rowtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.rowtype,this.coltype]},enumerable:!0,configurable:!0}),b.prototype.ids=function(a){return void 0===a&&(a=ranges.all()),this.t.ids(a?a.swap():void 0).then(function(a){return a.swap()})},b.prototype.cols=function(a){return void 0===a&&(a=ranges.all()),this.t.rows(a?a.swap():void 0)},b.prototype.colIds=function(a){return void 0===a&&(a=ranges.all()),this.t.rowIds(a?a.swap():void 0)},b.prototype.rows=function(a){return void 0===a&&(a=ranges.all()),this.t.cols(a?a.swap():void 0)},b.prototype.rowIds=function(a){return void 0===a&&(a=ranges.all()),this.t.colIds(a?a.swap():void 0)},b.prototype.view=function(a){return void 0===a&&(a=ranges.all()),a.isAll?this:new MatrixView(this._root,a.swap()).t},b.prototype.slice=function(a){return new SliceRowVector(this._root,a)},b.prototype.size=function(){var a=this.t.dim;return[a[1],a[0]]},b.prototype.at=function(a,b){return this.t.at(b,a)},b.prototype.data=function(a){return void 0===a&&(a=ranges.all()),this.t.data(a?a.swap():void 0).then(function(a){return datatypes.transpose(a)})},b.prototype.hist=function(a,b,c){return void 0===b&&(b=ranges.all()),void 0===c&&(c=0),this.t.hist(a,b?b.swap():void 0,1-c)},b.prototype.heatmapUrl=function(a,b){return void 0===a&&(a=ranges.all()),void 0===b&&(b={}),b.transpose=b.transpose!==!0,this.t.heatmapUrl(a?a.swap():void 0,b)},b}(MatrixBase),MatrixView=function(a){function b(c,d,e){a.call(this,c),this.range=d,this.t=e,this.range=d,d.dim(0),d.dim(1),e||(this.t=new b(c.t,d.swap(),this))}return __extends(b,a),Object.defineProperty(b.prototype,"desc",{get:function(){return this._root.desc},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this._root.persist(),range:this.range.toString()}},b.prototype.ids=function(a){return void 0===a&&(a=ranges.all()),this._root.ids(this.range.preMultiply(a,this._root.dim))},b.prototype.cols=function(a){return void 0===a&&(a=ranges.all()),this._root.cols(this.range.preMultiply(a,this._root.dim))},b.prototype.colIds=function(a){return void 0===a&&(a=ranges.all()),this._root.colIds(this.range.preMultiply(a,this._root.dim))},b.prototype.rows=function(a){return void 0===a&&(a=ranges.all()),this._root.rows(this.range.preMultiply(a,this._root.dim))},b.prototype.rowIds=function(a){return void 0===a&&(a=ranges.all()),this._root.rowIds(this.range.preMultiply(a,this._root.dim))},b.prototype.size=function(){return this.range.size(this._root.dim)},b.prototype.at=function(a,b){var c=this.range.invert([a,b],this._root.dim);return this._root.at(c[0],c[1])},b.prototype.data=function(a){return void 0===a&&(a=ranges.all()),this._root.data(this.range.preMultiply(a,this._root.dim))},b.prototype.hist=function(a,b,c){return void 0===b&&(b=ranges.all()),void 0===c&&(c=0),this._root.hist(a,this.range.preMultiply(b,this._root.dim),c)},b.prototype.heatmapUrl=function(a,b){return void 0===a&&(a=ranges.all()),void 0===b&&(b={}),this._root.heatmapUrl(this.range.preMultiply(a,this._root.dim),b)},b.prototype.view=function(a){return void 0===a&&(a=ranges.all()),a.isAll?this:new b(this._root,this.range.preMultiply(a,this.dim))},Object.defineProperty(b.prototype,"valuetype",{get:function(){return this._root.valuetype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rowtype",{get:function(){return this._root.rowtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"coltype",{get:function(){return this._root.coltype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.rowtype,this.coltype]},enumerable:!0,configurable:!0}),b}(MatrixBase),SliceColVector=function(a){function b(b,c){a.call(this,null),this.m=b,this.col=c,this.colRange=ranges.Range1D.from([this.col]),this.desc={name:b.desc.name+"-c"+c,fqname:b.desc.fqname+"-c"+c,id:b.desc.id+"-c"+c,type:"vector",size:this.dim,value:this.valuetype},this._root=this}return __extends(b,a),b.prototype.persist=function(){return{root:this.m.persist(),col:this.col}},b.prototype.restore=function(a){var b=this;return a&&a.range&&(b=b.view(ranges.parse(a.range))),b},Object.defineProperty(b.prototype,"valuetype",{get:function(){return this.m.valuetype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtype",{get:function(){return this.m.rowtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.size=function(){return this.m.nrow},b.prototype.names=function(a){return this.m.rows(a)},b.prototype.ids=function(a){return this.m.rowIds(a)},b.prototype.at=function(a){return this.m.at(a,this.col)},b.prototype.data=function(a){void 0===a&&(a=ranges.all());var b=ranges.list(a.dim(0),this.colRange);return this.m.data(b).then(function(a){return a.length>0&&Array.isArray(a[0])?a.map(function(a){return a[0]}):a})},b.prototype.sort=function(a,b){var c=this;return this.data().then(function(d){var e=C.argSort(d,a,b);return c.view(ranges.list(e))})},b.prototype.map=function(a,b){return null},b.prototype.filter=function(a,b){var c=this;return this.data().then(function(d){var e=C.argFilter(d,a,b);return c.view(ranges.list(e))})},b}(vector_impl.VectorBase),SliceRowVector=function(a){function b(b,c){a.call(this,null),this.m=b,this.row=c,this.rowRange=ranges.Range1D.from([this.row]),this.desc={name:b.desc.name+"-r"+c,fqname:b.desc.fqname+"-r"+c,id:b.desc.id+"-r"+c,type:"vector",size:this.dim,value:this.valuetype},this._root=this}return __extends(b,a),b.prototype.persist=function(){return{root:this.m.persist(),row:this.row}},b.prototype.restore=function(a){var b=this;return a&&a.range&&(b=b.view(ranges.parse(a.range))),b},Object.defineProperty(b.prototype,"valuetype",{get:function(){return this.m.valuetype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtype",{get:function(){return this.m.coltype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.size=function(){return this.m.ncol},b.prototype.names=function(a){return this.m.cols(a)},b.prototype.ids=function(a){return this.m.colIds(a)},b.prototype.at=function(a){return this.m.at(this.row,a)},b.prototype.data=function(a){void 0===a&&(a=ranges.all());var b=ranges.list(this.rowRange,a.dim(0));return this.m.data(b).then(function(a){return a[0]})},b.prototype.sort=function(a,b){var c=this;return this.data().then(function(d){var e=C.argSort(d,a,b);return c.view(ranges.list(e))})},b.prototype.map=function(a,b){return null},b.prototype.filter=function(a,b){var c=this;return this.data().then(function(d){var e=C.argFilter(d,a,b);return c.view(ranges.list(e))})},b}(vector_impl.VectorBase),ProjectedVector=function(a){function b(b,c,d,e,f){void 0===d&&(d=b),void 0===e&&(e=b.valuetype),void 0===f&&(f=b.rowtype),a.call(this,null),this.m=b,this.f=c,this.this_f=d,this.valuetype=e,this._idtype=f,this.desc={name:b.desc.name+"-p",fqname:b.desc.fqname+"-p",type:"vector",id:b.desc.id+"-p",size:this.dim,value:this.valuetype},this._root=this}return __extends(b,a),b.prototype.persist=function(){return{root:this.m.persist(),f:this.f.toString(),valuetype:this.valuetype===this.m.valuetype?void 0:this.valuetype,idtype:this.idtype===this.m.rowtype?void 0:this.idtype.name}},b.prototype.restore=function(a){var b=this;return a&&a.range&&(b=b.view(ranges.parse(a.range))),b},Object.defineProperty(b.prototype,"idtype",{get:function(){return this._idtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{
get:function(){return[this._idtype]},enumerable:!0,configurable:!0}),b.prototype.size=function(){return this.m.nrow},b.prototype.names=function(a){return this.m.rows(a)},b.prototype.ids=function(a){return this.m.rowIds(a)},b.prototype.at=function(a){var b=this;return this.m.data(ranges.list(a)).then(function(a){return b.f.call(b.this_f,a[0])})},b.prototype.data=function(a){var b=this;return this.m.data(a).then(function(a){return a.map(b.f,b.this_f)})},b.prototype.sort=function(a,b){var c=this;return this.data().then(function(d){var e=C.argSort(d,a,b);return c.view(ranges.list(e))})},b.prototype.map=function(a,b){return null},b.prototype.filter=function(a,b){var c=this;return this.data().then(function(d){var e=C.argFilter(d,a,b);return c.view(ranges.list(e))})},b}(vector_impl.VectorBase);exports.create=create}(require,exports,require("./main"),require("./ajax"),require("./range"),require("./idtype"),require("./datatype"),require("./vector_impl"),require("./math"))},{"./ajax":3,"./datatype":6,"./idtype":9,"./main":13,"./math":15,"./range":20,"./vector_impl":27}],18:[function(a,b,c){!function(a,b,c,d,e,f){function g(a,b){switch(typeof a){case"number":return b[Math.max(0,Math.min(a,b.length-1))];case"string":return b[Math.max(0,c.indexOf(b,function(b){return b.id===a}))];default:return b[Math.max(0,b.indexOf(a))]}}function h(a){for(var b=a.firstChild;null!=(b=a.firstChild);)a.removeChild(b)}function i(a,b,c){void 0===b&&(b="div");var d=document.createElement(b);return c&&c.split(" ").forEach(function(a){return d.classList.add(a)}),a.appendChild(d),d}function j(a){return a.reduce(function(a,b){return a+b},0)}function k(a,b){return 0===a.length?NaN:a.reduce(function(a,c){return Math.max(a,b(c))},-(1/0))}function l(a){return 0===a.length?[]:1===a.length?a[0].visses:a[0].visses.filter(function(b){return a.every(function(a){return a.visses.indexOf(b)>=0})})}function m(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=document.createElement("div");a.insertBefore(d,a.firstChild);var e=l(b);e.forEach(function(a){var c=i(d,"i");a.iconify(c),c.__data__=a,c.onclick=function(){return b.forEach(function(b){return b.switchTo(a)})}})}function n(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=document.createElement("select");a.insertBefore(d,a.firstChild);var e=l(b);e.forEach(function(a,b){var c=i(d,"option");c.__data__=a,c.setAttribute("value",String(b)),c.textContent=a.name}),d.onchange=function(){return b.forEach(function(a){return a.switchTo(e[d.selectedIndex])})}}function o(a,b,c){return new r(a,b,c)}function p(a,b,c,d,e){return new t(a,b,c,d,e)}var q=function(){function a(a){this.proxy=a}return Object.defineProperty(a.prototype,"scaling",{get:function(){var a=this.proxy();return a?a.scaling:"free"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotation",{get:function(){var a=this.proxy();return a?a.rotation:0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sizeDependsOnDataDimension",{get:function(){var a=this.proxy();return a?a.sizeDependsOnDataDimension:[!1,!1]},enumerable:!0,configurable:!0}),a}(),r=function(a){function b(b,e,f){var g=this;void 0===f&&(f={}),a.call(this),this.data=b,this.options=f,this.metaData_=new q(function(){return g.actDesc}),this.options=c.mixin({initialVis:0,all:{}},f),this.node=i(e,"div","multiform"),e.__data__=b,d.assignVis(this.node,this),this.visses=d.list(b),this.build()}return __extends(b,a),Object.defineProperty(b.prototype,"asMetaData",{get:function(){return this.metaData_},enumerable:!0,configurable:!0}),b.prototype.build=function(){this.content=i(this.node,"div","content"),this.switchTo(this.options.initialVis)},b.prototype.destroy=function(){this.actVis&&c.isFunction(this.actVis.destroy)&&this.actVis.destroy(),a.prototype.destroy.call(this)},b.prototype.persist=function(){return{id:this.actDesc?this.actDesc.id:null,content:this.actVis&&c.isFunction(this.actVis.persist)?this.actVis.persist():null}},b.prototype.restore=function(a){var b=this;if(a.id){var d=c.search(this.visses,function(b){return b.id===a.id});if(d)return this.switchTo(d).then(function(d){return d&&a.content&&c.isFunction(d.restore)?Promise.resolve(d.restore(a.content)).then(function(){return b}):b})}return Promise.resolve(b)},b.prototype.locate=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var d=this.actVisPromise||Promise.resolve(null);return d.then(function(){for(var b=[],d=0;d<arguments.length;d++)b[d-0]=arguments[d];var e=b.length>0?b[0]:void 0;return e&&c.isFunction(e.locate)?e.locate.apply(e,a):Promise.resolve(1===b.length?void 0:new Array(a.length))})},b.prototype.locateById=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var d=this.actVisPromise||Promise.resolve(null);return d.then(function(){for(var b=[],d=0;d<arguments.length;d++)b[d-0]=arguments[d];var e=b.length>0?b[0]:void 0;return e&&c.isFunction(e.locateById)?e.locateById.apply(e,a):Promise.resolve(1===b.length?void 0:new Array(a.length))})},b.prototype.transform=function(a,b){var c=this;if(this.actVis){if(0===arguments.length)return this.actVis.transform();var d=function(a,b,d){c.fire("transform",b,d)};this.actVis.on("transform",d);var e=this.actVis.transform(a,b);return this.actVis.off("transform",d),e}return this.actVisPromise&&arguments.length>0?void this.actVisPromise.then(function(d){return c.transform(a,b)}):{scale:[1,1],rotate:0}},Object.defineProperty(b.prototype,"act",{get:function(){return this.actDesc},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"actLoader",{get:function(){return this.actVisPromise},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"size",{get:function(){return this.actVis?this.actVis.size:[100,100]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rawSize",{get:function(){return this.actVis?this.actVis.rawSize:[100,100]},enumerable:!0,configurable:!0}),b.prototype.switchTo=function(a){var b=this,d=g(a,this.visses);if(d===this.actDesc)return this.actVisPromise;this.actVis&&(this.actVis.destroy(),this.actVis=null,this.actVisPromise=null),h(this.content);var e=this.actDesc;return this.actDesc=d,this.markReady(!1),this.fire("change",d,e),this.actVis=null,this.actVisPromise=null,d?this.actVisPromise=d.load().then(function(a){return b.actDesc!==d?null:(b.actVis=a.factory(b.data,b.content,c.mixin({},b.options.all,b.options[d.id]||{})),b.actVis.on("ready",function(){return b.markReady()}),b.fire("changed",d,e),b.actVis)}):Promise.resolve(null)},b}(d.AVisInstance);b.MultiForm=r;var s=function(){function a(a,b,c){this.range=a,this.pos=b,this.data=c}return a.prototype.setContent=function(a){this.content=a,this.content.__data__=this.data},a.prototype.subrange=function(a){var b=this.range.intersect(a);return this.range.indexOf(b)},Object.defineProperty(a.prototype,"hasOne",{get:function(){return null!=this.actVis},enumerable:!0,configurable:!0}),a.prototype.destroy=function(){this.actVis&&c.isFunction(this.actVis.destroy)&&this.actVis.destroy()},Object.defineProperty(a.prototype,"size",{get:function(){return this.actVis?this.actVis.size:[100,100]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rawSize",{get:function(){return this.actVis?this.actVis.rawSize:[100,100]},enumerable:!0,configurable:!0}),a.prototype.persist=function(){return{range:this.range.toString(),content:this.actVis&&c.isFunction(this.actVis.persist)?this.actVis.persist():null}},a.prototype.restore=function(a){return null},a.prototype.switchDestroy=function(){h(this.content),this.actVis&&c.isFunction(this.actVis.destroy)&&this.actVis.destroy(),this.actVis=null},a.prototype.build=function(a,b){return this.actVis=a.factory(this.data,this.content,b),d.assignVis(this.content,this.actVis),this.actVis},Object.defineProperty(a.prototype,"location",{get:function(){var a=c.offset(this.content);return{x:a.left,y:a.top}},enumerable:!0,configurable:!0}),a.prototype.transform=function(a,b){return this.actVis?arguments.length>0?this.actVis.transform(a,b):this.actVis.transform():{scale:[1,1],rotate:0}},a}(),t=function(a){function b(b,f,g,h,j){function k(a,c,d){if(a===m.length){var f=0===c.length?e.all():e.list(c.slice());n.push(new s(f,d.slice(),h(b,f,d.slice())))}else m[a].forEach(function(b,e){c.push(b),d.push(e),k(a+1,c,d),c.pop(),d.pop()})}var l=this;void 0===j&&(j={}),a.call(this),this.data=b,this.range=f,this.options=j,this.metaData_=new q(function(){return l.actDesc}),this.options=c.mixin({initialVis:0,singleRowOptimization:!0},j),this.node=i(g,"div","multiformgrid"),g.__data__=b,d.assignVis(this.node,this),this.visses=d.list(b);var m=this.dims=f.dims.map(function(a){return a instanceof e.CompositeRange1D?a.groups:a instanceof e.Range1DGroup?[a]:[e.asUngrouped(a)]}),n=this.grid=[];k(0,[],[]),this.build()}return __extends(b,a),Object.defineProperty(b.prototype,"dimSizes",{get:function(){return this.dims.map(function(a){return a.length})},enumerable:!0,configurable:!0}),b.prototype.toElem=function(a){var b=this.dimSizes;return 1===b.length?this.grid[a[0]]:this.grid[a[0]*b[1]+(a[1]||0)]},b.prototype.getRange=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=this.toElem(a);return c.range},b.prototype.getData=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=this.toElem(a);return c.data},b.prototype.getBounds=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var d=this.toElem(a),e=d.location,g=d.size,h=c.offset(this.content);return f.rect(e.x-h.left,e.y-h.top,g[0],g[1])},Object.defineProperty(b.prototype,"asMetaData",{get:function(){return this.metaData_},enumerable:!0,configurable:!0}),b.prototype.build=function(){var a=this;this.content=this.node;var b=this.options.wrap||c.identity;if(1===this.dims.length)this.options.singleRowOptimization?this.grid.forEach(function(c){return c.setContent(b(i(a.node,"div","content gridrow"),c.data,c.range,c.pos))}):this.grid.forEach(function(c){var d=i(a.node,"div","gridrow"),e=i(d,"div","content");e.style.display="inline-block",c.setContent(b(e,c.data,c.range,c.pos))});else for(var d=this.dimSizes,e=0;e<d[0];++e)for(var f=i(this.node,"div","gridrow"),g=0;g<d[1];++g){var h=this.grid[e*d[1]+g],j=i(f,"div","content");j.style.display="inline-block",h.setContent(b(j,h.data,h.range,h.pos))}this.switchTo(this.options.initialVis)},b.prototype.destroy=function(){this.grid.forEach(function(a){a.destroy()}),a.prototype.destroy.call(this)},b.prototype.transform=function(a,b){if(this.grid[0].hasOne){var c=this.grid[0].transform();return arguments.length>0&&(this.grid.forEach(function(c){return c.transform(a,b)}),this.fire("transform",{scale:a,rotate:b},c)),c}return{scale:[1,1],rotate:0}},b.prototype.persist=function(){return{id:this.actDesc?this.actDesc.id:null,contents:this.grid.map(function(a){return a.persist()})}},b.prototype.restore=function(a){var b=this;if(a.id){var d=c.search(this.visses,function(b){return b.id===a.id});if(d)return this.switchTo(d).then(function(d){return d&&a.content&&c.isFunction(d.restore)?Promise.resolve(d.restore(a.content)).then(function(){return b}):Promise.resolve(b)})}return Promise.resolve(b)},b.prototype.locateGroup=function(a){function b(a){return{x:a.x-g.left,y:a.y-g.top}}function d(){var c,d,e,f=[];for(c=0;c<this.grid.length;++c)e=this.grid[c],d=e.subrange(a),d.isNone||f.push({g:e,pos:b(e.location),r:d});return f}if(a.isAll||a.isNone){var e=this.size;return Promise.resolve(f.rect(0,0,e[0],e[1]))}var g=c.offset(this.content),h=d.call(this);return 1===h.length?h[0].g.actVis.locate(h[0].r).then(function(a){return a?a.shift(h[0].pos):a}):Promise.all(h.map(function(a){return a.g.actVis.locate(a.r)})).then(function(a){a=a.map(function(a,b){return a?a.shift(h[b].pos):a}).filter(function(a){return null!=a});var b=a[0].aabb(),c=b.x,d=b.y,e=b.x2,g=b.y2;return a.forEach(function(a){var b=a.aabb();c=Math.min(c,b.x),d=Math.min(d,b.y),e=Math.min(e,b.x2),g=Math.min(g,b.y2)}),f.rect(c,d,e-c,g-d)})},b.prototype.locateGroupById=function(a){var b=this;return this.data.ids().then(function(c){return b.locateGroup(c.indexOf(a))})},b.prototype.locate=function(){var a=this.actVisPromise||Promise.resolve(null),b=c.argList(arguments);return a.then(function(a){var c=this;return a?1===a.length?a[0].locate.apply(a[0],b):1===arguments.length?this.locateGroup(arguments[0]):Promise.all(b.map(function(a){return c.locateGroup(a)})):Promise.resolve(1===arguments.length?void 0:new Array(b.length))})},b.prototype.locateById=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var d=this.actVisPromise||Promise.resolve(null),e=c.argList(arguments);return d.then(function(a){var b=this;return a?1===a.length?a[0].locateById.apply(a[0],e):1===e.length?this.locateGroupById(e[0]):Promise.all(e.map(function(a){return b.locateGroupById(a)})):Promise.resolve(1===arguments.length?void 0:new Array(e.length))})},Object.defineProperty(b.prototype,"act",{get:function(){return this.actDesc},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"actLoader",{get:function(){return this.actVisPromise},enumerable:!0,configurable:!0}),b.prototype.gridSize=function(a){void 0===a&&(a=!1);var b=this.grid.map(a?function(a){return a.rawSize}:function(a){return a.size});if(1===this.dims.length)return{cols:[k(b,function(a){return a[0]})],rows:b.map(function(a){return a[1]}),grid:b.map(function(a){return[a]})};var c=this.dims[1].length,d=this.dims[0].map(function(a,d){return b.slice(d*c,(d+1)*c)});return{cols:this.dims[1].map(function(a,b){return k(d,function(a){return a[b][0]})}),rows:d.map(function(a){return k(a,function(a){return a[1]})}),grid:d}},Object.defineProperty(b.prototype,"size",{get:function(){var a=this.gridSize();return[j(a.cols),j(a.rows)]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rawSize",{get:function(){var a=this.gridSize(!0);return[j(a.cols),j(a.rows)]},enumerable:!0,configurable:!0}),b.prototype.switchTo=function(a){var b=this,d=g(a,this.visses);if(d===this.actDesc)return this.actVisPromise;this.grid.forEach(function(a){return a.switchDestroy()});var e=this.actDesc;return this.actDesc=d,this.markReady(!1),this.fire("change",d,e),this.actVisPromise=null,d?this.actVisPromise=d.load().then(function(a){if(b.actDesc!==d)return null;var f=c.mixin({},b.options.all,b.options[d.id]||{}),g=b.grid.map(function(b){return b.build(a,f)}),h=g.length;return g.forEach(function(a){a.on("ready",function(){h--,0===h&&b.markReady()})}),b.fire("changed",d,e),g}):Promise.resolve([])},b}(d.AVisInstance);b.MultiFormGrid=t,b.toAvailableVisses=l,b.addIconVisChooser=m,b.addSelectVisChooser=n,b.create=o,b.createGrid=p}(a,c,a("./main"),a("./vis"),a("./range"),a("./geom"))},{"./geom":8,"./main":13,"./range":20,"./vis":28}],19:[function(a,b,c){!function(a,b,c,d){function e(a,b){return{desc:b,impl:a,factory:a[b.factory]}}function f(a){return function(){return a.instance||a.loader?Promise.resolve(a.instance||a.loader()).then(function(b){return e(b,a)}):new Promise(function(b){c([a.module],function(c){b(e(c,a))})})}}function g(a,b,c){return void 0===b&&(b=""),void 0===c&&(c=".."),a=d.mixin({name:a.id,folder:a.folder,file:"main",factory:"create",description:"",version:"1.0"},a),a=d.mixin({module:a.folder+"/"+a.file,baseUrl:b+"/"+a.folder},a),a.module=c+"/"+a.module,a.load=f(a),a}function h(a,b,c){return void 0===b&&(b=""),void 0===c&&(c=".."),a.map(function(a){return g(a,b,c)})}function i(a){if(void 0===a&&(a=d.constantTrue),"string"==typeof a){var b=a;a=function(a){return a.type===b}}return 0===m.length&&(m=h(d.registry.extensions,d.registry.baseUrl,d.registry.relativeUrl)),a===d.constantTrue?m:m.filter(a)}function j(a,b,c){void 0===b&&(b=d.registry.baseUrl),void 0===c&&(c=d.registry.relativeUrl),0===m.length&&(m=h(d.registry.extensions,d.registry.baseUrl,d.registry.relativeUrl));var e=g(a,b,c);return m.push(e),e}function k(a,b,c){return void 0===b&&(b=d.registry.baseUrl),void 0===c&&(c=d.registry.relativeUrl),a.map(function(a){return j(a,b,c)})}function l(a){return 0===a.length?Promise.resolve([]):new Promise(function(b){a.every(function(a){return!!a.instance||!!a.loader})?Promise.all(a.map(function(a){return a.instance||a.loader()})).then(function(b){return b.map(function(b,c){return e(b,a[c])})}).then(b):c(a.map(function(a){return a.module}),function(){for(var c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];b(c.map(function(b,c){return e(b,a[c])}))})})}var m=[];b.list=i,b.push=j,b.pushAll=k,b.load=l}(a,c,a,a("./main"))},{"./main":13}],20:[function(a,b,c){!function(a,b,c,d){"use strict";function e(a,b){return 0>a?b+1+a:a}function f(a){return new v("unnamed","gray",a)}function g(a,b){return new w(a,b)}function h(a){if(1===a.length)return a[0];var b=a[0].iter().asList();return a.slice(1).forEach(function(a){a.iter().forEach(function(a){b.indexOf(a)<0&&b.push(a)})}),u.from(b)}function i(){return new x}function j(){var a=new x;return a.dims=[u.none(),u.none()],a}function k(a){return a instanceof x}function l(){if(0===arguments.length)return i();var a=new x;return Array.isArray(arguments[0])&&c.argList(arguments).forEach(function(b,c){0!==b.length&&a.dim(c).setSlice(b[0],b[1],b[2])}),"number"==typeof arguments[0]&&a.dim(0).setSlice(arguments[0],arguments[1],arguments[2]),a}function m(){if(0===arguments.length)return i();var a=new x,b=arguments[0];return Array.isArray(b)||(b=c.argList(arguments)),a.dims=b.map(function(a){return a.dim(0)}),a}function n(){if(0===arguments.length)return i();var a=new x;return Array.isArray(arguments[0])&&arguments[0][0]instanceof u?a.dims=arguments[0]:Array.isArray(arguments[0])?c.argList(arguments).forEach(function(b,c){b instanceof u?a.dims[c]=b:a.dim(c).setList(b)}):"number"==typeof arguments[0]?a.dim(0).setList(c.argList(arguments)):arguments[0]instanceof u&&(a.dims=c.argList(arguments)),a}function o(a){var b,c,d=0,e=new Array;for(a=a.trim();d<a.length;)switch(b=a.charAt(d)){case'"':c=p(a,d),d=c.act+1,e.push(c.dim);break;case",":d++,e.push(u.all());break;default:c=q(a,d),d=c.act+1,e.push(c.dim)}","===a.charAt(a.length-1)&&e.push(u.all());var f=new x(e);return f}function p(a,b){b+=1;var c,d=a.indexOf('"',b),e=a.slice(b,d);switch(b=d+1,a.charAt(b)){case'"':return d=a.indexOf('"',b+1),c=q(a,d+1),{dim:new v(e,a.slice(b+1,d),c.dim),act:c.act};case"{":for(var f=[];"}"!==a.charAt(b);)c=p(a,b+1),f.push(c.dim),b=c.act;return{dim:new w(e,f),act:c.act+1};default:return{dim:u.all(),act:b}}}function q(a,b){var c,d=new u;switch(a.charAt(b)){case",":case"}":c=b,d=u.all();break;case"(":c=a.indexOf(")",b),c>b+1&&d.push.apply(d,a.slice(b+1,c).split(",").map(s.parse)),c+=1;break;default:c=a.indexOf("}",b);var e=a.indexOf(",",b);c>=0&&e>=0?c=Math.min(c,e):0>c&&(c=e),0>c&&(c=a.length),d=new u([s.parse(a.slice(b,c))])}return{act:c,dim:d}}function r(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return 0===a.length?i():1===a.length&&a[0]instanceof x?a[0]:1===a.length&&Array.isArray(a[0])&&"number"==typeof a[0][0]?n(a[0]):o(a.map(String).join(","))}var s=function(){function a(a,b,c){void 0===b&&(b=-1),void 0===c&&(c=1),this.from=a,this.to=b,this.step=c}return Object.defineProperty(a.prototype,"isAll",{get:function(){return 0===this.from&&-1===this.to&&1===this.step},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isSingle",{get:function(){return this.from+this.step===this.to},enumerable:!0,configurable:!0}),a.all=function(){return new a(0,-1,1)},a.none=function(){return new a(0,0,1)},a.single=function(a){return new t(a)},a.range=function(b,c,d){return void 0===c&&(c=-1),void 0===d&&(d=1),b+d===c?a.single(b):new a(b,c,d)},a.prototype.size=function(a){var b=e(this.to,a),c=e(this.from,a);if(1===this.step)return Math.max(b-c,0);if(-1===this.step)return Math.max(c-b,0);var d=this.step>0?b-c+1:c-b+1,f=Math.abs(this.step);return 0>=d?0:Math.floor(d/f)},a.prototype.clone=function(){return new a(this.from,this.to,this.step)},a.prototype.reverse=function(){var b=this.from<0?this.from:this.from+1,c=this.to<0?this.to:this.to-1;return new a(c,b,-this.step)},a.prototype.invert=function(a,b){return this.isAll?a:e(this.from,b)+a*this.step},a.prototype.iter=function(a){return d.range(e(this.from,a),e(this.to,a),this.step)},Object.defineProperty(a.prototype,"__iterator__",{get:function(){return this.iter()},enumerable:!0,configurable:!0}),a.prototype.contains=function(a,b){var c=e(this.from,b),d=e(this.to,b);return-1===this.step?c>=a&&a>d:a>=c&&d>a},a.prototype.toString=function(){if(this.isAll)return"";if(this.isSingle)return this.from.toString();var a=this.from+":"+this.to;return 1!==this.step&&(a+=":"+this.step),a},a.parse=function(b){if(0===b.length)return a.all();var c=b.split(":");return 1===c.length?a.single(parseFloat(c[0])):2===c.length?new a(parseFloat(c[0]),parseFloat(c[1])):new a(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]))},a}();b.RangeElem=s;var t=function(){function a(a){this.from=a}return Object.defineProperty(a.prototype,"step",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"to",{get:function(){return this.from+1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isAll",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isSingle",{get:function(){return!0},enumerable:!0,configurable:!0}),a.prototype.size=function(a){return 1},a.prototype.clone=function(){return new a(this.from)},a.prototype.contains=function(a,b){return e(this.from,b)===a},a.prototype.reverse=function(){return this.clone()},a.prototype.invert=function(a,b){return e(this.from,b)+a},a.prototype.iter=function(a){return d.single(e(this.from,a))},Object.defineProperty(a.prototype,"__iterator__",{get:function(){return this.iter()},enumerable:!0,configurable:!0}),a.prototype.toString=function(){return this.from.toString()},a}();b.SingleRangeElem=t;var u=function(){function a(b){b instanceof a?this.arr=b.arr:Array.isArray(b)?this.arr=b:this.arr=[]}return Object.defineProperty(a.prototype,"length",{get:function(){return this.size()},enumerable:!0,configurable:!0}),a.all=function(){return new a([s.all()])},a.none=function(){return new a},a.from=function(b){return new a(a.compress(b))},a.compress=function(a){if(0===a.length)return[];if(1===a.length)return[s.single(a[0])];for(var b=new Array,c=a.slice(1).map(function(b,c){return b-a[c]}),d=0,e=1,f=0;e<a.length;){for(;c[d]===c[e-1]&&e<a.length;)e++;if(e===d+1)b.push(s.single(a[d]));else if(1===Math.abs(c[d]))b.push(s.range(a[d],a[e-1]+c[d],c[d]));else for(f=d;e>f;f++)b.push(s.single(a[f]));d=e,e+=1}for(;d<a.length;)b.push(s.single(a[d++]));return b},Object.defineProperty(a.prototype,"isAll",{get:function(){return 1===this.arr.length&&this.at(0).isAll},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isNone",{get:function(){return 0===this.arr.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isList",{get:function(){return this.arr.every(function(a){return a.isSingle})},enumerable:!0,configurable:!0}),a.prototype.push=function(){function a(a){return"string"==typeof a?s.parse(a.toString()):"number"==typeof a?s.single(a):Array.isArray(a)?new s(a[0],a[1],a[2]):a}for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];return this.arr.push.apply(this.arr,b.map(a))},a.prototype.pushSlice=function(a,b,c){void 0===b&&(b=-1),void 0===c&&(c=1),this.arr.push(new s(a,b,c))},a.prototype.pushList=function(b){this.arr.push.apply(this.arr,a.compress(b))},a.prototype.setSlice=function(a,b,c){void 0===b&&(b=-1),void 0===c&&(c=1),this.arr.length=0,this.pushSlice(a,b,c)},a.prototype.setList=function(a){this.arr.length=0,this.pushList(a)},a.prototype.at=function(a){return 0>a&&(a+=this.length),0>a||a>=this.arr.length?s.none():this.arr[a]},a.prototype.size=function(a){var b=this.arr.map(function(b){return b.size(a)});return b.reduce(function(a,b){return a+b},0)},Object.defineProperty(a.prototype,"isIdentityRange",{get:function(){return 1===this.arr.length&&0===this.arr[0].from&&1===this.arr[0].step},enumerable:!0,configurable:!0}),a.prototype.repeat=function(b){if(void 0===b&&(b=1),1===b)return this;for(var c=this.arr.slice(),d=1;b>d;++d)c.push.apply(c,this.arr);return new a(c)},a.prototype.preMultiply=function(b,c){if(this.isAll)return b.clone();if(b.isAll)return this.clone();if(b.isNone||this.isNone)return a.none();if(this.isIdentityRange)return b.clone();var d=this.iter(c).asList(),e=function(a){var b=a.iter(d.length),c=[];return b.forEach(function(a){a>=0&&a<d.length&&c.push(d[a])}),a.fromLike(c)};return b instanceof w?g(b.name,b.groups.map(e)):e(b)},a.prototype.union=function(a,b){if(this.isAll||a.isNone)return this.clone();if(a.isAll||this.isNone)return a.clone();var c=this.iter(b).asList(),d=a.iter(b);return d.forEach(function(a){c.indexOf(a)<0&&c.push(a)}),a.fromLike(c.sort())},a.prototype.intersect=function(b,c){if(this.isNone||b.isNone)return a.none();if(this.isAll)return b.clone();if(b.isAll)return this.clone();var d=this.iter(c).asList(),e=b.iter(c),f=[];return e.forEach(function(a){d.indexOf(a)>=0&&f.push(a)}),b.fromLike(f.sort())},a.prototype.toSet=function(a){return this.removeDuplicates(a)},a.prototype.without=function(b,c){if(this.isNone||b.isNone)return this.clone();if(b.isAll)return a.none();var d=this.iter(c),e=b.iter(c).asList(),f=[];return d.forEach(function(a){e.indexOf(a)<0&&f.push(a)}),a.from(f.sort())},a.prototype.clone=function(){return new a(this.arr.map(function(a){return a.clone()}))},a.prototype.invert=function(a,b){if(this.isAll)return a;if(this.isNone)return-1;for(var c=0,d=this.arr[0].size(b),e=d;e>a&&c<this.length;)c++,d=this.arr[c].size(b),e+=d;return c>=this.arr.length?-1:this.arr[c-1].invert(a-e+d,b)},a.prototype.indexOf=function(){if(arguments[0]instanceof x)return this.indexRangeOf(arguments[0],arguments[1]);var a,b=this.iter().asList();if(1===arguments.length){if("number"==typeof arguments[0])return b.indexOf(arguments[0]);a=arguments[0]}else a=c.argList(arguments);return 0===a.length?[]:a.map(function(a,c){return b.indexOf(a)})},a.prototype.indexRangeOf=function(b,c){if(b.isNone||this.isNone)return b.fromLike([]);if(b.isAll)return a.all();var d;if(this.isIdentityRange){var e=this.arr[0].to;d=function(a,b){a>=0&&e>a&&b.push(a)}}else{var f=this.iter().asList();d=function(a,b){var c=f.indexOf(a);c>=0&&b.push(c)}}if(b instanceof w)return g(b.name,b.groups.map(function(a){var b=[];return a.forEach(function(a){return d(a,b)}),a.fromLike(b)}));var h=[];return b.forEach(function(a){return d(a,h)}),b.fromLike(h)},a.prototype.filter=function(a,b,e){if(void 0===e&&(e=c.identity),this.isAll)return a.map(e);var f=this.iter(b);if(f.byOne&&f instanceof d.Iterator)return a.slice(f.from,f.to).map(e);for(var g=[];f.hasNext();)g.push(e(a[f.next()]));return g},a.prototype.iter=function(a){return this.isList?d.forList(this.arr.map(function(a){return a.from})):d.concat.apply(d,this.arr.map(function(b){return b.iter(a)}))},Object.defineProperty(a.prototype,"__iterator__",{get:function(){return this.iter()},enumerable:!0,configurable:!0}),a.prototype.asList=function(a){return this.iter(a).asList()},Object.defineProperty(a.prototype,"first",{get:function(){return this.isNone?null:this.arr[0].from},enumerable:!0,configurable:!0}),a.prototype.forEach=function(a,b){return this.iter().forEach(a,b)},a.prototype.contains=function(a,b){return this.arr.some(function(c){return c.contains(a,b)})},a.prototype.sort=function(a){void 0===a&&(a=function(a,b){return a-b});var b=this.iter().asList(),c=b.sort(a);return this.fromLike(c)},a.prototype.removeDuplicates=function(b){var c=this.iter().asList();return c=c.sort(),c=c.filter(function(a,b){return a!==c[b-1]}),a.from(c)},a.prototype.reverse=function(){var b=this.arr.map(function(a){return a.reverse()});return b.reverse(),new a(b)},a.prototype.toString=function(){return this.isAll?"":1===this.length?this.arr[0].toString():"("+this.arr.join(",")+")"},a.prototype.eq=function(a){return this===a||this.isAll&&a.isAll||this.isNone&&a.isNone?!0:this.toString()===a.toString()},a.prototype.fromLike=function(b){return a.from(b)},a}();b.Range1D=u;var v=function(a){function b(b,c,d){a.call(this,d),this.name=b,this.color=c}return __extends(b,a),b.prototype.preMultiply=function(c,d){var e=a.prototype.preMultiply.call(this,c,d);return new b(this.name,this.color,e)},b.prototype.union=function(c,d){var e=a.prototype.union.call(this,c,d);return new b(this.name,this.color,e)},b.prototype.intersect=function(c,d){var e=a.prototype.intersect.call(this,c,d);return new b(this.name,this.color,e)},b.prototype.without=function(c,d){var e=a.prototype.without.call(this,c,d);return new b(this.name,this.color,e)},b.prototype.clone=function(){return new b(this.name,this.color,a.prototype.clone.call(this))},b.prototype.toString=function(){return'"'+this.name+'""'+this.color+'"'+a.prototype.toString.call(this)},b.prototype.toSet=function(c){return new b(this.name,this.color,a.prototype.toSet.call(this,c))},b.prototype.fromLike=function(c){return new b(this.name,this.color,a.prototype.fromLike.call(this,c))},b}(u);b.Range1DGroup=v,b.asUngrouped=f,b.composite=g;var w=function(a){function b(b,c,d){a.call(this,d?d:h(c)),this.name=b,this.groups=c}return __extends(b,a),b.prototype.preMultiply=function(c,d){var e=this.groups.length>1?a.prototype.preMultiply.call(this,c,d):void 0;return new b(this.name,this.groups.map(function(a){return a.preMultiply(c,d)}),e)},b.prototype.union=function(c,d){var e=this.groups.length>1?a.prototype.union.call(this,c,d):void 0;return new b(this.name,this.groups.map(function(a){return a.union(c,d)}),e)},b.prototype.intersect=function(c,d){var e=this.groups.length>1?a.prototype.intersect.call(this,c,d):void 0;return new b(this.name,this.groups.map(function(a){return a.intersect(c,d)}),e)},b.prototype.without=function(c,d){var e=this.groups.length>1?a.prototype.without.call(this,c,d):void 0;return new b(this.name,this.groups.map(function(a){return a.without(c,d)}),e)},b.prototype.clone=function(){var c=this.groups.length>1?a.prototype.clone.call(this):void 0;return new b(name,this.groups.map(function(a){return a.clone()}),c)},b.prototype.sort=function(c){var d=this.groups.length>1?a.prototype.sort.call(this,c):void 0;return new b(this.name,this.groups.map(function(a){return a.sort(c)}),d)},b.prototype.toSet=function(c){var d=this.groups.length>1?a.prototype.toSet.call(this,c):void 0;return new b(this.name,this.groups.map(function(a){return a.toSet(c)}),d)},b.prototype.toString=function(){return'"'+this.name+'"{'+this.groups.join(",")+"}"},b}(u);b.CompositeRange1D=w;var x=function(){function a(a){void 0===a&&(a=new Array),this.dims=a}return Object.defineProperty(a.prototype,"isAll",{get:function(){return this.dims.every(function(a){return a.isAll})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isNone",{get:function(){return this.dims.every(function(a){return a.isNone})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"first",{get:function(){return this.dim(0).first},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ndim",{get:function(){return this.dims.length},enumerable:!0,configurable:!0}),a.prototype.eq=function(a){return this===a||this.isAll&&a.isAll||this.isNone&&a.isNone?!0:this.toString()===a.toString()},a.prototype.preMultiply=function(b,c){if(this.isAll)return b.clone();if(b.isAll)return this.clone();var d=new a;return this.dims.forEach(function(a,e){d.dims[e]=a.preMultiply(b.dim(e),c?c[e]:void 0)}),d},a.prototype.union=function(b,c){if(this.isAll||b.isNone)return this.clone();if(b.isAll||this.isNone)return b.clone();var d=new a;return this.dims.forEach(function(a,e){d.dims[e]=a.union(b.dim(e),c?c[e]:void 0)}),d},a.prototype.intersect=function(b,c){if(this.isNone||b.isNone)return j();if(this.isAll)return b.clone();if(b.isAll)return this.clone();var d=new a;return this.dims.forEach(function(a,e){d.dims[e]=a.intersect(b.dim(e),c?c[e]:void 0)}),d},a.prototype.without=function(b,c){if(this.isNone||b.isNone)return this.clone();if(b.isAll)return j();var d=new a;return this.dims.forEach(function(a,e){
d.dims[e]=a.without(b.dim(e),c?c[e]:void 0)}),d},a.prototype.clone=function(){var b=new a;return this.dims.forEach(function(a,c){b.dims[c]=a.clone()}),b},a.prototype.swap=function(){var b=new a;return b.dims=this.dims.map(function(a){return a.clone()}).reverse(),b},a.prototype.filter=function(a,b){function d(a){if(a>=e)return c.identity;var g=f.dim(a),h=d(a+1),i=b?b[a]:void 0;return function(a){return Array.isArray(a)?g.filter(a,i,h):a}}if(this.isAll)return a;var e=this.ndim,f=this,g=d(0);return g(a)},a.prototype.dim=function(a){var b=this.dims[a];return b?b:(this.dims[a]=u.all(),this.dims[a])},a.prototype.invert=function(a,b){var c=this;return this.isAll?a:a.map(function(a,d){return c.dim(d).invert(a,b?b[d]:void 0)})},a.prototype.indexRangeOf=function(b,c){return b.isNone||this.isNone?j():this.isNone||b.isAll?this.clone():new a(this.dims.map(function(a,d){return a.indexRangeOf(b.dim(d),c?c[d]:void 0)}))},a.prototype.indexOf=function(){var b=this;if(arguments[0]instanceof a)return this.indexRangeOf(arguments[0],arguments[1]);var d;if(1===arguments.length){if("number"==typeof arguments[0])return this.dim(0).indexOf(arguments[0]);d=arguments[0]}else d=c.argList(arguments);return 0===d.length?[]:d.map(function(a,c){return b.dim(c).indexOf(a)})},a.prototype.size=function(a){return this.isAll?a:this.dims.map(function(b,c){return b.size(a?a[c]:void 0)})},a.prototype.split=function(){return this.dims.map(function(b){return new a([b])})},a.prototype.toString=function(){return this.dims.map(function(a){return a.toString()}).join(",")},a}();b.Range=x,b.all=i,b.none=j,b.is=k,b.range=l,b.join=m,b.list=n,b.parse=r}(a,c,a("./main"),a("./iterator"))},{"./iterator":10,"./main":13}],21:[function(a,b,c){!function(a,b){function c(a,b){var c=g[a];return g[a]=b,c}function d(a){delete g[a]}function e(a){return a in g}function f(a,b){return void 0===b&&(b=null),e(a)?g[a]:b}var g={};b.store=c,b.remove=d,b.has=e,b.retrieve=f}(a,c)},{}],22:[function(a,b,c){!function(a,b,c,d,e){"use strict";function f(a,b){switch(b.toLowerCase()){case"male":return"blue";case"female":return"red";case"deceased":return"#e41a1b";case"living":return"#377eb8"}return"gray"}b.guessColor=f;var g=function(a){function b(b,c,d){a.call(this),this.root=b,this.groupIndex=c,this.groupDesc=d}return __extends(b,a),Object.defineProperty(b.prototype,"desc",{get:function(){return this.root.desc},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"groups",{get:function(){return[this.groupDesc]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ngroups",{get:function(){return 1},enumerable:!0,configurable:!0}),b.prototype.group=function(a){return 0===a?this:null},Object.defineProperty(b.prototype,"idtype",{get:function(){return this.root.idtype},enumerable:!0,configurable:!0}),b.prototype.hist=function(a,b){return void 0===b&&(b=c.all()),this.range().then(function(a){return e.rangeHist(a)})},b.prototype.vector=function(){return Promise.all([this.root.vector(),this.rangeGroup()]).then(function(a){return a[0].view(c.list(a[1]))})},b.prototype.origin=function(){return this.root.origin()},b.prototype.range=function(){return this.rangeGroup().then(function(a){return new c.CompositeRange1D(a.name,[a])})},b.prototype.idRange=function(){var a=this;return this.root.idRange().then(function(b){var d=b.groups[a.groupIndex];return new c.CompositeRange1D(d.name,[d])})},b.prototype.rangeGroup=function(){var a=this;return this.root.range().then(function(b){return b.groups[a.groupIndex]})},b.prototype.names=function(a){var b=this;return void 0===a&&(a=c.all()),this.rangeGroup().then(function(d){var e=c.list(d).preMultiply(a);return b.root.names(e)})},b.prototype.ids=function(a){var b=this;return void 0===a&&(a=c.all()),this.rangeGroup().then(function(d){var e=c.list(d).preMultiply(a);return b.root.ids(e)})},b.prototype.idView=function(a){return void 0===a&&(a=c.all()),Promise.reject("not implemented")},b.prototype.toString=function(){return this.persist()},Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.size=function(){return[this.length]},Object.defineProperty(b.prototype,"length",{get:function(){return this.groupDesc.size},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dim",{get:function(){return this.size()},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this.root.persist(),group:this.groupIndex}},b.prototype.restore=function(a){return this},b}(d.SelectAble);b.StratificationGroup=g}(a,c,a("./range"),a("./idtype"),a("./math"))},{"./idtype":9,"./math":15,"./range":20}],23:[function(a,b,c){!function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,b){return e.composite(a,b.map(function(a){var b=new e.Range1DGroup(a.name,a.color||"gray",e.parse(a.range).dim(0));return b}))}function m(){var a=void 0;return function(b){return a?a:a=d.getAPIJSON("/dataset/"+b.id).then(function(a){var c={rowIds:e.parse(a.rowIds),rows:a.rows,range:l(b.name,a.groups)};return c})}}function n(a,b,c){var d=void 0;return function(f){return d?Promise.resolve(d):(d={rowIds:e.list(b),rows:a,range:c},Promise.resolve(d))}}function o(a){return new r(a,m())}function p(a,b,c,d){return new r(a,n(b,c,d))}function q(a){function b(){return Promise.all([a.groups(),a.ids(),a.names()]).then(function(a){return{range:a[0],rowIds:a[1],rows:a[2]}})}var c={id:a.desc.id+"-s",type:"stratification",name:a.desc.name+"-s",fqname:a.desc.fqname+"-s",ngroups:a.desc.value.categories.length,size:a.dim};return new r(c,b)}var r=function(a){function b(b,c){a.call(this,b),this.desc=b,this.loader=c;var d=b;this._idtype=f.resolve(d.idtype)}return __extends(b,a),Object.defineProperty(b.prototype,"idtype",{get:function(){return this._idtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"groups",{get:function(){return this.desc.groups},enumerable:!0,configurable:!0}),b.prototype.group=function(a){return new k.StratificationGroup(this,a,this.groups[a])},b.prototype.load=function(){return this.loader(this.desc)},b.prototype.hist=function(a,b){return this.range().then(function(a){return j.rangeHist(a)})},b.prototype.vector=function(){var a=this;return this._v?this._v:(this._v=this.load().then(function(b){return new s(a,b.range,a.desc)}),this._v)},b.prototype.origin=function(){return"origin"in this.desc?h.getFirstByFQName(this.desc.origin):Promise.reject("no origin specified")},b.prototype.range=function(){return this.load().then(function(a){return a.range})},b.prototype.idRange=function(){var a=this;return this.load().then(function(b){var c=b.rowIds.dim(0),d=b.range;return c.preMultiply(d,a.dim[0])})},b.prototype.names=function(a){void 0===a&&(a=e.all());var b=this;return this.load().then(function(c){return a.filter(c.rows,b.dim)})},b.prototype.ids=function(a){void 0===a&&(a=e.all());var b=this;return this.load().then(function(c){return c.rowIds.preMultiply(a,b.dim)})},Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.size=function(){return this.desc.size},Object.defineProperty(b.prototype,"length",{get:function(){return this.size()[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ngroups",{get:function(){return this.desc.ngroups},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dim",{get:function(){return this.size()},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return this.desc.id},b}(g.DataTypeBase);b.Stratification=r;var s=function(a){function b(b,c,d){a.call(this,null),this.strat=b,this.range=c,this._cache=null,this._root=this,this.valuetype={type:"categorical",categories:c.groups.map(function(a){return{name:a.name,label:a.name,color:a.color}})},this.desc={name:d.name,fqname:d.fqname,id:d.id,type:"vector",value:this.valuetype}}return __extends(b,a),Object.defineProperty(b.prototype,"idtype",{get:function(){return this.strat.idtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this.strat.persist()}},b.prototype.restore=function(a){var b=this;return a&&a.range&&(b=b.view(e.parse(a.range))),b},b.prototype.load=function(){if(null!==this._cache)return this._cache;var a=[];return this.range.groups.forEach(function(b){b.forEach(function(){return a.push(b.name)})}),this._cache=Promise.resolve(a)},b.prototype.at=function(a){return this.load().then(function(b){return b[a]})},b.prototype.data=function(a){void 0===a&&(a=e.all());var b=this;return this.load().then(function(c){return a.filter(c,b.dim)})},b.prototype.names=function(a){return void 0===a&&(a=e.all()),this.strat.names(a)},b.prototype.ids=function(a){return void 0===a&&(a=e.all()),this.strat.ids(a)},b.prototype.size=function(){return this.strat.size()},b.prototype.sort=function(a,b){var d=this;return this.data().then(function(f){var g=c.argSort(f,a,b);return d.view(e.list(g))})},b.prototype.map=function(a,b){return null},b.prototype.filter=function(a,b){var d=this;return this.data().then(function(f){var g=c.argFilter(f,a,b);return d.view(e.list(g))})},b}(i.VectorBase);b.StratificationVector=s,b.create=o,b.wrap=p,b.wrapCategoricalVector=q}(a,c,a("./main"),a("./ajax"),a("./range"),a("./idtype"),a("./datatype"),a("./data"),a("./vector_impl"),a("./math"),a("./stratification"))},{"./ajax":3,"./data":5,"./datatype":6,"./idtype":9,"./main":13,"./math":15,"./range":20,"./stratification":22,"./vector_impl":27}],24:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{dup:16}],25:[function(require,module,exports){!function(require,exports,C,ajax,ranges,idtypes,datatypes,vector_impl){"use strict";function toObjects(a,b){return a.map(function(a){var c={};return b.forEach(function(b,d){c[b.name]=datatypes.mask(a[d],b.value)}),c})}function viaAPILoader(){var a=void 0;return function(b){return a?a:a=ajax.getAPIJSON("/dataset/"+b.id).then(function(a){return a.rowIds=ranges.parse(a.rowIds),a.objs=toObjects(a.data,b.columns),a.data=datatypes.transpose(a.data),b.columns.some(function(a){return a.value&&"missing"in a.value})&&(a.data=a.data.map(function(a,c){return datatypes.mask(a,b.columns[c].value)})),a})}}function viaDataLoader(a,b){var c=void 0;return function(d){function e(a){return a.getter?a.getter:function(b){return b[a.name]}}if(c)return Promise.resolve(c);var f=C.isFunction(b)?b:C.getter(b.toString()),g=d.columns.map(e),h=a.map(function(a){var b={_:a};return d.columns.forEach(function(c,d){b[c.name]=g[d](a)}),b}),i=a.map(f);return c={rowIds:d.rowassigner?d.rowassigner.map(i):ranges.range(0,a.length),rows:i,objs:h,data:g.map(function(b){return a.map(b)})},Promise.resolve(c)}}function create(a){return C.isFunction(a.loader)?new Table(a,a.loader):new Table(a,viaAPILoader())}function wrapObjects(a,b,c){return new Table(a,viaDataLoader(b,c))}function fromVectors(a,b){return new VectorTable(a,b)}var TableBase=function(_super){function TableBase(a){_super.call(this),this._root=a}return __extends(TableBase,_super),Object.defineProperty(TableBase.prototype,"dim",{get:function(){return this.size()},enumerable:!0,configurable:!0}),Object.defineProperty(TableBase.prototype,"nrow",{get:function(){return this.dim[0]},enumerable:!0,configurable:!0}),Object.defineProperty(TableBase.prototype,"ncol",{get:function(){return this.dim[1]},enumerable:!0,configurable:!0}),TableBase.prototype.size=function(){throw new Error("not implemented")},TableBase.prototype.view=function(a){return void 0===a&&(a=ranges.all()),new TableView(this._root,a)},TableBase.prototype.idView=function(a){var b=this;return void 0===a&&(a=ranges.all()),this.ids().then(function(c){return b.view(c.indexOf(a))})},TableBase.prototype.reduce=function(a,b,c,d){return new MultITableVector(this,a,b,c,d)},TableBase.prototype.restore=function(persisted){return persisted&&persisted.f?this.reduce(eval(persisted.f),this,persisted.valuetype,persisted.idtype?idtypes.resolve(persisted.idtype):void 0):persisted&&persisted.range?this.view(ranges.parse(persisted.range)):this},TableBase}(idtypes.SelectAble);exports.TableBase=TableBase;var Table=function(a){function b(b,c){var d=this;a.call(this,null),this.desc=b,this.loader=c,this._root=this;var e=b;this.rowtype=idtypes.resolve(e.idtype||e.rowtype),this.vectors=e.columns.map(function(a,b){return new TableVector(d,b,a)})}return __extends(b,a),b.prototype.load=function(){return this.loader(this.desc)},Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.rowtype]},enumerable:!0,configurable:!0}),b.prototype.col=function(a){return this.vectors[a]},b.prototype.cols=function(a){return void 0===a&&(a=ranges.all()),a.filter(this.vectors,[this.ncol])},b.prototype.at=function(a,b){return this.load().then(function(c){return c.data[b][a]})},b.prototype.data=function(a){void 0===a&&(a=ranges.all());var b=this;return this.load().then(function(c){return datatypes.transpose(a.swap().filter(c.data,b.swap(b.size())))})},b.prototype.objects=function(a){void 0===a&&(a=ranges.all());var b=this;return this.load().then(function(c){return a.filter(c.objs,b.size())})},b.prototype.rows=function(a){void 0===a&&(a=ranges.all());var b=this;return this.load().then(function(c){return a.dim(0).filter(c.rows,b.nrow)})},b.prototype.rowIds=function(a){void 0===a&&(a=ranges.all());var b=this;return this.load().then(function(c){return c.rowIds.preMultiply(a,b.dim)})},b.prototype.ids=function(a){return void 0===a&&(a=ranges.all()),this.rowIds(a)},b.prototype.swap=function(a){return a.slice(0).reverse()},b.prototype.size=function(){return this.desc.size},b.prototype.persist=function(){return this.desc.id},b.prototype.restore=function(b){return b&&"number"==typeof b.col?this.col(b.col):a.prototype.restore.call(this,b)},b}(TableBase);exports.Table=Table;var TableView=function(a){function b(b,c){a.call(this,b),this.range=c,this.range=c}return __extends(b,a),Object.defineProperty(b.prototype,"desc",{get:function(){return this._root.desc},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this._root.persist(),range:this.range.toString()}},b.prototype.restore=function(a){var b=this;return a&&a.range&&(b=b.view(ranges.parse(a.range))),b},b.prototype.size=function(){return this.range.size(this._root.dim)},b.prototype.at=function(a,b){var c=this.range.invert([a,b],this._root.dim);return this._root.at(c[0],c[1])},b.prototype.col=function(a){var b=this.range.invert([0,a],this._root.dim);return this._root.col(b[1])},b.prototype.cols=function(a){return void 0===a&&(a=ranges.all()),this._root.cols(this.range.swap().preMultiply(a,this._root.dim))},b.prototype.data=function(a){return void 0===a&&(a=ranges.all()),this._root.data(this.range.preMultiply(a,this._root.dim))},b.prototype.objects=function(a){return void 0===a&&(a=ranges.all()),this._root.objects(this.range.preMultiply(a,this._root.dim))},b.prototype.rows=function(a){return void 0===a&&(a=ranges.all()),this._root.rows(this.range.preMultiply(a,this._root.dim))},b.prototype.rowIds=function(a){return void 0===a&&(a=ranges.all()),this._root.rowIds(this.range.preMultiply(a,this._root.dim))},b.prototype.ids=function(a){return void 0===a&&(a=ranges.all()),this.rowIds(a)},b.prototype.view=function(a){return void 0===a&&(a=ranges.all()),a.isAll?this:new b(this._root,this.range.preMultiply(a,this.dim))},Object.defineProperty(b.prototype,"rowtype",{get:function(){return this._root.rowtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.rowtype]},enumerable:!0,configurable:!0}),b}(TableBase),TableVector=function(a){function b(b,c,d){a.call(this,null),this.table=b,this.index=c,this.desc=d,this._root=this,this.valuetype=d.value,this.desc.fqname=b.desc.fqname+"/"+this.desc.name,this.desc.type="vector"}return __extends(b,a),Object.defineProperty(b.prototype,"idtype",{get:function(){return this.table.rowtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this.table.persist(),col:this.index}},b.prototype.restore=function(a){var b=this;return a&&a.range&&(b=b.view(ranges.parse(a.range))),b},b.prototype.load=function(){var a=this;return this.table.load().then(function(b){return b.data[a.index]})},b.prototype.at=function(a){return this.load().then(function(b){return b[a]})},b.prototype.data=function(a){void 0===a&&(a=ranges.all());var b=this;return this.load().then(function(c){return a.filter(c,b.dim)})},b.prototype.names=function(a){return void 0===a&&(a=ranges.all()),this.table.rows(a)},b.prototype.ids=function(a){return void 0===a&&(a=ranges.all()),this.table.rowIds(a)},b.prototype.size=function(){return this.table.nrow},b.prototype.sort=function(a,b){var c=this;return this.data().then(function(d){var e=C.argSort(d,a,b);return c.view(ranges.list(e))})},b.prototype.map=function(a,b){return null},b.prototype.filter=function(a,b){var c=this;return this.data().then(function(d){var e=C.argFilter(d,a,b);return c.view(ranges.list(e))})},b}(vector_impl.VectorBase);exports.TableVector=TableVector;var MultITableVector=function(a){function b(b,c,d,e,f){void 0===d&&(d=b),void 0===e&&(e=null),void 0===f&&(f=b.rowtype),a.call(this,null),this.table=b,this.f=c,this.this_f=d,this.valuetype=e,this._idtype=f,this.desc={name:b.desc.name+"-p",fqname:b.desc.fqname+"-p",type:"vector",id:b.desc.id+"-p"},this._root=this}return __extends(b,a),Object.defineProperty(b.prototype,"idtype",{get:function(){return this._idtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this.table.persist(),f:this.f.toString(),valuetype:this.valuetype?this.valuetype:void 0,idtype:this.idtype===this.table.rowtype?void 0:this.idtype.name}},b.prototype.restore=function(a){var b=this;return a&&a.range&&(b=b.view(ranges.parse(a.range))),b},b.prototype.size=function(){return this.table.nrow},b.prototype.names=function(a){return this.table.rows(a)},b.prototype.ids=function(a){return this.table.rowIds(a)},b.prototype.at=function(a){var b=this;return this.table.data(ranges.list(a)).then(function(a){return b.f.call(b.this_f,a[0])})},b.prototype.data=function(a){var b=this;return this.table.data(a).then(function(a){return a.map(b.f,b.this_f)})},b.prototype.sort=function(a,b){var c=this;return this.data().then(function(d){var e=C.argSort(d,a,b);return c.view(ranges.list(e))})},b.prototype.map=function(a,b){return null},b.prototype.filter=function(a,b){var c=this;return this.data().then(function(d){var e=C.argFilter(d,a,b);return c.view(ranges.list(e))})},b}(vector_impl.VectorBase);exports.create=create,exports.wrapObjects=wrapObjects;var VectorTable=function(a){function b(b,c){a.call(this,null),this.desc=b,this.vectors=c,this._root=this;var d=b,e=c[0].desc;d.idtype=e.idtype,d.size=[c[0].length,c.length],d.columns=c.map(function(a){return a.desc}),this.rowtype=c[0].idtype}return __extends(b,a),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.rowtype]},enumerable:!0,configurable:!0}),b.prototype.col=function(a){return this.vectors[a]},b.prototype.cols=function(a){return void 0===a&&(a=ranges.all()),a.filter(this.vectors,[this.ncol])},b.prototype.at=function(a,b){return this.col(a).at(b)},b.prototype.data=function(a){return void 0===a&&(a=ranges.all()),Promise.all(this.vectors.map(function(b){return b.data(a)})).then(function(a){var b=a[0].map(function(a){return[a]});return a.slice(1).forEach(function(a){return a.forEach(function(a,c){return b[c].push(a)})}),b})},b.prototype.objects=function(a){var b=this;return void 0===a&&(a=ranges.all()),Promise.all(this.vectors.map(function(b){return b.data(a)})).then(function(a){var c=b.vectors.map(function(a){return a.desc.name}),d=a[0].map(function(a){return b={},b[c[0]]=a,b;var b});return a.slice(1).forEach(function(a,b){var e=c[b+1];a.forEach(function(a,b){return d[b][e]=a})}),d})},b.prototype.rows=function(a){return void 0===a&&(a=ranges.all()),this.col(0).names(a)},b.prototype.rowIds=function(a){return void 0===a&&(a=ranges.all()),this.col(0).ids(a)},b.prototype.ids=function(a){return void 0===a&&(a=ranges.all()),this.rowIds(a)},b.prototype.size=function(){return[this.col(0).length,this.vectors.length]},b.prototype.persist=function(){return this.desc.id},b.prototype.restore=function(b){return b&&"number"==typeof b.col?this.col(b.col):a.prototype.restore.call(this,b)},b}(TableBase);exports.VectorTable=VectorTable,exports.fromVectors=fromVectors}(require,exports,require("./main"),require("./ajax"),require("./range"),require("./idtype"),require("./datatype"),require("./vector_impl"))},{"./ajax":3,"./datatype":6,"./idtype":9,"./main":13,"./range":20,"./vector_impl":27}],26:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{dup:16}],27:[function(a,b,c){!function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a=void 0;return function(b){return a?a:a=d.getAPIJSON("/dataset/"+b.id).then(function(a){return a.rowIds=e.parse(a.rowIds),a})}}function k(a,b,c){var d=void 0;return function(f){return d?Promise.resolve(d):(d={rowIds:e.parse(b),rows:a,data:c},Promise.resolve(d))}}function l(a){return c.isFunction(a.loader)?new o(a,a.loader):new o(a,j())}function m(a,b,c,d){return new o(a,k(b,c,d))}var n=function(a){function b(b){a.call(this),this._root=b}return __extends(b,a),Object.defineProperty(b.prototype,"dim",{get:function(){return[this.length]},enumerable:!0,configurable:!0}),b.prototype.data=function(a){throw new Error("not implemented")},b.prototype.size=function(){throw new Error("not implemented")},Object.defineProperty(b.prototype,"length",{get:function(){return this.size()},enumerable:!0,configurable:!0}),b.prototype.view=function(a){return void 0===a&&(a=e.all()),new p(this._root,a)},b.prototype.idView=function(a){var b=this;return void 0===a&&(a=e.all()),this.ids().then(function(c){return b.view(c.indexOf(a))})},b.prototype.stats=function(){return this.data().then(function(a){return h.computeStats(a)})},Object.defineProperty(b.prototype,"indices",{get:function(){return e.range(0,this.length)},enumerable:!0,configurable:!0}),b.prototype.groups=function(){var a=this,b=this._root.valuetype;return"categorical"===b.type?this.data().then(function(c){var d={name:a._root.desc.id};return b.categories[0].color&&(d.colors=b.categories.map(function(a){return a.color})),b.categories[0].label&&(d.labels=b.categories.map(function(a){return a.label})),g.categorical2partitioning(c,b.categories.map(function(a){return"string"==typeof a?a:a.name}),d)}):Promise.resolve(e.composite(this._root.desc.id,[e.asUngrouped(this.indices.dim(0))]))},b.prototype.stratification=function(){var a=this;return this.groups().then(function(b){return new q(a,b)})},b.prototype.hist=function(a,b){var c=this;void 0===b&&(b=e.all());var d=this._root.valuetype;return this.data(b).then(function(b){switch(d.type){case"categorical":return h.categoricalHist(b,c.indices.dim(0),b.length,d.categories.map(function(a){return"string"==typeof a?a:a.name}),d.categories.map(function(a){return"string"==typeof a?a:a.name||a.label}),d.categories.map(function(a){return"string"==typeof a?"gray":a.color||"gray"}));case"real":case"int":return h.hist(b,c.indices.dim(0),b.length,a?a:Math.round(Math.sqrt(c.length)),d.range);default:return null}})},b.prototype.every=function(a,b){return this.data().then(function(c){return c.every(a,b)})},b.prototype.some=function(a,b){return this.data().then(function(c){return c.some(a,b)})},b.prototype.forEach=function(a,b){this.data().then(function(c){return c.forEach(a,b)})},b.prototype.reduce=function(a,b,d){function e(){return a.apply(d,c.argList(arguments))}return this.data().then(function(a){return a.reduce(e,b)})},b.prototype.reduceRight=function(a,b,d){function e(){return a.apply(d,c.argList(arguments))}return this.data().then(function(a){return a.reduceRight(e,b)})},b.prototype.restore=function(a){var b=this;return a&&a.range&&(b=b.view(e.parse(a.range))),b},b}(f.SelectAble);b.VectorBase=n;var o=function(a){function b(b,c){a.call(this,null),this.desc=b,this.loader=c,this._root=this;var d=b;this.valuetype=d.value,this._idtype=f.resolve(d.idtype)}return __extends(b,a),Object.defineProperty(b.prototype,"idtype",{get:function(){return this._idtype},enumerable:!0,configurable:!0}),b.prototype.load=function(){return this.loader(this.desc)},b.prototype.at=function(a){return this.load().then(function(b){return b.data[a]})},b.prototype.data=function(a){void 0===a&&(a=e.all());var b=this;return this.load().then(function(c){return g.mask(a.filter(c.data,b.dim),b.valuetype)})},b.prototype.names=function(a){void 0===a&&(a=e.all());var b=this;return this.load().then(function(c){return a.filter(c.rows,b.dim)})},b.prototype.ids=function(a){void 0===a&&(a=e.all());var b=this;return this.load().then(function(c){return c.rowIds.preMultiply(a,b.dim)})},Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.size=function(){return this.desc.size},b.prototype.sort=function(a,b){var d=this;return this.data().then(function(f){var g=c.argSort(f,a,b);return d.view(e.list(g))})},b.prototype.map=function(a,b){return null},b.prototype.filter=function(a,b){var d=this;return this.data().then(function(f){var g=c.argFilter(f,a,b);return d.view(e.list(g))})},b.prototype.persist=function(){return this.desc.id},b}(n);b.Vector=o;var p=function(a){function b(b,c){a.call(this,b),this.range=c}return __extends(b,a),Object.defineProperty(b.prototype,"desc",{get:function(){return this._root.desc},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this._root.persist(),range:this.range.toString()}},b.prototype.size=function(){return this.range.size(this._root.dim)[0]},b.prototype.at=function(a){var b=this.range.invert([a],this._root.dim);return this._root.at(b[0])},b.prototype.data=function(a){return void 0===a&&(a=e.all()),this._root.data(this.range.preMultiply(a,this._root.dim))},b.prototype.names=function(a){return void 0===a&&(a=e.all()),this._root.names(this.range.preMultiply(a,this._root.dim))},b.prototype.ids=function(a){return void 0===a&&(a=e.all()),this._root.ids(this.range.preMultiply(a,this._root.dim))},b.prototype.view=function(a){return void 0===a&&(a=e.all()),a.isAll?this:new b(this._root,this.range.preMultiply(a,this.dim))},Object.defineProperty(b.prototype,"valuetype",{get:function(){return this._root.valuetype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtype",{get:function(){return this._root.idtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.sort=function(a,b){var d=this;return this.data().then(function(f){var g=c.argSort(f,a,b);return d.view(d.range.preMultiply(e.list(g)))})},b.prototype.map=function(a,b){return null},b.prototype.filter=function(a,b){var d=this;return this.data().then(function(f){var g=c.argFilter(f,a,b);return d.view(d.range.preMultiply(e.list(g)))})},b}(n),q=function(a){function b(b,c){a.call(this,{id:b.desc.id+"-s",name:b.desc.name,fqname:b.desc.fqname,type:"stratification",size:b.dim,ngroups:c.groups.length,groups:c.groups.map(function(a){return{name:a.name,color:a.color,size:a.length}})}),this.v=b,this.r=c}return __extends(b,a),Object.defineProperty(b.prototype,"idtype",{get:function(){return this.v.idtype},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"groups",{get:function(){return this.desc.groups},enumerable:!0,configurable:!0}),b.prototype.group=function(a){return new i.StratificationGroup(this,a,this.groups[a])},b.prototype.hist=function(a,b){return void 0===b&&(b=e.all()),this.range().then(function(a){return h.rangeHist(a)})},b.prototype.vector=function(){return Promise.resolve(this.v)},b.prototype.origin=function(){return this.vector()},b.prototype.range=function(){return Promise.resolve(this.r)},b.prototype.idRange=function(){var a=this,b=this;return this.ids().then(function(c){var d=a.r;return c.dim(0).preMultiply(d,b.dim[0])})},b.prototype.names=function(a){return void 0===a&&(a=e.all()),this.v.names(a)},b.prototype.ids=function(a){return void 0===a&&(a=e.all()),this.v.ids(a)},Object.defineProperty(b.prototype,"idtypes",{get:function(){return[this.idtype]},enumerable:!0,configurable:!0}),b.prototype.size=function(){return this.desc.size},Object.defineProperty(b.prototype,"length",{get:function(){return this.size()[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ngroups",{get:function(){return this.desc.ngroups},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dim",{get:function(){return this.size()},enumerable:!0,configurable:!0}),b.prototype.persist=function(){return{root:this.v.persist(),asstrat:!0}},b}(g.DataTypeBase);b.StratificationVector=q,b.create=l,b.wrap=m}(a,c,a("./main"),a("./ajax"),a("./range"),a("./idtype"),a("./datatype"),a("./math"),a("./stratification"))},{"./ajax":3,"./datatype":6,"./idtype":9,"./main":13,"./math":15,"./range":20,"./stratification":22}],28:[function(a,b,c){!function(a,b,c,d,e){function f(a,b){a.__vis__=b}function g(a){var b=a.filter;"undefined"==typeof b?a.filter=c.constantTrue:"string"==typeof b?a.filter=function(a){return a&&a.desc.type&&a.desc.type.match(b)}:Array.isArray(b)&&(a.filter=function(a){return a&&a&&a.desc.type&&a.desc.type.match(b[0])&&(!a.desc.value||a.desc.value.type.match(b[1]))})}function h(a){c.isFunction(a.iconify)||(a.iconify=function(a){a.title=this.name,this.iconcss?(a.classList.add("fa"),a.classList.add(this.iconcss)):this.icon?(a.classList.add("fa"),a.classList.add("fa-fw"),a.style.width="1em",a.style["background-image"]="url("+this.baseUrl+"/"+this.icon+")",a.innerHTML="&nbsp"):a.innerText=this.name.substr(0,1).toUpperCase()})}function i(a){a.scaling=a.scaling||"free",Array.isArray(a.sizeDependsOnDataDimension)&&"boolean"==typeof a.sizeDependsOnDataDimension[0]||("boolean"==typeof a.sizeDependsOnDataDimension?a.sizeDependsOnDataDimension=[a.sizeDependsOnDataDimension,a.sizeDependsOnDataDimension]:a.sizeDependsOnDataDimension=[!1,!1])}function j(a){var b={free:NaN,no:0,transpose:90,swap:180};"string"==typeof a.rotation&&a.rotation in b?a.rotation=b[a.rotation]:"number"==typeof a.rotation?a.rotation=+a.rotation:null===a.rotation?a.rotation=NaN:a.rotation=0}function k(a){var b=a;return g(b),h(b),i(b),j(b),b}function l(a){return d.list("vis").map(k).filter(function(b){return b.filter(a)})}b.assignVis=f;var m=function(a){function b(){a.apply(this,arguments),this.id=c.uniqueId("vis"),this._built=!1}return __extends(b,a),b.prototype.option=function(a,b){return null},b.prototype.persist=function(){return null},Object.defineProperty(b.prototype,"isBuilt",{get:function(){return this._built},enumerable:!0,configurable:!0}),b.prototype.markReady=function(a){void 0===a&&(a=!0),this._built=a,a&&this.fire("ready")},b.prototype.locate=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return 1===a.length?this.locateImpl(a[0]):Promise.all(a.map(this.locateImpl,this))},b.prototype.locateById=function(){for(var a=this,b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];return this.data.ids().then(function(c){return 1===b.length?a.locateImpl(c.indexOf(b[0])):Promise.all(b.map(function(b){return a.locateImpl(c.indexOf(b))}))})},b.prototype.locateImpl=function(a){return Promise.resolve(null)},b.prototype.restore=function(a){return Promise.resolve(this)},b.prototype.update=function(){},b.prototype.destroy=function(){var a=this.node;!a||!a.parentNode||window.event&&"DOMNodeRemoved"===window.event.type&&window.event.target===a||a.parentNode.removeChild(a),this.fire("destroyed")},b.prototype.transform=function(){return{scale:[1,1],rotate:0}},Object.defineProperty(b.prototype,"rawSize",{get:function(){return[100,100]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"size",{
get:function(){var a=this.transform(),b=this.rawSize;return[b[0]*a.scale[0],b[1]*a.scale[1]]},enumerable:!0,configurable:!0}),b}(e.EventHandler);b.AVisInstance=m,b.list=l}(a,c,a("./main"),a("./plugin"),a("./event"))},{"./event":7,"./main":13,"./plugin":19}],29:[function(a,b,c){!function(a,b,c,d,e,f,g,h){b.C=c,b.data=d,b.ranges=e,b.idtypes=f,b.geom=h,b.events=g}(a,c,a("./main"),a("./data"),a("./range"),a("./idtype"),a("./event"),a("./geom"))},{"./data":5,"./event":7,"./geom":8,"./idtype":9,"./main":13,"./range":20}],30:[function(a,b,c){!function(a,b,c,d){"use strict";function e(){return new g}function f(a,b){return void 0===b&&(b="json"),"json"===b?JSON.parse(a.responseText):a.responseText}var g=function(){function a(){}return a.prototype.send=function(a,b,e,g){return void 0===b&&(b={}),void 0===e&&(e="get"),void 0===g&&(g="json"),new Promise(function(h,i){("get"===e||"head"===e)&&(b=c.encodeParams(b),b&&(a+=(/\?/.test(a)?"&":"?")+b),b=null);var j=d.xhr(a);b instanceof FormData||j.header("Content-Type","application/x-www-form-urlencoded"),j.send(e,b instanceof FormData?b:c.encodeParams(b),function(a,b){a?i(a):h(f(b,g))})})},a}();b.create=e}(a,c,a("../caleydo_core/ajax"),a("d3"))},{"../caleydo_core/ajax":3,d3:void 0}],31:[function(a,b,c){!function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,d,e){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===e&&(e=1);var f=g.transform("");return f.translate=[a,b],f.rotate=c,f.scale=[d,e],f}function i(a,b,e){var f=function(a,c,d){var f=b.selectAll(e);f.classed("select-"+c,!1);var h=d.filter(f[0]);h.length>0&&g.selectAll(h).classed("select-"+c,!0)};return a.on("select",f),c.onDOMNodeRemoved(b.node(),function(){a.off("select",f)}),a.selections().then(function(a){f(null,"selected",a)}),function(b,c){a.select(0,[c],d.toSelectOperation(g.event))}}function j(a,b,d,h,i){function j(f,i,j){e.AVisInstance.call(this,f,i,j),this.data=f,this.name=a,this.$parent=g.select(i),this.initialSize=g.functor(d),this.options=c.mixin({},g.functor(b).call(this,f,j||{}),j),c.isFunction(this.init)&&this.init(f),this.$node=h.call(this,this.$parent,this.data,this.size),this.$node.datum(f),this.$node.node().__vis__=this}return c.extendClass(j,e.AVisInstance),j.prototype.toString=function(){return a},j.prototype.option=function(a,b){if(1===arguments.length)return this.options[a];var c=this.options[a];return c===b?c:(this.fire("option",a,b,c),this.fire("option."+a,b,c),this.options[a]=b,this.updatedOption(a,b),c)},j.prototype.updatedOption=function(a,b){},j.prototype.transform=function(a,b){var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;var d=this.rawSize;"svg"===this.node.tagName.toLowerCase()?(this.$node.attr({width:d[0]*a[0],height:d[1]*a[1]}).style("transform","rotate("+b+"deg)"),this.$node.select("g").attr("transform","scale("+a[0]+","+a[1]+")")):this.$node.style("transform","rotate("+b+"deg)scale("+a[0]+","+a[1]+")");var e={scale:a,rotate:b};return this.fire("transform",e,c),this.options.scale=a,this.options.rotate=b,e},j.prototype.locateImpl=function(a){var b=this.locateIt(a);if(!b)return null;var c=this;return b.then(function(a){return a=f.wrap(a),a?a.transform(c.options.scale||[1,1],c.options.rotate||0):a})},j.prototype.locateIt=function(a){return null},Object.defineProperty(j.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0}),Object.defineProperty(j.prototype,"rawSize",{get:function(){return this.initialSize(this.data)},enumerable:!0}),Object.keys(i||{}).forEach(function(a){j.prototype[a]=i[a]}),j}b.transform=h,b.selectionUtil=i,b.defineVis=j}(a,c,a("../caleydo_core/main"),a("../caleydo_core/idtype"),a("../caleydo_core/vis"),a("../caleydo_core/geom"),a("d3"))},{"../caleydo_core/geom":8,"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_core/vis":28,d3:void 0}],32:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e,f){function g(a,b,c){return void 0===c&&(c={}),new k(a,b,c)}function h(a,b){void 0===b&&(b=d.identity),a.attr("draggable",!0).on("dragstart",function(a){var d=c.event,e=b(a);if(e){d.dataTransfer.effectAllowed="copy",d.dataTransfer.setData("text/plain",e.desc.name),d.dataTransfer.setData("application/json",JSON.stringify(e.desc));var f=JSON.stringify(e.persist());d.dataTransfer.setData("application/caleydo-data-item",f),d.dataTransfer.setData("application/caleydo-data-"+e.desc.type,f),d.dataTransfer.setData("application/caleydo-data-item-"+f,f)}})}function i(a,b){return void 0===b&&(b={}),new j(a,b)}var j=function(a){function b(b,c){void 0===c&&(c={}),a.call(this),this.parent=b,this.options=c,this.options=d.mixin({layout:"tree",draggable:!0,filter:d.constantTrue},c),this.$node=this.build(b)}return __extends(b,a),b.prototype.build=function(a){return"tree"===this.options.layout?this.buildTree(a):"list"===this.options.layout?this.buildList(a):c.select(a)},b.prototype.buildTree=function(a){function b(a){var d=a.selectAll("li").data(function(a){return a.children}),e=d.enter().append("li").classed("collapsed",!0),g=e.append("span").on("click",function(a){if(a.children.length>0){var b=c.select(this.parentNode),d=!b.classed("collapsed");b.classed("collapsed",d),f.fire("toggleCollapse",a,d),b.select("i").classed("fa-chevron-down",!d).classed("fa-chevron-right",d)}else f.fire("select",a.data)}).call(h,function(a){return a.data});g.append("i").attr("class","fa-li fa"),g.append("span"),e.append("ul").classed("fa-ul",!0),d.select("i").classed("fa-chevron-right",function(a){return a.children.length>0}).classed("fa-file-o",function(a){return 0===a.children.length}),d.select("span").attr("draggable",function(a){return null!==a.data&&f.options.draggable}),d.select("span span").text(function(a){var b=a.name;return a.children.length>0&&(b+=" ("+a.children.length+")"),null!==a.data&&(b+=" ["+a.data.dim.join(",")+"]"),b}),d.each(function(a){a.children.length>0&&b(c.select(this).select("ul"))}),d.exit().remove()}var d=c.select(a).append("ul").classed("databrowser",!0).classed("fa-ul",!0),f=this;return e.tree(this.options.filter).then(function(a){d.datum(a),b(d)}),d},b.prototype.buildList=function(a){var b=c.select(a).append("ul").classed("databrowser",!0).classed("fa-ul",!0);return e.list(this.options.filter).then(function(a){var c=b.selectAll("li").data(a),d=c.enter().append("li").append("span").call(h);d.append("i").attr("class","fa-li fa fa-file-o"),d.append("span"),c.select("span span").text(function(a){return a.desc.name}),c.exit().remove()}),b},b}(f.EventHandler);b.DataBrowser=j;var k=function(a){function b(b,e,f){void 0===f&&(f={}),a.call(this),this.handler=e,this.options={types:[]},d.mixin(this.options,f),this.register(c.select(b))}return __extends(b,a),b.prototype.checkType=function(a){return 0===this.options.types.length?d.hasDnDType(a,"application/caleydo-data-item"):this.options.types.some(function(b){return d.hasDnDType(a,"application/caleydo-data-"+b)})},b.prototype.register=function(a){var b=this;a.on("dragenter",function(){var d=c.event,e=c.mouse(a.node());return b.checkType(d)?(b.fire("enter",{x:e[0],y:e[1]}),!1):void 0}).on("dragover",function(){var e=c.event,f=c.mouse(a.node());return b.checkType(e)?(e.preventDefault(),d.updateDropEffect(e),b.fire("over",{x:f[0],y:f[1]}),!1):void 0}).on("dragleave",function(){b.fire("leave")}).on("drop",function(){var f=c.event;f.preventDefault();var g=c.mouse(a.node());if(d.hasDnDType(f,"application/caleydo-data-item")){var h=JSON.parse(f.dataTransfer.getData("application/caleydo-data-item"));return e.get(h).then(function(a){b.fire("drop",a,f.dataTransfer.dropEffect,{x:g[0],y:g[1]}),b.handler&&b.handler(a,f.dataTransfer.dropEffect,{x:g[0],y:g[1]})}),!1}})},b}(f.EventHandler);b.DropDataItemHandler=k,b.makeDropable=g,b.makeDraggable=h,b.create=i}(a,c,a("d3"),a("../caleydo_core/main"),a("../caleydo_core/data"),a("../caleydo_core/event"),d)},{"../caleydo_core/data":5,"../caleydo_core/event":7,"../caleydo_core/main":13,css:void 0,d3:void 0}],33:[function(a,b,c){!function(a,b,c,d,e){"use strict";function f(a,b,c,d){return void 0===d&&(d={}),new i(a,b,c,d)}function g(a,b){return void 0===b&&(b={}),new j(a,b)}function h(a,b){return void 0===b&&(b={}),new k(a,b)}var i=function(a){function b(b,c,d,e){void 0===e&&(e={}),a.call(this,e),this.$elem=b,this.rawWidth=c,this.rawHeight=d}return __extends(b,a),b.prototype.setBounds=function(a,b,d,e){var f=c.transform(this.$elem.attr("transform"));return f.translate[0]=a,f.translate[1]=b,f.scale[0]=d/this.rawWidth,f.scale[1]=e/this.rawHeight,this.$elem.attr("transform",f.toString()),null},b.prototype.getBounds=function(){var a=c.transform(this.$elem.attr("transform"));return e.rect(a.translate[0],a.translate[1],this.rawWidth*a.scale[0],this.rawHeight*a.scale[1])},b}(d.ALayoutElem),j=function(a){function b(b,c){void 0===c&&(c={}),a.call(this,c),this.$elem=b}return __extends(b,a),b.prototype.setBounds=function(a,b,c,d){return this.$elem.attr({x:a,y:b,width:c,height:d}),null},b.prototype.getBounds=function(){return e.rect(parseFloat(this.$elem.attr("x")),parseFloat(this.$elem.attr("y")),parseFloat(this.$elem.attr("width")),parseFloat(this.$elem.attr("height")))},b}(d.ALayoutElem),k=function(a){function b(b,d){void 0===d&&(d={}),a.call(this,d),this.targetBounds=null,this.$node=c.select(b)}return __extends(b,a),b.prototype.setBounds=function(a,b,c,d){var f=this,g=this.layoutOption("unit","px"),h=this.layoutOption("animate",!1)===!0,i=e.rect(a,b,c,d),j=this.layoutOption("set-call",null),k=this.layoutOption("animation-duration",200),l=h&&k>0?this.$node.transition().duration(k):this.$node;if(l.style({left:a+g,top:b+g,width:c+g,height:d+g}),j&&l.call(j),j=this.layoutOption("onSetBounds",null),h){this.targetBounds=i;var m=new Promise(function(a){setTimeout(function(){f.targetBounds=null,j&&j(),a(null)},k)});return m}return j&&j(),Promise.resolve(null)},b.prototype.getBounds=function(){function a(a){return a.length>=b.length&&a.substring(a.length-b.length)===b?(a=a.substring(0,a.length-b.length),parseFloat(a)):0}if(this.targetBounds)return this.targetBounds;var b=this.layoutOption("unit","px"),c=this.$node.node().style;return e.rect(a(c.left),a(c.top),a(c.width),a(c.height))},b}(d.ALayoutElem);b.wrapSVGTransform=f,b.wrapSVGRect=g,b.wrapDom=h}(a,c,a("d3"),a("../caleydo_core/layout"),a("../caleydo_core/geom"))},{"../caleydo_core/geom":8,"../caleydo_core/layout":11,d3:void 0}],34:[function(a,b,c){!function(a,b,c,d,e,f,g,h){"use strict";function i(a,b){return void 0===b&&(b={}),new Promise(function(c,e){d.text(a,function(a,f){a&&e(a);var g=d.csv.parseRows(f);c(l(g,b))})})}function j(a){return a-parseFloat(a)+1>=0}function k(a){if(0===a.length)return{type:"string"};var b=a[0];if("number"==typeof b||j(b))return{type:"real",range:d.extent(a.map(parseFloat))};var c=d.set(a);return c.size()<.2*a.length||c.size()<8?{type:"categorical",categories:c.values()}:{type:"string"}}function l(a,b,d,g){void 0===g&&(g={});var i=Array.isArray(b)?b:a.map(function(a){return a[0]}),j=d?d:a[0].slice(1);"object"==typeof b&&(g=b),g=g||{};var l=c.uniqueString("localData"),m={type:"matrix",id:l,name:l,fqname:l,rowtype:"_rows",coltype:"_cols",rowassigner:h.createLocalAssigner(),colassigner:h.createLocalAssigner()};c.mixin(m,g);var n=m;n.size=n.size||[i.length,j.length];var o=Array.isArray(b)?a:a.slice(1).map(function(a){return a.slice(1)});n.value=n.value||k([].concat.apply([],o)),"real"===n.value.type&&(o=o.map(function(a){return a.map(parseFloat)}));var p={rowIds:function(a,b){return Promise.resolve(m.rowassigner(b.filter(i)))},colIds:function(a,b){return Promise.resolve(m.rowassigner(b.filter(j)))},ids:function(a,b){var c=m.rowassigner(b.dim(0).filter(i)),d=m.colassigner(b.dim(1).filter(j));return Promise.resolve(e.join(c,d))},at:function(a,b,c){return Promise.resolve(o[b][c])},rows:function(a,b){return Promise.resolve(b.filter(i))},cols:function(a,b){return Promise.resolve(b.filter(j))},data:function(a,b){return Promise.resolve(b.filter(o))}};return f.create(m,p)}function m(a,b){return void 0===b&&(b={}),new Promise(function(c,e){d.csv(a,function(a,d){a&&e(a),c(q(d,b))})})}function n(a,b){return a.map(function(a){var c={};return b.forEach(function(b,d){return c[b]=a[d]}),c})}function o(a,b){void 0===b&&(b={});var d=c.uniqueString("localData"),e={type:"table",id:d,name:d,fqname:d,idtype:"_rows",rowassigner:h.createLocalAssigner()};c.mixin(e,b);var f=a.map(function(a){return a[0]}),i=a[0].slice(1),j=a.slice(1).map(function(a){return a.slice(1)}),l=e;l.size=l.size||[f.length,i.length],l.columns=l.columns||i.map(function(a,b){return{name:a,value:k(j.map(function(a){return a[b]}))}}),j=j.map(function(a){return l.columns.map(function(b,c){return"real"===b.value.type?parseFloat(a[c]):a[c]})});var m=n(j,i);return l.loader=function(a){var b={rowIds:e.rowassigner(f),rows:f,objs:m,data:j};return Promise.resolve(b)},g.create(e)}function p(a,b){return a.map(function(a){return b.map(function(b){return a[b]})})}function q(a,b){void 0===b&&(b={});var d=c.uniqueString("localData"),e={type:"table",id:d,name:d,fqname:d,idtype:"_rows",rowassigner:h.createLocalAssigner(),keyProperty:"_id"};c.mixin(e,b);var f=a.map(function(a,b){return a[e.keyProperty]||b}),i=Object.keys(a[0]),j=a,l=p(j,i),m=e;return m.dim=m.dim||[f.length,i.length],m.columns=m.columns||i.map(function(a,b){return{name:a,value:k(l.map(function(a){return a[b]}))}}),m.loader=function(a){var b={rowIds:e.rowassigner(f),rows:f,objs:j,data:l};return Promise.resolve(b)},g.create(e)}b.parseRemoteMatrix=i,b.parseMatrix=l,b.parseRemoteTable=m,b.parseTable=o,b.parseObjects=q}(a,c,a("../caleydo_core/main"),a("d3"),a("../caleydo_core/range"),a("../caleydo_core/matrix_impl"),a("../caleydo_core/table_impl"),a("../caleydo_core/idtype"))},{"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_core/matrix_impl":17,"../caleydo_core/range":20,"../caleydo_core/table_impl":25,d3:void 0}],35:[function(a,b,c){!function(a,b,c,d,e,f){function g(a,b,d){return new i(a,c.select(b),d)}function h(a,b){return void 0===b&&(b={}),new j(a,b)}var i=function(){function a(a,b,c){var d=this;void 0===c&&(c={}),this.idType=a,this.l=function(a,b,c){d.update(b,c)},this.options={useNames:!1,addClear:!0,selectionTypes:[e.defaultSelectionType,e.hoverSelectionType],filterSelectionTypes:f.constantTrue},f.mixin(this.options,c),a.on("select",this.l),this.$div=b.append("div"),this.$div.append("span").text(a.name),this.options.addClear&&this.$div.append("span").text(" (clear)").style("cursor","pointer").attr("title","click to clear selection").on("click",function(){d.options.selectionTypes.forEach(function(b){return a.clear(b)})}),this.$ul=this.$div.append("div"),this.options.selectionTypes.forEach(function(b){return d.update(b,a.selections(b))})}return a.prototype.update=function(a,b){if(this.options.filterSelectionTypes(a)){this.$div.classed("no-selection-"+a,b.isNone);var c=this.$ul.select("span.select-"+a);if(b.isNone)return void c.remove();if(c.empty()&&(c=this.$ul.append("span").classed("select-"+a,!0)),this.options.useNames&&"_"!==this.idType.id.charAt(0)&&!this.idType.internal)this.idType.unmap(b).then(function(a){c.text(a.join(", "))});else{var d=b.dim(0).asList();c.text(d.join(", "))}}},a.prototype.destroy=function(){this.idType.off("select",this.l)},a}();b.SelectionIDType=i;var j=function(){function a(a,b){var d=this;void 0===b&&(b={}),this.parent=a,this.handler=[],this.listener=function(a,b){d.options.filter(b)&&d.handler.push(new i(b,d.$div,d.options))},this.options={useNames:!1,addClear:!0,selectionTypes:[e.defaultSelectionType,e.hoverSelectionType],filterSelectionTypes:f.constantTrue,filter:f.constantTrue},f.mixin(this.options,b),this.build(c.select(a))}return a.prototype.build=function(a){var b=this,c=this.$div=a.append("div").classed("selectioninfo",!0);f.onDOMNodeRemoved(c.node(),this.destroy,this),d.on("register.idtype",this.listener),e.list().forEach(function(a){b.listener(null,a)})},a.prototype.destroy=function(){d.off("register.idtype",this.listener),this.handler.forEach(function(a){return a.destroy()}),this.handler.length=0},a}();b.SelectionInfo=j,b.createFor=g,b.create=h}(a,c,a("d3"),a("../caleydo_core/event"),a("../caleydo_core/idtype"),a("../caleydo_core/main"))},{"../caleydo_core/event":7,"../caleydo_core/idtype":9,"../caleydo_core/main":13,d3:void 0}],36:[function(a,b,c){!function(a,b,c,d,e,f,g,h){function i(a){return function(b){return a instanceof RegExp?a.test(b.type):b.type===a}}function j(a){return new p(a)}var k=function(a){function b(){a.apply(this,arguments),this._attrs={}}return __extends(b,a),b.prototype.persist=function(){return Object.keys(this._attrs).length>0?{attrs:c.mixin({},this._attrs)}:{}},b.prototype.setAttr=function(a,b){var c=this._attrs[a];(c!==b||Array.isArray(c))&&(this._attrs[a]=b,this.fire("attr-"+a,b,c),this.fire("setAttr",a,b,c))},b.prototype.hasAttr=function(a){return a in this._attrs},b.prototype.getAttr=function(a,b){return void 0===b&&(b=null),a in this._attrs?this._attrs[a]:b},Object.defineProperty(b.prototype,"attrs",{get:function(){return Object.keys(this._attrs)},enumerable:!0,configurable:!0}),b.prototype.restore=function(a){return a.attrs&&(this._attrs=a.attrs),this},b}(h.EventHandler);b.AttributeContainer=k;var l=function(a){function b(b,d){void 0===b&&(b="node"),void 0===d&&(d=NaN),a.call(this),this.type=b,this.outgoing=[],this.incoming=[],this._id=NaN,this._id=c.flagId("graph_node",d)}return __extends(b,a),Object.defineProperty(b.prototype,"id",{get:function(){return isNaN(this._id)&&(this._id=c.uniqueId("graph_node")),this._id},enumerable:!0,configurable:!0}),b.prototype.persist=function(){var b=a.prototype.persist.call(this);return b.type=this.type,b.id=this.id,b},b.prototype.restore=function(b){return a.prototype.restore.call(this,b),this.type=b.type,this._id=c.flagId("graph_node",b.id),this},b}(k);b.GraphNode=l;var m=function(a){function b(b,d,e,f){void 0===b&&(b="edge"),void 0===d&&(d=null),void 0===e&&(e=null),void 0===f&&(f=NaN),a.call(this),this.type=b,this.source=d,this.target=e,this._id=NaN,this._id=c.flagId("graph_edge",f),d&&e&&this.init()}return __extends(b,a),Object.defineProperty(b.prototype,"id",{get:function(){return isNaN(this._id)&&(this._id=c.uniqueId("graph_edge")),this._id},enumerable:!0,configurable:!0}),b.prototype.init=function(){this.source.outgoing.push(this),this.target.incoming.push(this)},b.prototype.takeDown=function(){this.source&&this.source.outgoing.splice(this.source.outgoing.indexOf(this),1),this.target&&this.target.incoming.splice(this.target.incoming.indexOf(this),1)},b.prototype.toString=function(){return this.source+" "+this.type+" "+this.target},b.prototype.persist=function(){var b=a.prototype.persist.call(this);return b.type=this.type,b.id=this.id,b.source=this.source.id,b.target=this.target.id,b},b.prototype.restore=function(b,d){return a.prototype.restore.call(this,b),this.type=b.type,this._id=c.flagId("graph_edge",b.id),this.source=d(b.source),this.target=d(b.target),this.init(),this},b}(k);b.GraphEdge=m,b.isType=i;var n=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),Object.defineProperty(b.prototype,"nodes",{get:function(){return[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nnodes",{get:function(){return this.nodes.length},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"edges",{get:function(){return[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nedges",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),b}(e.SelectAble);b.AGraph=n;var o={makeNode:function(a){return(new l).restore(a)},makeEdge:function(a,b){return(new m).restore(a,b)}},p=function(a){function b(b){a.call(this,b),this._impl=null,this._loaded=null}return __extends(b,a),Object.defineProperty(b.prototype,"nnodes",{get:function(){if(this._loaded)return this._loaded.nnodes;var a=this.desc.size;return a[0]||0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nedges",{get:function(){if(this._loaded)return this._loaded.nedges;var a=this.desc.size;return a[1]||0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dim",{get:function(){return[this.nnodes,this.nedges]},enumerable:!0,configurable:!0}),b.prototype.impl=function(a){var b=this;if(void 0===a&&(a=o),this._impl)return this._impl;var c=this.desc.storage||"remote";return"memory"===c?(this._loaded=new r(this.desc,[],[],a),this._impl=Promise.resolve(this._loaded)):"local"===c?(this._loaded=t.load(this.desc,a,localStorage),this._impl=Promise.resolve(this._loaded)):"session"===c?(this._loaded=t.load(this.desc,a,sessionStorage),this._impl=Promise.resolve(this._loaded)):"given"===c&&this.desc.graph instanceof q?(this._loaded=this.desc.graph,this._impl=Promise.resolve(this._loaded)):this._impl=s.load(this.desc,a).then(function(a){return b._loaded=a}),this._impl},b.prototype.ids=function(a){return void 0===a&&(a=g.all()),this._impl?this._impl.then(function(b){return b.ids(a)}):Promise.resolve(g.none())},Object.defineProperty(b.prototype,"idtypes",{get:function(){return["_nodes","_edges"].map(e.resolve)},enumerable:!0,configurable:!0}),b}(f.DataTypeBase);b.GraphProxy=p,b.create=j;var q=function(a){function b(b,c,d){void 0===c&&(c=[]),void 0===d&&(d=[]),a.call(this),this.desc=b,this._nodes=c,this._edges=d}return __extends(b,a),Object.defineProperty(b.prototype,"nodes",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"edges",{get:function(){return this._edges},enumerable:!0,configurable:!0}),b.prototype.addNode=function(a){return this._nodes.push(a),this.fire("add_node",a),this},b.prototype.updateNode=function(a){return this.fire("update_node",a),this},b.prototype.updateEdge=function(a){return this.fire("update_edge",a),this},b.prototype.removeNode=function(a){var b=this._nodes.indexOf(a);return 0>b?null:(this._nodes.splice(b,1),this.fire("remove_node",a),this)},b.prototype.addEdge=function(a,b,c){if(a instanceof m){var d=a;return this._edges.push(d),void this.fire("add_edge",d,d.type,d.source,d.target)}return this.addEdge(new m(b,a,c))},b.prototype.removeEdge=function(a){var b=this._edges.indexOf(a);return 0>b?null:(a.takeDown(),this._edges.splice(b,1),this.fire("remove_edge",a),this)},Object.defineProperty(b.prototype,"dim",{get:function(){return[this._nodes.length,this._edges.length]},enumerable:!0,configurable:!0}),b.prototype.ids=function(a){return void 0===a&&(a=g.all()),Promise.resolve(g.list(this._nodes.map(function(a){return a.id}),this._edges.map(function(a){return a.id})))},b.prototype.selectNode=function(a,b){void 0===b&&(b=e.SelectOperation.SET),this.select(0,[this._nodes.indexOf(a)],b)},b.prototype.selectedNodes=function(){var a=this;return this.selections().then(function(b){var c=[];return b.dim(0).forEach(function(b){return c.push(a._nodes[b])}),c})},b.prototype.selectEdge=function(a,b){void 0===b&&(b=e.SelectOperation.SET),this.select(1,[this._edges.indexOf(a)],b)},b.prototype.selectedEdges=function(){var a=this;return this.selections().then(function(b){var c=[];return b.dim(1).forEach(function(b){return c.push(a._edges[b])}),c})},Object.defineProperty(b.prototype,"idtypes",{get:function(){return["_nodes","_edges"].map(e.resolve)},enumerable:!0,configurable:!0}),b.prototype.clear=function(){return this._nodes=[],this._edges=[],this},b.prototype.persist=function(){var a={root:this.desc.id};return a.nodes=this.nodes.map(function(a){return a.persist()}),a.edges=this.edges.map(function(a){return a.persist()}),a},b}(n);b.GraphBase=q;var r=function(a){function b(b,c,d,e){void 0===c&&(c=[]),void 0===d&&(d=[]),void 0===e&&(e=o),a.call(this,b,c,d),this.factory=e}return __extends(b,a),b.prototype.restore=function(a){var b=this,c={},d=function(a){return c[a]};return a.nodes.forEach(function(a){var d=b.factory.makeNode(a);c[d.id]=d,b.addNode(d)}),a.edges.forEach(function(a){var c=b.factory.makeEdge(a,d);b.addEdge(c)}),this},b}(q);b.MemoryGraph=r;var s=function(a){function b(b,c,d){var e=this;void 0===c&&(c=[]),void 0===d&&(d=[]),a.call(this,b,c,d),this.updateHandler=function(a){var b=a.target;b instanceof l&&e.updateNode(b),b instanceof m&&e.updateEdge(b)},this._wait_for_synced=0}return __extends(b,a),b.load=function(a,c){var d=new b(a,[],[]);return d.load(c)},b.prototype.load=function(a){var b=this;return d.sendAPI("/dataset/graph/"+this.desc.id+"/data").then(function(c){return b.loadImpl(c.nodes,c.edges,a),b.fire("sync_load,sync",--b._wait_for_synced),b})},b.prototype.loadImpl=function(b,c,d){var e=this,f={},g=function(a){return f[a]};b.forEach(function(b){var c=d.makeNode(b);f[c.id]=c,c.on("setAttr",e.updateHandler),a.prototype.addNode.call(e,c)}),c.forEach(function(b){var c=d.makeEdge(b,g);c.on("setAttr",e.updateHandler),a.prototype.addEdge.call(e,c)}),this.fire("loaded")},Object.defineProperty(b.prototype,"activeSyncOperations",{get:function(){return this._wait_for_synced},enumerable:!0,configurable:!0}),b.prototype.addNode=function(b){var c=this;return a.prototype.addNode.call(this,b),b.on("setAttr",this.updateHandler),this.fire("sync_start_node,sync_start",++this._wait_for_synced,"add_node",b),d.sendAPI("/dataset/graph/"+this.desc.id+"/node",{desc:JSON.stringify(b.persist())},"post").then(function(a){return c.fire("sync_node,sync",--c._wait_for_synced,b),c})},b.prototype.updateNode=function(b){var c=this;return a.prototype.updateNode.call(this,b),this.fire("sync_start_node,sync_start",++this._wait_for_synced,"update_node",b),d.sendAPI("/dataset/graph/"+this.desc.id+"/node/"+b.id,{desc:JSON.stringify(b.persist())},"put").then(function(a){return c.fire("sync_node,sync",--c._wait_for_synced,b),c})},b.prototype.removeNode=function(b){var c=this;return a.prototype.removeNode.call(this,b)?(b.off("setAttr",this.updateHandler),this.fire("sync_start_node,sync_start",++this._wait_for_synced,"remove_node",b),d.sendAPI("/dataset/graph/"+this.desc.id+"/node/"+b.id,{},"delete").then(function(a){return c.fire("sync_node,sync",--c._wait_for_synced,b),c})):Promise.reject("invalid node")},b.prototype.addEdge=function(b,c,e){var f=this;if(b instanceof m){a.prototype.addEdge.call(this,b);var g=b;return g.on("setAttr",this.updateHandler),this.fire("sync_start_edge,sync_start",++this._wait_for_synced,"add_edge",g),d.sendAPI("/dataset/graph/"+this.desc.id+"/edge",{desc:JSON.stringify(g.persist())},"post").then(function(a){return f.fire("sync_edge,sync",--f._wait_for_synced,g),f})}return a.prototype.addEdge.call(this,b,c,e)},b.prototype.removeEdge=function(b){var c=this;return a.prototype.removeEdge.call(this,b)?(b.off("setAttr",this.updateHandler),this.fire("sync_start_edge,sync_start",++this._wait_for_synced,"remove_edge",b),d.sendAPI("/dataset/graph/"+this.desc.id+"/edge/"+b.id,{},"delete").then(function(a){return c.fire("sync_edge,sync",--c._wait_for_synced,b),c})):Promise.reject("invalid edge")},b.prototype.updateEdge=function(b){var c=this;return a.prototype.updateEdge.call(this,b),this.fire("sync_start_edge,sync_start",++this._wait_for_synced,"update_edge",b),d.sendAPI("/dataset/graph/"+this.desc.id+"/edge/"+b.id,{desc:JSON.stringify(b.persist())},"put").then(function(a){return c.fire("sync_edge,sync",--c._wait_for_synced,b),c})},b.prototype.clear=function(){var b=this;return 0===this.nnodes&&0===this.nedges?Promise.resolve(this):(this.nodes.forEach(function(a){return a.off("setAttr",b.updateHandler)}),this.edges.forEach(function(a){return a.off("setAttr",b.updateHandler)}),a.prototype.clear.call(this),this.fire("sync_start",++this._wait_for_synced,"clear"),d.sendAPI("/dataset/graph/"+this.desc.id+"/node",{},"delete").then(function(a){return b.fire("sync"),b}))},b}(q);b.RemoteStoreGraph=s;var t=function(a){function b(b,c,d,e){var f=this;void 0===c&&(c=[]),void 0===d&&(d=[]),void 0===e&&(e=sessionStorage),a.call(this,b,c,d),this.storage=e,this.updateHandler=function(a){var b=a.target;b instanceof l&&f.updateNode(b),b instanceof m&&f.updateEdge(b)}}return __extends(b,a),b.load=function(a,c,d,e){void 0===d&&(d=sessionStorage),void 0===e&&(e=!1);var f=new b(a,[],[],d);return e||f.load(c),f},b.clone=function(a,c,d){void 0===d&&(d=sessionStorage);var e=new b(a.desc,[],[],d);return e.restoreDump(a.persist(),c),e},Object.defineProperty(b.prototype,"uid",{get:function(){return"graph"+this.desc.id},enumerable:!0,configurable:!0}),b.prototype.load=function(b){var c=this,d=this.uid;if(this.storage.hasOwnProperty(d+".nodes")){var e=JSON.parse(this.storage.getItem(d+".nodes")),f={},g=function(a){return f[a]};e.forEach(function(e){var g=JSON.parse(c.storage.getItem(d+".node."+e)),h=b.makeNode(g);f[h.id]=h,h.on("setAttr",c.updateHandler),a.prototype.addNode.call(c,h)});var h=JSON.parse(this.storage.getItem(d+".edges"));h.forEach(function(e){var f=JSON.parse(c.storage.getItem(d+".edge."+e)),h=b.makeEdge(f,g);h.on("setAttr",c.updateHandler),a.prototype.addEdge.call(c,h)}),this.fire("loaded")}},b["delete"]=function(a,b){void 0===b&&(b=sessionStorage);var c="graph"+a.id;return JSON.parse(b.getItem(c+".nodes")).forEach(function(a){b.removeItem(c+".node."+a)}),b.removeItem(c+".nodes"),JSON.parse(b.getItem(c+".edges")).forEach(function(a){b.removeItem(c+".edge."+a)}),b.removeItem(c+".edges"),!0},b.prototype.restoreDump=function(a,b){var c=this,d={},e=function(a){return d[a]};return a.nodes.forEach(function(a){var e=b.makeNode(a);d[e.id]=e,c.addNode(e)}),a.edges.forEach(function(a){var d=b.makeEdge(a,e);c.addEdge(d)}),this},b.prototype.addNode=function(b){a.prototype.addNode.call(this,b);var c=this.uid;return this.storage.setItem(c+".node."+b.id,JSON.stringify(b.persist())),this.storage.setItem(c+".nodes",JSON.stringify(this.nodes.map(function(a){return a.id}))),b.on("setAttr",this.updateHandler),this},b.prototype.updateNode=function(b){a.prototype.updateNode.call(this,b);var c=this.uid;return this.storage.setItem(c+".node."+b.id,JSON.stringify(b.persist())),this},b.prototype.removeNode=function(b){if(!a.prototype.removeNode.call(this,b))return null;var c=this.uid;return this.storage.setItem(c+".nodes",JSON.stringify(this.nodes.map(function(a){return a.id}))),this.storage.removeItem(c+".node."+b.id),b.off("setAttr",this.updateHandler),this},b.prototype.addEdge=function(b,c,d){if(b instanceof m){a.prototype.addEdge.call(this,b);var e=b,f=this.uid;return this.storage.setItem(f+".edges",JSON.stringify(this.edges.map(function(a){return a.id}))),this.storage.setItem(f+".edge."+e.id,JSON.stringify(e.persist())),e.on("setAttr",this.updateHandler),this}return a.prototype.addEdge.call(this,b,c,d)},b.prototype.removeEdge=function(b){if(!a.prototype.removeEdge.call(this,b))return null;var c=this.uid;return this.storage.setItem(c+".edges",JSON.stringify(this.edges.map(function(a){return a.id}))),this.storage.removeItem(c+".edge."+b.id),b.off("setAttr",this.updateHandler),this},b.prototype.updateEdge=function(b){a.prototype.updateEdge.call(this,b);var c=this.uid;return this.storage.setItem(c+".edge."+b.id,JSON.stringify(b.persist())),this},b.prototype.clear=function(){var b=this,c=this.nnodes,d=this.nedges;if(0===c&&0===d)return this;this.nodes.forEach(function(a){return a.off("setAttr",b.updateHandler)}),this.edges.forEach(function(a){return a.off("setAttr",b.updateHandler)}),a.prototype.clear.call(this);var e=this.uid;JSON.parse(this.storage.getItem(e+".nodes")).forEach(function(a){b.storage.removeItem(e+".node."+a)}),this.storage.removeItem(e+".nodes"),JSON.parse(this.storage.getItem(e+".edges")).forEach(function(a){b.storage.removeItem(e+".edge."+a)}),this.storage.removeItem(e+".edges")},b.prototype.persist=function(){var a={root:this.desc.id};return a.nodes=this.nodes.map(function(a){return a.persist()}),a.edges=this.edges.map(function(a){return a.persist()}),a},b}(q);b.LocalStorageGraph=t}(a,c,a("../caleydo_core/main"),a("../caleydo_core/ajax"),a("../caleydo_core/idtype"),a("../caleydo_core/datatype"),a("../caleydo_core/range"),a("../caleydo_core/event"))},{"../caleydo_core/ajax":3,"../caleydo_core/datatype":6,"../caleydo_core/event":7,"../caleydo_core/idtype":9,"../caleydo_core/main":13,
"../caleydo_core/range":20}],37:[function(a,b,c){!function(a,b,c,d,e,f,g,h,i){function j(a,b){return a="number"==typeof a?a:a.id,b="number"==typeof b?b:b.id,Math.min(a,b)+"-"+Math.max(a,b)}var k=function(){function a(a,b){var c=this;this.v=a,this.dirtyEvents=b,this.callbacks=[],this.lookup=i.map(),this.l=function(){c.callbacks.forEach(function(a){return a(c)})},this.dirtyEvents.forEach(function(b){return a.on(b,c.l)}),this.v.data.idtypes.forEach(function(a,b){c.lookup.set(a.id,b)})}return Object.defineProperty(a.prototype,"vis",{get:function(){return this.v},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"id",{get:function(){return this.v.id},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"location",{get:function(){return this.v.location},enumerable:!0,configurable:!0}),a.prototype.dimOf=function(a){return this.lookup.has(a.id)?this.lookup.get(a.id):-1},Object.defineProperty(a.prototype,"data",{get:function(){return this.v.data},enumerable:!0,configurable:!0}),a.prototype.ids=function(){return this.v.ids()},Object.defineProperty(a.prototype,"idtypes",{get:function(){return this.data.idtypes},enumerable:!0,configurable:!0}),a.prototype.locate=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return this.v.locate.apply(this.vis,a)},a.prototype.locateById=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return this.v.locateById.apply(this.vis,a)},a.prototype.destroy=function(){var a=this;this.dirtyEvents.forEach(function(b){return a.v.off(b,a.l)})},a}(),l=i.svg.line().interpolate("linear-closed").x(c.getter("x")).y(c.getter("y")),m=function(){function a(a,b,c,d,e){this.a=a,this.b=b,this.idtype=c,this.all=d,this.options=e,this.id=j(a,b)}return a.prototype.update=function(a){var b,c=this,d=this.a,e=this.b,f=d.location.aabb(),g=e.location.aabb();if(g.x2<f.x-10&&(b=e,e=d,d=b,b=g,g=f,f=b),this.options.animate&&a.transition().duration(this.options.duration).style("opacity",0),!this.shouldRender(d,f,e,g))return this.render([],a),void(this.options.animate&&a.transition().duration(this.options.duration).style("opacity",1));var h=this.options.reprs[Math.abs(this.mode(a))-1].load().then(function(a){return a.factory(c,d,f,e,g)});return h.then(function(b){return c.options.interactive!==!1&&b.unshift({clazz:"rel-back",d:l.interpolate("linear-closed")([f.corner("ne"),g.corner("nw"),g.corner("sw"),f.corner("se")]),id:"background"}),c.render(b,a),c.options.animate&&a.transition().duration(c.options.duration).style("opacity",1),null})},Object.defineProperty(a.prototype,"line",{get:function(){return l},enumerable:!0,configurable:!0}),a.prototype.createBand=function(a,b,c,d,h,i,j){function k(c,d,f,i,j,k){var m=n.slice(),p=e.Vector2D.fromPoints(n[0],a.corner("se")),q=e.Vector2D.fromPoints(n[1],b.corner("sw"));m.push(n[1].add(q.multiply(d))),m.push(n[0].add(p.multiply(c))),j>0&&m[0].addEquals(p.multiplyEquals(j)),k>0&&m[1].addEquals(q.multiplyEquals(k)),o.push({clazz:i,d:l.interpolate("linear-closed")(m),id:f,range:g.list(h)})}var m=h.length,n=[a.corner("ne"),b.corner("nw")],o=[],p=this.idtype.selections().dim(0),q=p.isNone?0:h.intersect(p).length;if(q>0&&k(q/c.length,q/d.length,i+"-sel",j+" select-"+f.defaultSelectionType,0,0),k(m/c.length,m/d.length,i,j,q/c.length,q/d.length),this.options.hover){p=this.idtype.selections(f.hoverSelectionType).dim(0);var r=p.isNone?0:h.intersect(p).length;r>0&&k(r/c.length,r/d.length,i+"-sel",j+" select-"+f.hoverSelectionType,0,0)}return o},a.prototype.shouldRender=function(a,b,c,e){var f=this;if(!(b.x2<e.x-10))return!1;var g=d.polygon(b.corner("ne"),e.corner("nw"),e.corner("sw"),b.corner("se"));return this.all.every(function(a){if(a===f.a||a===f.b)return!0;var b=a.location,c=g.intersects(b);return!c.intersects})},a.prototype.mode=function(a){var b=+a.attr("data-mode");return b?b:(b=this.options.mode||1,"string"==typeof b&&(b=1+c.indexOf(this.options.reprs,function(a){return a.id===b})),b)},a.prototype.setMode=function(a,b){a.attr("data-mode",b),this.update(a)},a.prototype.nextMode=function(a){var b=this.mode(a),c=this.options.reprs.length;1!==c&&(b>0?b=b===c.length?-b+1:b+1:0>b&&(b=-1===b?-b+1:b+1),this.setMode(a,b))},a.prototype.render=function(a,b){var c=this,d=b.selectAll("path").data(a,function(a){return a.id}),e=d.enter().append("path").on("click",function(a){a.range&&c.options.canSelect()&&c.idtype.select(a.range,f.toSelectOperation(i.event)),i.event.preventDefault(),i.event.stopPropagation()});this.options.hover&&e.on("mouseenter",function(a){a.range&&c.options.canHover()&&c.idtype.select(f.hoverSelectionType,a.range),i.event.preventDefault(),i.event.stopPropagation()}).on("mouseleave",function(a){a.range&&c.options.canHover()&&c.idtype.clear(f.hoverSelectionType),i.event.preventDefault(),i.event.stopPropagation()}),d.exit().remove(),d.attr({"class":function(a){return a.clazz},d:function(a){return a.d}}),this.options.interactive!==!1&&b.select("path.rel-back").on("contextmenu",function(){c.nextMode(b),i.event.preventDefault()})},a}(),n=function(){function a(a,b,d){var e=this;void 0===d&&(d={}),this.idtype=a,this.parent=b,this.options=d,this.listener=function(a,b,c,d,f){return e.selectionUpdate(b,c,d,f)},this.change=function(a){return e.changed(a)},this.arr=[],a.on("select",this.listener),this.$node=i.select(b).append("svg"),this.$node.style({left:"0px",top:"0px",opacity:1}),this.$node.append("g"),c.onDOMNodeRemoved(this.$node.node(),this.destroy,this)}return a.prototype.selectionUpdate=function(a,b,c,d){this.renderAll()},a.prototype.hide=function(){this.$node.select("g").selectAll("g").transition().duration(this.options.duration).style("opacity",0)},a.prototype.show=function(){this.$node.select("g").selectAll("g").transition().duration(this.options.duration).style("opacity",1)},a.prototype.changed=function(a){this.arr.length>1&&this.render(a)},a.prototype.moveSVG=function(){var a=this.arr[0].location.aabb();this.arr.forEach(function(b){var c=b.location.aabb(),d=0;c.x<a.x&&(d=a.x-c.x,a.x-=d,a.w+=d),c.x2>a.x2&&(a.x2=c.x2),c.y<a.y&&(d=a.y-c.y,a.y-=d,a.h+=d),c.y2>a.y2&&(a.y2=c.y2)}),this.$node.attr({width:a.w,height:a.h}),this.$node.style({left:a.x+"px",top:a.y+"px"}),this.$node.select("g").attr("transform","translate("+-a.x+","+-a.y+")")},a.prototype.prepareCombinations=function(){var a,b,d,e,f=this.$node.select("g"),g=[],h=this.arr.length,i=this.options.filter||c.constantTrue;for(a=0;h>a;++a)for(d=this.arr[a],b=0;a>b;++b)e=this.arr[b],i(d.vis,e.vis)&&g.push(new m(d,e,this.idtype,this.arr,this.options));var j=f.selectAll("g").data(g,function(a){return a.id});j.enter().append("g").attr("data-id",function(a){return a.id}).style("opacity",this.options.animate?0:1),this.options.animate?j.exit().transition().duration(this.options.duration).style("opacity",0).remove():j.exit().remove()},a.prototype.update=function(){return this.moveSVG(),this.prepareCombinations(),this.renderAll()},a.prototype.renderAll=function(){var a,b,c,d,e=this.$node.select("g"),f=this.arr.length,g=[];for(a=0;f>a;++a)for(c=this.arr[a],b=1;f>b;++b){d=this.arr[b];var h=j(c,d),k=e.select('g[data-id="'+h+'"]');k.each(function(a){g.push(a.update(i.select(this)))})}return Promise.all(g)},a.prototype.render=function(a){this.moveSVG(),this.prepareCombinations();var b=this.$node.select("g"),c=[];return this.arr.forEach(function(d){if(d!==a){var e=j(d,a);b.select('g[data-id="'+e+'"]').each(function(a){c.push(a.update(i.select(this)))})}}),Promise.all(c)},a.prototype.destroy=function(){this.idtype.off("select",this.listener)},a.prototype.push=function(a,b){void 0===b&&(b=!0);var c=a.idtypes;c.indexOf(this.idtype)>=0&&(this.arr.push(a),a.callbacks.push(this.change),this.arr.length>1&&b&&this.render(a))},a.prototype.remove=function(a,b){void 0===b&&(b=!0);var c=this.arr.indexOf(a);return c>=0&&(this.arr.splice(c,1),a.callbacks.splice(a.callbacks.indexOf(this.change),1),this.prepareCombinations()),0===this.arr.length&&this.$node.remove(),this.arr.length>0},a}(),o=function(){function a(a,b,d){void 0===d&&(d={}),this.parent=a,this.dirtyEvents=b,this.arr=[],this.node=document.createElement("div"),this.links=[],this.options={reprs:h.list("link-representation").sort(function(a,b){return b.granularity-a.granularity}),animate:!0,duration:100,filter:c.constantTrue,idTypeFilter:c.constantTrue,hover:!1,canSelect:c.constantTrue,canHover:c.constantFalse},a.appendChild(this.node),this.node.classList.add("link-container"),c.onDOMNodeRemoved(this.node,this.destroy,this),c.mixin(this.options,d)}return a.prototype.hide=function(){this.links.forEach(function(a){return a.hide()})},a.prototype.show=function(){this.links.forEach(function(a){return a.show()})},a.prototype.update=function(){this.links.forEach(function(a){return a.update()})},a.prototype.push=function(a){for(var b=this,c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=a!==!1;"boolean"!=typeof a&&c.unshift(a);var f=this.options.idTypeFilter;c.forEach(function(a){var c=new k(a,b.dirtyEvents);b.arr.push(c);var d=c.idtypes.filter(function(b,c){return f(b,c,a)});b.links.forEach(function(a){a.push(c,e);var b=d.indexOf(a.idtype);b>=0&&d.splice(b,1)}),d.forEach(function(a){var d=new n(a,b.node,b.options);d.push(c,e),b.links.push(d)})})},a.prototype.remove=function(a,b){var d=a!==!1;"boolean"!=typeof a&&(b=a);var e=c.indexOf(this.arr,function(a){return a.vis===b});if(0>e)return!1;var f=this.arr[e];return f.destroy(),this.links=this.links.filter(function(a){return a.remove(f,d)}),this.arr.splice(e,1),!0},a.prototype.clear=function(){this.arr.forEach(function(a){return a.destroy()}),this.links=[],this.arr=[]},a.prototype.destroy=function(){this.node.parentElement.removeChild(this.node),this.arr.forEach(k.prototype.destroy.call)},a}();b.LinkContainer=o}(a,c,a("../caleydo_core/main"),a("../caleydo_core/geom"),a("../caleydo_core/2D"),a("../caleydo_core/idtype"),a("../caleydo_core/range"),a("../caleydo_core/plugin"),a("d3"))},{"../caleydo_core/2D":2,"../caleydo_core/geom":8,"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_core/plugin":19,"../caleydo_core/range":20,d3:void 0}],38:[function(a,b,c){!function(a,b,c,d){function e(a,b,c,d,e){var f=b.dimOf(a.idtype),g=d.dimOf(a.idtype);return Promise.all([b.ids(),d.ids()]).then(function(b){var d=b[0].dim(f),h=b[1].dim(g);return a.createBand(c,e,d,h,d.intersect(h),"block","rel-block")})}function f(a){return Array.isArray(a)?a:[a]}function g(a,b,c,e,g){function h(a){return a instanceof d.CompositeRange1D?a.groups:[d.asUngrouped(a)]}var i=b.dimOf(a.idtype),j=e.dimOf(a.idtype);return Promise.all([b.ids(),e.ids()]).then(function(a){var c=h(a[0].dim(i)),f=h(a[1].dim(j)),g=c.map(function(a){var b=d.all();return b.dims[i]=a,b}),k=f.map(function(a){var b=d.all();return b.dims[j]=a,b});return Promise.all([Promise.resolve({groupa:c,groupb:f}),b.locateById.apply(b,g),e.locateById.apply(e,k)])}).then(function(b){function c(a){return function(b,c){return{g:b,len:b.length,loc:a[c]?a[c].aabb():null}}}var d=b[0].groupa.map(c(f(b[1]))),e=b[0].groupb.map(c(f(b[2]))),g=[];return d.forEach(function(b){e.forEach(function(c){var d=b.g.intersect(c.g),e=d.length;if(0!==e){var f=b.g.name+"-"+c.g.name;b.loc&&c.loc&&(g.push.apply(g,a.createBand(b.loc,c.loc,b.g,c.g,d,f,"rel-group")),b.loc.y+=b.loc.h*(e/b.len),c.loc.y+=c.loc.h*(e/c.len))}})}),g})}function h(a,b){var c=a.aabb(),d=b.aabb();return c.cx>d.cx?["w","e"]:["e","w"]}function i(a,b,e,g,i){function j(a,b,c){if(!c)return a.center;var d=h(a,b);return a.corner(d[0])}var k=b.dimOf(a.idtype),l=g.dimOf(a.idtype),m=b.data.dim.length>1,n=g.data.dim.length>1;return Promise.all([b.ids(),g.ids()]).then(function(a){var c=a[0].dim(k),e=a[1].dim(l),f=c.intersect(e),h=[],i=[];return f.forEach(function(a){var b=d.all();b.dim(k).setList([a]),h.push(b),b=d.all(),b.dim(l).setList([a]),i.push(b)}),Promise.all([Promise.resolve(f),b.locateById.apply(b,h),g.locateById.apply(g,i)])}).then(function(b){var d=b[0],e=f(b[1]),g=f(b[2]),h=[];a.line.interpolate("linear");var i=a.idtype.selections().dim(0);return d.forEach(function(b,d){var f=c.wrap(e[d]),k=c.wrap(g[d]);f&&k&&h.push({clazz:"rel-item"+(i.contains(b)?" select-selected":""),id:b,d:a.line([j(f,k,m),j(k,f,n)])})}),h})}b.createBlockRep=e,b.createGroupRep=g,b.createItemRep=i}(a,c,a("../caleydo_core/geom"),a("../caleydo_core/range"))},{"../caleydo_core/geom":8,"../caleydo_core/range":20}],39:[function(a,b,c){!function(a,b,c,d,e){"use strict";function f(){return i++}function g(a,b){var c=a.aabb(),d=b.aabb();return c.cx>d.cx?["w","e"]:["e","w"]}function h(a){return new k(a)}var i=0,j=c.svg.line(),k=function(){function a(a){this.visses=[],this.observing=c.map(),this.$parent=c.select(a),this.$div=this.$parent.append("div").attr({"class":"layer layer1 links"}),this.$svg=this.$div.append("svg").attr({width:"100%",height:"100%"})}return a.prototype.register=function(a){function b(){c.update(a)}var c=this;return a.on("select",b),{idtype:a,l:b,visses:[],push:function(a,b){this.visses.push({vis:a,dim:b,id:f()})},remove:function(a){var b,c=this.visses;for(b=c.length-1;b>=0;--b)c[b].vis===a&&c.splice(b,1)}}},a.prototype.unregister=function(a){var b=a.idtype;b.off("select",a.l)},a.prototype.push=function(a){var b=this;this.visses.push(a);var c=this.observing;a.data.idtypes.forEach(function(d,e){if(c.has(d.name))c.get(d.name).push(a,e);else{var f=b.register(d);f.push(a,e),c.set(d.name,f),b.updateIDTypes()}}),this.update()},a.prototype.remove=function(a){var b=this,c=this.visses.indexOf(a);c>=0&&this.visses.splice(c,1);var d=this.observing;a.data.idtypes.forEach(function(c){var e=d.get(c.name);e.remove(a),0===e.visses.length&&(b.unregister(e),d.remove(c.name),b.updateIDTypes())}),this.update()},a.prototype.update=function(a){function b(a,b){var c,d,f,g,h=[],i=a.visses.length;for(c=0;i>c;++c)for(f=a.visses[c].id,d=0;c>d;++d)g=a.visses[d].id,h.push(Math.min(f,g)+"-"+Math.max(f,g));var j=b.selectAll("g").data(h);j.enter().append("g"),j.exit().remove(),j.attr("data-id",e.identity)}function c(a,b,c,d){0!==a.length&&a.forEach(function(a){var e=b>a.id,f=Math.min(b,a.id)+"-"+Math.max(b,a.id),h=d.select('g[data-id="'+f+'"]'),i=[];c.forEach(function(b,c){if(b&&a.locs[c]){var d=g(b,a.locs[c]),f=[b.corner(d[0]),a.locs[c].corner(d[1])];i.push(e?f.reverse():f)}});var k=h.selectAll("path").data(i);k.enter().append("path").attr("class","select-selected"),k.exit().remove(),k.attr("d",function(a){return j(a)})})}function f(a){var e=this.$svg.select('g[data-idtype="'+a.idtype.name+'"]');if(a.visses.length<=1)return void e.selectAll("*").remove();var f=a.idtype.selections();if(f.isNone)return void e.selectAll("*").remove();console.log(a.idtype.name,f.toString()),b(a,e);var g=[];a.visses.forEach(function(a){var b=a.id;a.vis.data.ids().then(function(h){var i=h.dim(a.dim),j=[],k=[];f.dim(0).iter().forEach(function(a){var b=i.indexOf(a);0>b?j.push(-1):(j.push(k.length),k.push(d.list(b)))}),0!==k.length&&a.vis.locate.apply(a.vis,k).then(function(a){var d;d=1===k.length?j.map(function(b){return 0>b?void 0:a}):j.map(function(b){return a[b]}),c(g,b,d,e),g.push({id:b,locs:d})})})})}a?f.call(this,this.observing.get(a.name)):this.observing.values().forEach(f,this)},a.prototype.updateIDTypes=function(){var a=this.$svg.selectAll("g").data(this.observing.values());a.enter().append("g"),a.exit().remove(),a.attr("data-idtype",function(a){return a.idtype.name})},a}();b.LinksRenderer=k,b.create=h}(a,c,a("d3"),a("../caleydo_core/range"),a("../caleydo_core/main"))},{"../caleydo_core/main":13,"../caleydo_core/range":20,d3:void 0}],40:[function(a,b,c){!function(a,b,c,d,e,f,g,h,i,j){function k(a,c,d,e){return void 0===d&&(d=b.cat.data),void 0===e&&(e=c+"_"+d),{v:Promise.resolve(a),value:a,name:c,category:d,hash:e}}function l(a){if(a instanceof Element){var b=a,c=b.getAttribute("id");return{type:"element",id:c}}if(i.isDataType(a)){var b=a;return{type:"dataset",id:b.desc.id,persist:b.persist()}}return"string"==typeof a||"number"==typeof a?{type:"primitive",v:a}:null}function m(a){if(!a)return null;switch(a.type){case"element":return a.id?Promise.resolve(document.getElementById(a.id)):null;case"dataset":return e.get(a.persist);case"primitive":return Promise.resolve(a.v)}return null}function n(){return j.retrieve("username","Anonymous")}function o(a,c,d,e,f){return void 0===c&&(c=b.cat.data),void 0===d&&(d=b.op.update),void 0===e&&(e=Date.now()),void 0===f&&(f=n()),new F(c,d,a,e,f)}function p(a,b,c,d,e){return void 0===d&&(d=[]),void 0===e&&(e={}),{meta:a,id:b,f:c,inputs:d,parameter:e}}function q(a,b){var c=+a.getAttr("index",0),d=+b.getAttr("index",0);return c-d}function r(a){return a.filter(function(a){return"noop"!==a.f_id})}function s(a){return function(b){b=r(b);var c;do c=b.length,a.forEach(function(a){return b=a(b)});while(c>b.length);return b}}function t(a){var b=d.list("actionCompressor").filter(function(b){return a.some(function(a){return null!=a.f_id.match(b.matches)})});return d.load(b).then(function(a){return s(a.map(function(a){return a.factory}))})}function u(a){return t(a).then(function(b){var c;do c=a.length,a=b(a);while(c>a.length);return a})}function v(a,b){for(var c=0;c<a.length&&c<b.length&&a[c]===b[c];)c++;return 0===c?null:{i:c-1,j:c-1}}function w(a){return c.isFunction(a)?a:c.constant(a)}function x(a,b){return{inverse:y()}}function y(){return{meta:o("noop",b.cat.custom),id:"noop",f:x,inputs:[],parameter:{}}}function z(){function a(a){if("noop"===a)return Promise.resolve(x);var c=b.filter(function(b){return null!=a.match(b.creates)})[0];return null==c?Promise.reject("no factory found for "+a):c.load().then(function(b){return b.factory(a)})}var b=d.list("actionFactory"),e=function(b){var d=null;return function(e,f){var g=this,h=c.argList(arguments);return null==d&&(d=a(b)),d.then(function(a){return a.apply(g,h)})}};return function(a){return e(a)}}function A(){var a=z(),b={action:G,state:H,object:E,story:I};return{makeNode:function(c){return b[c.type].restore(c,a)},makeEdge:function(a,b){return(new f.GraphEdge).restore(a,b)}}}function B(a){for(var b=[];a;){if(b.indexOf(a)>=0)return b;b.push(a),a=a.next}return b}function C(a){return function(b){return a===b||(null===b.value||b.value===a.value)&&a.hash===b.hash}}function D(a){for(var b=a.path.slice();null!=(a=a.nextState)&&b.indexOf(a)<0;)b.push(a);return b}b.cat={data:"data",selection:"selection",visual:"visual",layout:"layout",logic:"logic",custom:"custom",annotation:"annotation"},b.op={create:"create",update:"update",remove:"remove"},b.ref=k;var E=function(a){function c(c,d,e,f,g){void 0===e&&(e=b.cat.data),void 0===f&&(f=d+"_"+e),void 0===g&&(g=""),a.call(this,"object"),this._v=c,this._persisted=null,null!=c&&(this._promise=Promise.resolve(c)),a.prototype.setAttr.call(this,"name",d),a.prototype.setAttr.call(this,"category",e),a.prototype.setAttr.call(this,"hash",f),a.prototype.setAttr.call(this,"description",g)}return __extends(c,a),Object.defineProperty(c.prototype,"value",{get:function(){return this.checkPersisted(),this._v},set:function(a){this._v=a,null==this._promise&&(this._promise=Promise.resolve(a)),this._persisted=null},enumerable:!0,configurable:!0}),c.prototype.checkPersisted=function(){var a=this;null!=this._persisted&&(this._promise=m(this._persisted),this._promise&&this._promise.then(function(b){a._v=b}),this._persisted=null)},Object.defineProperty(c.prototype,"v",{get:function(){return this.checkPersisted(),this._promise},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return a.prototype.getAttr.call(this,"name","")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"category",{get:function(){return a.prototype.getAttr.call(this,"category","")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hash",{get:function(){return a.prototype.getAttr.call(this,"hash","")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"description",{get:function(){return a.prototype.getAttr.call(this,"description","")},enumerable:!0,configurable:!0}),c.prototype.persist=function(){var b=a.prototype.persist.call(this);return b.attrs||(b.attrs={}),b.attrs.v=this._persisted?this._persisted:l(this.value),b},c.prototype.restore=function(b){return this._persisted=b.attrs.v,delete b.attrs.v,a.prototype.restore.call(this,b),this},c.restore=function(a){var b=new c(null,a.attrs.name,a.attrs.category,a.attrs.hash||a.attrs.name+"_"+a.attrs.category);return b.restore(a)},Object.defineProperty(c.prototype,"createdBy",{get:function(){var a=this.incoming.filter(f.isType("creates"))[0];return a?a.source:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"removedBy",{get:function(){var a=this.incoming.filter(f.isType("removes"))[0];return a?a.source:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"requiredBy",{get:function(){return this.incoming.filter(f.isType("requires")).map(function(a){return a.source})},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"partOf",{get:function(){return this.incoming.filter(f.isType("consistsOf")).map(function(a){return a.source})},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return this.name},c}(f.GraphNode);b.ObjectNode=E;var F=function(){function a(a,b,c,d,e){void 0===d&&(d=Date.now()),void 0===e&&(e=n()),this.category=a,this.operation=b,this.name=c,this.timestamp=d,this.user=e}return a.restore=function(b){return new a(b.category,b.operation,b.name,b.timestamp,b.user)},a.prototype.eq=function(a){return this.category===a.category&&this.operation===a.operation&&this.name===a.name},a.prototype.inv=function(a){return this.category!==a.category?!1:this.operation===b.op.update?a.operation===b.op.update:this.operation===b.op.create?a.operation===b.op.remove:a.operation===b.op.create},a.prototype.toString=function(){return this.category+":"+this.operation+" "+this.name},a}();b.ActionMetaData=F,b.meta=o,b.action=p;var G=function(a){function b(b,c,d,e){void 0===e&&(e={}),a.call(this,"action"),this.f=d,a.prototype.setAttr.call(this,"meta",b),a.prototype.setAttr.call(this,"f_id",c),a.prototype.setAttr.call(this,"parameter",e)}return __extends(b,a),b.prototype.clone=function(){return new b(this.meta,this.f_id,this.f,this.parameter)},Object.defineProperty(b.prototype,"name",{get:function(){return this.meta.name},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"meta",{get:function(){return a.prototype.getAttr.call(this,"meta")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"f_id",{get:function(){return a.prototype.getAttr.call(this,"f_id")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"parameter",{get:function(){return a.prototype.getAttr.call(this,"parameter")},set:function(b){a.prototype.setAttr.call(this,"parameter",b)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onceExecuted",{get:function(){return a.prototype.getAttr.call(this,"onceExecuted",!1)},set:function(b){this.onceExecuted!==b&&a.prototype.setAttr.call(this,"onceExecuted",b)},enumerable:!0,configurable:!0}),b.restore=function(a,c){var d=new b(F.restore(a.attrs.meta),a.attrs.f_id,c(a.attrs.f_id),a.attrs.parameter);return d.restore(a)},b.prototype.toString=function(){return this.meta.name},Object.defineProperty(b.prototype,"inversedBy",{get:function(){var a=this.incoming.filter(f.isType("inverses"))[0];return a?a.source:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inverses",{get:function(){var a=this.outgoing.filter(f.isType("inverses"))[0];return a?a.target:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isInverse",{get:function(){return null!=this.outgoing.filter(f.isType("inverses"))[0]},enumerable:!0,configurable:!0}),b.prototype.getOrCreateInverse=function(a){var b=this.inversedBy;return b?b:this.inverter?a.createInverse(this,this.inverter):(this.inverter=null,null)},b.prototype.updateInverse=function(a,b){var c=this.inversedBy;if(c){var d=b.call(this,this.requires,this.creates,this.removes);c.parameter=d.parameter,this.inverter=null}else this.isInverse?this.inverter=b:(a.createInverse(this,b),this.inverter=null)},b.prototype.execute=function(a,b){var c=this.f.call(this,this.requires,this.parameter,a,b);return Promise.resolve(c)},b.prototype.equals=function(a){return this.meta.category!==a.meta.category||a.meta.operation!==a.meta.operation?!1:this.f_id!==a.f_id?!1:!0},Object.defineProperty(b.prototype,"uses",{get:function(){return this.outgoing.filter(f.isType(/(creates|removes|requires)/)).map(function(a){return a.target})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"creates",{get:function(){return this.outgoing.filter(f.isType("creates")).map(function(a){return a.target})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"removes",{get:function(){return this.outgoing.filter(f.isType("removes")).sort(q).map(function(a){return a.target})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"requires",{get:function(){return this.outgoing.filter(f.isType("requires")).sort(q).map(function(a){return a.target})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"resultsIn",{get:function(){var a=this.outgoing.filter(f.isType("resultsIn"))[0];return a?a.target:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"previous",{get:function(){var a=this.incoming.filter(f.isType("next"))[0];return a?a.source:null},enumerable:!0,configurable:!0}),b}(f.GraphNode);b.ActionNode=G;var H=function(a){function b(b,c){void 0===c&&(c=""),a.call(this,"state"),a.prototype.setAttr.call(this,"name",b),a.prototype.setAttr.call(this,"description",c)}return __extends(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return a.prototype.getAttr.call(this,"name")},set:function(b){a.prototype.setAttr.call(this,"name",b)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"description",{get:function(){return a.prototype.getAttr.call(this,"description","")},set:function(b){a.prototype.setAttr.call(this,"description",b)},enumerable:!0,configurable:!0}),b.restore=function(a){var c=new b(a.attrs.name);return c.restore(a)},Object.defineProperty(b.prototype,"consistsOf",{get:function(){return this.outgoing.filter(f.isType("consistsOf")).map(function(a){return a.target})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"resultsFrom",{get:function(){return this.incoming.filter(f.isType("resultsIn")).map(function(a){return a.source})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"creator",{get:function(){var a=this.incoming.filter(f.isType("resultsIn")).map(function(a){return a.source}).filter(function(a){return!a.isInverse});return 0===a.length?null:a[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"next",{get:function(){return this.outgoing.filter(f.isType("next")).map(function(a){return a.target}).filter(function(a){return!a.isInverse})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"previousState",{get:function(){var a=this.creator;return a?a.previous:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"previousStates",{get:function(){return this.resultsFrom.map(function(a){return a.previous})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextStates",{get:function(){return this.next.map(function(a){return a.resultsIn})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextState",{get:function(){var a=this.next[0];return a?a.resultsIn:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"path",{get:function(){var a=this.previousState,b=[];return b.unshift(this),a&&a.pathImpl(b),b},enumerable:!0,configurable:!0}),b.prototype.pathImpl=function(a){var b=this.previousState;a.unshift(this),b&&a.indexOf(b)<0&&b.pathImpl(a)},b.prototype.toString=function(){return this.name},b}(f.GraphNode);b.StateNode=H,b.DEFAULT_DURATION=1500,b.DEFAULT_TRANSITION=0;var I=function(a){function c(){a.call(this,"story")}return __extends(c,a),Object.defineProperty(c.prototype,"name",{get:function(){return a.prototype.getAttr.call(this,"name","")},set:function(b){a.prototype.setAttr.call(this,"name",b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isTextOnly",{get:function(){return!this.outgoing.some(f.isType("jumpTo"))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"state",{get:function(){var a=this.outgoing.filter(f.isType("jumpTo"))[0];return a?a.target:null},enumerable:!0,configurable:!0}),c.restore=function(a){return(new c).restore(a)},Object.defineProperty(c.prototype,"next",{get:function(){var a=this.outgoing.filter(f.isType("next"))[0];return a?a.target:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"nexts",{get:function(){return this.outgoing.filter(f.isType("next")).map(function(a){return a.target})},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"previous",{get:function(){var a=this.incoming.filter(f.isType("next"))[0];return a?a.source:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"slideIndex",{get:function(){var a=this.previous;return 1+(a?a.slideIndex:0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){return this.getAttr("duration",b.DEFAULT_DURATION)},set:function(a){this.setAttr("duration",a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"transition",{get:function(){return this.getAttr("transition",b.DEFAULT_TRANSITION)},set:function(a){this.setAttr("transition",a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"annotations",{get:function(){return this.getAttr("annotations",[])},enumerable:!0,configurable:!0}),c.prototype.setAnnotation=function(a,b){var c=this.annotations;c[a]=b,this.setAttr("annotations",c)},c.prototype.updateAnnotation=function(a){this.setAttr("annotations",this.annotations)},c.prototype.removeAnnotation=function(a){var b=this.annotations;b.splice(a,1),this.setAttr("annotations",b)},c.prototype.removeAnnotationElem=function(a){var b=this.annotations;b.splice(b.indexOf(a),1),this.setAttr("annotations",b)},c.prototype.pushAnnotation=function(a){var b=this.annotations;b.push(a),this.setAttr("annotations",b),this.fire("push-annotations",a,b)},Object.defineProperty(c.prototype,"isStart",{get:function(){return null==this.previous},enumerable:!0,configurable:!0}),c.makeText=function(a){var b=new c;return a&&(b.pushAnnotation({type:"text",pos:[25,25],text:"# ${name}"}),b.name=a),b},c}(f.GraphNode);b.SlideNode=I,b.compress=u,function(a){a[a.Action=0]="Action",a[a.Object=1]="Object",a[a.State=2]="State",a[a.Slide=3]="Slide"}(b.ProvenanceGraphDim||(b.ProvenanceGraphDim={}));var J=b.ProvenanceGraphDim,K=function(){function a(a){void 0===a&&(a={}),this.options={storage:localStorage,prefix:"clue",application:"unknown"},c.mixin(this.options,a)}return a.prototype.list=function(){var a=this,b=JSON.parse(this.options.storage.getItem(this.options.prefix+"_provenance_graphs")||"[]"),c=b.map(function(b){return JSON.parse(a.options.storage.getItem(a.options.prefix+"_provenance_graph."+b))});return Promise.resolve(c)},a.prototype.getGraph=function(a){return Promise.resolve(f.LocalStorageGraph.load(a,A(),this.options.storage))},a.prototype.get=function(a){return this.getGraph(a).then(function(b){return new N(a,b)})},a.prototype.clone=function(a){var b=this.createDesc();return this.getGraph(b).then(function(c){return c.restoreDump(a.persist(),A()),new N(b,c)})},a.prototype["import"]=function(a){var b=this.createDesc();return this.getGraph(b).then(function(c){return c.restoreDump(a,A()),new N(b,c)})},a.prototype["delete"]=function(a){var b=JSON.parse(this.options.storage.getItem(this.options.prefix+"_provenance_graphs")||"[]");return b.splice(b.indexOf(a.id),1),f.LocalStorageGraph["delete"](a),this.options.storage.setItem(this.options.prefix+"_provenance_graphs",JSON.stringify(b)),Promise.resolve(!0)},a.prototype.createDesc=function(){var a=this,b=JSON.parse(this.options.storage.getItem(this.options.prefix+"_provenance_graphs")||"[]"),c=this.options.prefix+(b.length>0?String(1+d3.max(b.map(function(b){
return parseInt(b.slice(a.options.prefix.length),10)}))):"0"),d={type:"provenance_graph",name:"Local Workspace#"+c,fqname:this.options.prefix+".Provenance Graph #"+c,id:c,local:!0,size:[0,0],attrs:{graphtype:"provenance_graph",of:this.options.application},creator:n(),ts:Date.now(),description:""};return b.push(c),this.options.storage.setItem(this.options.prefix+"_provenance_graphs",JSON.stringify(b)),this.options.storage.setItem(this.options.prefix+"_provenance_graph."+c,JSON.stringify(d)),d},a.prototype.create=function(){var a=this.createDesc();return this.get(a)},a}();b.LocalStorageProvenanceGraphManager=K,b.toSlidePath=B;var L=function(){function a(a){void 0===a&&(a={}),this.options={application:"unknown"},c.mixin(this.options,a)}return a.prototype.list=function(){var a=this;return e.list(function(b){return"graph"===b.desc.type&&"provenance_graph"===b.desc.attrs.graphtype&&b.desc.attrs.of===a.options.application}).then(function(a){return a.map(function(a){return a.desc})})},a.prototype.getGraph=function(a){return e.get(a.id).then(function(a){return a.impl(A())})},a.prototype.get=function(a){return this.getGraph(a).then(function(b){return new N(a,b)})},a.prototype["delete"]=function(a){return e.remove(a)},a.prototype["import"]=function(a){var b={type:"graph",attrs:{graphtype:"provenance_graph",of:this.options.application},name:"Workspace for "+this.options.application,creator:n(),ts:Date.now(),description:"",nodes:a.nodes,edges:a.edges};return e.upload(b).then(function(a){return a.impl(A())}).then(function(a){return new N(a.desc,a)})},a.prototype.create=function(){var a={type:"graph",attrs:{graphtype:"provenance_graph",of:this.options.application},name:"Workspace for "+this.options.application,creator:n(),ts:Date.now(),description:""};return e.upload(a).then(function(a){return a.impl(A())}).then(function(a){return new N(a.desc,a)})},a}();b.RemoteStorageProvenanceGraphManager=L;var M=function(){function a(a){void 0===a&&(a={}),this.remote=new L(a),this.local=new K(a)}return a.prototype.listRemote=function(){return this.remote.list()},a.prototype.listLocal=function(){return this.local.list()},a.prototype.list=function(){return Promise.all([this.listLocal(),this.listRemote()]).then(function(a){return a[0].concat(a[1])})},a.prototype["delete"]=function(a){return a.local?this.local["delete"](a):this.remote["delete"](a)},a.prototype.get=function(a){return a.local?this.local.get(a):this.remote.get(a)},a.prototype.getGraph=function(a){return a.local?this.local.getGraph(a):this.remote.getGraph(a)},a.prototype.cloneLocal=function(a){return this.getGraph(a).then(this.local.clone.bind(this.local))},a.prototype.importLocal=function(a){return this.local["import"](a)},a.prototype.importRemote=function(a){return this.remote["import"](a)},a.prototype["import"]=function(a){return this.importLocal(a)},a.prototype.createLocal=function(){return this.local.create()},a.prototype.createRemote=function(){return this.remote.create()},a.prototype.create=function(){return this.createLocal()},a}();b.MixedStorageProvenanceGraphManager=M;var N=function(a){function d(b,c){if(a.call(this,b),this.backend=c,this._actions=[],this._objects=[],this._states=[],this._slides=[],this.act=null,this.lastAction=null,this.currentlyRunning=!1,this.executeCurrentActionWithin=-1,this.nextQueue=[],this.propagate(this.backend,"sync","add_edge","add_node","sync_node","sync_edge","sync_start"),0===this.backend.nnodes)this.act=new H("Start"),this._states.push(this.act),this.backend.addNode(this.act);else{var d=b.act;this._actions=this.backend.nodes.filter(function(a){return a instanceof G}),this._objects=this.backend.nodes.filter(function(a){return a instanceof E}),this._states=this.backend.nodes.filter(function(a){return a instanceof H}),this._slides=this.backend.nodes.filter(function(a){return a instanceof I}),this.act=d>=0?this.getStateById(d):this._states[0]}}return __extends(d,a),Object.defineProperty(d.prototype,"dim",{get:function(){return[this._actions.length,this._objects.length,this._states.length,this._slides.length]},enumerable:!0,configurable:!0}),d.prototype.ids=function(a){void 0===a&&(a=h.all());var b=function(a){return a.id},c=h.Range1D.from(this._actions.map(b)),d=h.Range1D.from(this._objects.map(b)),e=h.Range1D.from(this._states.map(b)),f=h.Range1D.from(this._slides.map(b));return Promise.resolve(a.preMultiply(h.list(c,d,e,f)))},d.prototype.selectState=function(a,b,c,d){void 0===b&&(b=g.SelectOperation.SET),void 0===c&&(c=g.defaultSelectionType),void 0===d&&(d={}),this.fire("select_state,select_state_"+c,a,c,b,d),this.select(J.State,c,a?[this._states.indexOf(a)]:[],b)},d.prototype.selectSlide=function(a,b,c,d){void 0===b&&(b=g.SelectOperation.SET),void 0===c&&(c=g.defaultSelectionType),void 0===d&&(d={}),this.fire("select_slide,select_slide_"+c,a,c,b,d),this.select(J.Slide,c,a?[this._slides.indexOf(a)]:[],b)},d.prototype.selectAction=function(a,b,c){void 0===b&&(b=g.SelectOperation.SET),void 0===c&&(c=g.defaultSelectionType),this.fire("select_action,select_action_"+c,a,c,b),this.select(J.Action,c,a?[this._actions.indexOf(a)]:[],b)},d.prototype.selectedStates=function(a){void 0===a&&(a=g.defaultSelectionType);var b=this.idtypes[J.State].selections(a);if(b.isNone)return[];var c={};this._states.forEach(function(a){return c[a.id]=a});var d=[];return b.dim(0).forEach(function(a){var b=c[a];b&&d.push(b)}),d},d.prototype.selectedSlides=function(a){void 0===a&&(a=g.defaultSelectionType);var b=this.idtypes[J.Slide].selections(a);if(b.isNone)return[];var c={};this._slides.forEach(function(a){return c[a.id]=a});var d=[];return b.dim(0).forEach(function(a){var b=c[a];b&&d.push(b)}),d},Object.defineProperty(d.prototype,"idtypes",{get:function(){return["_provenance_actions","_provenance_objects","_provenance_states","_provenance_stories"].map(g.resolve)},enumerable:!0,configurable:!0}),d.prototype.clear=function(){this.backend.clear(),this._states=[],this._actions=[],this._objects=[],this._slides=[],this.act=null,this.lastAction=null,this.act=new H("start"),this._states.push(this.act),this.backend.addNode(this.act),this.fire("clear")},Object.defineProperty(d.prototype,"states",{get:function(){return this._states},enumerable:!0,configurable:!0}),d.prototype.getStateById=function(a){return c.search(this._states,function(b){return b.id===a})},Object.defineProperty(d.prototype,"actions",{get:function(){return this._actions},enumerable:!0,configurable:!0}),d.prototype.getActionById=function(a){return c.search(this._actions,function(b){return b.id===a})},Object.defineProperty(d.prototype,"objects",{get:function(){return this._objects},enumerable:!0,configurable:!0}),d.prototype.getObjectById=function(a){return c.search(this._objects,function(b){return b.id===a})},Object.defineProperty(d.prototype,"stories",{get:function(){return this._slides},enumerable:!0,configurable:!0}),d.prototype.getSlideById=function(a){return c.search(this._slides,function(b){return b.id===a})},d.prototype.getSlideChains=function(){return this.stories.filter(function(a){return a.isStart})},d.prototype.getSlides=function(){return this.getSlideChains().map(B)},Object.defineProperty(d.prototype,"edges",{get:function(){return this.backend.edges},enumerable:!0,configurable:!0}),d.prototype.addEdge=function(a,b,c,d){void 0===d&&(d={});var e=new f.GraphEdge(b,a,c);return Object.keys(d).forEach(function(a){return e.setAttr(a,d[a])}),this.backend.addEdge(e),e},d.prototype.createAction=function(a,b,c,d,e){void 0===d&&(d=[]),void 0===e&&(e={});var f=new G(a,b,c,e);return this.initAction(f,d)},d.prototype.initAction=function(a,b){var c=this;void 0===b&&(b=[]);var d=b.map(function(a){return c.findInArray(c._objects,a)});return this._actions.push(a),this.backend.addNode(a),this.fire("add_action",a),d.forEach(function(b,d){c.addEdge(a,"requires",b,{index:d})}),a},d.prototype.createInverse=function(a,b){var c=this,d=a.creates,e=a.removes,f=b.call(a,a.requires,d,e),g=this.createAction(f.meta,f.id,f.f,f.inputs,f.parameter);return g.onceExecuted=!0,this.addEdge(g,"inverses",a),e.forEach(function(a,b){c.addEdge(g,"creates",a,{index:b})}),d.forEach(function(a){c.addEdge(g,"removes",a)}),this.addEdge(a.resultsIn,"next",g),this.addEdge(g,"resultsIn",a.previous),g},d.prototype.push=function(a,b,c,d,e){var f=this;return void 0===b&&(b=""),void 0===c&&(c=null),void 0===d&&(d=[]),void 0===e&&(e={}),this.inOrder(function(){if(a instanceof F)return f.run(f.createAction(a,b,c,d,e));var g=a;return f.run(f.createAction(g.meta,g.id,g.f,g.inputs||[],g.parameter||{}))})},d.prototype.findObject=function(a){var b=c.search(this._objects,function(b){return b.value===a});return b?b:null},d.prototype.addObject=function(a,c,d,e){return void 0===c&&(c=a?a.toString():"Null"),void 0===d&&(d=b.cat.data),void 0===e&&(e=c+"_"+d),this.addObjectImpl(a,c,d,e,!0)},d.prototype.addJustObject=function(a,c,d,e){return void 0===c&&(c=a?a.toString():"Null"),void 0===d&&(d=b.cat.data),void 0===e&&(e=c+"_"+d),this.addObjectImpl(a,c,d,e,!1)},d.prototype.addObjectImpl=function(a,c,d,e,f){void 0===c&&(c=a?a.toString():"Null"),void 0===d&&(d=b.cat.data),void 0===e&&(e=c+"_"+d),void 0===f&&(f=!1);var g=new E(a,c,d,e);return this._objects.push(g),this.backend.addNode(g),f&&this.addEdge(this.act,"consistsOf",g),this.fire("add_object",g),g},d.prototype.resolve=function(a){var b=this;return a.map(function(a){if(a instanceof E)return a;if(a._resolvesTo instanceof E)return a._resolvesTo;var c=b.addJustObject(a.value,a.name,a.category,a.hash);return a._resolvesTo=c,c})},d.prototype.findInArray=function(a,b){if(b instanceof E)return b;if(b._resolvesTo instanceof E)return b._resolvesTo;var d=c.search(a,C(b));return b._resolvesTo=d,d},d.prototype.findOrAddObject=function(a,b,c){return this.findOrAddObjectImpl(a,b,c,!0)},d.prototype.findOrAddJustObject=function(a,b,c){return this.findOrAddObjectImpl(a,b,c,!1)},d.prototype.findOrAddObjectImpl=function(a,d,e,f){void 0===f&&(f=!1);var g,h=a;return a instanceof E?a:h._resolvesTo instanceof E?h._resolvesTo:h.hasOwnProperty("value")&&h.hasOwnProperty("name")?(h.category=h.category||b.cat.data,g=c.search(this._objects,C(h)),g?(null===g.value&&(g.value=h.value),h._resolvesTo=g,g):this.addObjectImpl(h.value,h.name,h.category,h.hash,f)):(g=c.search(this._objects,function(b){return!(null!==b.value&&b.value!==a||null!==d&&b.name!==d||null!==e&&e!==b.category)}),g?(null===g.value&&(g.value=a),g):this.addObjectImpl(a,d,e,d+"_"+e,f))},d.prototype.inOrder=function(a){var b=this;if(this.currentlyRunning){var c,d=new Promise(function(a){c=a.bind(b)});return this.nextQueue.push(c),d.then(a)}return a()},d.prototype.run=function(a,b){var d=this;void 0===b&&(b=-1);var e=this.act,f=a.resultsIn,g=!1;f||(g=!0,this.addEdge(e,"next",a),f=this.makeState(a.meta.name),this.addEdge(a,"resultsIn",f)),this.fire("execute",a),c.hash.is("debug")&&console.log("execute "+a.meta+" "+a.f_id),this.currentlyRunning=!0,c.isFunction(b)&&(b=b()),this.executeCurrentActionWithin=b;var h=a.execute(this,this.executeCurrentActionWithin).then(function(b){b=c.mixin({created:[],removed:[],inverse:null,consumed:0},b),d.fire("executed",a,b);var h=!a.onceExecuted;if(a.onceExecuted=!0,h){var i=d.resolve(b.created);i.forEach(function(b,c){d.addEdge(a,"creates",b,{index:c})});var j=a.requires,k=b.removed.map(function(a){return d.findInArray(j,a)});if(k.forEach(function(b){b.value=null,d.addEdge(a,"removes",b)}),g){var l=e.consistsOf;l.push.apply(l,i),k.forEach(function(a){var b=l.indexOf(a);l.splice(b,1)}),l.forEach(function(a){return d.addEdge(f,"consistsOf",a)})}d.fire("executed_first",a,f)}else a.creates.forEach(function(a,c){a.value=b.created[c].value}),a.removes.forEach(function(a){return a.value=null});return b.inverse=w(b.inverse),a.updateInverse(d,b.inverse),d.switchToImpl(a,f),{action:a,state:f,created:i,removed:k,consumed:b.consumed}});return h.then(function(a){var b=d.nextQueue.shift();b?b():d.currentlyRunning=!1}),h},d.prototype.switchToImpl=function(a,b){var c=this.act;this.act=b,this.fire("switch_state",b,c),c=this.lastAction,this.lastAction=a,this.fire("switch_action",a,c)},d.prototype.runChain=function(a,b){var d=this;if(void 0===b&&(b=-1),0===a.length)return b>0?c.resolveIn(b).then(function(){return[]}):Promise.resolve([]);var e=a[a.length-1];return u(a).then(function(a){function c(b){var c=a.length-b;return function(){return 0>h?-1:h/c}}function f(a){h-=a}var g=Promise.resolve([]),h=b;return a.forEach(function(a,e){g=g.then(function(g){return d.run(a,0>b?-1:c(e)).then(function(a){return g.push(a),f(a.consumed),g})})}),g.then(function(a){return d.act!==e.resultsIn&&d.switchToImpl(e,e.resultsIn),a})})},d.prototype.undo=function(){var a=this;return this.lastAction?null!=this.lastAction.inverses?this.jumpTo(this.act.previousState):this.inOrder(function(){return a.run(a.lastAction.getOrCreateInverse(a))}):Promise.resolve(null)},d.prototype.jumpTo=function(a,b){var d=this;return void 0===b&&(b=-1),this.inOrder(function(){var e=[],f=d.act;if(f===a)return b>=0?c.resolveIn(b).then(function(){return[]}):Promise.resolve([]);var g=f.path,h=a.path,i=v(g,h);if(i){var j=g.slice(i.i+1).reverse(),k=h.slice(i.j+1);e=e.concat(j.map(function(a){return a.resultsFrom[0].getOrCreateInverse(d)})),e=e.concat(k.map(function(a){return a.resultsFrom[0]}))}return d.runChain(e,b)})},d.prototype.fork=function(a,b){for(var c=[],d=[a.resultsIn];d.length>0;){var e=d.shift();c.indexOf(e)>=0||(c.push(e),d.push.apply(d,e.nextStates))}if(c.indexOf(b)>=0)return!1;var f=b.consistsOf,g=a.previous.consistsOf,h=g.filter(function(a){return f.indexOf(a)<0});return this.copyBranch(a,b,h),this.fire("forked_branch",a,b),!0},d.prototype.copyAction=function(a,b){var c=this.initAction(a.clone(),a.requires);this.addEdge(b,"next",c);var d=this.makeState(a.resultsIn.name,a.resultsIn.description);return this.addEdge(c,"resultsIn",d),d},d.prototype.copyBranch=function(a,b,c){for(var d=[{a:a,b:b}];d.length>0;){var e=d.shift(),f=e.b,g=e.a;g.requires.some(function(a){return c.indexOf(a)>=0})||(f=this.copyAction(g,e.b)),d.push.apply(d,g.resultsIn.next.map(function(a){return{a:a,b:f}}))}},d.prototype.makeState=function(a,b){void 0===b&&(b="");var c=new H(a,b);return this._states.push(c),this.backend.addNode(c),this.fire("add_state",c),c},d.prototype.persist=function(){var a=this.backend.persist();return a.act=this.act?this.act.id:null,a.lastAction=this.lastAction?this.lastAction.id:null,a},d.prototype.wrapAsSlide=function(a){var b=new I;return b.name=a.name,this.addEdge(b,"jumpTo",a),this._slides.push(b),this.backend.addNode(b),this.fire("add_slide",b),b},d.prototype.cloneSingleSlideNode=function(a){var b=null!=a.state?this.wrapAsSlide(a.state):this.makeTextSlide();return a.attrs.forEach(function(c){"annotations"!==c&&b.setAttr(c,a.getAttr(c,null))}),b.setAttr("annotations",a.annotations.map(function(a){return c.mixin({},a)})),b},d.prototype.extractSlide=function(a,b){var c=this;void 0===b&&(b=!0);var d=function(a){return c._slides.push(a),c.backend.addNode(a),c.fire("add_slide",a),a},e=b?d(I.makeText("Unnamed Story")):null,f=e;if(a.forEach(function(a,b){var g=d(new I);g.name=a.name,c.addEdge(g,"jumpTo",a),f?c.addEdge(f,"next",g):e=g,f=g}),b){var g=I.makeText("Thanks");d(g),this.addEdge(f,"next",g)}return this.fire("extract_slide",e),this.selectSlide(e),e},d.prototype.startNewSlide=function(a,b){void 0===b&&(b=[]);var c=this.makeTextSlide(a);if(b.length>0){var d=this.extractSlide(b,!1);this.addEdge(c,"next",d)}return this.fire("start_slide",c),c},d.prototype.makeTextSlide=function(a){var b=I.makeText(a);return this._slides.push(b),this.backend.addNode(b),this.fire("add_slide",b),b},d.prototype.insertIntoSlide=function(a,b,c){void 0===c&&(c=!1),this.moveSlide(a,b,c)},d.prototype.appendToSlide=function(a,b){var c=B(a);return this.moveSlide(b,c[c.length-1],!1)},d.prototype.moveSlide=function(a,b,c){var d=this;if(void 0===c&&(c=!1),!(c&&a.next===b||!c&&a.previous===b)){var e=a.previous;if(e&&a.nexts.forEach(function(a){d.addEdge(e,"next",a)}),this.edges.filter(function(b){return(b.source===a||b.target===a)&&"next"===b.type}).forEach(function(a){d.backend.removeEdge(a)}),c){var f=b.previous;f&&(this.edges.filter(function(a){return a.target===b&&"next"===a.type}).forEach(function(a){d.backend.removeEdge(a)}),this.addEdge(f,"next",a),this.addEdge(a,"next",b)),this.addEdge(a,"next",b)}else{var g=b.nexts;g.length>0&&(this.edges.filter(function(a){return a.source===b&&"next"===a.type}).forEach(function(a){d.backend.removeEdge(a)}),g.forEach(function(b){d.addEdge(a,"next",b)})),this.addEdge(b,"next",a)}this.fire("move_slide",a,b,c)}},d.prototype.removeSlideNode=function(a){var b=this,c=a.previous;c&&a.nexts.forEach(function(a){b.addEdge(c,"next",a)}),this.edges.filter(function(b){return b.source===a||b.target===a}).forEach(function(a){b.backend.removeEdge(a)}),this._slides.splice(this._slides.indexOf(a),1),this.backend.removeNode(a),this.fire("remove_slide",a)},d.prototype.removeFullSlide=function(a){for(;a.previous;)a=a.previous;for(var b=a;a;){var c=a.next;this.removeSlideNode(a),a=c}this.fire("destroy_slide",b)},d.prototype.setSlideJumpToTarget=function(a,b){var c=a.outgoing.filter(f.isType("jumpTo"))[0];c&&this.backend.removeEdge(c),b&&this.addEdge(a,"jumpTo",b),this.fire("set_jump_target",a,c?c.target:null,b)},d}(i.DataTypeBase);b.ProvenanceGraph=N,b.findLatestPath=D}(a,c,a("../caleydo_core/main"),a("../caleydo_core/plugin"),a("../caleydo_core/data"),a("../caleydo_graph/main"),a("../caleydo_core/idtype"),a("../caleydo_core/range"),a("../caleydo_core/datatype"),a("../caleydo_core/session"))},{"../caleydo_core/data":5,"../caleydo_core/datatype":6,"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_core/plugin":19,"../caleydo_core/range":20,"../caleydo_core/session":21,"../caleydo_graph/main":36}],41:[function(a,b,c){!function(a,b,c,d,e){function f(a){var b=a.reduce(function(a,b){return a+b},0);return a.map(function(a){return a/b})}function g(a,b,c){return new p(a,b,c)}function h(a){if("P"===a)return b.modes.Presentation;if("A"===a)return b.modes.Authoring;if("E"===a)return b.modes.Exploration;var c=a.slice(1,a.length-1).split("-").map(parseFloat);return new p(c[0],c[1],c[2])}function i(){return h(d.hash.getProp("clue","E"))}function j(){return r.mode}function k(a){r.mode=a}function l(a,b){return void 0===b&&(b={}),m(a,b)}function m(a,b){return void 0===b&&(b={}),new u(a,b)}function n(a,b){return void 0===b&&(b={}),new s(a,b)}function o(a,b){return void 0===b&&(b={}),new t(a,b)}var p=function(){function a(a,b,c){this.coord=f([a,b,c])}return Object.defineProperty(a.prototype,"exploration",{get:function(){return this.coord[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"authoring",{get:function(){return this.coord[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"presentation",{get:function(){return this.coord[2]},enumerable:!0,configurable:!0}),a.prototype.value=function(a){if("number"==typeof a)return this.coord[a];if("string"==typeof a){var b={e:this.coord[0],a:this.coord[1],p:this.coord[2]};return b[a.charAt(0).toLowerCase()]}return null},Object.defineProperty(a.prototype,"isAtomic",{get:function(){return 1===this.exploration||1===this.authoring||1===this.presentation},enumerable:!0,configurable:!0}),a.prototype.toString=function(){return 1===this.exploration?"E":1===this.authoring?"A":1===this.presentation?"P":"("+this.coord.map(function(a){return c.round(a,3).toString()}).join("-")+")"},a}();b.CLUEMode=p,b.modes={Exploration:g(1,0,0),Authoring:g(0,1,0),Presentation:g(0,0,1)};var q=function(a){function b(){a.call(this),this._mode=i(),e.fire("clue.modeChanged",this._mode,this._mode)}return __extends(b,a),Object.defineProperty(b.prototype,"mode",{get:function(){return this._mode},set:function(a){if(this._mode!==a){a.isAtomic&&(a=h(a.toString()));var b=this._mode;this._mode=a,d.hash.setProp("clue",a.toString()),this.fire("modeChanged",a,b),e.fire("clue.modeChanged",a,b)}},enumerable:!0,configurable:!0}),b}(e.EventHandler),r=new q;b.on=q.prototype.on.bind(r),b.off=q.prototype.off.bind(r),b.getMode=j,b.setMode=k;var s=function(){function a(a,b){var e=this;void 0===b&&(b={}),this.options={size:"xs"},d.mixin(this.options,b),this.$node=this.build(c.select(a));var f=function(a,b){e.$node.selectAll("label").classed("active",function(a){return a===b}).select("input").property("checked",function(a){return a===b})};r.on("modeChanged",f),d.onDOMNodeRemoved(this.$node.node(),function(){r.off("modeChanged",f)})}return a.prototype.build=function(a){var c=this,d=a.append("div").classed("clue_buttonmodeselector",!0).classed("btn-group",!0).attr("data-toggle","buttons"),e=d.selectAll("label").data([b.modes.Exploration,b.modes.Authoring,b.modes.Presentation]);return e.enter().append("label").attr("class",function(a){return"btn btn-"+c.options.size+" clue-"+a.toString()}).classed("active",function(a){return a===j()}).html(function(a,b){var c=["Exploration","Authoring","Presentation"][b];return'<input type="radio" name="clue_mode" autocomplete="off" value="'+a.toString()+'" '+(a===j()?'checked="checked"':"")+"> "+c}).on("click",function(a){k(a)}),d},a}();b.ButtonModeSelector=s;var t=function(){function a(a,b){var e=this;void 0===b&&(b={}),this.options={},d.mixin(this.options,b),this.$node=c.select(a).append("div").classed("clue_modeselector",!0).datum(this),this.build(this.$node);var f=function(a,b){e.$node.select("label.clue-E input").property("value",Math.round(100*b.exploration)),e.$node.select("label.clue-A input").property("value",Math.round(100*b.authoring)),e.$node.select("label.clue-P input").property("value",Math.round(100*b.presentation))};r.on("modeChanged",f),d.onDOMNodeRemoved(this.$node.node(),function(){r.off("modeChanged",f)})}return a.prototype.build=function(a){function d(a,b){var d=a[b];a[b]=0;var e=(1-d)/c.sum(a);return a=a.map(function(a){return a*e}),a[b]=d,a}function e(a){void 0===a&&(a=-1);var b=parseFloat(h.select("label.clue-E input").property("value"))/100,c=parseFloat(h.select("label.clue-A input").property("value"))/100,e=parseFloat(h.select("label.clue-P input").property("value"))/100;a>=0&&(f=d([b,c,e],a),b=f[0],c=f[1],e=f[2]),k(g(b,c,e));var f}var f=a.append("div").classed("clue_slidermodeselector",!0),h=f.selectAll("label").data([b.modes.Exploration,b.modes.Authoring,b.modes.Presentation]);return h.enter().append("label").attr("class",function(a){return"clue-"+a.toString()}).text(function(a,b){return["Exploration","Authoring","Presentation"][b]}).append("input").attr({type:"range",min:0,max:100,value:function(a,b){return 100*j().value(b)}}).on("input",function(a,b){e(b)}),f},a}();b.SliderModeSelector=t;var u=function(){function a(a,b){var e=this;void 0===b&&(b={}),this.options={height:15,offset:5},this.e=[0,30],this.a=[30,0],this.p=[60,30],d.mixin(this.options,b),this.e[1]=this.a[0]=this.p[1]=this.options.height,this.p[0]=2*this.options.height,this.$node=c.select(a).append("div").classed("clue_trianglemodeselector",!0).datum(this),this.build(this.$node);var f=function(a,b){var c=e.toCoordinates(b);e.$node.select("circle.point").attr({cx:c[0],cy:c[1]})};r.on("modeChanged",f),d.onDOMNodeRemoved(this.$node.node(),function(){r.off("modeChanged",f)})}return a.prototype.toCoordinates=function(a){var b=a.exploration*this.e[0]+a.authoring*this.a[0]+a.presentation*this.p[0],c=a.exploration*this.e[1]+a.authoring*this.a[1]+a.presentation*this.p[1];return[b,c]},a.prototype.fromCoordinates=function(a,b){var c=this.e[0],d=this.a[0],e=this.p[0],f=this.e[1],h=this.a[1],i=this.p[1],j=Math.max(0,Math.min(1,((h-i)*(a-e)+(e-d)*(b-i))/((h-i)*(c-e)+(e-d)*(f-i)))),k=Math.max(0,Math.min(1,((i-i)*(a-e)+(c-e)*(b-i))/((h-i)*(c-e)+(e-d)*(f-i)))),l=j+k;l>1&&(j/=l,k/=l);var m=1-j-k;return g(j,k,m)},a.prototype.build=function(a){var b=this,d=a.append("svg").classed("clue_trianglemodeselector",!0).attr({width:this.p[0]+this.options.offset,height:this.p[1]+this.options.offset}),e=this,f=d.append("g").attr("transform","translate("+this.options.offset/2+","+this.options.offset/2+")");f.append("path").attr("d",c.svg.line().interpolate("linear-closed")([this.e,this.a,this.p])).on("click",function(){var a=c.mouse(this),b=e.fromCoordinates(a[0],a[1]);k(b)});var g=this.toCoordinates(j());return f.append("circle").classed("point",!0).attr({cx:g[0],cy:g[1],r:2}).call(c.behavior.drag().on("drag",function(){var a=b.fromCoordinates(c.event.x,c.event.y);k(a)})),d},a}();b.TriangleModeSelector=u,b.create=l,b.createTriangle=m,b.createButton=n,b.createSlider=o}(a,c,a("d3"),a("../caleydo_core/main"),a("../caleydo_core/event"))},{"../caleydo_core/event":7,"../caleydo_core/main":13,d3:void 0}],42:[function(a,b,c){!function(a,b,c,d){function e(a,b){var c=a[0].value,d=b.transform,e=b.old||c.transform();return m["transform-"+c.id]=!0,c.transform(d.scale,d.rotate),delete m["transform-"+c.id],{inverse:f(a[0],e,d)}}function f(a,b,d){return void 0===d&&(d=null),{meta:c.meta("transform "+a.toString(),c.cat.visual),id:"transform",f:e,inputs:[a],parameter:{transform:b,old:d}}}function g(a,b){var c=a[0].value,d=b.to,e=b.from||c.act.id;return m["switch-"+c.id]=!0,c.switchTo(d).then(function(){return delete m["switch-"+c.id],{inverse:h(a[0],e,d)}})}function h(a,b,d){return void 0===d&&(d=null),{meta:c.meta("switch vis "+a.toString(),c.cat.visual),id:"changeVis",f:g,inputs:[a],parameter:{to:b,from:d}}}function i(a,b){var c=a[0].value,d=b.name,e=b.value,f=b.old||c.option(d);return m["option-"+c.id]=!0,c.option(d,e),delete m["option-"+c.id],{inverse:j(a[0],d,f,e)}}function j(a,b,d,e){return void 0===e&&(e=null),{meta:c.meta('set option "'+b+NaN+a.toString()+' to "'+d+'"',c.cat.visual),id:"setOption",f:i,inputs:[a],parameter:{name:b,value:d,old:e}}}function k(a,b){var c=b.value,e=c.id;d.isFunction(c.switchTo)&&c.on("changed",function(c,d,f){m["switch-"+e]!==!0&&(console.log("push switch"),a.push(h(b,d.id,f?f.id:null)))}),c.on("transform",function(c,d,g){m["transform-"+e]!==!0&&(console.log("push transform"),a.push(f(b,d,g)))}),c.on("option",function(c,d,f,g){m["option-"+e]!==!0&&(console.log("push option"),a.push(j(b,d,f,g)))})}function l(a){switch(a){case"transform":return e;case"changeVis":return g;case"setOption":return i}return null}var m={};b.createTransform=f,b.createChangeVis=h,b.createSetOption=j,b.attach=k,b.createCmd=l}(a,c,a("./main"),a("../caleydo_core/main"))},{"../caleydo_core/main":13,"./main":40}],43:[function(a,b,c){!function(a,b,c,d){b.FACTOR=1,b.MIN_DURATION=-1,b.MIN_TRANSITION=-1;var e=function(){function a(a,b,e){var f=this;void 0===e&&(e={}),this.graph=a,this.anim=-1,this.options={step:1e3},c.mixin(this.options,e);var g=d.select(b),h=this;this.$play=g.select('[data-player="play"]').on("click",function(){var a=d.select(this);a.classed("fa-play")&&h.start()?a.classed("fa-play",!1).classed("fa-pause",!0):(h.pause(),a.classed("fa-play",!0).classed("fa-pause",!1))}),g.select('[data-player="stop"]').on("click",function(){h.stop()}),g.select('[data-player="forward"]').on("click",function(){h.forward()}),g.select('[data-player="backward"]').on("click",function(){h.backward()}),d.select(document).on("keydown.playpause",function(){var a=d.event;if(19===a.keyCode){a.preventDefault();var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),f.$play.node().dispatchEvent(b)}})}return a.prototype.start=function(){var a=this,c=this.graph.getSlideChains(),d=this.graph.selectedSlides()[0]||c[c.length-1];return d?(this.render(d).then(function(){a.anim=setTimeout(a.next.bind(a),d.duration*b.FACTOR)}),!0):!1},a.prototype.render=function(a){return this.graph.selectSlide(a),Promise.resolve(a)},a.prototype.stopAnim=function(){this.anim>=0&&(clearTimeout(this.anim),this.anim=-1)},a.prototype.stop=function(){var a=this;this.stopAnim(),this.render(null).then(function(){a.$play.classed("fa-play",!0).classed("fa-pause",!1)})},a.prototype.pause=function(){this.stopAnim()},a.prototype.next=function(){var a=this,c=this.forward();c&&c.then(function(c){a.anim=setTimeout(a.next.bind(a),c.duration*b.FACTOR)})},a.prototype.forward=function(){this.stopAnim();var a=this.graph.selectedSlides()[0],b=a.next;return null==b?(this.stop(),null):this.render(b)},a.prototype.backward=function(){this.stopAnim();var a=this.graph.selectedSlides()[0],b=a.previous;return null==b?(this.stop(),null):this.render(b)},a}();b.Player=e}(a,c,a("../caleydo_core/main"),a("d3"))},{"../caleydo_core/main":13,d3:void 0}],44:[function(a,b,c){!function(a,b,c,d,e,f,g){function h(a,b,d,e){var h=c.resolve(b.idtype),i=g.parse(b.range),j=b.type,l=b.old?g.parse(b.old):h.selections(j);return f.hash.is("debug")&&console.log("select",i.toString()),o.fire("disable-"+h.id),h.select(j,i),o.fire("enable-"+h.id),k(h,j,l,i,b.animated).then(function(a){return{inverse:a,consumed:b.animated?e:0}})}function i(a){return a.split(" ").map(function(a){return a[0].toUpperCase()+a.slice(1)}).join(" ")}function j(a,b,d){var f,g=d.dim(0).length,h=b===c.defaultSelectionType?"":i(b)+" ";return 0===g?(h+="no "+a.names,f=Promise.resolve(h)):1===g?(h+=a.name+" ",f=a.unmap(d).then(function(a){return h+=a[0]})):3>g?(h+=a.names+" (",f=a.unmap(d).then(function(a){return h+=a.join(", ")+")"})):(h+=d.dim(0).length+" "+a.names,f=Promise.resolve(h)),f.then(function(a){return e.meta(a,e.cat.selection)})}function k(a,b,c,d,e){return void 0===d&&(d=null),void 0===e&&(e=!1),j(a,b,c).then(function(f){return{meta:f,id:"select",f:h,parameter:{idtype:a.id,range:c.toString(),type:b,old:d.toString(),animated:e}}})}function l(a){var b={};return a.forEach(function(a){if("select"===a.f_id){var c=a.parameter;b[c.idtype+"@"+c.type]=a}}),a.filter(function(a){if("select"!==a.f_id)return!0;var c=a.parameter;return b[c.idtype+"@"+c.type]===a})}function m(a,b,c){return void 0===c&&(c={}),new q(a,b,c)}function n(a){switch(a){case"select":return h}return null}var o=new d.EventHandler;b.createSelection=k,b.compressSelection=l;var p=function(){function a(a,b,c,d){var e=this;void 0===d&&(d={}),this.idtype=a,this.graph=b,this.type=c,this.options=d,this.l=function(a,b,c,d,f,g){k(e.idtype,b,c,g,e.options.animated).then(function(a){return e.graph.push(a)})},this._enable=this.enable.bind(this),this._disable=this.disable.bind(this),this.typeRecorders=[],this.type&&(this.typeRecorders=this.type.split(",").map(function(a){var b=function(b,c,d,f,g){return e.l(b,a,c,d,f,g)};return b})),this.enable(),o.on("enable-"+this.idtype.id,this._enable),o.on("disable-"+this.idtype.id,this._disable)}return a.prototype.disable=function(){var a=this;this.type?this.type.split(",").forEach(function(b,c){a.idtype.off("select-"+b,a.typeRecorders[c])}):this.idtype.off("select",this.l)},a.prototype.enable=function(){var a=this;this.type?this.type.split(",").forEach(function(b,c){a.idtype.on("select-"+b,a.typeRecorders[c])}):this.idtype.on("select",this.l)},a.prototype.destroy=function(){this.disable(),o.off("enable-"+this.idtype.id,this._enable),o.off("disable-"+this.idtype.id,this._disable)},a}(),q=function(){function a(a,b,e){var g=this;void 0===e&&(e={}),this.graph=a,this.type=b,this.options=e,this.handler=[],this.adder=function(a,b){g.options.filter(b)&&g.handler.push(new p(b,g.graph,g.type,g.options))},this.options=f.mixin({filter:f.constantTrue,animated:!1},this.options),d.on("register.idtype",this.adder),c.list().forEach(function(a){g.adder(null,a)})}return a.prototype.destroy=function(){d.off("register.idtype",this.adder),this.handler.forEach(function(a){return a.destroy()}),this.handler.length=0},a}();b.SelectionRecorder=q,b.create=m,b.createCmd=n}(a,c,a("../caleydo_core/idtype"),a("../caleydo_core/event"),a("./main"),a("../caleydo_core/main"),a("../caleydo_core/range"))},{"../caleydo_core/event":7,"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_core/range":20,"./main":40}],45:[function(a,b,c){!function(a,b,c){"use strict";function d(a,b){return c(a,{width:b?b[0]:null,height:b?b[1]:null})}function e(a,b){void 0===b&&(b=64);var c=document.createElement("canvas"),d=Math.round(b/a.width*a.height);c.width=b,c.height=d;var e=c.getContext("2d");return e.drawImage(a,0,0,b,d),
c}function f(a){return a.toDataURL("image/png")}function g(a,b){return void 0===b&&(b=64),f(e(a,b))}function h(a,b){return d(a).then(f)}function i(){return{takeCanvas:d,take:h}}window.html2canvas=c,b.takeCanvas=d,b.createThumbnailCanvas=e,b.toString=f,b.createThumbnail=g,b.take=h,b.create=i}(a,c,a("html2canvas"))},{html2canvas:void 0}],46:[function(a,b,c){!function(a,b,c,d){function e(a,b,e){return void 0===e&&(e=!1),c.send("/login",{username:a,password:b,remember:e},"post").then(function(a){return d.store("user",a.name),d.store("user_obj",a),a})["catch"](function(a){d.remove("user"),d.remove("user_obj")})}function f(){return c.send("/logout",{},"post").then(function(a){d.remove("user"),d.remove("user_obj")})}function g(a,b){c.getJSON("/loggedinas").then(function(a){return b(null,a)})["catch"](function(a){}),a.onsubmit=function(c){var d=a.login_username.value,f=a.login_password.value,g=a.login_remember.checked;e(d,f,g).then(function(a){return b(null,a)})["catch"](function(a){return b(a,null)}),c.stopPropagation(),c.preventDefault()}}b.login=e,b.logout=f,b.bindLoginForm=g}(a,c,a("../caleydo_core/ajax"),a("../caleydo_core/session"))},{"../caleydo_core/ajax":3,"../caleydo_core/session":21}],47:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c){function d(){var a=c.select("body > div.tooltip");return a.empty()&&(a=c.select("body").append("div").attr("class","tooltip").style("display","block").style("opacity",0)),a}function e(a,b){void 0===b&&(b=200);var e=c.functor(a);return function(a){a.on("mouseenter.tooltip",function(a,f){var g=d();g.html(e.call(this,a,f)).style("left",c.event.pageX+5+"px").style("top",c.event.pageY-28+"px"),g.style("display","block").interrupt().transition().delay(b).duration(200).style("opacity",.9)}).on("mouseleave.tooltip",function(){var a=d();a.interrupt().transition().duration(200).style("opacity",0).each("end",function(){c.select(this).style("display","none")})})}}b.bind=e}(a,c,a("d3"),d)},{css:void 0,d3:void 0}],48:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d){function e(b,c,d){return new a.Axis(b,c,d)}a.Axis=d.defineVis("Axis",{shift:10,tickSize:2,orient:"left",r:2},[50,300],function(a,c,e){var f=this.options,g=this,h=a.append("svg").attr({width:e[0],height:e[1],"class":"axis"});h.data(this);var i=h.append("g"),j=this.$axis=i.append("g").attr("class","makeover"),k=this.$points=i.append("g"),l=this.scale=b.scale.linear().domain(c.desc.value.range).range([f.shift,("left"===f.orient||"right"===f.orient?e[1]:e[0])-f.shift]).clamp(!0),m=this.axis=b.svg.axis().tickSize(f.tickSize).orient(f.orient).scale(l);switch(f.orient){case"left":k.attr("transform","translate("+(e[0]-f.shift)+",0)"),j.attr("transform","translate("+(e[0]-f.shift)+",0)");break;case"right":k.attr("transform","translate("+f.shift+",0)"),j.attr("transform","translate("+f.shift+",0)");break;case"top":k.attr("transform","translate(0, "+f.shift+")"),j.attr("transform","translate(0,"+f.shift+")");break;case"bottom":k.attr("transform","translate(0, "+(e[1]-f.shift)+")"),j.attr("transform","translate(0,"+(e[1]-f.shift)+")")}j.call(m);var n=d.selectionUtil(this.data,k,"circle"),o="left"===f.orient||"right"===f.orient?"cy":"cx";return c.data().then(function(a){var b=k.selectAll("circle").data(a);b.enter().append("circle").attr("r",f.r).on("click",n),b.exit().remove(),b.attr(o,l),g.markReady()}),h},{locateImpl:function(a){var c=this;if(a.isAll||a.isNone){var d=this.scale.range();return Promise.resolve(c.wrap({y:d[0],h:d[1]-d[0]}))}return this.data.data(a).then(function(a){var d=b.extent(a,c.scale);return c.wrap({y:d[0],h:d[1]-d[0]})})},transform:function(a,b){var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;var d=this.options,e=this.rawSize;this.$node.attr({width:e[0]*a[0],height:e[1]*a[1]}).style("transform","rotate("+b+"deg)"),this.scale.range([d.shift,("left"===d.orient||"right"===d.orient?e[1]*a[1]:e[0]*a[0])-d.shift]);var f="left"===d.orient||"right"===d.orient?"cy":"cx";this.$points.selectAll("circle").attr(f,this.scale),this.$axis.call(this.axis);var g={scale:a,rotate:b};return this.fire("transform",g,c),this.options.scale=a,this.options.rotate=b,g},wrap:function(a){var b=this.rawSize;switch(this.options.orient){case"left":a.x=b[0]-this.options.shift,a.w=0;break;case"right":a.x=this.options.shift,a.w=0;break;case"top":a.x=a.y,a.w=a.h,a.y=this.options.shift,a.h=0;break;case"bottom":a.x=a.y,a.w=a.h,a.y=b[1]-this.options.shift,a.h=0}return a.x-=this.options.r,a.y-=this.options.r,a.w+=2*this.options.r,a.h+=2*this.options.r,a}}),a.create=e}(c,a("d3"),a("../caleydo_core/main"),a("../caleydo_d3/d3util"),d)},{"../caleydo_core/main":13,"../caleydo_d3/d3util":31,css:void 0,d3:void 0}],49:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e,f){a.BarPlot=f.defineVis("BarPLot",{cssClass:"",width:100,heighti:10,min:0,max:NaN},function(a){return[this.options.width,a.dim[0]*this.options.heighti]},function(a,e,f){var g=this.options,h=this,i=a.append("svg").attr({width:f[0],height:f[1],"class":"barplot "+g.cssClass}),j=h.xscale=b.scale.linear().range([0,100]),k=h.yscale=b.scale.linear().range([0,100]),l=function(a,c){e.select(0,[c],d.toSelectOperation(b.event))},m=function(a,b,c){if(i.selectAll("rect").classed("select-"+b,!1),!c.isNone){var d=c.dim(0);c.isAll?i.selectAll("rect").classed("select-"+b,!0):d.forEach(function(a){i.selectAll("rect:nth-child("+(a+1)+")").classed("select-"+b,!0)})}};return e.on("select",m),c.onDOMNodeRemoved(i.node(),function(){e.off("select",m)}),e.data().then(function(a){if(k.domain([0,e.length]),isNaN(g.min)||isNaN(g.max)){var c=b.extent(a);isNaN(g.min)&&(g.min=c[0]),isNaN(g.max)&&(g.max=c[1])}j.domain([g.min,g.max]);var d=i.selectAll("rect").data(a);d.enter().append("rect").on("click",l),d.attr({y:function(a,b){return k(b)},height:function(a){return k(1)},width:function(a){return j(a)}}),h.markReady(),e.selections().then(function(a){m(null,"selected",a)})}),i},{locateIt:function(a){var c=this.options,d=this,f=b.extent(a.dim(0).iter().asList());return this.data.data(a).then(function(a){var g=b.extent(a);return e.rect(d.xscale(g[0])/100*c.width,f[0]*c.heighti,d.xscale(g[1])/100*c.width,(f[1]+1)*c.heighti)})}}),a.create=function(b,c,d){return new a.BarPlot(b,c,d)}}(c,a("d3"),a("../caleydo_core/main"),a("../caleydo_core/idtype"),a("../caleydo_core/geom"),a("../caleydo_d3/d3util"),d)},{"../caleydo_core/geom":8,"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_d3/d3util":31,css:void 0,d3:void 0}],50:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e){function f(a){var b="<table><tbody>",c=["min","max","sum","mean","var","sd","n","nans","moment2","moment3","moment4","kurtosis","skewness"];return c.forEach(function(c){var d=a[c];b=b+"<tr><td>"+c+"</td><td>"+d+"</td></tr>"}),b+="</tbody></table>"}function g(b,c){return new a.BoxPlot(b,c)}a.BoxPlot=e.defineVis("BoxPlot",{},[300,50],function(a,d,e){var g=a.append("svg").attr({width:e[0],height:e[1],"class":"box"}),h=g.append("g"),i=this.scale=b.scale.linear().domain(this.data.desc.value.range).range([0,e[0]]).clamp(!0);h.append("path").attr({d:"M0,0 L0,$ M0,§ L%,§ M%,0 L%,$".replace(/%/g,e[0]).replace(/\$/g,e[1]).replace(/\§/g,e[1]/2),"class":"axis"});var j=this;return d.stats().then(function(a){var b=f(a);h.append("rect").attr({x:i(a.mean-a.sd),y:"10%",width:i(2*a.sd),height:"80%","class":"box"}).call(c.bind(b)),h.append("line").attr({x1:i(a.mean),x2:i(a.mean),y1:"10%",y2:"90%","class":"mean"}),j.markReady()}),g},{locateIt:function(a){var c=this;if(a.isAll||a.isNone){var d=this.scale.range();return{x:d[0],w:d[1]-d[0],y:0,h:50}}return this.data.data(a).then(function(a){var d=b.extent(a,c.scale);return{x:d[0],w:d[1]-d[0],y:0,h:50}})}}),a.create=g}(c,a("d3"),a("../caleydo_tooltip/main"),a("../caleydo_core/main"),a("../caleydo_d3/d3util"),d)},{"../caleydo_core/main":13,"../caleydo_d3/d3util":31,"../caleydo_tooltip/main":47,css:void 0,d3:void 0}],51:[function(a,b,c){!function(a,b,c,d,e,f){function g(a){var c=a.categories,d=a.colors||b.scale.category10().range(),e=a.validCount,f=[],g=0;return a.forEach(function(b,h){f[h]={v:b,acc:g,ratio:b/e,range:a.range(h),name:"string"==typeof c[h]?c[h]:c[h].name,color:void 0===c[h].color?d[h]:c[h].color},g+=b}),f}function h(a,c){var d=[],e=b.scale.linear().domain(c).range(["#111111","#999999"]),f=a.validCount,g=(c[1]-c[0])/a.bins,h=0;return a.forEach(function(c,i){d[i]={v:c,acc:h,ratio:c/f,range:a.range(i),name:"Bin "+(i+1)+" (center: "+b.round((i+.5)*g,2)+")",color:e((i+.5)*g)},h+=c}),d}function i(a,b,c){return"stratification"===b.type?g(a):"categorical"===c.valuetype.type?g(a):h(a,c.valuetype.range)}function j(a,c){var d=b.functor(c);return Promise.resolve(d(a)).then(function(b){return b===!0?a.validCount:b===!1?a.largestBin:b})}function k(a,b,c){var d=[{x:c,y:c},{x:c+Math.cos(a)*c,y:c+Math.sin(a)*c},{x:c+Math.cos(b)*c,y:c+Math.sin(b)*c}];return b-a>Math.PI&&d.splice(2,0,{x:c+Math.cos(.5*(b-a))*c,y:c+Math.sin(.5*(b-a))*c}),geom.polygon(d)}a.Histogram=f.defineVis("HistogramVis",function(a){return{nbins:Math.floor(Math.sqrt("matrix"===a.desc.type?a.ncol*a.nrow:a.length)),total:!0,duration:200}},[200,100],function(a,f,g){var h=this.options,k=this,l=a.append("svg").attr({width:g[0],height:g[1],"class":"histogram"}),m=l.append("g"),n=m.append("g"),o=m.append("g").style("pointer-events","none").classed("select-selected",!0),p=k.xscale=b.scale.ordinal().rangeBands([0,g[0]],.1),q=k.yscale=b.scale.linear().range([0,g[1]]),r=function(a,b,c){if(k.hist_data){var d=k.hist_data.map(function(a,b){var d=a.range.intersect(c);return{i:b,v:d.size()[0]}}).filter(function(a){return a.v>0}),e=o.selectAll("rect").data(d);e.enter().append("rect").attr("width",p.rangeBand()),e.attr({x:function(a){return p(a.i)},y:function(a){return q(q.domain()[1]-a.v)},height:0}),e.transition().duration(h.duration).attr("height",function(a){return q(a.v)}),e.exit().remove()}};f.on("select",r),c.onDOMNodeRemoved(n.node(),function(){f.off("select",r)});var s=function(a){f.select(0,a.range,d.toSelectOperation(b.event))};return this.data.hist(Math.floor(h.nbins)).then(function(a){return k.hist=a,p.domain(b.range(a.bins)),j(a,k.options.total)}).then(function(a){var b=k.hist;q.domain([0,a]);var c=k.hist_data=i(b,k.data.desc,k.data),d=n.selectAll("rect").data(c);d.enter().append("rect").attr("width",p.rangeBand()).call(e.bind(function(a){return a.name+" "+a.v+" entries ("+Math.round(100*a.ratio)+"%)"})).on("click",s),d.attr({x:function(a,b){return p(b)},fill:function(a){return a.color},y:function(a){return q(q.domain()[1]-a.v)},height:function(a){return q(a.v)}}),k.markReady(),f.selections().then(function(a){r(null,"selected",a)})}),l},{locateImpl:function(a){var c=this,d=this.rawSize;return a.isAll||a.isNone?Promise.resolve({x:0,y:0,w:d[0],h:d[1]}):this.data.data(a).then(function(a){var d=b.extent(a,function(a){return c.hist.binOf(a)}),e=c.hist_data[d[0]],f=c.hist_data[d[1]];return Promise.resolve({x:c.xscale(d[0]),width:c.xscale(d[1])-c.xscale(d[0])+c.xscale.rangeBand(),height:c.yscale(Math.max(e.v,f.v)),y:c.yscale(c.yscale.domain()[1]-Math.max(e.v,f.v))})})}}),a.Mosaic=f.defineVis("MosaicVis",{width:20,initialScale:10,duration:200,heightTo:null,selectAble:!0},function(a){return[this.options.width,a.dim[0]]},function(a,f,g){var h=this.options,j=this,k=a.append("svg").attr({width:g[0],height:g[1],"class":"mosaic"}),l=k.append("g").attr("transform","scale("+h.scale[0]+","+h.scale[1]+")"),m=l.append("g"),n=l.append("g").style("pointer-events","none").classed("select-selected",!0),o=function(a,b,c){if(j.hist_data){var d=j.hist_data.map(function(a,b){var d=a.range.intersect(c);return{i:b,acc:a.acc,v:d.size()[0]}}).filter(function(a){return a.v>0}),e=n.selectAll("rect").data(d);e.enter().append("rect").attr("width","100%").classed("select-selected",!0),e.attr({y:function(a){return a.acc},height:function(a){return a.v}}).style("opacity",0),e.transition().duration(h.duration).style("opacity",1),e.exit().remove()}};h.selectAble&&(f.on("select",o),c.onDOMNodeRemoved(m.node(),function(){f.off("select",o)}));var p=h.selectAble?function(a){f.select(0,a.range,d.toSelectOperation(b.event))}:null;return this.data.hist(Math.floor(h.nbins)).then(function(a){j.hist=a;var b=j.hist_data=i(a,f.desc,f),c=m.selectAll("rect").data(b);c.enter().append("rect").attr("width","100%").call(e.bind(function(a){return a.name+" "+a.v+" entries ("+Math.round(100*a.ratio)+"%)"})).on("click",p),c.attr({y:function(a){return a.acc},height:function(a){return a.v},fill:function(a){return a.color}}),j.fire("built"),j.markReady(),h.selectAble&&f.selections().then(function(a){o(null,"selected",a)})}),k},{init:function(){this.options.scale=[1,this.options.initialScale],this.options.heightTo&&(this.options.scale[1]=this.options.heightTo/this.data.dim[0])},locateIt:function(a){var c=this;return a.isAll||a.isNone?Promise.resolve({x:0,y:0,w:this.rawSize[0],h:this.data.length}):this.data.data(a).then(function(a){var d=b.extent(a,function(a){return c.hist.binOf(a)}),e=c.hist_data[d[0]],f=c.hist_data[d[1]],g=Math.min(e.acc,f.acc),h=Math.max(e.acc+e.v,f.acc+f.v);return Promise.resolve({x:0,width:c.rawSize[0],height:h-g,y:g})})}}),a.Pie=f.defineVis("Pie",{radius:50,innerRadius:0,duration:200,total:!0},function(){var a=this.options.radius;return[2*a,2*a]},function(a,f,g){var h=this.options,i=this,k=a.append("svg").attr({width:g[0],height:g[1],"class":"pie"}),l=k.append("g").attr("transform","translate("+h.radius+","+h.radius+")"),m=l.append("g"),n=l.append("g").style("pointer-events","none").classed("select-selected",!0),o=this.scale=b.scale.linear().range([0,2*Math.PI]),p=this.arc=b.svg.arc().innerRadius(h.innerRadius).outerRadius(h.radius).startAngle(function(a){return o(a.start)}).endAngle(function(a){return o(a.end)}),q=function(a,b,c){if(i.hist_data){var d=i.hist_data.map(function(a){var b=a.range.intersect(c);return{start:a.start,end:a.start+b.size()[0]}}).filter(function(a){return a.start<a.end}),e=n.selectAll("path").data(d);e.enter().append("path"),e.exit().remove(),e.attr("d",p)}};return f.on("select",q),c.onDOMNodeRemoved(m.node(),function(){f.off("select",q)}),f.hist().then(function(a){return i.hist=a,j(a,i.options.total)}).then(function(a){var c=i.hist;o.domain([0,a]);var g=i.hist_data=[],j=0,k=c.categories,l=c.colors||b.scale.category10().range();c.forEach(function(b,d){g[d]={name:"string"==typeof k[d]?k[d]:k[d].name,start:j,size:b,ratio:b/a,end:j+b,color:void 0===k[d].color?l[d]:k[d].color,range:c.range(d)},j+=b});var n=m.selectAll("path").data(g);n.enter().append("path").call(e.bind(function(a){return a.name+" "+a.size+" entries ("+Math.round(100*a.ratio)+"%)"})).on("click",function(a){f.select(0,a.range,d.toSelectOperation(b.event))}),n.attr("d",p).attr("fill",function(a){return a.color}).style("opacity",0),n.transition().duration(h.duration).delay(function(a,b){return b*h.duration}).style("opacity",1),i.markReady(),f.selections().then(function(a){q(null,"selected",a)})}),k},{locateIt:function(a){var c=this,d=this.options;return a.isAll||a.isNone?Promise.resolve({x:d.radius,y:d.radius,radius:d.radius}):this.data.data(a).then(function(a){var e=b.extent(a,function(a){return c.hist.binOf(a)}),f=c.scale(c.hist_data[e[0]].start),g=c.scale(c.hist_data[e[1]].end);return Promise.resolve(k(f,g,d.radius))})},updatedOption:function(a,b){("innerRadius"===a||"radius"===a||"total"===a)&&this.updateVis()},updateVis:function(){var a=this.options;this.arc.innerRadius(a.innerRadius).outerRadius(a.radius),this.scale.domain([0,a.total||this.hist.count]),$svg.selectAll("path").transition().attr("d",this.arc)},transform:function(a,b){var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;this.$node.attr({width:2*this.options.radius*a[0],height:2*this.options.radius*a[1]}).style("transform","rotate("+b+"deg)"),this.$node.select("g").attr("transform","scale("+a[0]+","+a[1]+")translate("+this.options.radius+","+this.options.radius+")");var d={scale:a,rotate:b};return this.fire("transform",d,c),this.options.scale=a,this.options.rotate=b,d}}),a.create=function(b,c,d){return new a.Histogram(b,c,d)},a.createMosaic=function(b,c,d){return new a.Mosaic(b,c,d)},a.createPie=function(b,c,d){return new a.Pie(b,c,d)}}(c,a("d3"),a("../caleydo_core/main"),a("../caleydo_core/idtype"),a("../caleydo_tooltip/main"),a("../caleydo_d3/d3util"))},{"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_d3/d3util":31,"../caleydo_tooltip/main":47,d3:void 0}],52:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){if("categorical"===a.type)return a.categories.map(function(a){return a.color});var b=a.range;return b[0]<0&&b[1]>0?["blue","white","red"]:["white","red"]}function k(a){if("categorical"===a.type)return a.categories.map(function(a){return a.name});var b=a.range;return b[0]<0&&b[1]>0?[Math.min(b[0],-b[1]),Math.max(-b[0],b[1])]:b}function l(a){return"categorical"===a.type?c.scale.ordinal():c.scale.linear()}function m(a,b,c){void 0===b&&(b=!0),void 0===c&&(c=!1);var d=a.length;if(1e3>=d)return new o(b);var e=a.heatmapUrl();return e&&c?new r(b):5e3>d||null===e?new q(b):new r(b)}function n(a,b,c){return"matrix"===a.desc.type?new s(a,b,c):"vector"===a.desc.type?new t(a,b,c):null}var o=function(){function a(a){void 0===a&&(a=!0),this.selectAble=a}return a.prototype.rescale=function(a,b,c){a.attr({width:b[1]*c[0],height:b[0]*c[1]}),a.select("g").attr("transform","scale("+c[0]+","+c[1]+")")},a.prototype.recolor=function(a,b,c,d){this.color=c,a.selectAll("rect").attr("fill",function(a){return c(a)})},a.prototype.redraw=function(a,b){var c=this;a.selectAll("rect").attr("fill",function(a){return c.color(a)})},a.prototype.build=function(a,b,d,e,g){var h=a.dim,j=this,k=h[1],l=h[0],m=b.append("svg").attr({width:k*d[0],height:l*d[1],"class":"heatmap"}),n=m.append("g").attr("transform","scale("+d[0]+","+d[1]+")");this.color=e,a.data().then(function(b){var d=n.selectAll("g").data(b);d.enter().append("g").each(function(b,d){var g=c.select(this).selectAll("rect").data(b),h=g.enter().append("rect").attr({width:1,height:1,x:function(a,b){return b},y:d,fill:function(a){return e(a)}});j.selectAble&&h.on("click",function(b,e){a.select([[d],[e]],f.toSelectOperation(c.event))}),h.append("title").text(String)}),g()});var o=function(a,b,c){if(n.selectAll("rect").classed("select-"+b,!1),!c.isNone){var d=c.dim(0),e=c.dim(1);c.isAll?n.selectAll("rect").classed("select-"+b,!0):d.isAll||d.isNone?e.forEach(function(a){n.selectAll("g > rect:nth-child("+(a+1)+")").classed("select-"+b,!0)}):e.isAll||e.isNone?d.forEach(function(a){n.selectAll("g:nth-child("+(a+1)+") > rect").classed("select-"+b,!0)}):d.forEach(function(a){var c=n.select("g:nth-child("+(a+1)+")");e.forEach(function(a){c.select("rect:nth-child("+(a+1)+")").classed("select-"+b,!0)})})}};return this.selectAble&&(a.on("select",o),i.onDOMNodeRemoved(n.node(),function(){a.off("select",o)}),a.selections().then(function(a){o(null,"selected",a)})),m},a}(),p=function(){function a(a){void 0===a&&(a=!0),this.selectAble=a}return a.prototype.rescale=function(a,b,c){var d=this;a.selectAll("canvas.heatmap-selection").attr({width:b[1]*c[0],height:b[0]*c[1]}),this.selectAble&&a.datum().selections().then(function(c){d.redrawSelection(a.select("canvas.heatmap-selection").node(),b,"selected",c)})},a.prototype.redrawSelection=function(a,b,c,d){var e=a.getContext("2d");if(e.save(),e.clearRect(0,0,a.width,a.height),e.fillStyle="orange",d.isNone)return void e.restore();if(d.isAll)return e.fillRect(0,0,a.width,a.height),void e.restore();var f=d.dim(0),g=d.dim(1);e.scale(a.width/b[1],a.height/b[0]),f.isAll||f.isNone?g.forEach(function(a){e.fillRect(a,0,1,b[0])}):g.isAll||g.isNone?f.forEach(function(a){e.fillRect(0,a,b[1],1)}):f.forEach(function(a){g.forEach(function(b){e.fillRect(b,a,1,1)})}),e.restore()},a.prototype.buildSelection=function(a,b,d){var e=this;if(this.selectAble){var g=a.dim,h=g[1],j=g[0],k=b.append("canvas").attr({width:h*d[0],height:j*d[1],"class":"heatmap-selection"}),l=function(a){var b=k.node(),c=b.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=Math.floor(h*d/b.width),g=Math.floor(j*e/b.height);return[g,f]};k.on("click",function(){var b=l(c.event);a.select([[b[0]],[b[1]]],f.toSelectOperation(c.event))});var m=function(a,b,c){e.redrawSelection(k.node(),g,b,c)};a.on("select",m),i.onDOMNodeRemoved(k.node(),function(){a.off("select",m)}),a.selections().then(function(a){e.redrawSelection(k.node(),g,"selected",a)})}},a}(),q=function(a){function b(b){void 0===b&&(b=!0),a.call(this,b),this.ready=!1}return __extends(b,a),b.prototype.rescale=function(b,c,d){b.selectAll("canvas").attr({width:c[1]*d[0],height:c[0]*d[1]}),this.ready&&this.redrawImpl(this.imageData,b,d),a.prototype.rescale.call(this,b,c,d)},b.prototype.redraw=function(a,b){this.ready&&this.redrawImpl(this.imageData,a,b)},b.prototype.recolor=function(a,b,c,d){var e=this,f=this.imageData.data;this.ready&&b.data().then(function(g){e.genImage(f,g,b.ncol,c),e.redrawImpl(e.imageData,a,d)})},b.prototype.genImage=function(a,b,d,e){b.forEach(function(b,f){var g=f*d;b.forEach(function(b,d){var f=c.rgb(e(b));a[4*(g+d)]=f.r,a[4*(g+d)+1]=f.g,a[4*(g+d)+2]=f.b,a[4*(g+d)+3]=255})})},b.prototype.redrawImpl=function(a,b,d){var e=b.select("canvas").node().getContext("2d");if(e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,1===d[0]&&1===d[1])e.putImageData(a,0,0);else{var f=document.createElement("canvas");f.width=a.width,f.height=a.height;var g=f.getContext("2d");g.putImageData(a,0,0),e.save(),e.scale(d[0],d[1]),e.drawImage(f,0,0),e.restore(),c.select(f).remove()}},b.prototype.build=function(b,c,d,e,f){var g=this,h=b.dim,i=h[1],j=h[0],k=c.append("div").attr("class","heatmap"),l=k.append("canvas").attr({width:i*d[0],height:j*d[1],"class":"heatmap-data"});this.imageData=l.node().getContext("2d").createImageData(i,j);var m=this.imageData.data;return b.data().then(function(a){g.ready=!0,g.genImage(m,a,b.ncol,e),f()}),a.prototype.buildSelection.call(this,b,k,d),k},b}(p),r=function(a){function b(b){void 0===b&&(b=!0),a.call(this,b),this.ready=!1}return __extends(b,a),b.prototype.rescale=function(b,c,d){b.selectAll("canvas").attr({width:c[1]*d[0],height:c[0]*d[1]}),this.ready&&this.redrawImpl(b,d),a.prototype.rescale.call(this,b,c,d)},b.prototype.redraw=function(a,b){this.ready&&this.redrawImpl(a,b)},b.prototype.redrawImpl=function(a,b){var c=a.select("canvas").node(),d=c.getContext("2d");d.msImageSmoothingEnabled=!1,d.imageSmoothingEnabled=!1,1===b[0]&&1===b[1]?d.drawImage(this.image,0,0):(d.save(),d.scale(b[0],b[1]),d.drawImage(this.image,0,0),d.restore())},b.prototype.recolor=function(a,b,c,d){this.color=c,this.redrawImpl(a,d)},b.prototype.build=function(b,c,d,e,f){function g(a,b){return a.length!==b.length?!1:a.every(function(a,c){return a===b[c]})}var i=this;this.color=e;var j=b.dim,k=j[1],l=j[0],m=c.append("div").attr("class","heatmap");m.append("canvas").attr({width:k*d[0],height:l*d[1],"class":"heatmap-data"}),this.image=new Image,this.image.onload=function(){i.ready=!0,f()};var n={range:e.domain()},o=e.range();return g(o,["black","white"])||(g(o,["white","red"])?n.palette="white_red":g(o,["blue","white","red"])&&(n.palette="blue_white_red")),this.image.src=b.heatmapUrl(h.all(),n),a.prototype.buildSelection.call(this,b,m,d),m},b}(p),s=function(a){function b(b,d,f){a.call(this),this.data=b,this.parent=d,this.options=f;var g=this.data.desc.value;if(this.options=i.mixin({initialScale:10,scaleTo:null,color:j(g),domain:k(g),duration:200,selectAble:!0,forceThumbnails:!1},f),this.options.scale=[this.options.initialScale,this.options.initialScale],this.options.scaleTo){var h=this.data.dim;this.options.scale=this.options.scaleTo.map(function(a,b){return a/h[b]})}this.options.rotate=0,this.colorer=l(g).domain(this.options.domain).range(this.options.color),this.renderer=m(b,this.options.selectAble,this.options.forceThumbnails),this.$node=this.build(c.select(d)),this.$node.datum(b),e.assignVis(this.$node.node(),this)}return __extends(b,a),Object.defineProperty(b.prototype,"rawSize",{get:function(){var a=this.data.dim;return[a[1],a[0]]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),b.prototype.option=function(a,b){if(1===arguments.length)return this.options[a];switch(this.fire("option",a,b,this.options[a]),this.fire("option."+a,b,this.options[a]),this.options[a]=b,a){case"color":case"domain":this.recolor()}},b.prototype.locateImpl=function(a){function b(a,b,d){if(a.isAll||a.isNone)return[0,b*d];var e=c.extent(a.iter().asList());return[e[0]*d,(e[1]-e[0]+1)*d]}var d=this.data.dim,e=d[1],f=d[0],h=this.options,i=b(a.dim(1),e,h.scale[0]),j=b(a.dim(0),f,h.scale[1]);return Promise.resolve(g.rect(i[0],j[0],i[1],j[1]))},b.prototype.transform=function(a,b){void 0===b&&(b=0);var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;var d=this.data.dim;this.$node.style("transform","rotate("+b+"deg)"),(c.scale[0]!==a[0]||c.scale[1]!==a[1])&&this.renderer.rescale(this.$node,d,a);var e={scale:a,rotate:b};return this.fire("transform",e,c),this.options.scale=a,this.options.rotate=b,e},b.prototype.recolor=function(){var a=this.colorer;a.domain(this.options.domain).range(this.options.color),this.renderer.recolor(this.$node,this.data,a,this.options.scale)},b.prototype.build=function(a){var b=this;return this.renderer.build(this.data,a,this.options.scale,this.colorer,function(){b.renderer.redraw(b.$node,b.options.scale),b.markReady()})},b}(e.AVisInstance);b.HeatMap=s;var t=function(a){function b(b,d,f){a.call(this),this.data=b,this.parent=d,this.options=f;var g=this.data.desc.value;this.options=i.mixin({initialScale:10,color:j(g),domain:k(g),width:20,heightTo:null},f),this.options.scale=[1,this.options.initialScale],this.options.heightTo&&(this.options.scale[1]=this.options.heightTo/this.data.dim[0]),this.options.rotate=0,this.colorer=l(g).domain(this.options.domain).range(this.options.color),this.$node=this.build(c.select(d)),this.$node.datum(b),e.assignVis(this.$node.node(),this)}return __extends(b,a),Object.defineProperty(b.prototype,"rawSize",{get:function(){var a=this.data.dim;return[this.options.width,a[0]]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),b.prototype.option=function(a,b){if(1===arguments.length)return this.options[a];switch(this.fire("option",a,b,this.options[a]),this.fire("option."+a,b,this.options[a]),this.options[a]=b,a){case"color":case"domain":this.recolor()}},b.prototype.locateImpl=function(a){function b(a,b,d){if(a.isAll||a.isNone)return[0,b*d];var e=c.extent(a.iter().asList());return[e[0]*d,(e[1]-e[0]+1)*d]}var d=this.data.dim,e=d[0],f=b(a.dim(0),e,this.options.scale[1]);return Promise.resolve(g.rect(0,f[0],20,f[1]))},b.prototype.transform=function(a,b){void 0===b&&(b=0);var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;var d=this.data.dim,e=this.options.width,f=d[0];this.$node.attr({width:e*a[0],height:f*a[1]}).style("transform","rotate("+b+"deg)"),this.$node.select("g").attr("transform","scale("+a[0]+","+a[1]+")");var g={scale:a,rotate:b};return this.fire("transform",g,c),this.options.scale=a,this.options.rotate=b,g},b.prototype.recolor=function(){var a=this.colorer;a.domain(this.options.domain).range(this.options.color),this.$node.selectAll("rect").attr("fill",function(b){return a(b)})},b.prototype.build=function(a){var b=this,c=this.data.dim,e=this.options.width,f=c[0],g=a.append("svg").attr({width:e,height:f*this.options.initialScale,"class":"heatmap"}),h=g.append("g").attr("transform","scale(1,"+this.options.initialScale+")"),j=this.colorer,k=this.data;return k.data().then(function(a){var c=h.selectAll("rect").data(a),e=d.selectionUtil(k,h,"rect");c.enter().append("rect").on("click",e).attr({width:b.options.width,height:1}).append("title").text(i.identity),c.attr({fill:function(a){return j(a)},y:function(a,b){return b}}),c.exit().remove()}),g},b}(e.AVisInstance);b.HeatMap1D=t,b.create=n}(a,c,a("d3"),a("../caleydo_d3/d3util"),a("../caleydo_core/vis"),a("../caleydo_core/idtype"),a("../caleydo_core/geom"),a("../caleydo_core/range"),a("../caleydo_core/main"),d)},{"../caleydo_core/geom":8,"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_core/range":20,"../caleydo_core/vis":28,"../caleydo_d3/d3util":31,css:void 0,d3:void 0}],53:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e){function f(a,b,c){return new g(a,b,c)}var g=function(a){function b(b,f,g){void 0===g&&(g={}),a.call(this),this.data=b,this.parent=f,this.options={scale:[1,1],rotate:0,width:300,height:300,maxTime:function(a){return a[a.length-1]}},this.line=c.svg.line().interpolate("step"),e.mixin(this.options,g),this.$node=this.build(c.select(f)),this.$node.datum(b),d.assignVis(this.$node.node(),this)}return __extends(b,a),Object.defineProperty(b.prototype,"rawSize",{get:function(){return[this.options.width,this.options.height]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),b.prototype.locateImpl=function(a){return Promise.resolve(null)},b.prototype.transform=function(a,b){void 0===b&&(b=0);var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;var d=this.options.width,e=this.options.height;this.$node.attr({width:d*a[0],height:e*a[1]}).style("transform","rotate("+b+"deg)"),this.$node.select("g").attr("transform","scale("+a[0]+","+a[1]+")");var f={scale:a,rotate:b};return this.fire("transform",f,c),this.options.scale=a,this.options.rotate=b,f},b.prototype.build=function(a){var b=this,d=this.options.width,e=this.options.height,f=this.options.scale||[1,1],g=a.append("svg").attr({width:d*f[0],height:e*f[1],"class":"kaplanmeier"}),h=g.append("g"),i=c.scale.linear().range([0,d]),j=c.scale.linear().range([0,e]);return this.line.x(function(a){return i(a[0])}).y(function(a){return j(a[1])}),this.data.data().then(function(a){var d=a.filter(function(a){return!isNaN(a)}).map(function(a){return Math.abs(a)});d.sort(c.ascending),j.domain([0,a.length]),Promise.resolve(c.functor(b.options.maxTime)(d)).then(function(a){i.domain([0,a]);for(var c=[[0,0]],e=0,f=1;f<d.length;++f){for(;d[f]===d[f-1]&&f<d.length;)++f;c.push([d[e],e+1]),e=f}d.length>0&&c.push([d[e],e+1]),c.push([a,d.length]),h.append("path").datum(c).attr("d",b.line),b.markReady()})}),g},b}(d.AVisInstance);b.KaplanMeierPlot=g,b.create=f}(a,c,a("d3"),a("../caleydo_core/vis"),a("../caleydo_core/main"),d)},{"../caleydo_core/main":13,"../caleydo_core/vis":28,css:void 0,d3:void 0}],54:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e){function f(b,c,d){return new a.ScatterPlot(b,c,d)}a.ScatterPlot=e.defineVis("ScatterPlot",{},[300,300],function(a,e,f){function g(){m.data.data().then(function(a){var c=b.scale.linear().domain([0,b.max(a.map(function(a){return a[j]}))]).range([0,h]),d=b.scale.linear().domain([0,b.max(a.map(function(a){return a[k]}))]).range([i,0]);l.selectAll("circle").transition().ease("linear").duration(1e3).attr("cx",function(a){return c(a[j])}).attr("cy",function(a){return d(a[k])})})}var h=f[0],i=f[1],j=0,k=1,l=a.append("svg").attr({width:h,height:i}),m=this;Promise.all([e.data(),e.rows()]).then(function(a){var c=a[0],e=a[1],f=b.scale.linear().domain([0,b.max(c.map(function(a){return a[j]}))]).range([0,h]),g=b.scale.linear().domain([0,b.max(c.map(function(a){return a[k]}))]).range([i,0]);l.selectAll("circle").data(c).enter().append("circle").attr("cx",function(a){return f(a[j])}).attr("cy",function(a){
return g(a[k])}).attr("r",2).call(d.bind(function(a,b){return e[b]}))});var n=a.append("select").on("change",function(){j=this.selectedIndex,g()}),o=a.append("select").on("change",function(){k=this.selectedIndex,g()});return e.cols().then(function(a){var d=n.selectAll("option").data(a);d.enter().append("option"),d.attr("value",function(a,b){return b}).text(c.identity).each(function(a,c){c==j&&b.select(this).attr("selected","selected")}),d.exit().remove();var e=o.selectAll("option").data(a);e.enter().append("option"),e.attr("value",function(a,b){return b}).text(c.identity).each(function(a,c){c==k&&b.select(this).attr("selected","selected")}),e.exit().remove()}),l}),a.create=f}(c,a("d3"),a("../caleydo_core/main"),a("../caleydo_tooltip/main"),a("../caleydo_d3/d3util"),d)},{"../caleydo_core/main":13,"../caleydo_d3/d3util":31,"../caleydo_tooltip/main":47,css:void 0,d3:void 0}],55:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e,f,g){function h(a,b){return new i(a,b)}var i=function(a){function b(b,e){a.call(this),this.data=b,this.parent=e,this.options={};var f=c.select(e);switch(b.desc.type){case"matrix":this.$node=this.build(f,[this.data.cols(),this.data.rows(),this.data.data()]);break;case"table":this.$node=this.build(f,[this.data.cols().map(function(a){return a.name}),this.data.rows(),this.data.data()]);break;case"vector":this.$node=this.build(f,[[this.data.desc.name],this.data.names(),this.data.data().then(function(a){return a.map(function(a){return[a]})})])}this.$node.datum(b),d.assignVis(this.$node.node(),this)}return __extends(b,a),Object.defineProperty(b.prototype,"rawSize",{get:function(){var a=this.data.dim;return[200*(a[1]||1),22*a[0]]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),b.prototype.locateImpl=function(a){var b,d,f=c.select(this.node).select("tbody"),g=f.node().offsetTop,h=f.node().clientWidth;if(a.isAll||a.isNone)return d=f.select("tr:last").node(),Promise.resolve(e.rect(0,g,h,d.offsetTop+d.clientHeight));var i=c.extent(a.dim(0).iter().asList());return b=f.select("tr:nth-child("+(i[0]+1)+")").node(),d=f.select("tr:nth-child("+(i[1]+1)+")").node(),Promise.resolve(e.rect(0,b.offsetTop,h,d.offsetTop+d.clientHeight-b.offsetTop))},b.prototype.transform=function(a,b){void 0===b&&(b=0);var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;this.$node.style("transform","rotate("+b+"deg)scale("+a[0]+","+a[1]+")");var d={scale:a,rotate:b};return this.fire("transform",d,c),this.options.scale=a,this.options.rotate=b,d},b.prototype.build=function(a,b){var d=this,e=a.append("table").attr("class","table");e.append("thead").append("tr"),e.append("tbody");var h=f.selectionUtil(this.data,e.select("tbody"),"tr");return Promise.all(b).then(function(a){var b=a[0],f=a[1],i=a[2],j=e.select("thead tr").selectAll("th").data(["ID"].concat(b));j.enter().append("th"),j.text(g.identity),j.exit().remove();var k=e.select("tbody").selectAll("tr").data(i);k.enter().append("tr").on("click",h),k.each(function(a,b){var d=c.select(this).selectAll("th").data(f.slice(b,b+1));d.enter().append("th"),d.text(g.identity),d.exit().remove();var e=c.select(this).selectAll("td").data(a);e.enter().append("td"),e.text(g.identity),e.exit().remove()}),k.exit().remove(),d.markReady()}),e},b}(d.AVisInstance);b.Table=i,b.create=h}(a,c,a("d3"),a("../caleydo_core/vis"),a("../caleydo_core/geom"),a("../caleydo_d3/d3util"),a("../caleydo_core/main"),d)},{"../caleydo_core/geom":8,"../caleydo_core/main":13,"../caleydo_core/vis":28,"../caleydo_d3/d3util":31,css:void 0,d3:void 0}],56:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e){"use strict";function f(a,b,c){return new g(a,b,c)}var g=function(a){function b(b,f,g){a.call(this),this.data=b,this.parent=f,this.options={scale:[1,1],rotate:0,colors:!0},e.mixin(this.options,g),this.$node=this.build(c.select(f)),this.$node.datum(b),d.assignVis(this.$node.node(),this)}return __extends(b,a),Object.defineProperty(b.prototype,"rawSize",{get:function(){return[300,300]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),b.prototype.option=function(a,b){return 1===arguments.length?this.options[a]:(this.fire("option",a,b,this.options[a]),this.fire("option."+a,b,this.options[a]),this.options[a]=b,void 0)},b.prototype.transform=function(a,b){void 0===b&&(b=0);var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;var d=this.rawSize;this.$node.style("transform","rotate("+b+"deg)"),this.$node.attr("width",d[0]*a[0]).attr("height",d[1]*a[1]),this.$node.select("g").attr("transform","scale("+a[0]+","+a[1]+")");var e={scale:a,rotate:b};return this.fire("transform",e,c),this.options.scale=a,this.options.rotate=b,e},b.prototype.build=function(a){var b=this,d=this.options.scale,e=this.size,f=a.append("svg").attr({width:e[0],height:e[1],"class":"graph-force"}),g=f.append("g").attr("transform","scale("+d[0]+","+d[1]+")"),h=c.scale.category20().range();return this.data.impl().then(function(a){var d=a.nodes.map(function(a){return{v:a}}),e=c.map(d,function(a){return String(a.v.id)}),f=a.edges.map(function(a){return{v:a,source:e.get(String(a.source.id)),target:e.get(String(a.target.id))}}),i=c.layout.force().size(b.rawSize);i.nodes(d).links(f);var j=g.selectAll(".edge").data(f);j.enter().append("line").classed("edge",!0),j.attr("data-type",function(a){return a.v.type}),j.exit().remove();var k=g.selectAll(".node").data(d);k.enter().append("circle").classed("node",!0).attr("r",5).call(i.drag).on("click",function(a){console.log(a.v)}).append("title"),k.attr("data-type",function(a){return a.v.type}),b.options.colors&&(j.style("stroke",function(a){var b=e[a.v.type];return b||(b=h.shift(),e[a.v.type]=b),b}),k.style("fill",function(a){var b=e[a.v.type];return b||(b=h.shift(),e[a.v.type]=b),b})),k.select("title").text(function(a){return a.v.id+" "+a.v.type}),i.on("tick",function(){j.attr({x1:function(a){return a.source.x},y1:function(a){return a.source.y},x2:function(a){return a.target.x},y2:function(a){return a.target.y}}),k.attr({cx:function(a){return a.x},cy:function(a){return a.y}})}),b.markReady(),i.start()}),f},b}(d.AVisInstance);b.ForceDirectedGraphVis=g,b.create=f}(a,c,a("d3"),a("../caleydo_core/vis"),a("../caleydo_core/main"),d)},{"../caleydo_core/main":13,"../caleydo_core/vis":28,css:void 0,d3:void 0}],57:[function(a,b,c){var d,e=a("css");e.load("./style",function(){},function(a){d=a}),function(a,b,c,d,e,f){"use strict";function g(a){return a.map(function(a){var b={column:a.desc.name};a.desc.color?b.color=a.desc.color:a.desc.cssClass&&(b.cssClass=a.desc.cssClass),a.desc.lineup&&Object.keys(a.desc.lineup).forEach(function(c){b[c]=a.desc.lineup[c]});var c=a.desc.value;switch(c.type){case"string":b.type="string";break;case"categorical":b.type="categorical",b.categories=a.desc.categories;break;case"real":case"int":b.type="number",b.domain=c.range;break;default:b.type="string"}return b})}a.LineUp=f.defineVis("LineUp",{rowNames:!1},function(a){var b=a.dim;return[Math.min(100*b[1],1e3),Math.min(20*b[0],600)]},function(a){var b=a.append("div"),f=this,h=this.option("rowNames",!1)===!0,i=g(this.data.cols());h&&i.unshift({type:"string",label:"Row",column:"_name"});var j=function(a,b){f.lineup&&f.lineup.data.setSelection(b.dim(0).asList())};f.data.on("select-selected",j),c.onDOMNodeRemoved(b.node(),function(){f.data.off("select-selected",j)});var j=function(a,b){f.lineup&&f.lineup.data.setSelection(b.dim(0).asList())};return f.data.on("select-selected",j),c.onDOMNodeRemoved(b.node(),function(){f.data.off("select-selected",j)}),Promise.all([this.data.objects(),this.data.rowIds(),h?this.data.rows():Promise.resolve([])]).then(function(a){var g=a[0],h=a[1].dim(0).asList(),k=a[2],l=g.map(function(a,b){return c.mixin({_name:k[b],_id:h[b]},a)});f.provider=e.createLocalStorage(l,i);var m=f.option("dump");m&&f.provider.restore(m),f.lineup=e.create(f.provider,b,f.option("lineup")),f.lineup.on("hoverChanged",function(a){var b=null;0>a?f.data.clear(d.hoverSelectionType):(b=l[a]._id,f.data.select(d.hoverSelectionType,[a])),f.fire(d.hoverSelectionType,b)}),f.lineup.on("multiSelectionChanged",function(a){0===a.length?f.data.clear(d.defaultSelectionType):f.data.select(d.defaultSelectionType,a),f.fire(d.defaultSelectionType,0===a.length?null:l[a[0]]._id)}),f.provider.deriveDefault(),f.lineup.update(),f.data.selections().then(function(a){a.isNone||j(null,a)}),f.markReady()}),b},{transform:function(a,b){var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;this.$node.style("transform","rotate("+b+"deg)scale("+a[0]+","+a[1]+")");var d={scale:a,rotate:b};return this.fire("transform",d,c),this.options.scale=a,this.options.rotate=b,d},update:function(){this.lineup&&this.lineup.update()}}),a.create=function(b,c,d){return new a.LineUp(b,c,d)}}(c,a("d3"),a("../caleydo_core/main"),a("../caleydo_core/idtype"),a("lineupjs"),a("../caleydo_d3/d3util"),a("font-awesome"),d)},{"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_d3/d3util":31,css:void 0,d3:void 0,"font-awesome":void 0,lineupjs:void 0}],58:[function(a,b,c){!function(a,b,c,d,e,f,g,h){function i(a,b){var c=function(a){return{position:a.position,offset:a.offset}};a.draggable({scroll:!0,handle:"div.ui-widget-header h3",start:function(a,d){b.fire("drag_start",c(d))},stop:function(a,d){b.fire("drag_stop",c(d))},drag:function(a,d){b.fire("drag",c(d))}})}function j(a){a.draggable("destroy")}function k(a,b,d){void 0===d&&(d={});var e=function(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}};a.resizable(c.extend({start:function(a,c){b.fire("resize_start",e(c))},stop:function(a,c){b.fire("resize_stop",e(c))},resize:function(a,c){b.fire("resize",e(c))},autoHide:!0,delay:150,distance:10},d))}function l(a){a.resizable("destroy")}function m(a,b){a.on({mouseenter:function(){b.css("opacity",1)},mouseleave:function(){b.css("opacity",0)}}),b.css("opacity",0)}function n(a,b){a.off("mouseenter").off("mouseleave"),b.css("opacity",null)}function o(a,b){return new q(a,b)}function p(a,b){return new t(a,b)}b.manager=new h.ObjectManager("uiwindow","Window");var q=function(a){function d(d,f){var g=this;a.call(this),this._data={},this.id=b.manager.nextId(this),this.options=e.mixin({resizeable:!0,draggable:!0},f),this.$parent=c(d),this.$div=c("<div/>").appendTo(this.$parent).addClass("ui-widget-content window").css({left:0,top:0,"z-index":0}),this.$div.on({mouseenter:function(){b.manager.select(h.hoverSelectionType,[g.id],h.SelectOperation.ADD),g.fire("mouseenter",g)},mouseleave:function(){b.manager.select(h.hoverSelectionType,[g.id],h.SelectOperation.REMOVE),g.fire("mouseleave",g)}}),this.$header=c("<div>").appendTo(this.$div).addClass("ui-widget-header"),c("<h3>").appendTo(this.$header).disableSelection(),this.toolbar=new r(this.$header[0]),this.$content=c('<div class="content"/>').appendTo(this.$div),this.options.draggable&&i(this.$div,this),this.options.resizeable&&k(this.$content,this),this.options.animatedHeader&&m(this.$div,this.$header),this.toolbar.bindTo(this)}return __extends(d,a),d.prototype.data=function(a,b){if(1===arguments.length)return this._data[a];var c=this._data[a];return this._data[a]=b,c},d.prototype.close=function(){this.$div.remove(),b.manager.remove(this),this.fire("removed",this)},d.prototype.incZLevel=function(){return this.changeZLevel(1)},d.prototype.decZLevel=function(){return this.changeZLevel(1)},d.prototype.changeZLevel=function(a){0>a?this.$div.css("z-index","-="+-a):this.$div.css("z-index","+="+a)},d.prototype.persist=function(){return{title:this.title,size:this.size,pos:this.pos,options:this.options}},d.prototype.restore=function(a){var b=this.options;return this.options=a.options,this.options.draggable!==b.draggable&&(this.options.draggable?i(this.$div,this):j(this.$div)),this.options.resizeable!==b.resizeable&&(this.options.resizeable?k(this.$content,this):l(this.$content)),this.options.animatedHeader!==b.animatedHeader&&(this.options.animatedHeader?m(this.$div,this.$header):n(this.$div,this.$header)),this.title=a.title,this.size=a.size,this.pos=a.pos,this},Object.defineProperty(d.prototype,"title",{get:function(){return this.$header.find("h3").text()},set:function(a){this.$header.find("h3").html(a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"size",{get:function(){return[this.$content.width(),this.$content.height()]},set:function(a){this.$content.css("width",a[0]),this.$content.css("height",a[1])},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"contentSize",{get:function(){var a=this.size;return[a[0],a[1]-(this.options.animatedHeader?0:20)]},set:function(a){this.size=[a[0],a[1]+(this.options.animatedHeader?0:20)]},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"contentPos",{get:function(){var a=this.pos,b=this.$content.position();return a[0]+=b.left,a[1]+=b.top,a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"pos",{get:function(){var a=this.$div.position();return[a.left,a.top]},set:function(a){this.$div.css("left",a[0]+"px"),this.$div.css("top",a[1]+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"node",{get:function(){return this.$content[0]},enumerable:!0,configurable:!0}),d}(d.EventHandler);b.UIWindow=q;var r=function(){function a(a){this.builder=[],this.$node=c('<div class="toolbar" />').appendTo(a)}return a.prototype.bindTo=function(a){this.window=a,this.$node.empty(),a&&this.rebuild()},a.prototype.rebuild=function(){var a=this;this.builder.forEach(function(b){return b.call(a,a.window,a.$node[0])}),this.addButton("fa-caret-square-o-up","Move Up",function(a){a.incZLevel()}),this.addButton("fa-caret-square-o-down","Move Down",function(a){a.decZLevel()}),this.addButton("fa-close","Close",function(a){a.close()})},a.prototype.addButton=function(a,b,d){var e=this;c('<i class="fa '+a+'">').appendTo(this.$node).click(function(){d.call(e,e.window)}).attr("title",b)},Object.defineProperty(a.prototype,"node",{get:function(){return this.$node[0]},enumerable:!0,configurable:!0}),a}();b.ToolBar=r;var s=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.prototype.push=function(a){var b=this;a.on("mouseenter",function(a,c){b.bindTo(c)}).on("mouseleave",function(a,c){b.bindTo(null)}).on("removed",function(a,c){b.window===c&&b.bindTo(null)})},b}(r);b.StaticToolBar=s;var t=function(a){function b(b,c){a.call(this,b,c),this.options.zoomAble&&(this.zoom=new f.ZoomBehavior(this.node,null,null),this.propagate(this.zoom,"zoom"))}return __extends(b,a),Object.defineProperty(b.prototype,"vis",{get:function(){return this.vis_},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"visMeta",{get:function(){return this.visMeta_},enumerable:!0,configurable:!0}),b.prototype.attachVis=function(a){function b(){if(i.options.resizeable){var a=c(i.node),b=a.resizable("option","aspectRatio"),d=a.resizable("option","handles"),e=!1,g="e,s,se";switch(f.scaling){case"aspect":e=!0;break;case"width-only":g="e";break;case"height-only":g="s"}(e!==b||g!==d)&&(l(a),k(a,i,{aspectRatio:e,handles:g}))}}var d,f,g=this;if(e.isFunction(a)){var h=a(this.node);d=h.vis,f=h.meta}else d=arguments[0],f=arguments[1];this.vis_=d,this.visMeta_=f,this.data("vis",this.vis_),this.data("visMeta",this.visMeta_),this.zoom&&(this.zoom.v=d,this.zoom.meta=f),this.title=d.data.desc.name;var i=this;return b(),this.on("resize",function(a,b){g.zoom&&g.zoom.zoomTo(b.size.width,b.size.height)}),this.contentSize=d.size,d.on("changed",function(){g.contentSize=d.size,b()}),d.on("transform",function(){g.contentSize=d.size}),this.on("removed",function(){d.destroy()}),this.vis_},b.prototype.adapter=function(a){var b=this,c={data:a.data,locate:function(){return e.isFunction(a.locate)?a.locate.apply(a,e.argList(arguments)).then(function(a){var c=b.contentPos;return Array.isArray(a)?a.map(function(a){return a?g.wrap(a).shift(c):a}):a?g.wrap(a).shift(c):a}):Promise.resolve(1===arguments.length?void 0:new Array(arguments.length))},locateById:function(){return e.isFunction(a.locateById)?a.locateById.apply(a,e.argList(arguments)).then(function(a){var c=b.contentPos;return Array.isArray(a)?a.map(function(a){return a?g.wrap(a).shift(c):a}):a?g.wrap(a).shift(c):a}):Promise.resolve(1===arguments.length?void 0:new Array(arguments.length))}};return c},b}(q);b.VisWindow=t,b.create=o,b.createVisWindow=p}(a,c,a("jquery"),a("../caleydo_core/event"),a("../caleydo_core/main"),a("../caleydo_core/behavior"),a("../caleydo_core/geom"),a("../caleydo_core/idtype"),a("jquery-ui"),a("font-awesome"))},{"../caleydo_core/behavior":4,"../caleydo_core/event":7,"../caleydo_core/geom":8,"../caleydo_core/idtype":9,"../caleydo_core/main":13,"font-awesome":void 0,jquery:void 0,"jquery-ui":void 0}],59:[function(a,b,c){!function(a,b,c,d,e,f,g,h){function i(a,b){var c=new k(e.select(a),b);return{render:c.render.bind(c)}}var j={isEditable:function(){return d.getMode().authoring>.8}},k=function(){function a(a,b,e){var f=this;void 0===e&&(e={}),this.$main=a,this.graph=b,this.options={animation:!0,duration:100,markdown:!0,renderSubtitle:!1,subtitlePattern:"${name}"},this.prev=Promise.resolve(null),this.l=function(a,b,c,d,e){return f.render(b,e.withTransition!==!1)},this.updateAnnotations=function(){return f.renderAnnotationsImpl(f.act)},this.rerender=function(){return f.render(f.act)},this.act=null,this.renderer=this.rendererImpl.bind(this),c.mixin(this.options,e),this.graph.on("select_slide_"+g.defaultSelectionType,this.l),c.onDOMNodeRemoved(a.node(),this.destroy.bind(this)),d.on("modeChanged",this.rerender)}return a.prototype.rendererImpl=function(a){if(j.isEditable()&&0===a.length)return'<i class="placeholder">Enter Text by Clicking (MarkDown supported)</i>';if(this.act){var b={name:this.act.name,duration:this.act.duration,slide_number:this.act.slideIndex},c=this.act.state;if(c){b.state_name=c.name,b.state_notes=c.getAttr("notes");var d=c.creator;if(d){var e=d.meta;b.action_name=e.name,b.action_category=e.category,b.action_operation=e.operation,b.action_user=e.user,b.action_ts=new Date(e.timestamp)}}a=this.replaceVariables(a,b)}return this.options.markdown?f(a):a},a.prototype.replaceVariables=function(a,b){return a.replace(/\$\{([^}]+)\}/gi,function(a,c){var d=b[c];return d?d:"${"+c+"}?"})},a.prototype.destroy=function(){this.graph.off("select_slide_"+g.defaultSelectionType,this.l),d.off("modeChanged",this.rerender)},a.prototype.render=function(a,b){var c=this;return void 0===b&&(b=!0),this.act&&this.act.off("push-annotations,attr-name,attr-duration",this.updateAnnotations),this.prev=this.prev.then(function(){var e=c.hideOld();if(c.act=a,!a)return e;if(c.act.on("push-annotations,attr-name,attr-duration",c.updateAnnotations),d.getMode().exploration>.8)return e;var f=Promise.resolve(null);f=a.isTextOnly?c.renderText(a):c.graph.jumpTo(a.state,a.transition<=0||!b?h.MIN_TRANSITION:a.transition*h.FACTOR);var g=[e,f,c.renderAnnotations(a)];return c.options.renderSubtitle&&g.push(c.renderSubtitle(a)),Promise.all(g)}),this.prev},a.prototype.renderAnnotationsImpl=function(a){var b=this,d=this,f=j.isEditable()&&null!=a,g=this.$main.selectAll("div.annotation").data(a?a.annotations:[],function(a,b){return a.type+b}),h=g.enter().append("div").attr("class",function(a){return a.type+"-annotation annotation"}),i=function(a){return"translate("+a.pos[0]+","+a.pos[1]+")rotate("+(a.rotation||0)+"deg)"};return h.append("button").attr("tabindex",-1).attr("class","btn btn-default btn-xs fa fa-arrows").call(e.behavior.drag().on("drag",function(b,d){var f=e.mouse(this.parentNode.parentNode),g=c.bounds(this.parentNode.parentNode);b.pos=[100*f[0]/g.w,100*f[1]/g.h],a.updateAnnotation(b),e.select(this.parentNode).style("left",b.pos[0]+"%").style("top",b.pos[1]+"%")})),h.append("button").attr("tabindex",-1).attr("class","btn btn-default btn-xs fa fa-times").on("click",function(b,c){e.select(this.parentNode).remove(),a.removeAnnotationElem(b),e.event.preventDefault()}),g.filter(function(a){return"text"===a.type||!a.hasOwnProperty("type")}).call(function(c,f){var g=function(b,c){var f=e.select(this);e.select(this.parentNode).classed("editable")&&(f.on("click",null),f.append("textarea").property("value",b.text).on("blur",function(){b.text=this.value,a.updateAnnotation(b),f.html(d.renderer(this.value)).on("click",g)}))};f.append("div").classed("text",!0).on("click",g),c.select("div.text").html(function(a){return b.renderer(a.text)}).style({width:function(a){return a.size?a.size[0]+"px":null},height:function(a){return a.size?a.size[1]+"px":null},transform:i}).each(function(a){a.styles&&e.select(this).style(a.styles)})},h.filter(function(a){return"text"===a.type||!a.hasOwnProperty("type")})),g.filter(function(a){return"arrow"===a.type}).call(function(b,c){function d(){g.attr({width:function(a){return 30+Math.abs(a.at[0])},height:function(a){return 30+Math.abs(a.at[1])}}).style({left:function(a){return-15+Math.min(0,a.at[0])+"px"},top:function(a){return-15+Math.min(0,a.at[1])+"px"}}),g.select("g").attr("transform",function(a){return"translate("+(-Math.min(0,a.at[0])+15)+","+(-Math.min(0,a.at[1])+15)+")"})}var f=c.insert("svg",":first-child").attr({width:function(a){return 30+Math.abs(a.at[0])},height:function(a){return 30+Math.abs(a.at[1])}}).style({left:function(a){return-15+Math.min(0,a.at[0])+"px"},top:function(a){return-15+Math.min(0,a.at[1])+"px"}});f.append("defs").append("marker").attr({id:function(a,b){return"clue_text_arrow_marker"+b},viewBox:"0 0 10 10",refX:6,refY:5,markerWidth:4,markerHeight:3,markerUnits:"strokeWidth",orient:"auto"}).append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),f.append("g").append("line").classed("arrow",!0).attr({"marker-end":function(a,b){return"url(#clue_text_arrow_marker"+b+")"}});var g=b.select("svg");f.select("g").append("circle").classed("anchor",!0).attr("r",5),g.select("circle").style({cx:function(a){return a.at[0]},cy:function(a){return a.at[1]}}).call(e.behavior.drag().on("drag",function(b,c){var f=e.event;b.at=[f.x,f.y],a.updateAnnotation(b),e.select(this).style({cx:b.at[0],cy:b.at[1]}),g.select('line[data-index="'+c+'"]').attr({x2:b.at[0],y2:b.at[1]}),d()})),d(),g.select("line").attr({"data-index":function(a,b){return b},x2:function(a){return a.at[0]},y2:function(a){return a.at[1]}}).each(function(a){a.styles&&e.select(this).style(a.styles)})},h.filter(function(a){return"arrow"===a.type})),g.filter(function(a){return"frame"===a.type}).call(function(b,d){b.style({width:function(a){return a.size[0]+"%"},height:function(a){return a.size[1]+"%"}}).each(function(a){a.styles&&e.select(this).style(a.styles)}),d.append("button").attr("tabindex",-1).attr("class","btn btn-default btn-xs fa fa-expand fa-flip-horizontal").call(e.behavior.drag().on("drag",function(b,d){var f=e.mouse(this.parentNode.parentNode),g=c.bounds(this.parentNode.parentNode);b.size=[100*f[0]/g.w-b.pos[0],100*f[1]/g.h-b.pos[1]],a.updateAnnotation(b),e.select(this.parentNode).style({width:function(a){return a.size?a.size[0]+"%":null},height:function(a){return a.size?a.size[1]+"%":null}})}))},h.filter(function(a){return"frame"===a.type})),g.style({left:function(a){return a.pos[0]+"%"},top:function(a){return a.pos[1]+"%"}}).classed("editable",f),g.exit().remove(),g},a.prototype.renderAnnotations=function(a){var b=this;return new Promise(function(d){var e=b.renderAnnotationsImpl(a);b.options.animation&&!e.empty()&&b.options.duration>0?(e.style("opacity",0).transition().duration(b.options.duration).style("opacity",1),c.resolveIn(b.options.duration).then(function(){return d(e.node())})):(e.style("opacity",1),d(e.node()))})},a.prototype.hideOld=function(){var a=this;return new Promise(function(b){var d=a.$main.classed("hide-all-non-annotations",!1).selectAll("div.annotation, div.text-overlay, div.add-text-annotation, div.subtitle-annotation");a.options.animation&&!d.empty()&&a.options.duration>0?(d.transition().duration(a.options.duration).style("opacity",0).remove(),c.resolveIn(a.options.duration).then(function(){return b()})):(d.remove(),b())})},a.prototype.renderSubtitle=function(a){var b=this;return new Promise(function(a){b.$main.append("div").attr("class","subtitle-annotation").html(b.renderer(b.options.subtitlePattern)),a(b.$main.node())})},a.prototype.renderText=function(a){var b=this,d=a.transition*h.FACTOR;return c.resolveIn(d).then(function(){return b.$main.classed("hide-all-non-annotations",!0),b.$main.node()})},a}();b.Renderer=k,b.create=i}(a,c,a("../caleydo_core/main"),a("../caleydo_provenance/mode"),a("d3"),a("marked"),a("../caleydo_core/idtype"),a("../caleydo_provenance/player"))},{"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_provenance/mode":41,"../caleydo_provenance/player":43,d3:void 0,marked:void 0}],60:[function(a,b,c){!function(a,b,c,d,e,f,g,h,i,j,k){function l(a){for(var b,c=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,d=[];b=c.exec(a);)d.push(b[1]);return d}function m(){var a=g.getMode();return a.presentation>.3?o.ExtraSmall:a.authoring>=.8?o.Large:o.Medium}function n(a,b,c){return void 0===c&&(c={}),new t(a,b,c)}var o;!function(a){a[a.ExtraSmall=0]="ExtraSmall",a[a.Small=1]="Small",a[a.Medium=2]="Medium",a[a.Large=3]="Large"}(o||(o={}));var p=.9,q=.7,r=.4,s=function(){function a(a,b){this.s=a,this.graph=b,this.xy=[0,0],this.selected=!1,this.parent=null,this.children=[],this.a=null,this.doi=.1,this.a=a.creator}return Object.defineProperty(a.prototype,"thumbnail",{get:function(){return"url("+k.thumbnail_url(this.graph,this.s)+")"},enumerable:!0,configurable:!0}),a.prototype.build=function(a,b){var c=this.s.previousState;c&&(this.parent=a[c.id],b.indexOf(this)>=0?this.parent.children.unshift(this):this.parent.children.push(this))},Object.defineProperty(a.prototype,"flatChildren",{get:function(){var a=this.children.slice();return this.children.forEach(function(b){return a.push.apply(a,b.flatChildren)}),a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cx",{get:function(){return this.xy[0]+2},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cy",{get:function(){return this.xy[1]+13},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lod_local",{get:function(){return this.doi>=p?o.Large:this.doi>=q?o.Medium:this.doi>=r?o.Small:o.ExtraSmall},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lod",{get:function(){var a=m(),b=this.lod_local;return b>a?a:b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){switch(this.lod){case o.Large:return[50,40];case o.Medium:return[30,18];case o.Small:return[30,18];default:return[10,7]}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return this.s.name},enumerable:!0,configurable:!0}),a.toRepr=function(b,c,d){void 0===d&&(d={});var e={},g=b.act,h=g.path.reverse(),j=m(),l=b.states.length,n=function(j){var m=new a(j,b),n=j.creator,o=n?n.meta:f.meta("No","none","none"),q=c.category[o.category]?1:0,s=c.operation[o.operation]?1:0,t=j.getAttr("starred",!1)?1:0,u=c.tags.length>0&&j.getAttr("tags",[]).some(function(a){return c.tags.indexOf(a)>=0})?1:0,v=j===g?3:0,w=h.indexOf(j)>=0?Math.max(-2.5,6-h.indexOf(j)):-2.5,x=Math.max(-1,-l/10),y=6+v+w+x;return m.doi=i.round(Math.max(0,Math.min(10,y))/10,1),q+s+t+u>0&&(m.doi=Math.max(m.doi,r)),k.areThumbnailsAvailable(b)&&d.thumbnails!==!1||(m.doi=Math.min(m.doi,p-.01)),m.selected=j===g,e[j.id]=m,m},q=(j<o.Medium?h:b.states).map(n),s=g.path.map(function(a){return e[a.id]});return q.forEach(function(a){return a.build(e,s)}),this.layout(q,s),q},a.layout=function(a,b){var c=[],d=a.filter(function(a){return null===a.parent})[0];for(c.push([d]),c.push(d.children.slice());c[c.length-1].length>0;)c.push([].concat.apply([],c[c.length-1].map(function(a){return a.children.slice()})));c.forEach(function(a,c){c<b.length&&(a.splice(a.indexOf(b[c]),1),a.unshift(b[c]))});var e=!1,f=0;do e=!1,f++,c.forEach(function(a,b){for(var d=0;d<a.length;++d){var f=a[d];if(f&&(f.xy=[d,b],f.children.length>0)){var g=c[b+1].indexOf(f.children[0]);e=e||g!==d,d>g?c[b+1].splice.apply(c[b+1],[g,0].concat(i.range(d-g).map(function(a){return null}))):g>d&&d>0&&(a.splice.apply(a,[d,0].concat(i.range(g-d).map(function(a){return null}))),f.xy[0]=g,d=g)}}});while(e&&5>f);c=c.filter(function(a){return a.length>0}),c.forEach(function(a){var b=a[0];b&&b.lod===o.Small&&(b.doi=.8)});var g=[],h=[];a.forEach(function(a){g[a.xy[0]]=Math.max(g[a.xy[0]]||0,a.size[0]),h[a.xy[1]]=Math.max(h[a.xy[1]]||0,a.size[1])});var j=g.reduce(function(a,b,c){return a[c+1]=a[a.length-1]+b,a},[0]),k=h.reduce(function(a,b,c){return a[c+1]=a[a.length-1]+b,a},[0]);j.shift(),a.forEach(function(a){var b=a.xy,c=j[j.length-1]-j[b[0]]+5,d=k[b[1]];a.xy=[c,d]})},a.toIcon=function(a){if(!a.a)return"";var b=a.a.meta,c={visual:"bar-chart",data:"database",logic:"gear",layout:"desktop",selection:"pencil-square"},d={create:"plus",update:"refresh",remove:"remove"};return'<span title="'+b.name+" @ "+b.timestamp+" ("+b.user+')"><i class="fa fa-'+c[b.category]+'"></i><i class="super fa fa-'+d[b.operation]+'"></i></span>'},a.render=function(b){b.classed("doi-xs",function(a){return a.lod===o.ExtraSmall}).classed("doi-sm",function(a){return a.lod===o.Small}).classed("doi",function(a){return a.lod===o.Medium}).classed("doi-lg",function(a){return a.lod===o.Large}).classed("select-selected",function(a){return a.selected}).classed("bookmarked",function(a){return a.s.getAttr("starred",!1)}).attr("data-doi",function(a){return a.doi}).attr("title",function(a){return a.name}),b.select("span.icon").html(a.toIcon),b.select("span.slabel").text(function(a){return a.name}),b.select("i.bookmark").classed("fa-bookmark-o",function(a){return!a.s.getAttr("starred",!1)}).classed("fa-bookmark",function(a){return a.s.getAttr("starred",!1)}),b.select("div.sthumbnail").style("background-image",function(a){return a.lod===o.Large?a.thumbnail:null}),b.transition().style({"padding-left":function(a){return a.xy[0]+4+"px"},top:function(a){return a.xy[1]+"px"}})},a.prototype.showDialog=function(){var b=this,c=a.toIcon(b),e=b.s.name,f=h.generateDialog('<span class="icon">'+c+"</span>"+e),g=k.thumbnail_url(b.graph,b.s,{width:512,format:"png"}),j=b.s.getAttr("note",""),m=(b.s.getAttr("starred",!1),i.select(f.body));m.html('\n    <form class="state_info" onsubmit="return false">\n      <span class="star fa fa-bookmark-o" title="bookmark this state for latter use"></span>\n      <div class="img"><img src="'+g+'"></div>\n      <div class="form-group">\n        <label>Name</label>\n        <input type="text" class="form-control" placeholder="name" value="'+e+'">\n      </div>\n      <div class="form-group">\n        <label>Notes</label>\n        <textarea class="form-control" placeholder="place for notes... (#tags will be automatically extracted)">'+j+'</textarea>\n      </div>\n      <div class="form-group">\n        <label>Extracted Tags</label>\n        <input type="text" class="form-control readonly" readonly="readonly" value="'+l(j).join(" ")+'">\n      </div>\n    </form>'),m.select("span.star").on("click",function(){return b.s.setAttr("starred",!b.s.getAttr("starred",!1)),d(this).toggleClass("fa-bookmark-o").toggleClass("fa-bookmark"),!1}),m.select("textarea").on("input",function(){m.select("input.readonly").property("value",l(this.value).join(" "))}),f.onHide(function(){var a=m.select("input").property("value");b.s.name=a;var c=m.select("textarea").property("value");b.s.setAttr("tags",l(c)),b.s.setAttr("note",c)}),f.show()},a}(),t=function(a){function b(b,d,f){var g=this;a.call(this),this.data=b,this.parent=d,this.options=f,this.trigger=c.bind(this.update,this),this.triggerStoryHighlight=c.bind(this.updateStoryHighlight,this),this.onStateAdded=function(a,b){b.on("setAttr",g.trigger);
},this.onSelectionChanged=function(a,b,c){var d=g.data.selectedStates(b);g.$node.selectAll("div.state").classed("select-"+b,function(a){var c=d.indexOf(a.s)>=0;return c&&b===e.defaultSelectionType&&this.scrollIntoView(),c})},this.line=i.svg.line().interpolate("step-after").x(function(a){return a.cx}).y(function(a){return a.cy}),this.dim=[200,100],this.highlight={category:{data:!1,visual:!1,selection:!1,logic:!1,layout:!1,none:!1},operation:{create:!1,remove:!1,update:!1,none:!1},tags:[]},this.options=c.mixin({thumbnails:!0},f),this.options.scale=[1,1],this.options.rotate=0,this.$node=this.build(i.select(d)),c.onDOMNodeRemoved(this.node,this.destroy,this),this.bind(),this.update()}return __extends(b,a),b.prototype.bind=function(){var a=this;this.data.on("switch_state,forked_branch,clear",this.trigger),this.data.on("add_slide,move_slide,remove_slide",this.triggerStoryHighlight),this.data.on("add_state",this.onStateAdded),this.data.on("select",this.onSelectionChanged),this.data.states.forEach(function(b){b.on("setAttr",a.trigger)}),g.on("modeChanged",this.trigger)},b.prototype.destroy=function(){var b=this;a.prototype.destroy.call(this),this.data.off("switch_state,clear",this.trigger),this.data.off("add_slide,move_slidey,remove_slide",this.triggerStoryHighlight),this.data.off("add_state",this.onStateAdded),this.data.off("select",this.onSelectionChanged),this.data.states.forEach(function(a){a.off("setAttr",b.trigger)}),g.off("modeChanged",this.trigger)},Object.defineProperty(b.prototype,"rawSize",{get:function(){return this.dim},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),b.prototype.option=function(a,b){return 1===arguments.length?this.options[a]:(this.fire("option."+a,b,this.options[a]),void(this.options[a]=b))},b.prototype.locateImpl=function(a){return Promise.resolve(null)},b.prototype.build=function(a){var b=a.append("aside").attr({"class":"provenance-layout-vis"}).style("transform","rotate("+this.options.rotate+"deg)");b.html('\n      <div>\n        <h2><i class="fa fa-code-fork fa-rotate-180"></i> Provenance <i class="fa fa-filter"></i></h2>\n        <form class="form-inline toolbar" style="display:none" onsubmit="return false;">\n        <div class="btn-group" data-toggle="buttons">\n          <label class="btn btn-default btn-xs" title="data actions">\n            <input type="checkbox" autocomplete="off" name="category" value="data" > <i class="fa fa-database"></i>\n          </label>\n          <label class="btn btn-default btn-xs" title="visual actions">\n            <input type="checkbox" autocomplete="off" name="category" value="visual"> <i class="fa fa-bar-chart"></i>\n          </label>\n          <label class="btn btn-default btn-xs" title="selection actions">\n            <input type="checkbox" autocomplete="off" name="category" value="selection"> <i class="fa fa-pencil-square"></i>\n          </label>\n          <label class="btn btn-default btn-xs" title="layout actions">\n            <input type="checkbox" autocomplete="off" name="category" value="layout"> <i class="fa fa-desktop"></i>\n          </label>\n          <label class="btn btn-default btn-xs" title="logic actions">\n            <input type="checkbox" autocomplete="off" name="category" value="logic"> <i class="fa fa-gear"></i>\n          </label>\n        </div>\n\n        <div class="btn-group" data-toggle="buttons">\n          <label class="btn btn-default btn-xs" title="create actions">\n            <input type="checkbox" autocomplete="off" name="operation" value="create"> <i class="fa fa-plus"></i>\n          </label>\n          <label class="btn btn-default btn-xs" title="update actions">\n            <input type="checkbox" autocomplete="off" name="operation" value="update"> <i class="fa fa-refresh"></i>\n          </label>\n          <label class="btn btn-default btn-xs" title="remove actions">\n            <input type="checkbox" autocomplete="off" name="operation" value="remove"> <i class="fa fa-remove"></i>\n          </label>\n        </div>\n\n        <div class="btn-group" data-toggle="buttons">\n          <div class="form-group btn-group">\n            <div class="btn-group btn-group-xs" role="group">\n              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"\n                      aria-expanded="false">\n                <i class="fa fa-tags"></i><span class="caret"></span>\n              </button>\n              <div class="dropdown-menu dropdown-menu-right">\n                <div class="input-group input-group-sm">\n                  <span class="input-group-addon" title="tagged states"><i class="fa fa-tags"></i></span>\n                  <input name="tags" type="text" class="form-control input-sm" placeholder="tags">\n                </div>\n              </div>\n            </div>\n          </div>\n         </div>\n        </form>\n      </div>\n      <div style="position: relative">\n        <svg>\n          <g transform="translate(1,1)" class="edges"></g>\n          <g transform="translate(1,1)" class="storyhighlights" style="display:none">\n            <path class="story"></path>\n          </g>\n        </svg>\n        <div class="states"></div>\n      </div>\n      <div class="legend">\n        <div class="btn-group-vertical" data-toggle="buttons">\n          <label class="btn btn-default btn-xs" title="data actions">\n            <input type="checkbox" autocomplete="off" name="category" value="data"> <i class="fa fa-database"></i> Data\n          </label>\n          <label class="btn btn-default btn-xs" title="visual actions">\n            <input type="checkbox" autocomplete="off" name="category" value="visual"> <i class="fa fa-bar-chart"></i> Visual\n          </label>\n          <label class="btn btn-default btn-xs" title="selection actions">\n            <input type="checkbox" autocomplete="off" name="category" value="selection" > <i class="fa fa-pencil-square"></i> Selections\n          </label>\n          <label class="btn btn-default btn-xs" title="layout actions">\n            <input type="checkbox" autocomplete="off" name="category" value="layout"> <i class="fa fa-desktop"></i> Layout\n          </label>\n          <label class="btn btn-default btn-xs" title="logic actions">\n            <input type="checkbox" autocomplete="off" name="category" value="logic"> <i class="fa fa-gear"></i> Analysis\n          </label>\n        </div>\n      </div>\n    ');var c=d(b.node()),e=this;return c.find("form.toolbar input, .legend input").on("change",function(){"text"===this.type?(e.highlight.tags=this.value.split(" "),c.find('button[data-toggle="dropdown"]').toggleClass("active",e.highlight.tags.length>0)):e.highlight[this.name][this.value]=this.checked,e.update()}),c.find('*[data-toggle="buttons"],.btn[data-toggle="button"]').button(),c.find("h2 i").on("click",function(){c.find("form.toolbar").toggle("fast")}),b},b.prototype.onStateClick=function(a){i.event.stopPropagation(),this.data.selectState(a.s,e.toSelectOperation(i.event)),this.data.jumpTo(a.s)},b.prototype.update=function(){var a=this,b=this,d=this.data,f=m();this.$node.classed("large",f===o.Large),this.$node.classed("medium",f===o.Medium),this.$node.classed("small",f===o.Small),this.$node.classed("xsmall",f===o.ExtraSmall);var g=s.toRepr(d,this.highlight,{thumbnails:this.options.thumbnails}),h=this.$node.select("div.states").selectAll("div.state").data(g,function(a){return""+a.s.id}),j=h.enter().append("div").classed("state",!0).attr("data-id",function(a){return a.s.id}).append("div").on("click",this.onStateClick.bind(this)).on("mouseenter",function(a){return d.selectState(a.s,e.SelectOperation.SET,e.hoverSelectionType)}).on("mouseleave",function(a){return d.selectState(a.s,e.SelectOperation.REMOVE,e.hoverSelectionType)}).attr("draggable",!0).on("dragstart",function(a){var b=i.event;b.dataTransfer.effectAllowed="copy",b.dataTransfer.setData("text/plain",a.s.name),b.dataTransfer.setData("application/caleydo-prov-state",String(a.s.id))}).on("dragenter",function(){return c.hasDnDType(i.event,"application/caleydo-prov-state")?(i.select(this).classed("hover",!0),!1):void 0}).on("dragover",function(){return c.hasDnDType(i.event,"application/caleydo-prov-state")?(i.event.preventDefault(),c.updateDropEffect(i.event),!1):void 0}).on("dragleave",function(){i.select(this).classed("hover",!1)}).on("drop",function(a){i.select(this).classed("hover",!1);var c=i.event;c.preventDefault();var d=b.data.getStateById(parseInt(c.dataTransfer.getData("application/caleydo-prov-state"),10));return b.data.fork(d.creator,a.s),!1}),k=j;k.append("i").attr("class","fa fa-circle glyph"),k.append("span").classed("icon",!0),k.append("span").classed("slabel",!0),k.append("div").classed("sthumbnail",!0);var l=j.append("div").classed("toolbar",!0);l.append("i").attr("class","fa bookmark fa-bookmark-o").on("click",function(a){var b=!a.s.getAttr("starred",!1);a.s.setAttr("starred",b),i.select(this).classed("fa-bookmark",b).classed("fa-bookmark-o",!b),i.event.stopPropagation(),i.event.preventDefault()}),l.append("i").attr("class","fa fa-edit").on("click",function(a){a.showDialog(),i.event.stopPropagation(),i.event.preventDefault()}),h.call(s.render),h.exit().remove();var n=[];g.forEach(function(a){n.push.apply(n,a.children.map(function(b){return{s:a,t:b}}))}),this.dim=[i.max(g,function(a){return a.xy[0]+a.size[0]})+(f>=o.Medium?200:0),i.max(g,function(a){return a.xy[1]+a.size[1]})],this.$node.select("svg").attr("width",this.dim[0]).attr("height",this.dim[1]);var p=this.$node.select("svg g.edges").selectAll("path").data(n,function(a){return a.s.s.id+"-"+a.t.s.id});p.enter().append("path"),p.transition().attr("d",function(b){return a.line([b.s,b.t])}),p.exit().remove(),this.updateStoryHighlight()},b.prototype.updateStoryHighlight=function(){var a=this.$node.select("svg g.storyhighlights"),b=this.$node.select("div.states").selectAll("div.state"),c=b.data(),d={};c.forEach(function(a){return d[a.s.id]=a});var e=this.data.selectedSlides()[0]||this.data.getSlideChains()[0];if(e){for(a.style("display",null);e.previous;)e=e.previous;var g=f.toSlidePath(e).map(function(a){return a.state?d[a.state.id]:null}).filter(function(a){return!!a});b.classed("story_member",function(a){return g.indexOf(a)>=0}),a.select("path").attr("d",this.line.interpolate("linear")(g)),this.line.interpolate("step-after")}else a.style("display","none")},b}(j.AVisInstance);b.LayoutedProvVis=t,b.create=n}(a,c,a("../caleydo_core/main"),a("jquery"),a("../caleydo_core/idtype"),a("../caleydo_provenance/main"),a("../caleydo_provenance/mode"),a("../wrapper_bootstrap_fontawesome/dialogs"),a("d3"),a("../caleydo_core/vis"),a("./utils"))},{"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_core/vis":28,"../caleydo_provenance/main":40,"../caleydo_provenance/mode":41,"../wrapper_bootstrap_fontawesome/dialogs":65,"./utils":63,d3:void 0,jquery:void 0}],61:[function(a,b,c){!function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){var b=h.time.format("%M:%S");return b(new Date(a))}function n(a,b){if(!a)return h.sum(b,function(a){return a.duration+a.transition});var c=b.indexOf(a);return b.slice(0,c).reduce(function(a,b){return a+b.duration+b.transition},a.transition)}function o(){var a=f.getMode();return a.presentation>=.8?r.Large:a.exploration>.3?r.None:a.authoring>=.8?r.Large:r.Medium}function p(){return o()>=r.Large}function q(a,b,c){return void 0===c&&(c={}),new s(a,b,c)}var r;!function(a){a[a.None=0]="None",a[a.Small=1]="Small",a[a.Medium=2]="Medium",a[a.Large=3]="Large"}(r||(r={}));var s=function(a){function b(d,g,i){var j=this;void 0===i&&(i={}),a.call(this),this.data=d,this.parent=g,this.trigger=c.bind(this.update,this),this.onSelectionChanged=function(a,b,c,d,f){j.$node.selectAll("div.story:not(.placeholder)").classed("select-"+c,function(a){var d=a===b;return d&&c===e.defaultSelectionType&&this.scrollIntoView(),d}),c===e.defaultSelectionType&&j.updateTimeIndicator(b,f.withTransition!==!1)},this.onStateSelectionChanged=function(a,b,c,d,g){if(b&&g.slideSelected!==!0){var h=f.getMode().exploration<.8?j.findSlideForState(b):null,i=j.data.selectedSlides(c);h&&i.indexOf(h)>=0||!h&&0===i.length||(c===e.defaultSelectionType?j.data.selectSlide(h,e.SelectOperation.SET,e.defaultSelectionType,{withTransition:!1}):j.data.selectSlide(h,e.SelectOperation.SET,c))}},this.options={scale:[1,1],rotate:0,"class":"vertical",xy:"y",wh:"height",topleft:"top",thumbnails:!0},this.duration2pixel=h.scale.linear().domain([0,1e4]).range([b.MIN_HEIGHT,200]),this.story=null,this.player=null,this.options=c.mixin(this.options,i),"horizontal"===this.options["class"]&&(this.options.xy="x",this.options.wh="width",this.options.topleft="left"),this.$node=this.build(h.select(g)),c.onDOMNodeRemoved(this.node,this.destroy,this),this.player=new l.Player(d,this.node.querySelector("#player_controls")),this.bind(),this.story=this.data.selectedSlides()[0]||this.data.getSlideChains()[0],this.update()}return __extends(b,a),b.prototype.findSlideForState=function(a){return this.story?c.search(d.toSlidePath(this.story),function(b){return b.state===a}):null},b.prototype.bind=function(){this.data.on("select_slide",this.onSelectionChanged),this.data.on("select_state",this.onStateSelectionChanged),this.data.on("start_slide,destroy_slide",this.trigger),f.on("modeChanged",this.trigger)},b.prototype.destroy=function(){a.prototype.destroy.call(this),this.data.off("select_slide",this.onSelectionChanged),this.data.off("select_state",this.onStateSelectionChanged),this.data.off("start_slide,destroy_slide",this.trigger),f.off("modeChanged",this.trigger)},Object.defineProperty(b.prototype,"rawSize",{get:function(){return[300,500]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),b.prototype.option=function(a,b){return 1===arguments.length?this.options[a]:(this.fire("option."+a,b,this.options[a]),void(this.options[a]=b))},b.prototype.locateImpl=function(a){return Promise.resolve(null)},b.prototype.transform=function(a,b){void 0===b&&(b=0);var c={scale:this.options.scale||[1,1],rotate:this.options.rotate||0};if(0===arguments.length)return c;var d=this.data.dim,e=20,f=d[0];this.$node.attr({width:e*a[0],height:f*a[1]}).style("transform","rotate("+b+"deg)");var g={scale:a,rotate:b};return this.fire("transform",g,c),this.options.scale=a,this.options.rotate=b,g},b.prototype.switchTo=function(a){if(a){for(var b=a;b.previous;)b=b.previous;this.story=b,this.data.selectSlide(a)}else this.story=null;this.update()},b.prototype.build=function(a){var b=a.append("aside").attr({"class":"provenance-story-vis "+this.options["class"]}).style("transform","rotate("+this.options.rotate+"deg)");b.html('\n      <div>\n        <h2><i class="fa fa-video-camera"></i> Story <i class="fa fa-plus-circle"></i></h2>\n        <form class="form-inline toolbar" style="display: none" onsubmit="return false;">\n        <div class="btn-group btn-group-xs" role="group">\n          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"\n                  aria-expanded="false">\n            Select<span class="caret"></span>\n          </button>\n          <ul class="dropdown-menu" id="story_list">\n            <!--<li><a href="#">A</a></li>-->\n          </ul>\n        </div>\n        <div class="btn-group btn-group-xs" data-toggle="buttons">\n          <button class="btn btn-default btn-xs" data-create="plus" title="create a new story"><i class="fa fa-plus"></i> New Story</button>\n          <button class="btn btn-default btn-xs" data-create="clone" title="create a new story by extracting the current path"><i class="fa fa-files-o"></i> Extract</button>\n          <button class="btn btn-default btn-xs" data-create="bookmark" title="create a new story by extracting all bookmarked ones"><i class="fa fa-bookmark"></i> Bookmarked</button>\n        </div>\n        </form>\n      </div>\n      <div class="stories '+this.options["class"]+'">\n        <div class="line"></div>\n        <div class="time_marker"><i class="fa fa-circle"></i></div>\n      </div>\n      <div><div id="player_controls">\n        <button data-player="backward" class="btn btn-xs btn-default fa fa-step-backward"\n                  title="Step Backward"></button>\n          <button data-player="play" class="btn btn-default btn fa fa-play" title="Play"></button>\n          <button data-player="forward" class="btn btn-xs btn-default fa fa-step-forward" title="Step Forward"></button>\n          </div>\n       </div>\n    ');var c=this;b.selectAll("button[data-create]").on("click",function(){var a,b=this.dataset.create;switch(b){case"plus":a=c.data.startNewSlide("Welcome");break;case"clone":var d=c.data.selectedStates()[0]||c.data.act;a=c.data.startNewSlide("My story to "+(d?d.name:"heaven"),d?d.path:[]);break;case"bookmark":var e=c.data.states.filter(function(a){return a.getAttr("starred",!1)});a=c.data.startNewSlide("My favorite findings",e)}return c.switchTo(a),!1});var d=$(b.node());return d.find(".dropdown-toggle").dropdown(),d.find("h2 i").on("click",function(){d.find("form.toolbar").toggle("fast")}),0===this.data.getSlideChains().length&&d.find("form.toolbar").toggle("fast"),b},b.prototype.pushAnnotation=function(a){var b=this.data.selectedSlides()[0];b&&b.pushAnnotation(a)},b.prototype.onSlideClick=function(a){this.data.selectSlide(a,e.SelectOperation.SET,e.defaultSelectionType,{withTransition:!1}),a&&a.state&&this.data.selectState(a.state,e.SelectOperation.SET,e.defaultSelectionType,{slideSelected:!0})},b.prototype.dndSupport=function(a){var b=this;a.on("dragenter",function(a){return c.hasDnDType(h.event,"application/caleydo-prov-state")||c.hasDnDType(h.event,"application/caleydo-prov-story")||c.hasDnDType(h.event,"application/caleydo-prov-story-text")?(h.select(this).classed("hover",!0),!1):void 0}).on("dragover",function(a){return c.hasDnDType(h.event,"application/caleydo-prov-state")||c.hasDnDType(h.event,"application/caleydo-prov-story")||c.hasDnDType(h.event,"application/caleydo-prov-story-text")?(h.event.preventDefault(),c.updateDropEffect(h.event),!1):void 0}).on("dragleave",function(a){h.select(this).classed("hover",!1)}).on("drop",function(a){h.select(this).classed("hover",!1);var e=h.event;e.preventDefault();var f=d.toSlidePath(b.story),g=a.isPlaceholder?a.to:a,i=function(a){if(null==g){var c=b.story;b.story=a,c&&b.data.insertIntoSlide(a,c,!0)}else b.data.insertIntoSlide(a,g,!1);b.update()};if(c.hasDnDType(e,"application/caleydo-prov-state")){var j=b.data.getStateById(parseInt(e.dataTransfer.getData("application/caleydo-prov-state"),10));i(b.data.wrapAsSlide(j))}else if(c.hasDnDType(e,"application/application/caleydo-prov-story-text"))i(b.data.makeTextSlide());else if(c.hasDnDType(e,"application/caleydo-prov-story")){var k=b.data.getSlideById(parseInt(e.dataTransfer.getData("application/caleydo-prov-story"),10));if(f.indexOf(k)>=0&&"copy"!==e.dataTransfer.dropEffect)if(null==g){if(k!==b.story){var l=b.story;b.story=k,b.data.moveSlide(k,l,!0),b.update()}}else{var m=g;m!==k&&(k===b.story&&(b.story=k.next),b.data.moveSlide(k,m,!1),b.update())}else i(b.data.cloneSingleSlideNode(k))}return!1})},b.prototype.changeDuration=function(a){var b=this;a.call(h.behavior.drag().origin(function(){return{x:0,y:0}}).on("drag",function(a,c){var e=h.event,f=h.select(this.parentElement),g=Math.max(b.duration2pixel.range()[0],b.duration2pixel(a.duration)+e[b.options.xy]);f.style(b.options.wh,g+"px");var i=b.duration2pixel.invert(g)-a.duration,j=b.$node.selectAll("div.story").filter(function(a){return!a.isPlaceholder}),k=d.toSlidePath(b.story);j.select("div.duration span").text(function(a){var b=k.indexOf(a);return m(n(a,k)+(b>c?i:0))}),b.$node.select("div.story.placeholder div.duration span").text(m(n(null,k)+i))}).on("dragend",function(a){var c=parseInt(h.select(this.parentElement).style(b.options.wh),10);a.duration=b.duration2pixel.invert(c)}))},b.prototype.changeTransition=function(a){var c=this;a.call(h.behavior.drag().origin(function(){return{x:0,y:0}}).on("drag",function(a,e){var f=h.event,g=h.select(this.parentElement),i=Math.max(0,c.duration2pixel(a.transition)-b.MIN_HEIGHT+f[c.options.xy]);g.style("margin-"+c.options.topleft,i+"px");var j=c.duration2pixel.invert(i+b.MIN_HEIGHT)-a.transition,k=c.$node.selectAll("div.story").filter(function(a){return!a.isPlaceholder}),l=d.toSlidePath(c.story);k.select("div.duration span").text(function(a){var b=l.indexOf(a);return m(n(a,l)+(b>=e?j:0))}),c.$node.select("div.story.placeholder div.duration span").text(m(n(null,l)+j))}).on("dragend",function(a){var d=parseInt(h.select(this.parentElement).style("margin-"+c.options.topleft),10);a.transition=c.duration2pixel.invert(d+b.MIN_HEIGHT)}))},b.prototype.storyInteraction=function(a){var b=this.data;a.attr("draggable",!0).on("dragstart",function(a){if(!p())return void h.event.preventDefault();var b=h.event;b.dataTransfer.effectAllowed="copyMove",b.dataTransfer.setData("text/plain",a.name),b.dataTransfer.setData("application/caleydo-prov-story",String(a.id))}).on("click",this.onSlideClick.bind(this)).on("mouseenter",function(a){null!=a.state&&b.selectState(a.state,e.SelectOperation.SET,e.hoverSelectionType),b.selectSlide(a,e.SelectOperation.SET,e.hoverSelectionType)}).on("mouseleave",function(a){null!=a.state&&b.selectState(a.state,e.SelectOperation.REMOVE,e.hoverSelectionType),b.selectSlide(a,e.SelectOperation.REMOVE,e.hoverSelectionType)})},b.prototype.createToolbar=function(a){var b=this,c=a.append("div").classed("toolbar",!0);c.append("i").attr("class","fa fa-edit").on("click",function(a){return h.event.stopPropagation(),h.event.preventDefault(),g.prompt(a.name,{title:"Edit name",placeholder:"Markdown supported...",multiline:!0}).then(function(c){a.name=c,b.update()}),!1}),c.append("i").attr("class","fa fa-copy").attr("title","clone slide").on("click",function(a){return h.event.stopPropagation(),h.event.preventDefault(),b.data.moveSlide(b.data.cloneSingleSlideNode(a),a,!1),b.update(),!1}),c.append("i").attr("class","fa fa-remove").attr("title","remove slide").on("click",function(a){return h.event.stopPropagation(),h.event.preventDefault(),a===b.story&&(b.story=b.story.next,null===b.story)?void b.data.removeFullSlide(a):(b.data.removeSlideNode(a),void b.update())})},b.prototype.createLastPlaceholder=function(a){var b=this;a.html('<div>\n       <button class="btn btn-default btn-xs" data-add="text" title="add text slide"><i class="fa fa-file-text-o"></i></button>\n       <button class="btn btn-default btn-xs" data-add="extract" title="add current state"><i class="fa fa-file-o"></i></button>\n       <button class="btn btn-default btn-xs" data-add="extract_all" title="add path to current state"><i class="fa fa-files-o"></i></button>\n       </div>\n       <div class="duration"><span>00:00</span><i class="fa fa-circle"></i></div>\n      '),a.selectAll("button[data-add]").on("click",function(){var a=this.dataset.add,c=d.toSlidePath(b.story),e=c[c.length-1];switch(a){case"text":e?b.data.moveSlide(b.data.makeTextSlide("Unnamed"),e,!1):b.story=b.data.startNewSlide("Welcome");break;case"extract":var f=b.data.selectedStates()[0]||b.data.act,g=b.data.extractSlide([f],!1);e?b.data.moveSlide(g,e,!1):b.story=g;break;case"extract_all":var h=b.data.selectedStates()[0]||b.data.act,i=b.data.extractSlide(h.path,!1);e?b.data.moveSlide(i,e,!1):b.story=i}b.update()})},b.prototype.updateSelection=function(){var a=this,b=this.data.getSlideChains(),c=this.$node.select(".dropdown-menu").selectAll("li").data(b);c.enter().insert("li").append("a").attr("href","#").on("click",function(b){a.switchTo(b),h.event.preventDefault()}),c.select("a").text(function(a){return a.name}),c.exit().remove()},b.prototype.update=function(){var a=this;this.updateSelection();var c=d.toSlidePath(this.story),e=c.length>0?[{id:"f-1",i:-1,isPlaceholder:!0,to:null}]:[];c.forEach(function(a,b){e.push(a)}),e.push({id:"l"+(c.length-1),i:c.length-1,isPlaceholder:!0,to:c[c.length-1],isLastPlaceholder:!0});var f=function(a){return String(a.id)},g=o();this.$node.classed("large",g===r.Large).classed("medium",g===r.Medium).classed("small",g===r.Small),this.$node.select("div.stories").classed("large",g===r.Large).classed("medium",g===r.Medium).classed("small",g===r.Small).classed("no-thumbnails",!this.options.thumbnails);var h=this.$node.select("div.stories").selectAll("div.story").data(e,f),i=h.enter().append("div").classed("story",!0),l=i.filter(function(a){return!a.isPlaceholder}),p=i.filter(function(a){return a.isPlaceholder}).classed("placeholder",!0);l.call(this.storyInteraction.bind(this)),l.append("div").classed("preview",!0),l.append("div").classed("slabel",!0),l.call(this.createToolbar.bind(this)),l.append("div").classed("duration",!0).html('<span></span><i class="fa fa-circle"></i>'),l.append("div").classed("dragger",!0).call(this.changeDuration.bind(this)).call(this.dndSupport.bind(this)),l.append("div").classed("dragger-transition",!0).call(this.changeTransition.bind(this)),p.call(this.dndSupport.bind(this));var q=p.filter(function(a){return a.isLastPlaceholder});q.call(this.createLastPlaceholder.bind(this)),h.order();var s=h.filter(function(a){return!a.isPlaceholder});s.classed("text",function(a){return a.isTextOnly}),s.attr("data-id",function(a){return a.id}),s.attr("title",function(a){return a.name+"\n"+(a.transition>0?"("+m(a.transition)+")":"")+"("+m(a.duration)+")"}),s.select("div.preview").style("background-image",g<r.Medium||!this.options.thumbnails?null:function(b){return b.isTextOnly?"url(../clue/assets/text.png)":"url("+j.thumbnail_url(a.data,b.state)+")"}),s.select("div.slabel").html(function(a){return a.name?k(a.name):""}),s.select("div.duration span").text(function(a,b){return""+m(n(a,c))}),s.style(this.options.wh,function(b){return a.duration2pixel(b.duration)+"px"}),s.style("margin-"+this.options.topleft,function(c){return a.duration2pixel(c.transition)-b.MIN_HEIGHT+"px"}),h.filter(function(a){return a.isLastPlaceholder}).select("div.duration span").text(m(n(null,c))),h.exit().remove()},b.prototype.updateTimeIndicator=function(a,b){var d=this.$node.select("div.time_marker");if(!a)return void d.style("display","none");var e=c.bounds(this.$node.node().querySelector('div.story[data-id="'+a.id+'"]')),f=c.bounds(this.$node.node().querySelector("div.stories")),g=d.transition().ease("linear").duration(a.transition<0||!b?l.MIN_TRANSITION:a.transition*l.FACTOR).style("top",e.y-f.y+"px");g.transition().ease("linear").duration(a.duration<0||!b?l.MIN_DURATION:a.duration*l.FACTOR).style("top",e.y-f.y+e.h-4+"px")},b.MIN_HEIGHT=20,b}(i.AVisInstance);b.VerticalStoryVis=s,b.create=q}(a,c,a("../caleydo_core/main"),a("../caleydo_provenance/main"),a("../caleydo_core/idtype"),a("../caleydo_provenance/mode"),a("../wrapper_bootstrap_fontawesome/dialogs"),a("d3"),a("../caleydo_core/vis"),a("./utils"),a("marked"),a("../caleydo_provenance/player"))},{"../caleydo_core/idtype":9,"../caleydo_core/main":13,"../caleydo_core/vis":28,"../caleydo_provenance/main":40,"../caleydo_provenance/mode":41,"../caleydo_provenance/player":43,"../wrapper_bootstrap_fontawesome/dialogs":65,"./utils":63,d3:void 0,marked:void 0}],62:[function(a,b,c){var d,e=a("text");e.load("./template.html",function(){},function(a){d=a});var f,g=a("css");g.load("./style",function(){},function(a){f=a}),function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(a,b){function c(a){d.hash.setProp("clue_graph",a.id),window.location.reload()}var e=d.hash.getProp("clue_graph",null);return b.select("#provenancegraph_new_remote").on("click",function(){i.event.preventDefault(),r.retrieve("logged_in")===!0&&(d.hash.removeProp("clue_slide",!1),d.hash.removeProp("clue_state",!1),d.hash.setProp("clue_graph","new_remote"),window.location.reload())}),b.select("#provenancegraph_new").on("click",function(){d.hash.removeProp("clue_slide",!1),d.hash.removeProp("clue_state",!1),d.hash.setProp("clue_graph","new"),window.location.reload(),i.event.preventDefault()}),i.selectAll("#provenancegraph_import, #provenancegraph_import_remote").on("click",function(){i.event.preventDefault(),i.event.stopPropagation();var b="provenancegraph_import_remote"===this.id,d=s.generateDialog("Select File","Upload");d.body.innerHTML='<input type="file" placeholder="Select File to Upoad">',i.select(d.body).select("input").on("change",function(){var d=i.event.target.files[0],e=new FileReader;e.onload=function(d){var e=d.target.result,f=JSON.parse(e);(b?a.importRemote(f):a.importLocal(f)).then(function(a){c(a.desc)})},e.readAsText(d)}),d.show()}),a.list().then(function(d){var f=b.select("#provenancegraph_list").selectAll("li.graph").data(d);f.enter().insert("li",":first-child").classed("graph",!0).html(function(a){return'<a href="#clue_graph='+a.id+'"><span class="glyphicon glyphicon-file"></span> '+a.name+" </a>"}).select("a").on("click",function(a){i.event.preventDefault(),c(a)});var g=i.time.format.utc("%Y-%m-%dT%H:%M");j("#provenancegraph_list li.graph a").popover({html:!0,placement:"left",trigger:"manual",title:function(){var a=i.select(this).datum();return""+a.name},content:function(){var b=i.select(this).datum(),d=b.creator,e=b.description||"",f=b.ts?g(new Date(b.ts)):"Unknown",h=b.size[0],k=b.size[1],l=j('\n            <div class="container-fluid">\n            <div class="row">\n                <div class="col-sm-3">creator:</div>\n                <div class="col-sm-9">'+d+'</div>\n            </div>\n            <div class="row">\n                <div class="col-sm-3">created:</div>\n                <div class="col-sm-9">'+f+'</div>\n            </div>\n            <div class="row">\n                <div class="col-sm-3">description:</div>\n                <div class="col-sm-9">'+e+'</div>\n            </div>\n            <div class="row">\n                <div class="col-sm-3">nodes/edges:</div>\n                <div class="col-sm-9">'+h+"/"+k+'</div>\n            </div>\n            <div class="row">\n                <div class="col-sm-12 text-right">\n                    <button class="btn btn-primary" '+(r.retrieve("logged_in",!1)===!0||b.local?"":'disabled="disabled"')+' data-action="select" data-toggle="modal" ><span class="fa fa-open"></span> Select</button>\n                    <button class="btn btn-primary" data-action="clone" data-toggle="modal"><span class="fa fa-clone"></span> Clone</button>\n                    <button class="btn btn-danger" '+(r.retrieve("logged_in",!1)===!0||b.local?"":'disabled="disabled"')+' data-toggle="modal"><span class="glyphicon glyphicon-remove"></span> Delete</button>\n                </div>\n            </div>\n        </div>');return l.find("button.btn-danger").on("click",function(){s.areyousure('Are you sure to delete: "'+b.name+'"').then(function(c){c&&a["delete"](b)})}),l.find("button.btn-primary").on("click",function(){var d="select"===this.dataset.action;return d?c(b):a.cloneLocal(b).then(function(a){return c(a.desc)}),!1}),l}}).parent().on({mouseenter:function(){j(this).find("a").popover("show")},mouseleave:function(){j(this).find("a").popover("hide")}});var h=r.retrieve("logged_in",!1)===!0;if("new_remote"===e&&h)return a.createRemote();if(null===e||"new"===e)return a.createLocal();var k=d.filter(function(a){return a.id===e})[0];return k?k.local||h?a.get(k):a.cloneLocal(k):a.create()}).then(function(a){return d.hash.setProp("clue_graph",a.desc.id),b.select("#provenancegraph_name").text(a.desc.name),a})}function u(a){var b=window;b.__caleydo=b.__caleydo||{},b.__caleydo.clue=a,a.on("jumped_to",function(){setTimeout(function(){document.body.classList.add("clue_jumped"),prompt("clue_done_magic_key","test")},5e3)})}function v(a,b){return void 0===b&&(b={}),new w(a,b)}var w=function(a){function b(b,o){var q=this;void 0===o&&(o={}),a.call(this),this.options={app:"CLUE",application:"/clue",id:"clue",recordSelectionTypes:"selected",animatedSelections:!1,
thumbnails:!0};var r=this;d.mixin(this.options,o),b.innerHTML=c,d.hash.is("clue_headless")&&(console.log("init headless mode"),u(this),i.select("body").classed("headless",!0)),this.manager=new h.MixedStorageProvenanceGraphManager({prefix:this.options.id,storage:sessionStorage,application:this.options.application}),this.header=e.create(b.querySelector("div.box"),{app:this.options.app,inverse:!1}),this.header.wait(),this.createLogin();var v=document.createElement("ul"),w=i.select(v).attr("class","nav navbar-nav navbar-right").html('\n      <li class="dropdown">\n            <a class="active" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"\n               aria-expanded="false"><i class="fa fa-code-fork fa-lg fa-rotate-180"></i></a>\n            <ul class="dropdown-menu" id="provenancegraph_list">\n                <li role="separator" class="divider"></li>\n                <li><a href="#" id="provenancegraph_import"><span class="glyphicon glyphicon-import"></span> Import ...</a></li>\n                <li><a href="#" class="login_required disabled" disabled="disabled" id="provenancegraph_import_remote"><span class="glyphicon glyphicon-import"></span> Import Remote ...</a></li>\n                <li><a href="#" id="provenancegraph_export"><span class="glyphicon glyphicon-export"></span> Export ...</a></li>\n                <li role="separator" class="divider"></li>\n                <li><a href="#" id="provenancegraph_new"><span class="glyphicon glyphicon-upload"></span> New ...</a></li>\n                <li><a href="#" class="login_required disabled" disabled="disabled" id="provenancegraph_new_remote"><span class="glyphicon glyphicon-upload"></span> New Remote...</a></li>\n            </ul>\n        </li>');this.header.insertCustomRightMenu(v),i.select("#provenancegraph_export").on("click",function(){return i.event.preventDefault(),i.event.stopPropagation(),q.graph.then(function(a){console.log(a);var b=a.persist();console.log(b);var c=JSON.stringify(b,null,"	"),d=new Blob([c],{type:"application/json;charset=utf-8"}),e=new FileReader;e.onload=function(a){return window.open(a.target.result,"_blank")},e.readAsDataURL(d)}),!1}),i.select(this.header.options).append("button").text("Show").attr("class","btn btn-default").on("click",function(){return q.graph.then(function(a){return f.create({id:a.desc.id,name:a.desc.name,fqname:a.desc.fqname,type:"graph",storage:"given",graph:a.backend})}).then(function(a){var b=g.list(a);b.length<=0||b[0].load().then(function(b){var c=s.generateDialog("Provenance Graph");b.factory(a,c.body),c.show()})}),!1}),this.graph=t(this.manager,w),l.createButton(b.querySelector("header"),{size:"sm"}),this.$main=i.select(b).select("main"),this.graph.then(function(a){a.on("sync_start,sync",function(a){i.select("nav span.glyphicon-cog").classed("fa-spin","sync"!==a.type)}),k.create(a,q.options.recordSelectionTypes,{filter:function(a){return a&&"_"!==a.name[0]},animated:q.options.animatedSelections}),q.$main_ref=a.findOrAddObject(q.$main,"Application","visual");var c=p.create(q.$main.node(),a);m.create(a,b.querySelector("div.content"),{thumbnails:q.options.thumbnails}),q.storyvis=n.create(a,b.querySelector("div.content"),{render:c.render,thumbnails:q.options.thumbnails}),a.on("select_slide_selected",function(a,b){i.select("aside.annotations").style("display",b?null:"none")}),i.select("aside.annotations > div:first-of-type").call(i.behavior.drag().on("drag",function(){var a=i.mouse(this.parentElement.parentElement);i.select(this.parentElement).style({left:a[0]+"px",top:a[1]+"px"})})),i.selectAll("aside.annotations button[data-ann]").on("click",function(){var a,b=this.dataset.ann;switch(b){case"text":a={type:"text",pos:[10,10],text:""};break;case"arrow":a={type:"arrow",pos:[10,10],at:[200,200]};break;case"frame":a={type:"frame",pos:[10,10],size:[20,20]}}r.storyvis&&a&&r.storyvis.pushAnnotation(a)}),a.on("switch_state",function(a,b){b?d.hash.setInt("clue_state",b.id):d.hash.removeProp("clue_state")}),a.on("select_slide_selected",function(a,b){b?d.hash.setInt("clue_slide",b.id):d.hash.removeProp("clue_slide")});var e=j("aside.provenance-layout-vis"),f=j(q.storyvis.node);q.propagate(l,"modeChanged");var g=function(a){j("body").attr("data-clue",a.toString()),a.presentation>.8?e.animate({width:"hide"},"fast"):e.animate({width:"show"},"fast"),a.exploration>.8?f.animate({width:"hide"},"fast"):f.animate({width:"show"},"fast")};l.on("modeChanged",function(a,b){return g(b)}),q.fire("modeChanged",l.getMode()),g(l.getMode()),i.select("#bookmarkState").on("click",function(){a.act.setAttr("starred",!0)}),i.select("#attachNote form").on("submit",function(){var b=i.select("#attachNote_note").property("value");a.act.setAttr("note",b),j("#attachNote").modal("hide"),document.querySelector("#attachNote form").reset(),i.event.preventDefault(),i.event.stopPropagation()}),i.select("#undoStep").on("click",function(){a.undo()}),i.select(document).on("keydown.player",function(){var b=i.event;90===b.keyCode&&b.ctrlKey?(b.preventDefault(),a.undo()):37===b.keyCode&&b.ctrlKey?l.setMode(l.modes.Exploration):38!==b.keyCode&&40!==b.keyCode||!b.ctrlKey?39===b.keyCode&&b.ctrlKey&&l.setMode(l.modes.Presentation):l.setMode(l.modes.Authoring)}),q.fire("loaded_graph",a),q.header.ready()})}return __extends(b,a),b.prototype.createLogin=function(){var a=document.createElement("ul");a.classList.add("nav","navbar-nav","navbar-right"),a.innerHTML='\n      <li id="login_menu"><a data-toggle="modal" data-target="#loginDialog" href="#"><span class="glyphicon glyphicon-user"></span></a></li>\n        <li style="display: none" class="dropdown" id="user_menu">\n            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"\n               aria-expanded="false"><span class="glyphicon glyphicon-user"></span> Unknown</a>\n            <ul class="dropdown-menu">\n                <li role="separator" class="divider"></li>\n                <li><a href="#" id="logout_link">Logout</a></li>\n            </ul>\n        </li>',this.header.insertCustomRightMenu(a);var b=this;j("#loginDialog div.modal-body").load("../caleydo_security_flask/_login_form.html",function(){var a=j(this).find("form"),c=a.parent().find("div.alert");c.hide(),q.bindLoginForm(a[0],function(d,e){j("#login_menu").hide();var f=j("#user_menu").show();r.store("logged_in",!d),d?(b.header.ready(),a.addClass("has-error"),c.html(d).show()):(r.store("username",e.name),r.store("user",e),a.removeClass("has-error"),f.find("> a:first").text(e.name),j("#loginDialog").modal("hide"),j(".login_required.disabled").removeClass("disabled").attr("disabled",null))})}),j("#logout_link").on("click",function(){this.header.wait(),q.logout().then(function(){r.store("logged_in",!1),j("#user_menu").hide(),j("#login_menu").show(),j(".login_required").addClass("disabled")})})},b.prototype.jumpToStory=function(a){var b=this;return console.log("jump to stored story",a),this.graph.then(function(c){var e=c.getSlideById(a);if(e){console.log("jump to stored story",e.id),b.storyvis.switchTo(e);var f;return d.hash.is("clue_autoplay")?(b.storyvis.player.start(),f=Promise.resolve()):f=b.storyvis.player.render(e),f.then(function(){return b.fire("jumped_to",e),b.header.ready(),b})}return b.fire("jumped_to",null),b.header.ready(),Promise.reject("story not found")})},b.prototype.jumpToState=function(a){var b=this;return console.log("jump to stored state",a),this.graph.then(function(c){var d=c.getStateById(a);return d?(console.log("jump to stored",d.id),c.jumpTo(d).then(function(){return console.log("jumped to stored",d.id),b.fire("jumped_to",d),b.header.ready(),b})):(b.fire("jumped_to",null),b.header.ready(),Promise.reject("state not found"))})},b.prototype.jumpToStored=function(){var a=d.hash.getInt("clue_slide",null);if(null!==a)return this.jumpToStory(a);var b=d.hash.getInt("clue_state",null);return null!==b?this.jumpToState(b):(this.fire("jumped_to",null),this.header.ready(),Promise.resolve(this))},b.prototype.reset=function(){var a=this;this.graph.then(function(b){b.jumpTo(b.states[0]).then(function(){b.clear(),a.$main_ref=b.findOrAddObject(a.$main,"Application","visual"),l.setMode(l.modes.Exploration)})})},b}(o.EventHandler);b.CLUEWrapper=w,b.create=v}(a,c,d,a("../caleydo_core/main"),a("../wrapper_bootstrap_fontawesome/header"),a("../caleydo_core/data"),a("../caleydo_core/vis"),a("../caleydo_provenance/main"),a("d3"),a("jquery"),a("../caleydo_provenance/selection"),a("../caleydo_provenance/mode"),a("./provvis2"),a("./storyvis2"),a("../caleydo_core/event"),a("./annotation"),a("../caleydo_security_flask/login"),a("../caleydo_core/session"),a("../wrapper_bootstrap_fontawesome/dialogs"),a("font-awesome"),a("bootstrap"),f)},{"../caleydo_core/data":5,"../caleydo_core/event":7,"../caleydo_core/main":13,"../caleydo_core/session":21,"../caleydo_core/vis":28,"../caleydo_provenance/main":40,"../caleydo_provenance/mode":41,"../caleydo_provenance/selection":44,"../caleydo_security_flask/login":46,"../wrapper_bootstrap_fontawesome/dialogs":65,"../wrapper_bootstrap_fontawesome/header":66,"./annotation":59,"./provvis2":60,"./storyvis2":61,bootstrap:void 0,css:void 0,d3:void 0,"font-awesome":void 0,jquery:void 0,text:void 0}],63:[function(a,b,c){!function(a,b,c,d){function e(a,b,e){void 0===e&&(e={});var f={width:128,format:"jpg"};if(c.mixin(f,e),b.hasAttr("thumbnail"))return b.getAttr("thumbnail");var g=a.desc;return g.attrs&&g.attrs.of&&!g.local?d.api2absURL("/clue/thumbnail"+g.attrs.of+"/"+a.desc.id+"/"+b.id+"."+f.format,{width:f.width}):"../clue/assets/not_available.png"}function f(a,b,c){void 0===c&&(c={});var e={width:128,format:"jpg"};if(b.hasAttr("thumbnail"))return b.getAttr("thumbnail");var f=a.desc;return f.attrs&&f.attrs.of&&!f.local?d.api2absURL("/clue/preview_thumbnail"+f.attrs.of+"/"+a.desc.id+"/"+b.id+"."+e.format,{width:e.width}):"../clue/assets/not_available.png"}function g(a,b,c){void 0===c&&(c={});var e={width:128,format:"jpg"};if(b.hasAttr("screenshot"))return b.getAttr("screenshot");var f=a.desc;return f.attrs&&f.attrs.of&&!f.local?d.api2absURL("screnshot"+f.attrs.of+"/"+a.desc.id+"/"+b.id+"."+e.format,{width:e.width}):"../clue/assets/not_available.png"}function h(a){var b=a.desc;return b.attrs&&b.attrs.of&&!b.local}b.thumbnail_url=e,b.preview_thumbnail_url=f,b.screenshot_url=g,b.areThumbnailsAvailable=h}(a,c,a("../caleydo_core/main"),a("../caleydo_core/ajax"))},{"../caleydo_core/ajax":3,"../caleydo_core/main":13}],64:[function(a,b,c){!function(a,b,c){"use strict";function d(a){var b=Promise.resolve(a);return b}function e(){return new f}var f=function(){function a(){}return a.prototype.send=function(a,b,e,f){void 0===b&&(b={}),void 0===e&&(e="get"),void 0===f&&(f="json");var g={url:a,data:b,method:e,dataType:f,cache:"get"===e};return b instanceof FormData&&(g.contentType=!1,g.processData=!1),d(c.ajax(g))},a}();b.create=e}(a,c,a("jquery"))},{jquery:void 0}],65:[function(a,b,c){!function(a,b,c,d){function e(a,b){void 0===b&&(b="OK");var d=document.createElement("div");d.setAttribute("role","dialog"),d.classList.add("modal","fade"),d.innerHTML='\n     <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span class="glyphicon glyphicon-remove-sign" title="Close"></span></button>\n          <h4 class="modal-title">'+a+'</h4>\n        </div>\n        <div class="modal-body">\n\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-default" data-dismiss="modal">'+b+"</button>\n        </div>\n      </div>\n    </div>",document.body.appendChild(d);var e=c(d);return{show:function(){return e.modal("show")},hide:function(){return e.modal("hide")},body:d.querySelector(".modal-body"),footer:d.querySelector(".modal-footer"),onHide:function(a){return e.on("hidden.bs.modal",a)},destroy:function(){return e.remove()}}}function f(a,b){return void 0===b&&(b="info"),new Promise(function(d){var e=c('<div class="alert alert-'+b+' alert-dismissible fade in" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span class="glyphicon glyphicon-remove-sign" title="Close"></span></button>\n        '+a+"\n    </div>").appendTo("body");e.on("closed.bs.alert",d),e.alert()})}function g(a,b){void 0===b&&(b={});var c={title:"Input",placeholder:"Enter...",multiline:!1};return"string"==typeof b&&(b={title:b}),d.mixin(c,b),new Promise(function(b){var d=e(c.title);c.multiline?d.body.innerHTML='<form><textarea class="form-control" rows="5" placeholder="'+c.placeholder+'" autofocus="autofocus">'+a+"</textarea></form>":d.body.innerHTML='<form><input type="text" class="form-control" value="'+a+'" autofocus="autofocus" placeholder="'+c.placeholder+'"></form>',d.body.querySelector("form").onsubmit=function(){return d.hide(),!1},d.onHide(function(){b(d.body.querySelector("input, textarea").value),d.destroy()}),d.show()})}function h(a,b){void 0===b&&(b={});var c={title:"Choose",placeholder:"Enter...",editable:!1};return"string"==typeof b&&(b={title:b}),d.mixin(c,b),new Promise(function(d){var f=e(c.title),g=a.map(function(a){return'<option value="'+a+'">'+a+"</option>"}).join("\n");c.editable?f.body.innerHTML='<form><input type="text" list="chooseList" class="form-control" autofocus="autofocus" placeholder="'+c.placeholder+'">\n        <datalist id="chooseList">'+g+"</datalist>\n      </form>":f.body.innerHTML='<form><select class="form-control">'+g+"</select></form>",f.body.querySelector("form").onsubmit=function(){return f.hide(),!1},f.onHide(function(){d(b.editable?f.body.querySelector("input").value:a[f.body.querySelector("select").selectedIndex]),f.destroy()}),f.show()})}function i(a,b){void 0===b&&(b={});var f={title:"Are you sure?",button:'<span class="glyphicon glyphicon-remove"></span> Delete'};return"string"==typeof b&&(b={title:b}),d.mixin(f,b),new Promise(function(b){var d=e(f.title,"Cancel");d.body.innerHTML=a,c('<button class="btn btn-danger"><span class="glyphicon glyphicon-remove"></span> Delete</button>').appendTo(d.footer);var g=!1;c(d.footer).find("button.btn-danger").on("click",function(){g=!0,d.hide()}),d.onHide(function(){d.destroy(),b(g)}),d.show()})}b.generateDialog=e,b.msg=f,b.prompt=g,b.choose=h,b.areyousure=i}(a,c,a("jquery"),a("../caleydo_core/main"),a("bootstrap"))},{"../caleydo_core/main":13,bootstrap:void 0,jquery:void 0}],66:[function(a,b,c){var d,e=a("text");e.load("./header.html",function(){},function(a){d=a});var f,g=a("css");g.load("./style.css",function(){},function(a){f=a}),function(a,b,c,d,e){function f(a,b,c){void 0===c&&(c="#");var d=document.createElement("li");return d.innerHTML='<a href="'+c+'">'+a+"</a>",b&&(d.querySelector("a").onclick=b),d}function g(a,b){return void 0===b&&(b={}),new h(a,b)}var h=function(){function a(a,b){var e=this;void 0===b&&(b={}),this.parent=a,this._options={prepend:!0,app:"Caleydo Web",addLogo:!0,mainMenu:new Array,rightMenu:new Array,inverse:!0},d.mixin(this._options,b);var f=document.createElement("div");f.innerHTML=c;var g=a.firstChild;if(this._options.prepend&&g)for(;f.firstChild;)a.insertBefore(f.firstChild,g);else for(;f.firstChild;)a.appendChild(f.firstChild);this._options.inverse&&document.querySelector("nav.navbar").classList.add("navbar-inverse");var h=a.querySelector('*[data-header="app"]');h.innerHTML=this._options.app,this._options.addLogo&&h.classList.add("caleydo_app"),this.mainMenu=a.querySelector('*[data-header="main"]'),this.rightMenu=a.querySelector('*[data-header="rightmenu"]'),this.about=a.querySelector('*[data-header="about"]'),this.options=a.querySelector('*[data-header="options"]'),this._options.mainMenu.forEach(function(a){return e.addMainMenu(a.name,a.action,a.href)}),this._options.rightMenu.forEach(function(a){return e.addRightMenu(a.name,a.action,a.href)})}return a.prototype.addMainMenu=function(a,b,c){void 0===c&&(c="#");var d=f(a,b,c);return this.mainMenu.appendChild(d),d},a.prototype.insertCustomMenu=function(a){this.rightMenu.parentElement.insertBefore(a,this.rightMenu)},a.prototype.insertCustomRightMenu=function(a){this.rightMenu.parentElement.appendChild(a)},a.prototype.addRightMenu=function(a,b,c){void 0===c&&(c="#");var d=f(a,b,c);return this.rightMenu.insertBefore(d,this.rightMenu.firstChild),d},a.prototype.wait=function(){e("#headerWaitingOverlay").fadeIn()},a.prototype.ready=function(){e("#headerWaitingOverlay").fadeOut()},a}();b.AppHeader=h,b.create=g}(a,c,d,a("../caleydo_core/main"),a("jquery"),a("bootstrap"),f)},{"../caleydo_core/main":13,bootstrap:void 0,css:void 0,jquery:void 0,text:void 0}]},{},[1])});